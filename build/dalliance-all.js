(function e$$0(s,r,p){function m(k,y){if(!r[k]){if(!s[k]){var E="function"==typeof require&&require;if(!y&&E)return E(k,!0);if(h)return h(k,!0);throw Error("Cannot find module '"+k+"'");}E=r[k]={exports:{}};s[k][0].call(E.exports,function(a){var c=s[k][1][a];return m(c?c:a)},E,E.exports,e$$0,s,r,p)}return r[k].exports}for(var h="function"==typeof require&&require,k=0;k<p.length;k++)m(p[k]);return m})({1:[function(e,s,r){function p(){}function m(b,n,f,x,I){function t(d){if(!d)return x(null,"Couldn't access BAM");
d=c(d,d.byteLength);d=new Uint8Array(d);var a=k(d,0);if(a!=g)return x(null,"Not a BAM file, magic=0x"+a.toString(16));for(var b=k(d,4),n="",a=0;a<b;++a)n+=String.fromCharCode(d[a+8]);n=k(d,b+8);b+=12;B.chrToIndex={};B.indexToChr=[];for(a=0;a<n;++a){for(var f=k(d,b),z="",H=0;H<f-1;++H)z+=String.fromCharCode(d[b+4+H]);k(d,b+f+4);B.chrToIndex[z]=a;0==z.indexOf("chr")?B.chrToIndex[z.substring(3)]=a:B.chrToIndex["chr"+z]=a;B.indexToChr.push(z);b=b+8+f}if(B.indices)return x(B)}var B=new p;B.data=b;B.bai=
n;B.indexChunks=f;var C=B.indexChunks?B.indexChunks.minBlockIndex:1E9;if(B.indexChunks){n=B.indexChunks.chunks;B.indices=[];for(var J=0;J<n.length;J++)B.indices[J]=null;B.data.slice(0,C).fetch(t)}else B.bai.fetch(function(d){var w,c,n;if(d){var g=new Uint8Array(d),z=k(g,0);if(z!=q)d=x(null,"Not a BAI file, magic=0x"+z.toString(16));else{z=k(g,4);B.indices=[];for(var H=8,F=0;F<z;++F){var l=H;w=g;var L=n=l;c=k(w,L);for(var L=L+4,M=0;M<c;++M){k(w,L);var O=k(w,L+4),L=L+(8+16*O)}for(var M=k(w,L),L=L+4,
O=1E9,J=L,N=0;N<M;++N){var h=a(w,J),J=J+8;if(h){w=h.block;0<h.offset&&(w+=65536);w<O&&(O=w);break}}L+=8*M;w=O;n=L-n;H+=n;C=Math.min(w,C);0<c&&(B.indices[F]=new Uint8Array(d,l,H-l))}d=!0}}else d="Couldn't access BAI";!0!==d?B.bai.url&&"undefined"===typeof I?(B.bai.url=B.data.url.replace(/.bam$/,".bai"),m(b,B.bai,f,x,!0)):x(null,d):B.data.slice(0,C).fetch(t,{timeout:5E3})},{timeout:5E3})}function h(){}if("undefined"!==typeof e){e("./spans");r=e("./bin");var k=r.readInt,v=r.readShort,y=r.readByte,E=
r.readFloat;e=e("./lh3utils");var a=e.readVob,c=e.unbgzf,b=e.reg2bins,f=e.Chunk}var g=21840194,q=21578050;e={MULTIPLE_SEGMENTS:1,ALL_SEGMENTS_ALIGN:2,SEGMENT_UNMAPPED:4,NEXT_SEGMENT_UNMAPPED:8,REVERSE_COMPLEMENT:16,NEXT_REVERSE_COMPLEMENT:32,FIRST_SEGMENT:64,LAST_SEGMENT:128,SECONDARY_ALIGNMENT:256,QC_FAIL:512,DUPLICATE:1024,SUPPLEMENTARY:2048};p.prototype.blocksForRange=function(c,n,q){var g=this.indices[c];if(!g)return[];c=b(n,q);for(var x=[],t=0;t<c.length;++t)x[c[t]]=!0;c=[];for(var h=[],t=k(g,
0),C=4,J=0;J<t;++J){var d=k(g,C),w=k(g,C+4),C=C+8;if(x[d])for(var G=0;G<w;++G){var P=a(g,C),D=a(g,C+8);(4681>d?h:c).push(new f(P,D));C+=16}else C+=16*w}t=k(g,C);x=null;n=Math.min(n>>14,t-1);q=Math.min(q>>14,t-1);for(t=n;t<=q;++t)(n=a(g,C+4+8*t))&&(!x||n.block<x.block||n.offset<x.offset)&&(x=n);g=[];if(null!=x)for(t=0;t<h.length;++t)q=h[t],q.maxv.block>=x.block&&q.maxv.offset>=x.offset&&g.push(q);h=g;g=[];for(t=0;t<h.length;++t)g.push(h[t]);for(t=0;t<c.length;++t)g.push(c[t]);g.sort(function(d,a){var F=
d.minv.block-a.minv.block;return 0!=F?F:d.minv.offset-a.minv.offset});c=[];if(0<g.length){h=g[0];for(t=1;t<g.length;++t)q=g[t],q.minv.block==h.maxv.block?h=new f(h.minv,q.maxv):(c.push(h),h=q);c.push(h)}return c};p.prototype.fetch=function(a,b,n,f,q){function g(){if(G>=J.length)return f(w);if(P){var d=new Uint8Array(P),d=x.readBamRecords(d,J[G].minv.offset,w,b,n,C,q);P=null;++G;return d?f(w):g()}var z=J[G],d=z.minv.block;x.data.slice(d,z.maxv.block+65536-d).fetch(function(d){P=c(d,z.maxv.block-z.minv.block+
1);return g()})}var x=this;q=q||{};var C=this.chrToIndex[a],J;if(void 0===C)J=[];else{if(null===this.indices[C]&&this.indexChunks.chunks[C]){var d=this.indexChunks.chunks[C];return this.bai.slice(d[0],d[1]).fetch(function(d){d=new Uint8Array(d);this.indices[C]=d;return this.fetch(a,b,n,f,q)}.bind(this))}(J=this.blocksForRange(C,b,n))||f(null,"Error in index fetch")}var w=[],G=0,P;g()};var n="=ACxGxxxTxxxxxxN".split(""),x="MIDNSHP=X???????".split("");p.prototype.readBamRecords=function(a,b,c,f,q,g,
e){for(;;){var C=k(a,b),C=b+C+4;if(C>=a.length)return!1;var J=new h,d=k(a,b+4),w=k(a,b+8),G=k(a,b+12),P=(G&65280)>>8,D=G&255,G=k(a,b+16),z=(G&4294901760)>>16,H=G&65535,G=k(a,b+20),F=k(a,b+24),l=k(a,b+28);k(a,b+32);J.segment=this.indexToChr[d];J.flag=z;J.pos=w;J.mq=P;e.light&&(J.seqLength=G);if(!e.light){0<=F&&(J.nextSegment=this.indexToChr[F],J.nextPos=l);P="";for(w=0;w<D-1;++w)P+=String.fromCharCode(a[b+36+w]);J.readName=P;b=b+36+D;D="";for(w=0;w<H;++w)P=k(a,b),D=D+(P>>4)+x[P&15],b+=4;J.cigar=D;
H="";D=G+1>>1;for(w=0;w<D;++w)P=a[b+w],H+=n[(P&240)>>4],H.length<G&&(H+=n[P&15]);b+=D;J.seq=H;H="";for(w=0;w<G;++w)H+=String.fromCharCode(a[b+w]+33);b+=G;for(J.quals=H;b<C;){H=String.fromCharCode(a[b],a[b+1]);D=String.fromCharCode(a[b+2]);if("A"==D)D=String.fromCharCode(a[b+3]),b+=4;else if("i"==D||"I"==D)D=k(a,b+3),b+=7;else if("c"==D||"C"==D)D=a[b+3],b+=4;else if("s"==D||"S"==D)D=v(a,b+3),b+=5;else if("f"==D)D=E(a,b+3),b+=7;else if("Z"==D||"H"==D)for(b+=3,D="";w=a[b++],0!=w;)D+=String.fromCharCode(w);
else if("B"==D){D=String.fromCharCode(a[b+3]);w=k(a,b+4);if("i"==D||"I"==D||"f"==D)P=4,z="f"==D?E:k;else if("s"==D||"S"==D)P=2,z=v;else if("c"==D||"C"==D)P=1,z=y;else throw"Unknown array type "+D;b+=8;D=[];for(F=0;F<w;++F)D.push(z(a,b)),b+=P}else throw"Unknown type "+D;J[H]=D}}if(!f||J.pos<=q&&J.pos+G>=f)void 0!==g&&d!=g||c.push(J);if(J.pos>q)return!0;b=C}};"undefined"!==typeof s&&(s.exports={makeBam:m,BAM_MAGIC:g,BAI_MAGIC:q,BamFlags:e})},{"./bin":4,"./lh3utils":24,"./spans":36}],2:[function(e,s,
r){function p(a){this.type=a}function m(a,b){this.parser=a;this.sink=b}function h(a,b){this.parser=a;this.sink=b;this.wigState=null}if("undefined"!==typeof e){var k=e("./spans"),v=k.Range,y=k.union,E=k.intersection,k=e("./sourceadapters").registerParserFactory;s=e("./das");var a=s.DASStylesheet,c=s.DASStyle,b=s.DASGroup,f=e("./utils").shallowCopy}p.prototype.createSession=function(a){return"wig"==this.type?new h(this,a):new m(this,a)};var g=/([^=]+)=(.+)/,q=/\s/,n=/^[0-9]+,[0-9]+,[0-9]+/;m.prototype.parse=
function(a){var c=a.split(q);if(!(3>c.length)){var g=parseInt(c[1])+1;a=parseInt(c[2]);a={segment:c[0],min:g,max:a};3<c.length&&"."!==c[3]&&(a.label=c[3]);4<c.length&&(a.score=parseFloat(c[4]));5<c.length&&(a.orientation=c[5]);if(8<c.length){var A=c[8];n.test(A)&&(a.itemRgb="rgb("+A+")")}if(12<=c.length){var A=parseInt(c[6]),u=parseInt(c[7]),h=parseInt(c[9]),t=c[10].split(",").map(function(d){return parseInt(d)}),k=c[11].split(",").map(function(d){return parseInt(d)});a.type="transcript";var C=new b;
C.id=c[3];C.type="transcript";C.notes=[];a.groups=[C];if(12<c.length){var J=C=c[12];13<c.length&&(J=c[13]);c=new b;c.id=C;c.label=J;c.type="gene";a.groups.push(c)}c=null;for(C=0;C<h;++C)J=k[C]+g,J=new v(J,J+t[C]),c=c?y(c,J):J;k=c.ranges();for(g=0;g<k.length;++g)t=k[g],h=f(a),h.min=t.min(),h.max=t.max(),this.sink(h);if(u>A&&(A="+"==a.orientation?new v(A,u+3):new v(A-3,u),A=E(c,A)))for(a.type="translation",A=A.ranges(),g=u=0;g<A.length;++g)h=g,"-"==a.orientation&&(h=A.length-g-1),t=A[h],h=f(a),h.min=
t.min(),h.max=t.max(),a.readframe=u,t=t.max()-t.min(),u=(u+t)%3,this.sink(h)}else this.sink(a)}};m.prototype.flush=function(){};h.prototype.parse=function(a){a=a.split(q);if("fixedStep"==a[0]){this.wigState="fixedStep";this.chr=this.pos=this.step=null;for(var b=this.span=1;b<a.length;++b){var c=g.exec(a[b]);c&&("chrom"==c[1]?this.chr=c[2]:"start"==c[1]?this.pos=parseInt(c[2]):"step"==c[1]?this.step=parseInt(c[2]):"span"==c[1]&&(this.span=parseInt(c[2])))}}else if("variableStep"==a[0])for(this.wigState=
"variableStep",this.chr=null,b=this.span=1;b<a.length;++b)c=g.exec(a[b]),"chrom"==c[1]?this.chr=c[2]:"span"==c[1]&&(this.span=parseInt(c[2]));else this.wigState?"fixedStep"==this.wigState?1==a.length&&(a=parseFloat(a[0]),a={segment:this.chr,min:this.pos,max:this.pos+this.span-1,score:a},this.pos+=this.step,this.sink(a)):"variableStep"==this.wigState&&2==a.length&&(b=parseInt(a[0]),a=parseFloat(a[1]),a={segment:this.chr,min:b,max:b+this.span-1,score:a},this.sink(a)):4>a.length||(a={segment:a[0],min:parseInt(a[1])+
1,max:parseInt(a[2]),score:parseFloat(a[3])},this.sink(a))};h.prototype.flush=function(){};p.prototype.getStyleSheet=function(b){var n=new a;if("wig"==this.type){var f=new c;f.glyph="HISTOGRAM";f.BGCOLOR="blue";f.HEIGHT=30;n.pushStyle({type:"default"},null,f)}else f=new c,f.glyph="BOX",f.FGCOLOR="black",f.BGCOLOR="blue",f.HEIGHT=8,f.BUMP=!0,f.LABEL=!0,f.ZINDEX=20,n.pushStyle({type:"default"},null,f),f=new c,f.glyph="BOX",f.FGCOLOR="black",f.BGCOLOR="red",f.HEIGHT=10,f.BUMP=!0,f.ZINDEX=20,n.pushStyle({type:"translation"},
null,f),f=new c,f.glyph="BOX",f.FGCOLOR="black",f.BGCOLOR="white",f.HEIGHT=10,f.ZINDEX=10,f.BUMP=!0,f.LABEL=!0,n.pushStyle({type:"transcript"},null,f),f=new c,f.glyph="HISTOGRAM",f.COLOR1="white",f.COLOR2="black",f.HEIGHT=30,n.pushStyle({type:"density"},null,f);return b(n)};k("bed",function(a){return new p(a)});k("wig",function(a){return new p(a)})},{"./das":10,"./sourceadapters":34,"./spans":36,"./utils":49}],3:[function(e,s,r){function p(a,d){return a[d]+a[d+1]*u+a[d+2]*I+a[d+3]*t+a[d+4]*B}function m(){}
function h(a,d,b,c){this.bwg=a;this.cirTreeOffset=d;this.cirTreeLength=b;this.isSummary=c}function k(a,d,b){var c=new m;c.data=a;c.name=b;c.data.slice(0,512).salted().fetch(function(a){if(!a)return d(null,"Couldn't fetch file");var b=new Uint8Array(a),z=new Int16Array(a);a=new Int32Array(a);var f=b[0]+u*b[1]+I*b[2]+t*b[3];if(f==x)c.type="bigwig";else if(f==N)c.type="bigbed";else return f==S||f==A?d(null,"Currently don't support big-endian BBI files"):d(null,"Not a supported format, magic=0x"+f.toString(16));
c.version=z[2];c.numZoomLevels=z[3];c.chromTreeOffset=p(b,8);c.unzoomedDataOffset=p(b,16);c.unzoomedIndexOffset=p(b,24);c.fieldCount=z[16];c.definedFieldCount=z[17];c.asOffset=p(b,36);c.totalSummaryOffset=p(b,44);c.uncompressBufSize=a[13];c.extHeaderOffset=p(b,56);c.zoomLevels=[];for(z=0;z<c.numZoomLevels;++z){var f=a[6*z+16],F=p(b,24*z+72),l=p(b,24*z+80);c.zoomLevels.push({reduction:f,dataOffset:F,indexOffset:l})}c.readChromTree(function(){c.getAutoSQL(function(l){c.schema=l;return d(c)})})},{timeout:5E3})}
function v(a,d,b,c,f){this.bbi=a;this.type=d;this.fieldCount=b;this.offset=c;this.field=f}if("undefined"!==typeof e){r=e("./spans");var y=r.Range,E=r.union,a=r.intersection;r=e("./das");var c=r.DASFeature,b=r.DASGroup,f=e("./utils").shallowCopy,g=e("./bin").readInt;e=e("jszlib");var q=e.inflateBuffer,n=e.arrayCopy}var x=2291137574,S=654086024,N=2273964779,A=3958540679,u=256,I=65536,t=16777216,B=4294967296,C=/^[0-9]+,[0-9]+,[0-9]+/;m.prototype.readChromTree=function(a){var d=this;this.chromsToIDs=
{};this.idsToChroms={};this.maxID=0;var b=this.unzoomedDataOffset,b=b+4-(b-this.chromTreeOffset&3);this.data.slice(this.chromTreeOffset,b-this.chromTreeOffset).fetch(function(b){var c=new Uint8Array(b),f=new Int16Array(b),z=(new Int32Array(b))[2];p(c,16);var w=function(a){var l=c[a],b=f[a/2+1];a+=4;for(var n=0;n<b;++n)if(0==l){a+=z;var O=p(c,a);a+=8;O-=d.chromTreeOffset;w(O)}else{for(var O="",q=0;q<z;++q){var g=c[a++];0!=g&&(O+=String.fromCharCode(g))}q=c[a+3]<<24|c[a+2]<<16|c[a+1]<<8|c[a+0];a+=8;
d.chromsToIDs[O]=q;0==O.indexOf("chr")&&(d.chromsToIDs[O.substr(3)]=q);d.idsToChroms[q]=O;d.maxID=Math.max(d.maxID,q)}};w(32);a(d)})};h.prototype.readWigData=function(a,d,b,c){a=this.bwg.chromsToIDs[a];if(void 0===a)return c([]);this.readWigDataById(a,d,b,c)};h.prototype.readWigDataById=function(a,d,b,c){var f=this;if(this.cirHeader){var n=[],z=0;Date.now();var H=function(l,z,F,c){return(0>a||l==a)&&z<=b&&F>=d},F=function(d,a){f.bwg.instrument&&console.log("level="+a+"; offset="+d+"; time="+(Date.now()|
0));z+=d.length;if(1==d.length&&48==d[0]-f.cirTreeOffset&&f.cachedCirRoot)L(f.cachedCirRoot,0,a),--z,0==z&&f.fetchFeatures(H,n,c);else{for(var b=4+32*f.cirBlockSize,F,w=0;w<d.length;++w){var q=new y(d[w],d[w]+b);F=F?E(F,q):q}b=F.ranges();for(F=0;F<b.length;++F)l(d,b[F],a)}},l=function(d,l,a,b){l.max();l.min();f.bwg.data.slice(l.min(),l.max()-l.min()).fetch(function(b){for(var F=0;F<d.length;++F)l.contains(d[F])&&(L(b,d[F]-l.min(),a),48==d[F]-f.cirTreeOffset&&0==d[F]-l.min()&&(f.cachedCirRoot=b),--z,
0==z&&f.fetchFeatures(H,n,c))})},L=function(l,z,c){var L=new Uint8Array(l),f=new Int16Array(l);l=new Int32Array(l);var H=L[z],f=f[z/2+1];z+=4;if(0!=H)for(H=0;H<f;++H){var q=z/4,g=l[q],G=l[q+1],C=l[q+2],q=l[q+3],h=p(L,z+16);c=p(L,z+24);(0>a||g<a||g==a&&G<=b)&&(0>a||C>a||C==a&&q>=d)&&n.push({offset:h,size:c});z+=32}else{for(var u=[],H=0;H<f;++H)q=z/4,g=l[q],G=l[q+1],C=l[q+2],q=l[q+3],h=p(L,z+16),(0>a||g<a||g==a&&G<=b)&&(0>a||C>a||C==a&&q>=d)&&u.push(h),z+=24;0<u.length&&F(u,c+1)}};F([f.cirTreeOffset+
48],1)}else this.bwg.data.slice(this.cirTreeOffset,48).fetch(function(l){f.cirHeader=l;l=new Int32Array(f.cirHeader);f.cirBlockSize=l[1];f.readWigDataById(a,d,b,c)})};h.prototype.fetchFeatures=function(a,d,b){var f=this;d.sort(function(d,a){return(d.offset|0)-(a.offset|0)});if(0==d.length)b([]);else{var g=[],C=function(d,a,l,z){z||(z={});var b=new c;b._chromId=d;b.segment=f.bwg.idsToChroms[d];b.min=a;b.max=l;b.type="bigwig";for(var O in z)b[O]=z[O];g.push(b)},z=function(){if(0==d.length)Date.now(),
b(g);else{var c=d[0];if(c.data)f.parseFeatures(c.data,C,a),d.splice(0,1),z();else{for(var F=c.offset,l=c.size,c=1;c<d.length&&d[c].offset==F+l;)l+=d[c].size,++c;f.bwg.data.slice(F,l).fetch(function(a){for(var b=0,F=0;b<l;){var c=d[F],w;0<f.bwg.uncompressBufSize?w=q(a,b+2,c.size-2):(w=new Uint8Array(c.size),n(new Uint8Array(a,b,c.size),0,w,0,c.size),w=w.buffer);c.data=w;b+=c.size;++F}z()})}}};z()}};h.prototype.parseFeatures=function(c,d,w){var n=new Uint8Array(c);if(this.isSummary)for(var q=new Int16Array(c),
g=new Int32Array(c),z=new Float32Array(c),n=c.byteLength/32,q=0;q<n;++q){c=g[8*q];var H=g[8*q+1],F=g[8*q+2],l=g[8*q+3],L=z[8*q+5],M=z[8*q+6];w(c,H+1,F)&&(l={type:"bigwig",score:M/l,maxScore:L},"bigbed"==this.bwg.type&&(l.type="density"),d(c,H+1,F,l))}else if("bigwig"==this.bwg.type)if(q=new Int16Array(c),g=new Int32Array(c),z=new Float32Array(c),c=g[0],L=g[1],M=g[3],l=g[4],H=n[20],n=q[11],3==H)for(q=0;q<n;++q){var O=z[q+6],g=L+q*M+1,H=L+q*M+l;w(c,g,H)&&d(c,g,H,{score:O})}else if(2==H)for(q=0;q<n;++q)H=
g[2*q+6]+1,F=H+l-1,O=z[2*q+7],w(c,H,F)&&d(c,H,F,{score:O});else if(1==H)for(q=0;q<n;++q)H=g[3*q+6]+1,F=g[3*q+7],O=z[3*q+8],H>F&&(H=F),w(c,H,F)&&d(c,H,F,{score:O});else console.log("Currently not handling bwgType="+H);else if("bigbed"==this.bwg.type)for(q=0,l=this.bwg.definedFieldCount,L=this.bwg.schema;q<n.length;){c=n[q+3]<<24|n[q+2]<<16|n[q+1]<<8|n[q+0];H=n[q+7]<<24|n[q+6]<<16|n[q+5]<<8|n[q+4];F=n[q+11]<<24|n[q+10]<<16|n[q+9]<<8|n[q+8];q+=12;for(O="";;)if(M=n[q++],0!=M)O+=String.fromCharCode(M);
else break;var M={},h;h=0<O.length?O.split("\t"):[];0<h.length&&3<l&&(M.label=h[0]);1<h.length&&4<l&&(O=parseInt(h[1]),isNaN(O)||(M.score=O));2<h.length&&5<l&&(M.orientation=h[2]);5<h.length&&8<l&&(O=h[5],C.test(O)&&(M.itemRgb="rgb("+O+")"));if(h.length>l-3&&L)for(O=l-3;O<h.length;++O)M[L.fields[O+3].name]=h[O];if(w(c,H+1,F,h))if(12>l)d(c,H+1,F,M);else{var O=h[3]|0,u=h[4]|0,t=h[6]|0,k=h[7].split(","),A=h[8].split(",");M.exonFrames&&(z=M.exonFrames.split(","),M.exonFrames=void 0);M.type="transcript";
var x=new b;for(g in M)x[g]=M[g];x.id=h[0];x.segment=this.bwg.idsToChroms[c];x.min=H+1;x.max=F;x.notes=[];M.groups=[x];if(9<h.length){var e=F=M.geneName||h[9];10<h.length&&(e=h[10]);M.geneName2&&(e=M.geneName2);h=f(x);h.id=F;h.label=e;h.type="gene";M.groups.push(h)}F=[];for(h=0;h<t;++h)x=(A[h]|0)+H,x=new y(x,x+(k[h]|0)),F.push(x);k=E(F);t=k.ranges();for(H=0;H<t.length;++H)F=t[H],d(c,F.min()+1,F.max(),M);if(u>O&&(H="+"==M.orientation?new y(O,u+3):new y(O-3,u),H=a(k,H))){M.type="translation";O=H.ranges();
for(k=u=0;O[0].min()>t[k].max();)k++;for(H=0;H<O.length;++H)t=H,"-"==M.orientation&&(t=O.length-H-1),F=O[t],M.readframe=u,z&&(t=parseInt(z[t+k]),"number"===typeof t&&0<=t&&2>=t&&(M.readframe=t,M.readframeExplicit=!0)),t=F.max()-F.min(),u=(u+t)%3,d(c,F.min()+1,F.max(),M)}}}else throw Error("Don't know what to do with "+this.bwg.type);};h.prototype.getFirstAdjacent=function(a,d,b,c){a=this.bwg.chromsToIDs[a];if(void 0===a)return c([]);this.getFirstAdjacentById(a,d,b,c)};h.prototype.getFirstAdjacentById=
function(a,d,b,c){var f=this;if(this.cirHeader){var n=null,z=-1,q=-1,F=0;Date.now();var l=function(l,d){F+=l.length;for(var a=4+32*f.cirBlockSize,z,b=0;b<l.length;++b){var c=new y(l[b],l[b]+a);z=z?E(z,c):c}a=z.ranges();for(z=0;z<a.length;++z)L(l,a[z],d)},L=function(l,z,L,q){z.max();z.min();f.bwg.data.slice(z.min(),z.max()-z.min()).fetch(function(q){for(var H=0;H<l.length;++H)if(z.contains(l[H])&&(g(q,l[H]-z.min(),L),--F,0==F)){if(!n)return 0<b&&(0!=a||0<d)?f.getFirstAdjacentById(0,0,b,c):0>b&&(a!=
f.bwg.maxID||1E9>d)?f.getFirstAdjacentById(f.bwg.maxID,1E9,b,c):c([]);f.fetchFeatures(function(l,z,c,F){return 0>b&&(l<a||c<d)||0<b&&(l>a||z>d)},[n],function(l){for(var d=null,a=-1,z=-1,F=0;F<l.length;++F){var L=l[F],f=L._chromId,n=L.min,q=L.max;if(null==d||0>b&&(f>a||q>z)||0<b&&(f<a||n<z))d=L,z=0>b?q:n,a=f}return null!=d?c([d]):c([])})}})},g=function(c,F,L){var g=new Uint8Array(c),C=new Int16Array(c);c=new Int32Array(c);var G=g[F],C=C[F/2+1];F+=4;if(0!=G)for(G=0;G<C;++G){var h=F/4,M=c[h],t=c[h+1],
u=c[h+2],x=c[h+3],h=p(g,F+16);L=p(g,F+24);(0>b&&(M<a||M==a&&t<=d)||0<b&&(u>a||u==a&&x>=d))&&!/_random/.exec(f.bwg.idsToChroms[M])&&(null==n||0>b&&(u>z||u==z&&x>q)||0<b&&(M<z||M==z&&t<q))&&(n={offset:h,size:L},q=0>b?x:t,z=0>b?u:M);F+=32}else{for(var k=g=-1,G=0;G<C;++G){h=F/4;M=c[h];t=c[h+1];u=c[h+2];x=c[h+3];h=c[h+4]<<32|c[h+5];if(0>b&&(M<a||M==a&&t<=d)&&u>=a||0<b&&(u>a||u==a&&x>=d)&&M<=a)if(0>g||x>k)g=h,k=0>b?x:t;F+=24}0<=g&&l([g],L+1)}};l([f.cirTreeOffset+48],1)}else this.bwg.data.slice(this.cirTreeOffset,
48).fetch(function(l){f.cirHeader=l;l=new Int32Array(f.cirHeader);f.cirBlockSize=l[1];f.getFirstAdjacentById(a,d,b,c)})};m.prototype.readWigData=function(a,d,b,c){this.getUnzoomedView().readWigData(a,d,b,c)};m.prototype.getUnzoomedView=function(){if(!this.unzoomedView){var a=4E3;this.zoomLevels[0]&&(a=this.zoomLevels[0].dataOffset-this.unzoomedIndexOffset);this.unzoomedView=new h(this,this.unzoomedIndexOffset,a,!1)}return this.unzoomedView};m.prototype.getZoomedView=function(a){a=this.zoomLevels[a];
a.view||(a.view=new h(this,a.indexOffset,4E3,!0));return a.view};m.prototype._tsFetch=function(a,d,b,c,f){var n=this;if(a>=this.zoomLevels.length-1){if(this.topLevelReductionCache){for(var z=[],q=this.topLevelReductionCache,F=0;F<q.length;++F)q[F]._chromId==d&&z.push(q[F]);return f(z)}this.getZoomedView(this.zoomLevels.length-1).readWigDataById(-1,0,3E8,function(l){n.topLevelReductionCache=l;return n._tsFetch(a,d,b,c,f)})}else return(0>a?this.getUnzoomedView():this.getZoomedView(a)).readWigDataById(d,
b,c,f)};m.prototype.thresholdSearch=function(a,d,b,c,f){function n(){if(0==q.length)return f(null);q.sort(function(l,d){var a=l.zoom-d.zoom;if(0!=a)return a;a=l.chrOrd-d.chrOrd;return 0!=a?a:l.min-d.min*b});var l=q.splice(0,1)[0];z._tsFetch(l.zoom,l.chr,l.min,l.max,function(a){var z=0<b?0:3E8;l.fromRef&&(z=d);for(var F=0;F<a.length;++F){var g=a[F],C;C=void 0!=g.maxScore?g.maxScore:g.score;if(0<b){if(C>c)if(0>l.zoom){if(g.min>z)return f(g)}else g.max>z&&q.push({chr:l.chr,chrOrd:l.chrOrd,zoom:l.zoom-
2,min:g.min,max:g.max,fromRef:l.fromRef})}else if(C>c)if(0>l.zoom){if(g.max<z)return f(g)}else g.min<z&&q.push({chr:l.chr,chrOrd:l.chrOrd,zoom:l.zoom-2,min:g.min,max:g.max,fromRef:l.fromRef})}n()})}b=0>b?-1:1;var z=this;a=this.chromsToIDs[a];for(var q=[{chrOrd:0,chr:a,zoom:z.zoomLevels.length-4,min:0,max:3E8,fromRef:!0}],F=1;F<=this.maxID+1;++F){var l=(a+b*F)%(this.maxID+1);0>l&&(l+=this.maxID+1);q.push({chrOrd:F,chr:l,zoom:z.zoomLevels.length-1,min:0,max:3E8})}n()};m.prototype.getAutoSQL=function(a){if(!this.asOffset)return a(null);
this.data.slice(this.asOffset,2048).fetch(function(d){var b=new Uint8Array(d);d="";for(var c=0;c<b.length&&0!=b[c];++c)d+=String.fromCharCode(b[c]);var b=/([\w\[\]]+)\s+(\w+)\s*;\s*("([^"]+)")?\s*/g,f=/(\w+)\s+(\w+)\s+("([^"]+)")?\s+\(\s*/.exec(d);if(f){c={declType:f[1],name:f[2],comment:f[4],fields:[]};d=d.substring(f[0]);for(f=b.exec(d);null!=f;f=b.exec(d))c.fields.push({type:f[1],name:f[2],comment:f[4]});return a(c)}})};m.prototype.getExtraIndices=function(a){var d=this;if(4>this.version||0==this.extHeaderOffset||
"bigbed"!=this.type)return a(null);this.data.slice(this.extHeaderOffset,64).fetch(function(b){if(!b)return a(null,"Couldn't fetch extension header");var c=new Uint8Array(b),f=new Int16Array(b);new Int32Array(b);var q=f[1];b=p(c,4);if(0==q)return a(null);d.data.slice(b,20*q).fetch(function(z){if(!z)return a(null,"Couldn't fetch index info");var b=new Uint8Array(z),c=new Int16Array(z);new Int32Array(z);z=[];for(var l=0;l<q;++l){var f=c[10*l],n=c[10*l+1],g=p(b,20*l+4),f=new v(d,f,n,g,c[10*l+8]);z.push(f)}a(z)})})};
v.prototype.lookup=function(a,d){var b=this;this.bbi.data.slice(this.offset,32).fetch(function(c){function f(l){b.bbi.data.slice(l,4+z*(n+F)).fetch(function(l){var z=new Uint8Array(l),c=new Uint16Array(l);new Uint32Array(l);c=c[1];l=4;if(0==z[0]){for(var q=null,C=0;C<c;++C){for(var h="",G=0;G<n;++G){var t=z[l++];0!=t&&(h+=String.fromCharCode(t))}G=p(z,l);l+=8;if(0>a.localeCompare(h)&&q){f(q);return}q=G}f(q)}else{for(C=0;C<c;++C){h="";for(G=0;G<n;++G)t=z[l++],0!=t&&(h+=String.fromCharCode(t));if(h==
a)return c=p(z,l),z=g(z,l+8),b.bbi.getUnzoomedView().fetchFeatures(function(l,d,z,c){if(c&&c.length>b.field-3)return c[b.field-3]==a},[{offset:c,size:z}],d);l+=F}return d([])}})}var q=new Uint8Array(c);new Int16Array(c);c=new Int32Array(c);var z=c[1],n=c[2],F=c[3];p(q,16);f(b.offset+32)})};"undefined"!==typeof s&&(s.exports={makeBwg:k,BIG_BED_MAGIC:N,BIG_WIG_MAGIC:x})},{"./bin":4,"./das":10,"./spans":36,"./utils":49,jszlib:65}],4:[function(e,s,r){function p(a){this.blob=a}function m(a,b,c,f){f||("object"===
typeof b?(f=b,b=void 0):f={});this.url=a;this.start=b||0;c&&(this.end=c);this.opts=f}function h(a){if(!a)return null;for(var b=new Uint8Array(a.length),c=0;c<b.length;++c)b[c]=a.charCodeAt(c);return b.buffer}function k(a,b){return a[b+7]<<24|a[b+6]<<16|a[b+5]<<8|a[b+4]}function v(a,b){return a[b+3]<<24|a[b+2]<<16|a[b+1]<<8|a[b]}function y(a,b){return a[b+1]<<8|a[b]}function E(a,b){return a[b]}function a(a,b){return a[b]<<24|a[b+1]<<16|a[b+2]<<8|a[b+3]}if("undefined"!==typeof e)var c=e("./utils").shallowCopy,
b=e("./sha1").b64_sha1;p.prototype.slice=function(a,b){var c;c=this.blob.slice?b?this.blob.slice(a,a+b):this.blob.slice(a):b?this.blob.webkitSlice(a,a+b):this.blob.webkitSlice(a);return new p(c)};p.prototype.salted=function(){return this};p.prototype.fetch="undefined"!==typeof FileReader?function(a){var b=new FileReader;b.onloadend=function(c){a(h(b.result))};b.readAsBinaryString(this.blob)}:function(a){var b=new FileReaderSync;try{var c=b.readAsArrayBuffer(this.blob);a(c)}catch(f){a(null,f)}};m.prototype.slice=
function(a,b){if(0>a)throw"Bad slice "+a;var c=this.start,f=this.end,c=c&&a?c+a:a||c;return new m(this.url,c,b&&c?c+b-1:f||b-1,this.opts)};var f=0,g=0<=navigator.userAgent.indexOf("Safari")&&0>navigator.userAgent.indexOf("Chrome");m.prototype.fetchAsText=function(a){try{var c=new XMLHttpRequest,h=this.url;(g||this.opts.salt)&&0>h.indexOf("?")&&(h=h+"?salt="+b(""+Date.now()+","+ ++f));c.open("GET",h,!0);if(this.end){if(1E8<this.end-this.start)throw"Monster fetch!";c.setRequestHeader("Range","bytes="+
this.start+"-"+this.end)}c.onreadystatechange=function(){if(4==c.readyState)return 200==c.status||206==c.status?a(c.responseText):a(null)};this.opts.credentials&&(c.withCredentials=!0);c.send("")}catch(k){return a(null)}};m.prototype.salted=function(){var a=c(this.opts);a.salt=!0;return new m(this.url,this.start,this.end,a)};m.prototype.fetch=function(a,c){var k=this;c=c||{};var e=c.attempt||1,E=c.truncatedLength;if(3<e)return a(null);try{var A;c.timeout&&!this.opts.credentials&&(A=setTimeout(function(){console.log("timing out "+
t);u.abort();return a(null,"Timeout")},c.timeout));var u=new XMLHttpRequest,I,t=this.url;(g||this.opts.salt)&&0>t.indexOf("?")&&(t=t+"?salt="+b(""+Date.now()+","+ ++f));u.open("GET",t,!0);u.overrideMimeType("text/plain; charset=x-user-defined");if(this.end){if(1E8<this.end-this.start)throw"Monster fetch!";u.setRequestHeader("Range","bytes="+this.start+"-"+this.end);I=this.end-this.start+1}u.responseType="arraybuffer";u.onreadystatechange=function(){if(4==u.readyState){A&&clearTimeout(A);if(200==u.status||
206==u.status){if(u.response){var b=u.response.byteLength;return!I||I==b||E&&b==E?a(u.response):k.fetch(a,{attempt:e+1,truncatedLength:b})}if(u.mozResponseArrayBuffer)return a(u.mozResponseArrayBuffer);b=u.responseText;return!I||I==b.length||E&&b.length==E?a(h(u.responseText)):k.fetch(a,{attempt:e+1,truncatedLength:b.length})}return k.fetch(a,{attempt:e+1})}};this.opts.credentials&&(u.withCredentials=!0);u.send("")}catch(B){return a(null)}};(function(a){var b=new ArrayBuffer(8),c=new Uint8Array(b),
f=new Float32Array(b);a.readFloat=function(a,b){c[0]=a[b];c[1]=a[b+1];c[2]=a[b+2];c[3]=a[b+3];return f[0]}})(this);"undefined"!==typeof s&&(s.exports={BlobFetchable:p,URLFetchable:m,readInt:v,readIntBE:a,readInt64:k,readShort:y,readByte:E,readFloat:this.readFloat})},{"./sha1":33,"./utils":49}],5:[function(e,s,r){function p(h){var k="bp";1E9<h?(h/=1E9,k="Gb"):1E6<h?(h/=1E6,k="Mb"):1E3<h&&(h/=1E3,k="kb");return""+Math.round(h)+k}if("undefined"!==typeof e){var m=e("./cbrowser").Browser,h=e("./utils").makeElement,
k=e("./numformats").formatLongInt,v=e("./zoomslider");e("./tier-edit");e("./export-config");e("./export-ui");e("./export-image");e("./svg-export");e("./session")}m.prototype.initUI=function(e,E){this.noSourceCSS||["bootstrap-scoped.css","dalliance-scoped.css","font-awesome.min.css"].forEach(function(a){document.head.appendChild(h("link","",{rel:"stylesheet",href:this.resolveURL("$$css/"+a)}))}.bind(this));var a=this;a.disableDefaultFeaturePopup||this.addFeatureListener(function(d,l,b,c){a.featurePopup(d,
l,b,c)});e.classList.add("dalliance");var c=a.toolbar=h("div",null,{className:"btn-toolbar toolbar"}),b=a.coordSystem.speciesName+" "+a.nameForCoordSystem(a.coordSystem);this.setDocumentTitle&&(document.title=b+" :: dalliance");var f=h("input","",{className:"loc-field"});a.makeTooltip(f,"Enter a genomic location or gene name");var g=h("p","",{className:"loc-status"}),q=h("a",[h("i",null,{className:"fa fa-search-plus"})],{className:"btn"}),n=new v({width:a.zoomSliderWidth});a.makeTooltip(n,"Highlighted button shows current zoom level, gray button shows inactive zoom level (click or tap SPACE to toggle).");
var x=h("a",[h("i",null,{className:"fa fa-search-minus"})],{className:"btn"}),m=h("a",[h("i",null,{className:"fa fa-eraser"})],{className:"btn"}),N=h("a",[h("i",null,{className:"fa fa-plus"})],{className:"btn"}),A=h("a",[h("i",null,{className:"fa fa-bookmark"})],{className:"btn"}),u=h("a",[h("i",null,{className:"fa fa-print"})],{className:"btn"});h("a",[h("i",null,{className:"fa fa-refresh"})],{className:"btn"});var I=h("a",[h("i",null,{className:"fa fa-cogs"})],{className:"btn"}),t=h("a",[h("i",
null,{className:"fa fa-question"})],{className:"btn"}),B=h("a",[h("i",null,{className:"fa fa-road"})],{className:"btn"});a.makeTooltip(B,"Configure currently selected track(s) (E)");var C=h("a",[h("i",null,{className:"fa fa-angle-left"})],{className:"btn"},{width:"5px"}),J=h("a",[h("i",null,{className:"fa fa-angle-right"})],{className:"btn pull-right"},{width:"5px"}),d=h("div",null,{className:"btn-group pull-right"});this.noTrackAdder||d.appendChild(N);this.noTrackEditor||d.appendChild(B);this.noExport||
d.appendChild(u);this.noOptions||d.appendChild(I);this.noHelp||d.appendChild(t);this.setUiMode=function(a){this.uiMode=a;var l={help:t,add:N,opts:I,"export":u,tier:B},d;for(d in l)d==a?l[d].classList.add("active"):l[d].classList.remove("active")};this.noLeapButtons||c.appendChild(J);d.firstChild&&c.appendChild(d);this.noLeapButtons||c.appendChild(C);this.noTitle||c.appendChild(h("div",h("h4",b,{},{margin:"0px"}),{className:"btn-group title"}));this.noLocationField||c.appendChild(h("div",[f,g],{className:"btn-group loc-group"}));
this.noClearHighlightsButton||c.appendChild(m);this.noZoomSlider||c.appendChild(h("div",[q,h("span",n,{className:"btn"}),x],{className:"btn-group"}));this.toolbarBelow?(e.appendChild(E),e.appendChild(c)):(e.appendChild(c),e.appendChild(E));var w=Math.log(2)/Math.log(10),G=Math.log(5)/Math.log(10),P=function(d){var l=(d/a.zoomExpt+Math.log(a.zoomBase))/Math.log(10);d=l|0;l-=d;return((0.01>l?d:l<=w+0.01?d+w:l<=G+0.01?d+G:d+1)*Math.log(10)-Math.log(a.zoomBase))*a.zoomExpt},D=function(d){n.addLabel(d,
p(Math.exp(d/a.zoomExpt)*a.zoomBase))};this.addViewListener(function(d,l,b,c,z){f.value=d+":"+k(l)+".."+k(b);n.min=z.min|0;n.max=z.max|0;z.isSnapZooming?(n.value=z.alternate,n.value2=z.current,n.active=2):(n.value=z.current,n.value2=z.alternate,n.active=1);z.current==z.min?q.classList.add("disabled"):q.classList.remove("disabled");z.current==z.max?x.classList.add("disabled"):x.classList.remove("disabled");n.removeLabels();d=z.min;z=z.max;l=z-d;b=4;a.zoomSliderWidth&&150>a.zoomSliderWidth&&(b=3);D(P(d));
for(c=1;c<b-1;++c)D(P(d+1*c*l/(b-1)));D(P(z));a.storeStatus&&a.storeViewStatus();m.style.display=0<a.highlights.length?"inline-block":"none"});this.addTierListener(function(){a.storeStatus&&a.storeTierStatus()});f.addEventListener("keydown",function(d){40==d.keyCode&&(d.preventDefault(),d.stopPropagation(),a.setSelectedTier(0));if(10==d.keyCode||13==d.keyCode)d.preventDefault(),a.search(f.value,function(l){g.textContent=l?""+l:""})},!1);var z;N.addEventListener("click",function(d){z&&z.displayed?
a.removeAllPopups():z=a.showTrackAdder(d)},!1);a.makeTooltip(N,"Add a new track from the registry or an indexed file. (A)");q.addEventListener("click",function(d){d.stopPropagation();d.preventDefault();a.zoomStep(-10)},!1);a.makeTooltip(q,"Zoom in (+)");x.addEventListener("click",function(d){d.stopPropagation();d.preventDefault();a.zoomStep(10)},!1);a.makeTooltip(x,"Zoom out (-)");n.addEventListener("change",function(d){d=2==n.active;d!=a.isSnapZooming&&(a.savedZoom=a.zoomSliderValue-a.zoomMin,a.isSnapZooming=
d);d=1==n.active?n.value:n.value2;a.zoomSliderValue=1*d;a.zoom(Math.exp(1*d/a.zoomExpt))},!1);A.addEventListener("click",function(d){d.stopPropagation();d.preventDefault()},!1);a.makeTooltip(A,"Favourite regions");u.addEventListener("click",function(d){d.stopPropagation();d.preventDefault();a.openExportPanel()},!1);a.makeTooltip(u,"Export publication-quality SVG. (X)");I.addEventListener("click",function(d){d.stopPropagation();d.preventDefault();a.toggleOptsPopup(d)},!1);a.makeTooltip(I,"Configure options.");
t.addEventListener("click",function(d){d.stopPropagation();d.preventDefault();a.toggleHelpPopup(d)});a.makeTooltip(t,"Help; Keyboard shortcuts. (H)");B.addEventListener("click",function(d){d.stopPropagation();d.preventDefault();1==a.selectedTiers.length&&a.openTierPanel(a.tiers[a.selectedTiers[0]])},!1);C.addEventListener("click",function(d){a.leap(a.reverseKeyScrolling?-1:1,!1)},!1);a.makeTooltip(C,function(d){d=a.getSelectedTier();var l;0<=d&&(l=a.tiers[d]);return l&&l.featureSource&&a.sourceAdapterIsCapable(l.featureSource,
"quantLeap")&&"number"==typeof l.quantLeapThreshold?'Jump to the next region with a score above the threshold in the selected track "'+(l.config.name||l.dasSource.name)+'"" (ctrl+LEFT)':l&&l.featureSource&&a.sourceAdapterIsCapable(l.featureSource,"leap")?'Jump to the next feature in the selected track "'+(l.config.name||l.dasSource.name)+'" (ctrl+LEFT)':"Jump left (shift+LEFT)"});J.addEventListener("click",function(d){a.leap(a.reverseKeyScrolling?1:-1,!1)},!1);a.makeTooltip(J,function(d){d=a.getSelectedTier();
var l;0<=d&&(l=a.tiers[d]);return l&&l.featureSource&&a.sourceAdapterIsCapable(l.featureSource,"quantLeap")&&"number"==typeof l.quantLeapThreshold?'Jump to the next region with a score above the threshold in the selected track "'+(l.config.name||l.dasSource.name)+'"" (ctrl+RIGHT)':l&&l.featureSource&&a.sourceAdapterIsCapable(l.featureSource,"leap")?'Jump to the next feature in the selected track "'+(l.config.name||l.dasSource.name)+'" (ctrl+RIGHT)':"Jump right (shift+RIGHT)"});a.addTierSelectionListener(function(){var d=
a.getSelectedTier(),l;0<=d&&(l=a.tiers[d]);d=!1;l&&l.featureSource&&(a.sourceAdapterIsCapable(l.featureSource,"quantLeap")&&"number"==typeof l.quantLeapThreshold?d=!0:a.sourceAdapterIsCapable(l.featureSource,"leap")&&(d=!0));C.firstChild.className=d?"fa fa-angle-double-left":"fa fa-angle-left";J.firstChild.className=d?"fa fa-angle-double-right":"fa fa-angle-right"});m.addEventListener("click",function(d){a.clearHighlights()},!1);a.makeTooltip(m,"Clear highlights (C)");a.addTierSelectionWrapListener(function(d){0>
d&&(a.setSelectedTier(null),f.focus())});a.addTierSelectionListener(function(d){"tier"===a.uiMode&&(0==d.length?(a.hideToolPanel(),a.manipulatingTier=null,a.uiMode="none"):(d=a.tiers[d[0]],d!=a.manipulatingTier&&a.openTierPanel(d)))});var H=function(d){if(65==d.keyCode||97==d.keyCode)d.preventDefault(),d.stopPropagation(),a.showTrackAdder();else if(72==d.keyCode||104==d.keyCode)d.stopPropagation(),d.preventDefault(),a.toggleHelpPopup(d);else if(69==d.keyCode||101==d.keyCode)d.stopPropagation(),d.preventDefault(),
1==a.selectedTiers.length&&a.openTierPanel(a.tiers[a.selectedTiers[0]]);else if(88==d.keyCode||120==d.keyCode)d.stopPropagation(),d.preventDefault(),a.openExportPanel();else if(67==d.keyCode||99==d.keyCode)d.stopPropagation(),d.preventDefault(),a.clearHighlights()};e.addEventListener("focus",function(d){e.addEventListener("keydown",H,!1)},!1);e.addEventListener("blur",function(d){e.removeEventListener("keydown",H,!1)},!1);e.addEventListener("keydown",function(d){27===d.keyCode&&"none"!==a.uiMode&&
(d.preventDefault(),d.stopPropagation(),a.setUiMode("none"),a.hideToolPanel(),a.selectedTiers&&0<a.selectedTiers.length&&a.browserHolder.focus())},!1)};m.prototype.showToolPanel=function(k,e){var a=this;this.activeToolPanel&&this.activeToolPanel.parentElement.removeChild(this.activeToolPanel);var c;c=e?k:h("div",k,{},{overflowY:"auto",width:"100%"});var b=h("div",h("i",null,{className:"fa fa-caret-right"}),{className:"tool-divider"});b.addEventListener("click",function(b){a.hideToolPanel();a.setUiMode("none")},
!1);this.makeTooltip(b,"Close tool panel (ESC)");this.activeToolPanel=h("div",[b,c],{className:"tool-holder"});this.svgHolder.appendChild(this.activeToolPanel);this.resizeViewer();a=this};m.prototype.hideToolPanel=function(){this.activeToolPanel&&this.activeToolPanel.parentElement.removeChild(this.activeToolPanel);this.svgHolder.style.width="100%";this.activeToolPanel=null;this.resizeViewer()};m.prototype.toggleHelpPopup=function(k){"help"===this.uiMode?(this.hideToolPanel(),this.setUiMode("none")):
(k=h("iframe",null,{scrolling:"yes",seamless:"seamless",src:this.resolveURL("$$help/index.html"),className:"help-panel"}),this.showToolPanel(k,!1),this.setUiMode("help"))};m.prototype.toggleOptsPopup=function(k){var e=this;if("opts"===this.uiMode)this.hideToolPanel(),this.setUiMode("none");else{k=h("div",null,{className:"form-horizontal"},{boxSizing:"border-box",MozBoxSizing:"border-box",display:"inline-block",verticalAlign:"top"});var a=h("table");a.cellPadding=5;var c=h("input","",{type:"checkbox",
checked:e.reverseScrolling});c.addEventListener("change",function(a){e.reverseScrolling=c.checked;e.storeStatus()},!1);a.appendChild(h("tr",[h("td","Reverse trackpad scrolling",{align:"right"}),h("td",c)]));var b=h("input","",{type:"checkbox",checked:e.reverseKeyScrolling});b.addEventListener("change",function(a){e.reverseKeyScrolling=b.checked;e.storeStatus()},!1);a.appendChild(h("tr",[h("td","Reverse scrolling buttons and keys",{align:"right"}),h("td",b)]));var f=h("select");f.appendChild(h("option",
"Left",{value:"left"}));f.appendChild(h("option","Center",{value:"center"}));f.appendChild(h("option","Right",{value:"right"}));f.appendChild(h("option","None",{value:"none"}));f.value=e.rulerLocation;f.addEventListener("change",function(a){e.rulerLocation=f.value;e.positionRuler();for(a=0;a<e.tiers.length;++a)e.tiers[a].paintQuant();e.storeStatus()},!1);a.appendChild(h("tr",[h("td","Vertical guideline",{align:"right"}),h("td",f)]));var g=h("input","",{type:"checkbox",checked:e.singleBaseHighlight});
g.addEventListener("change",function(a){e.singleBaseHighlight=g.checked;e.positionRuler();e.storeStatus()},!1);g.setAttribute("id","singleBaseHightlightButton");a.appendChild(h("tr",[h("td","Display and highlight current genome location",{align:"right"}),h("td",g)]));k.appendChild(a);a=h("button","Reset browser",{className:"btn"},{marginLeft:"auto",marginRight:"auto",display:"block"});a.addEventListener("click",function(a){e.reset()},!1);k.appendChild(a);this.showToolPanel(k);this.setUiMode("opts")}}},
{"./cbrowser":6,"./export-config":14,"./export-image":15,"./export-ui":16,"./numformats":26,"./session":32,"./svg-export":38,"./tier-edit":44,"./utils":49,"./zoomslider":52}],6:[function(e,s,r){function p(d,a,b){this.min=a;this.max=b;this.chr=d}function m(d){d||(d={});this.prefix="//www.biodalliance.org/release-0.13/";this.sources=[];this.tiers=[];this.tierGroups={};this.featureListeners=[];this.featureHoverListeners=[];this.viewListeners=[];this.regionSelectListeners=[];this.tierListeners=[];this.tierSelectionListeners=
[];this.tierSelectionWrapListeners=[];this.cookieKey="browser";this.chains={};this.pageName="svgHolder";this.maxExtra=2.5;this.minExtra=0.5;this.zoomFactor=1;this.maxPixelsPerBase=10;this.origin=0;this.targetQuantRes=1;this.featurePanelWidth=750;this.zoomBase=100;this.zoomExpt=30;this.zoomSliderValue=100;this.entryPoints=null;this.currentSeqMax=-1;this.highlights=[];this.selectedTiers=[1];this.maxViewWidth=5E5;this.defaultSubtierMax=100;this.reverseScrolling=!1;this.rulerLocation="center";this.defaultHighlightFill=
"red";this.defaultHighlightAlpha=0.3;this.singleBaseHighlight=this.exportRuler=this.exportHighlights=!0;this.tierBackgroundColors=["rgb(245,245,245)","white"];this.minTierHeight=20;this.noDefaultLabels=!1;this.availableSources=new a;this.defaultSources=[];this.mappableSources={};this.registry=null;this.noRegistryTabs=!0;this.hubs=[];this.hubObjects=[];this.sourceCache=new E;this.useFetchWorkers=this.retina=!0;this.maxWorkers=2;this.workerPath="$$worker-all.js";this.assemblyNameUcsc=this.assemblyNamePrimary=
!0;this.httpCanaryURL="http://www.biodalliance.org/http-canary.txt";this.httpWarningURL="//www.biodalliance.org/https.html";this.initListeners=[];this.baseColors=d.baseColors?d.baseColors:{A:"green",C:"blue",G:"orange",T:"red","-":"hotpink",I:"red"};if(void 0!==d.viewStart&&"number"!==typeof d.viewStart)throw Error("viewStart must be an integer");if(void 0!==d.viewEnd&&"number"!==typeof d.viewEnd)throw Error("viewEnd must be an integer");if(void 0!==d.offscreenInitWidth&&"number"!==typeof d.offscreenInitWidth)throw Error("offscreenInitWidth must be an integer");
for(var b in d)this[b]=d[b];"string"===typeof d.uiPrefix&&"string"!==typeof d.prefix&&(this.prefix=d.uiPrefix);0>this.prefix.indexOf("//")&&0===this.prefix.indexOf("/")&&(d=window.location.hostname,window.location.port&&(d+=":"+window.location.port),this.prefix="//"+d+this.prefix);0===this.prefix.indexOf("//")&&(d=window.location.protocol,"http:"!=d&&"https:"!=d&&(console.log(window.location.protocol),console.log("WARNING: prefix is set to a protocol-relative URL ("+this.prefix+" when loading from a non-HTTP source"),
this.prefix="http:"+this.prefix));if(!this.coordSystem)throw Error("Coordinate system must be configured");if(void 0===this.chr||void 0===this.viewStart||void 0===this.viewEnd)throw Error("Viewed region (chr:start..end) must be defined");var c=this;if("complete"===document.readyState)c.realInit();else{var l=function(d){window.removeEventListener("load",l,!1);c.realInit()};window.addEventListener("load",l,!1)}}function h(d,a,b){if(b)for(var l=0;l<a.length;++l)a[l].mapping=b;d.set(a)}function k(d,a,
b,l){l=l||[];for(var c=d.length-1;0<=c;--c){var f=d[c];if(!f.notSelectable&&f.min()<=a&&f.max()>=a&&(!f.minY||!(b<f.minY()||b>f.maxY()))){f.feature?l.push(f.feature):f.group&&l.push(f.group);if(f.glyphs)return k(f.glyphs,a,b,l);if(f.glyph)return k([f.glyph],a,b,l);break}}return l}function v(d,a){var b=this;this.tagSeed=0;this.callbacks={};this.browser=d;this.worker=a;this.worker.onmessage=function(d){var a=b.callbacks[d.data.tag];a&&(a(d.data.result,d.data.error),delete b.callbacks[d.data.tag])}}
function y(d){var a=d.resolveURL(d.workerPath);0==a.indexOf("//")&&(a="https:"==window.location.protocol?"https:"+a:"http:"+a);var b=new Blob(['importScripts("'+a+"?version="+N+'");'],{type:"application/javascript"});return new t(function(a,c){var f=new Worker(URL.createObjectURL(b));f.onmessage=function(b){"init"===b.data.tag&&(console.log("Worker initialized"),a(new v(d,f)))};f.onerror=function(d){c(d.message)}})}function E(){this.sourcesByURI={}}if("undefined"!==typeof e){r=e("./utils");var a=
r.Observed,c=r.makeElement,b=r.removeChildren,f=r.miniJSONify,g=r.shallowCopy,q=r.textXHR,n=e("./tier").DasTier,x=e("./sha1").hex_sha1,S=e("./thub").connectTrackHub,N=e("./version");r=e("./numformats");var A=r.formatQuantLabel,u=r.formatLongInt,I=e("./chainset").Chainset,t=e("es6-promise").Promise;r=e("./sourcecompare");var B=r.sourcesAreEqual,C=r.sourcesAreEqualModuloStyle,J=r.sourceDataURI}m.prototype.resolveURL=function(d){return d.replace("$$",this.prefix)};m.prototype.destroy=function(){window.removeEventListener("resize",
this.resizeListener,!1)};m.prototype.realInit=function(){var d=this;if(this.wasInitialized)console.log("Attemping to call realInit on an already-initialized Dalliance instance");else{this.wasInitialized=!0;var a=navigator.userAgent||"dummy";0<=a.indexOf("Trident")&&0<=a.indexOf("rv:11")&&(this.disablePinning=!0);this.defaultChr=this.chr;this.defaultStart=this.viewStart;this.defaultEnd=this.viewEnd;this.defaultSources=[];for(a=0;a<this.sources.length;++a){var f=this.sources[a];f&&this.defaultSources.push(f)}this.restoreStatus&&
(this.statusRestored=this.restoreStatus());var l=this;this.browserHolderHolder=document.getElementById(this.pageName);this.browserHolderHolder.classList.add("dalliance-injection-point");this.browserHolder=c("div",null,{className:"dalliance dalliance-root",tabIndex:-1});this.maxHeight?this.browserHolder.style.maxHeight=this.maxHeight+"px":void 0!=this.maxHeight&&(this.browserHolder.style.maxHeight=null);b(this.browserHolderHolder);this.browserHolderHolder.appendChild(this.browserHolder);this.svgHolder=
c("div",null,{className:"main-holder"});this.initUI(this.browserHolder,this.svgHolder);this.pinnedTierHolder=c("div",null,{className:"tier-holder tier-holder-pinned"});this.tierHolder=c("div",this.makeLoader(24),{className:"tier-holder tier-holder-rest"});this.locSingleBase=c("span","",{className:"loc-single-base"});a=c("div",this.locSingleBase,{className:"loc-single-base-holder"});this.addViewListener(function(a,l,b,c,f,L,F){l=Math.round((F+L)/2);d.locSingleBase.appendChild(document.createTextNode(a+
":"+u(l)));d.locSingleBase.removeChild(d.locSingleBase.firstChild)});this.disablePinning?this.tierHolderHolder=this.tierHolder:(this.tierHolderHolder=c("div",[a,this.pinnedTierHolder,this.tierHolder],{className:"tier-holder-holder"}),this.svgHolder.appendChild(this.tierHolderHolder));this.svgHolder.appendChild(this.tierHolderHolder);this.bhtmlRoot=c("div");this.disablePoweredBy||this.bhtmlRoot.appendChild(c("span",["Powered by ",c("a","Biodalliance",{href:"http://www.biodalliance.org/"})," "+N],{className:"powered-by"}));
this.browserHolder.appendChild(this.bhtmlRoot);this.resizeListener=function(d){l.resizeViewer()};window.addEventListener("resize",this.resizeListener,!1);this.ruler=c("div",null,{className:"guideline"});this.ruler2=c("div",null,{className:"single-base-guideline"});this.tierHolderHolder.appendChild(this.ruler);this.tierHolderHolder.appendChild(this.ruler2);this.chainConfigs=this.chains||{};this.chains={};for(var L in this.chainConfigs)a=this.chainConfigs[L],a instanceof I&&console.log('WARNING: Should no longer use "new Chainset" in Biodalliance configurations.'),
this.chains[L]=new I(a);if(0<this.maxWorkers){L=[];for(a=0;a<this.maxWorkers;++a)L.push(y(this));L=t.all(L)}else L=t.resolve([]);this.fetchWorkers=null;this.nextWorker=0;L.then(function(d){console.log("Booted "+d.length+" workers");l.fetchWorkers=d},function(d){console.log("Failed to boot workers",d)}).then(function(){if(d.offscreenInitWidth||"none"!=window.getComputedStyle(l.browserHolderHolder).display&&0<l.tierHolder.getBoundingClientRect().width)setTimeout(function(){l.realInit2()},1);else var a=
setInterval(function(){"none"!=window.getComputedStyle(l.browserHolderHolder).display&&0<l.tierHolder.getBoundingClientRect().width&&(clearInterval(a),l.realInit2())},300)})}};m.prototype.realInit2=function(){var d=this;b(this.tierHolder);b(this.pinnedTierHolder);this.featurePanelWidth=this.tierHolder.getBoundingClientRect().width|d.offscreenInitWidth|0;this.scale=this.featurePanelWidth/(this.viewEnd-this.viewStart);this.zoomMax||(this.zoomMax=this.zoomExpt*Math.log(this.maxViewWidth/this.zoomBase),
this.zoomMin=this.zoomExpt*Math.log(this.featurePanelWidth/this.maxPixelsPerBase/this.zoomBase));this.zoomSliderValue=this.zoomExpt*Math.log((this.viewEnd-this.viewStart+1)/this.zoomBase);this.tierHolderHolder.addEventListener("mousewheel",function(a){a.stopPropagation();a.preventDefault();if(a.wheelDeltaX){var l=a.wheelDeltaX/5;d.reverseScrolling||(l=-l);d.move(l)}a.wheelDeltaY&&(l=a.wheelDeltaY,d.reverseScrolling&&(l=-l),d.tierHolder.scrollTop+=l)},!1);this.tierHolderHolder.addEventListener("MozMousePixelScroll",
function(a){a.stopPropagation();a.preventDefault();1==a.axis?0!=a.detail&&(a=a.detail/4,d.reverseScrolling&&(a=-a),d.move(a)):(a=a.detail,d.reverseScrolling||(a=-a),d.tierHolder.scrollTop+=a)},!1);this.tierHolderHolder.addEventListener("touchstart",function(a){return d.touchStartHandler(a)},!1);this.tierHolderHolder.addEventListener("touchmove",function(a){return d.touchMoveHandler(a)},!1);this.tierHolderHolder.addEventListener("touchend",function(a){return d.touchEndHandler(a)},!1);this.tierHolderHolder.addEventListener("touchcancel",
function(a){return d.touchCancelHandler(a)},!1);var a=function(a){if(13==a.keyCode){var l=!1;for(a=0;a<d.tiers.length;++a){var b=d.tiers[a];b.wantedLayoutHeight&&b.wantedLayoutHeight!=b.layoutHeight&&(b.layoutHeight=b.wantedLayoutHeight,b.clipTier(),l=!0)}l&&d.arrangeTiers()}else if(32==a.keyCode||32==a.charCode)d.isSnapZooming?(d.isSnapZooming=!1,l=(d.savedZoom||20)+d.zoomMin):(d.isSnapZooming=!0,l=(d.savedZoom||0)+d.zoomMin),d.savedZoom=d.zoomSliderValue-d.zoomMin,d.zoomSliderValue=l,d.zoom(Math.exp(1*
l/d.zoomExpt)),a.stopPropagation(),a.preventDefault();else if(85==a.keyCode)"opts"===d.uiMode&&(l=document.getElementById("singleBaseHightlightButton").checked,document.getElementById("singleBaseHightlightButton").checked=!l),d.singleBaseHighlight=!d.singleBaseHighlight,d.positionRuler(),a.stopPropagation(),a.preventDefault();else if(39==a.keyCode)a.stopPropagation(),a.preventDefault(),d.scrollArrowKey(a,-1);else if(37==a.keyCode)a.stopPropagation(),a.preventDefault(),d.scrollArrowKey(a,1);else if(38==
a.keyCode||87==a.keyCode)if(a.stopPropagation(),a.preventDefault(),a.shiftKey)a=d.getSelectedTier(),0>a||(l=d.tiers[a],a=l.forceHeight||l.subtiers[0].height,40<=a&&l.mergeConfig({height:a-10}));else if(a.ctrlKey||a.metaKey){if(a=d.getSelectedTier(),!(0>a)&&(l=d.tiers[a],l.quantLeapThreshold)){var b=l.subtiers[0].height,c=l.subtiers[0].quant;c&&(a=1*c.min,c=1*c.max,b=(c-a)/b,l.mergeConfig({quantLeapThreshold:a+((Math.round((l.quantLeapThreshold-a)/b)|0)+1)*b}),l.notify("Threshold: "+A(l.quantLeapThreshold)))}}else if(a.altKey){if(c=
d.selectedTiers.length,0!=c){a=d.selectedTiers[0];for(var f=!0,l=[],b=0;b<d.selectedTiers.length;++b)l.push(d.tiers[d.selectedTiers[b]]),0<b&&1!=d.selectedTiers[b]-d.selectedTiers[b-1]&&(f=!1);if(!(f&&0>=a)){for(b=d.selectedTiers.length-1;0<=b;--b)d.tiers.splice(d.selectedTiers[b],1);d.selectedTiers.splice(0,c);c=f?a-1:a;for(b=0;b<l.length;++b)d.tiers.splice(c+b,0,l[b]),d.selectedTiers.push(c+b);d.withPreservedSelection(d._ensureTiersGrouped);d.markSelectedTiers();d.notifyTierSelection();d.reorderTiers();
d.notifyTier("selected",a)}}}else if(a=d.getSelectedTier(),0<a){if(d.setSelectedTier(a-1),a=d.tiers[d.getSelectedTier()],l=a.row.offsetTop,a=l+a.row.offsetHeight,l<d.tierHolder.scrollTop||a>d.tierHolder.scrollTop+d.tierHolder.offsetHeight)d.tierHolder.scrollTop=l}else d.notifyTierSelectionWrap(-1);else if(40==a.keyCode||83==a.keyCode)if(a.stopPropagation(),a.preventDefault(),a.shiftKey)a=d.getSelectedTier(),0>a||(l=d.tiers[a],a=l.forceHeight||l.subtiers[0].height,l.mergeConfig({height:a+10}));else if(a.ctrlKey||
a.metaKey){if(a=d.getSelectedTier(),!(0>a)&&(l=d.tiers[a],l.quantLeapThreshold&&(b=l.subtiers[0].height,c=l.subtiers[0].quant)))a=1*c.min,c=1*c.max,b=(c-a)/b,c=Math.round((l.quantLeapThreshold-a)/b)|0,1<c&&(l.mergeConfig({quantLeapThreshold:a+(c-1)*b}),l.notify("Threshold: "+A(l.quantLeapThreshold)))}else if(a.altKey){if(c=d.selectedTiers.length,0!=c){a=d.selectedTiers[0];for(var L=0,l=[],b=0;b<d.selectedTiers.length;++b)l.push(d.tiers[d.selectedTiers[b]]),0<b&&(L+=d.selectedTiers[b]-d.selectedTiers[b-
1]-1);f=0==L;if(!(f&&a+c>=d.tiers.length)){for(b=d.selectedTiers.length-1;0<=b;--b)d.tiers.splice(d.selectedTiers[b],1);d.selectedTiers.splice(0,c);c=f?a+1:a+L;for(b=0;b<l.length;++b)d.tiers.splice(c+b,0,l[b]),d.selectedTiers.push(c+b);d.withPreservedSelection(function(){d._ensureTiersGrouped(!0)});d.markSelectedTiers();d.notifyTierSelection();d.reorderTiers();d.notifyTier("selected",a)}}}else{if(a=d.getSelectedTier(),a<d.tiers.length-1&&(d.setSelectedTier(a+1),a=d.tiers[d.getSelectedTier()],l=a.row.offsetTop,
a=l+a.row.offsetHeight,l<d.tierHolder.scrollTop||a>d.tierHolder.scrollTop+d.tierHolder.offsetHeight))d.tierHolder.scrollTop=Math.min(l,a-d.tierHolder.offsetHeight)}else if(187==a.keyCode||61==a.keyCode)a.stopPropagation(),a.preventDefault(),d.zoomStep(-10);else if(189==a.keyCode||173==a.keyCode)a.stopPropagation(),a.preventDefault(),d.zoomStep(10);else if(73==a.keyCode||105==a.keyCode)a.stopPropagation(),a.preventDefault(),a=d.getSelectedTier(),0>a||(b=d.tiers[a],b.infoVisible?(b.infoElement.style.display=
"none",b.updateHeight(),b.infoVisible=!1):(b.infoElement.style.display="block",b.updateHeight(),b.infoVisible=!0));else if(84==a.keyCode||116==a.keyCode)if(a.shiftKey)for(a.stopPropagation(),a.preventDefault(),a=0;a<d.tiers.length;++a)b=d.tiers[a],b.dasSource.collapseSuperGroups&&(void 0===l&&(l=!b.bumped),b.mergeConfig({bumped:l}));else a.ctrlKey||a.metaKey||(a.stopPropagation(),a.preventDefault(),a=d.getSelectedTier(),0>a||(b=d.tiers[a],b.dasSource.collapseSuperGroups&&(void 0===l&&(l=!b.bumped),
b.mergeConfig({bumped:l}))));else if(77==a.keyCode||109==a.keyCode)a.stopPropagation(),a.preventDefault(),(a.ctrlKey||a.metaKey)&&1<d.selectedTiers.length&&d.mergeSelectedTiers();else if(68==a.keyCode||100==a.keyCode){if(a.stopPropagation(),a.preventDefault(),a.ctrlKey||a.metaKey)a=d.getSelectedTier(),0>a||d.addTier(d.tiers[a].dasSource)}else if(80==a.keyCode||112==a.keyCode)if(a.ctrlKey||a.metaKey){l=[];for(a=0;a<d.selectedTiers.length;++a)l.push(d.tiers[d.selectedTiers[a]]);for(a=0;a<l.length;++a)l[a].mergeConfig({pinned:!l[a].pinned})}};
this.browserHolder.addEventListener("focus",function(l){d.browserHolder.addEventListener("keydown",a,!1)},!1);this.browserHolder.addEventListener("blur",function(l){d.browserHolder.removeEventListener("keydown",a,!1)},!1);this.hPopupHolder=c("div");this.hPopupHolder.style["font-family"]="helvetica";this.hPopupHolder.style["font-size"]="12pt";this.hPopupHolder.classList.add("dalliance");document.body.appendChild(this.hPopupHolder);for(var f=0;f<this.sources.length;++f){var l=this.sources[f];if(l){var L=
{};this.restoredConfigs&&(L=this.restoredConfigs[f]);l.disabled||this.makeTier(l,L).then(function(a){d.refreshTier(a)})}}d._ensureTiersGrouped();d.arrangeTiers();d.reorderTiers();(f=this.getSequenceSource())&&f.getSeqInfo(this.chr,function(a){d.currentSeqMax=a?a.length:-1});this.queryRegistry();for(var g in this.chains)this.queryRegistry(g,!0);if(this.hubs)for(g=0;g<this.hubs.length;++g)f=this.hubs[g],"string"==typeof f&&(f={url:f}),function(a){S(a.url,function(l,b){if(b)console.log(b);else{var c;
if(c=a.genome?l.genomes[a.genome]:l.genomes[d.coordSystem.ucscName])a.mapping&&(c.mapping=a.mapping),d.hubObjects.push(c)}},a)}(f);this.fullScreen&&this.setFullScreenHeight();!this.statusRestored&&this.storeStatus&&this.storeStatus();d.setLocation(this.chr,this.viewStart,this.viewEnd,function(){d.setSelectedTier(1);for(var a=0;a<d.initListeners.length;++a)try{d.initListeners[a].call(d)}catch(l){console.log(l)}})};m.prototype.touchStartHandler=function(d){this.touchOriginX=d.touches[0].pageX;this.touchOriginY=
d.touches[0].pageY;2==d.touches.length&&(d=Math.abs(d.touches[0].pageX-d.touches[1].pageX),this.zooming=!0,this.zoomLastSep=this.zoomInitialSep=d,this.zoomInitialScale=this.scale)};m.prototype.touchMoveHandler=function(d){d.stopPropagation();d.preventDefault();if(1==d.touches.length){var a=d.touches[0].pageX;d=d.touches[0].pageY;this.touchOriginX&&a!=this.touchOriginX&&this.move(a-this.touchOriginX);this.touchOriginY&&d!=this.touchOriginY&&(this.tierHolder.scrollTop-=d-this.touchOriginY);this.touchOriginX=
a;this.touchOriginY=d}else if(this.zooming&&2==d.touches.length){a=Math.abs(d.touches[0].pageX-d.touches[1].pageX);if(a!=this.zoomLastSep){d=(d.touches[0].pageX+d.touches[1].pageX)/2;var b=this.viewStart+d/this.scale|0;this.scale=a/this.zoomInitialSep*this.zoomInitialScale;this.viewStart=b-d/this.scale|0;for(d=0;d<this.tiers.length;++d)this.tiers[d].draw()}this.zoomLastSep=a}};m.prototype.touchEndHandler=function(d){};m.prototype.touchCancelHandler=function(d){};m.prototype.makeTier=function(d,a){try{return this.realMakeTier(d,
a)}catch(b){console.log("Error initializing",d),console.log(b.stack||b)}};m.prototype.realMakeTier=function(d,a){var b=this,l=null;this.tierBackgroundColors&&(l=this.tierBackgroundColors[this.tiers.length%this.tierBackgroundColors.length]);var c=new n(this,d,a,l);c.oorigin=this.viewStart;var f=!1,g,q,w,h=function(d,a){var l=c.subtiers;if(l){var f=0;for(a-=c.padding;f<l.length&&a>l[f].height&&f<l.length-1;)a=a-l[f].height-c.padding,++f;if(!(f>=l.length))return l=l[f].glyphs,d-=(c.glyphCacheOrigin-
b.viewStart)*b.scale,k(l,d,a)}},C=function(d){d.preventDefault();d.stopPropagation();d=d.clientX;d!=q&&(b.move(d-q,!0),q=d);b.isDragging=!0},G=function(d){window.removeEventListener("mousemove",C,!0);window.removeEventListener("mouseup",G,!0);b.move(d.clientX-q)};c.viewport.addEventListener("mousedown",function(d){b.browserHolder.focus();d.preventDefault();c.row.getBoundingClientRect();d=d.clientX;window.addEventListener("mousemove",C,!0);window.addEventListener("mouseup",G,!0);g=q=d;b.isDragging=
!1},!1);c.viewport.addEventListener("mousemove",function(d){var a=c.row.getBoundingClientRect(),l=d.clientX-a.left,z=d.clientY-a.top,a=h(l,z);c.row.style.cursor=a&&0<a.length?"pointer":"default";w&&clearTimeout(w);f||(w=setTimeout(function(){var a=h(l,z);a&&0<a.length&&b.notifyFeatureHover(d,a[a.length-1],a,c)},1E3))});var t=null;c.viewport.addEventListener("mouseup",function(d){var a=c.row.getBoundingClientRect(),l=d.clientX-a.left,a=d.clientY-a.top,f=h(l,a);f&&0<f.length&&!b.isDragging&&(t?(clearTimeout(t),
t=null,b.featureDoubleClick(f,l,a)):t=setTimeout(function(){t=null;b.notifyFeature(d,f[f.length-1],f,c)},500));if(b.isDragging&&l!=g&&c.sequenceSource){var a=b.viewStart+l/b.scale,z=b.viewStart+g/b.scale;a<z?(l=a|0,a=z|0):(l=z|0,a|=0);b.notifyRegionSelect(b.chr,l,a)}b.isDragging=!1},!1);c.viewport.addEventListener("mouseout",function(d){f=!1});c.removeButton.addEventListener("click",function(d){d.stopPropagation();d.preventDefault();for(d=0;d<b.tiers.length;++d)if(b.tiers[d]===c){b.removeTier({index:d});
break}},!1);c.nameButton.addEventListener("click",function(d){d.stopPropagation();d.preventDefault();if(d.shiftKey){d=-1;for(var a=0;a<b.tiers.length;++a)if(b.tiers[a]===c){d=a;break}0<=d&&(a=b.selectedTiers.indexOf(d),0<=a?b.selectedTiers.splice(a,1):(b.selectedTiers.push(d),b.selectedTiers.sort()),b.markSelectedTiers(),b.notifyTierSelection(),0<b.selectedTiers.length?b.browserHolder.focus():b.notifyTierSelectionWrap(-1))}else{for(a=0;a<b.tiers.length;++a)if(b.tiers[a]===c&&(b.browserHolder.focus(),
1!=b.selectedTiers.length||b.selectedTiers[0]!=a)){b.setSelectedTier(a);return}c.infoVisible?(c.infoElement.style.display="none",c.updateHeight(),c.infoVisible=!1):(c.infoElement.style.display="block",c.updateHeight(),c.infoVisible=!0)}},!1);c.bumpButton.addEventListener("click",function(d){d.stopPropagation();d.preventDefault();var a;c.dasSource.collapseSuperGroups&&(void 0===a&&(a=!c.bumped),c.mergeConfig({bumped:a}))},!1);var u,e,A,x,I,ja=!1,m=function(d){var a=c.label;d.stopPropagation();d.preventDefault();
if(!u){e=c.pinned?b.pinnedTierHolder:b.tierHolder;A=e.scrollHeight-e.offsetHeight;u=a.cloneNode(!0);u.style.cursor="pointer";e.appendChild(u);a.style.visibility="hidden";for(var l=0;l<b.tiers.length;++l)if(b.tiers[l]===c){x=l;break}I=d.clientY}var f=e.getBoundingClientRect();u.style.left=a.getBoundingClientRect().left-f.left+"px";u.style.top=d.clientY-f.top+e.scrollTop-10+"px";a=d.clientY-f.top+e.scrollTop;for(l=0;l<b.tiers.length;++l)if(f=b.tiers[l],!(f.pinned^c.pinned)&&(f=f.row.getBoundingClientRect(),
a-=f.bottom-f.top,0>a)){if(l<x&&d.clientY<I||l>x&&d.clientY>I){b.withPreservedSelection(function(){b.tiers.splice(x,1);b.tiers.splice(l,0,c);b._ensureTiersGrouped(l>x)});for(a=0;a<b.tiers.length;++a)b.tiers[a]==c&&(x=a);I=d.clientY;b.reorderTiers();e.appendChild(u);ja=!0}break}u.offsetTop<e.scrollTop?e.scrollTop-=e.scrollTop-u.offsetTop:u.offsetTop+u.offsetHeight>e.scrollTop+e.offsetHeight&&(e.scrollTop=Math.min(e.scrollTop+(u.offsetTop+u.offsetHeight)-(e.scrollTop+e.offsetHeight),A))},B=function(d){var a=
c.label;d.stopPropagation();d.preventDefault();u&&(u.style.cursor="auto",e.removeChild(u),u=null,a.style.visibility="visible");document.removeEventListener("mousemove",m,!1);document.removeEventListener("mouseup",B,!1);if(ja){for(d=0;d<b.tiers.length;++d)if(b.tiers[d]==c){b.setSelectedTier(d);break}b.notifyTier("reordered",c)}};c.label.addEventListener("mousedown",function(d){d.stopPropagation();d.preventDefault();ja=!1;document.addEventListener("mousemove",m,!1);document.addEventListener("mouseup",
B,!1)},!1);this.tiers.push(c);return c.init().then(function(d){d.currentlyHeight=50;b.updateHeight();d.updateLabel();b.withPreservedSelection(b._ensureTiersGrouped);d._updateFromConfig();b.reorderTiers();return d})};m.prototype.reorderTiers=function(){b(this.tierHolder);b(this.pinnedTierHolder);this.disablePinning&&(this.tierHolder.appendChild(this.ruler),this.tierHolder.appendChild(this.ruler2));for(var d=!1,a=[],c=[],l=0;l<this.tiers.length;++l){var f=this.tiers[l];f.pinned&&!this.disablePinning?
(a.push(f),this.pinnedTierHolder.appendChild(this.tiers[l].row),d=!0):(c.push(f),this.tierHolder.appendChild(this.tiers[l].row))}this.withPreservedSelection(function(){this.tiers.splice(0,this.tiers.length);for(var d=0;d<a.length;++d)this.tiers.push(a[d]);for(d=0;d<c.length;++d)this.tiers.push(c[d])});d?this.pinnedTierHolder.classList.add("tier-holder-pinned-full"):this.pinnedTierHolder.classList.remove("tier-holder-pinned-full");this.arrangeTiers()};m.prototype.withPreservedSelection=function(d){for(var a=
[],b=0;b<this.selectedTiers.length;++b)a.push(this.tiers[this.selectedTiers[b]]);d.call(this);this.selectedTiers=[];for(d=0;d<this.tiers.length;++d)0<=a.indexOf(this.tiers[d])&&this.selectedTiers.push(d)};m.prototype.refreshTier=function(a,b){b=b||d;this.knownSpace&&this.knownSpace.invalidate(a,b)};m.prototype._ensureTiersGrouped=function(d){for(var a={},b=0;b<this.tiers.length;++b){var l=this.tiers[b];l.dasSource.tierGroup&&pusho(a,l.dasSource.tierGroup,l)}var c=[];d&&this.tiers.reverse();for(b=
0;b<this.tiers.length;++b)if(l=this.tiers[b],l.dasSource.tierGroup){var f=a[l.dasSource.tierGroup];if(f){d&&f.reverse();for(var g=0;g<f.length;++g)c.push(f[g]);a[l.dasSource.tierGroup]=null}}else c.push(l);d&&c.reverse();this.tiers.splice(0,this.tiers.length);for(g=0;g<c.length;++g)this.tiers.push(c[g])};m.prototype.arrangeTiers=function(){for(var d=[],a={},b=0;b<this.tiers.length;++b){var l=this.tiers[b];l.pinned&&(d.push(l),l.dasSource.tierGroup&&pusho(a,l.dasSource.tierGroup,l))}for(b=0;b<this.tiers.length;++b)l=
this.tiers[b],l.pinned||(d.push(l),l.dasSource.tierGroup&&pusho(a,l.dasSource.tierGroup,l));for(var f in a){var l=a[f],g=this.tierGroups[f];g||(g={element:c("div",c("span",f,{className:"tier-group-label"}),{className:"tier-group"})},this.tierGroups[f]=g);g.element.parentNode&&g.element.parentNode.removeChild(g.element);for(var q=l[0].pinned?this.pinnedTierHolder:this.tierHolder,n=1E7,w=0,b=0;b<l.length;++b)var h=l[b].row,n=Math.min(n,h.offsetTop),w=Math.max(w,h.offsetTop+h.offsetHeight);g.element.style.top=
n+"px";g.element.style.left="0px";g.element.style.height=w-n+"px";q.appendChild(g.element)}if(this.tierBackgroundColors)for(b=0;b<d.length;++b)l=d[b],l.setBackground(this.tierBackgroundColors[b%this.tierBackgroundColors.length]),l.label.style.left=l.dasSource.tierGroup?"18px":"2px",l.background=this.tierBackgroundColors[b%this.tierBackgroundColors.length]};m.prototype.refresh=function(){this.retrieveTierData(this.tiers,d);this.drawOverlays();this.positionRuler()};var d=function(d,a){a.draw();a.updateStatus(d)};
m.prototype.retrieveTierData=function(d,a){this.notifyLocation();var b=100/this.scale|0,l=1E3/this.scale|0,c=(this.viewStart+this.viewEnd)/2,f=c-this.origin;this.origin=c;this.scaleAtLastRedraw=this.scale;for(c=0;c<d.length;++c){var g=f;d[c].originHaxx&&(g+=d[c].originHaxx);d[c].originHaxx=g}f=this.targetQuantRes/this.scale;c=Math.max(1,(this.viewStart|0)-b);b=Math.min((this.viewEnd|0)+b,0<(this.currentSeqMax|0)?this.currentSeqMax|0:1E9);g=Math.max(1,(this.viewStart|0)-l);l=Math.min((this.viewEnd|
0)+l,0<(this.currentSeqMax|0)?this.currentSeqMax|0:1E9);if(!this.knownSpace||this.knownSpace.chr!==this.chr){var q=this.getSequenceSource();this.knownSpace&&this.knownSpace.cancel();this.knownSpace=new P(this.tiers,this.chr,g,l,f,q)}(q=this.knownSpace.bestCacheOverlapping(this.chr,c,b))&&q.min<=c&&q.max>=b?(this.drawnStart=Math.max(q.min,g),this.drawnEnd=Math.min(q.max,l)):(this.drawnStart=g,this.drawnEnd=l);this.knownSpace.retrieveFeatures(d,this.chr,this.drawnStart,this.drawnEnd,f,a)};m.prototype.queryRegistry=
function(d,b){if(this.registry){var c,l;d?(c=this.chains[d].coords,this.mappableSources[d]||(this.mappableSources[d]=new a),l=this.mappableSources[d]):(c=this.coordSystem,l=this.availableSources);var g=x(f(c));if(b){var q=localStorage["dalliance.registry."+g+".last_queried"];if(q)try{if(h(l,JSON.parse(localStorage["dalliance.registry."+g+".sources"]),d),432E5>(Date.now()|0)-(q|0))return}catch(n){console.log("Bad registry cache: "+n)}}q=this.registry;if(0==q.indexOf("//")){var w=window.location.protocol;
"https:"!=w&&"http:"!=w&&(q="http:"+q)}(new D(q)).sources(function(a){for(var b=[],f=0;f<a.length;++f){var q=a[f];if(q.coords&&0!=q.coords.length){var n=q.coords[0];n.taxon==c.taxon&&n.auth==c.auth&&n.version==c.version&&b.push(q)}}localStorage["dalliance.registry."+g+".sources"]=JSON.stringify(b);localStorage["dalliance.registry."+g+".last_queried"]=""+Date.now();h(l,b,d)},function(d){},c)}};m.prototype.move=function(d,a){var b=this.viewEnd-this.viewStart,l=this.viewStart-1*d/this.scale,c=l+b;a||
(0<this.currentSeqMax&&c>this.currentSeqMax&&(c=this.currentSeqMax,l=this.viewEnd-b),1>l&&(l=1,c=l+b));this.setLocation(null,l,c,null,a)};m.prototype.zoomStep=function(d){var a=1*this.zoomSliderValue;d=a+d;d<this.zoomMin&&(d=this.zoomMin);d>this.zoomMax&&(d=this.zoomMax);d!=a&&(this.zoomSliderValue=d,this.zoom(Math.exp(1*d/this.zoomExpt)))};m.prototype.zoom=function(d){this.zoomFactor=d;d=Math.round((this.viewStart+this.viewEnd)/2)|0;this.viewStart=d-this.zoomBase*this.zoomFactor/2;this.viewEnd=d+
this.zoomBase*this.zoomFactor/2;0<this.currentSeqMax&&this.viewEnd>this.currentSeqMax+5&&(d=this.viewEnd-this.viewStart+1,this.viewEnd=this.currentSeqMax,this.viewStart=this.viewEnd-d+1);1>this.viewStart&&(d=this.viewEnd-this.viewStart+1,this.viewStart=1,this.viewEnd=this.viewStart+d-1);this.scale=this.featurePanelWidth/(this.viewEnd-this.viewStart);this.notifyLocation();this.refresh()};m.prototype.spaceCheck=function(d){this.knownSpace&&this.knownSpace.chr===this.chr?(d=100/this.scale|0,((this.drawnStart|
0)>Math.max(1,(this.viewStart|0)-d|0)||(this.drawnEnd|0)<Math.min((this.viewEnd|0)+d,0<(this.currentSeqMax|0)?this.currentSeqMax|0:1E9))&&this.refresh()):this.refresh()};m.prototype.resizeViewer=function(d){var a=this.tierHolder.getBoundingClientRect().width|0;if(0!=a){var b=Math.max(this.featurePanelWidth,300);this.featurePanelWidth=a|0;b!=this.featurePanelWidth&&(this.zoomMax=this.zoomExpt*Math.log(this.maxViewWidth/this.zoomBase),this.zoomMin=this.zoomExpt*Math.log(this.featurePanelWidth/this.maxPixelsPerBase/
this.zoomBase),this.zoomSliderValue=this.zoomExpt*Math.log((this.viewEnd-this.viewStart+1)/this.zoomBase),this.viewEnd=this.viewStart+(this.viewEnd-this.viewStart)*this.featurePanelWidth/b,a=this.viewEnd-this.viewStart+1,0<this.currentSeqMax&&this.viewEnd>this.currentSeqMax&&(this.viewEnd=this.currentSeqMax,this.viewStart=this.viewEnd-a+1),1>this.viewStart&&(this.viewStart=1,this.viewEnd=this.viewStart+a-1),this.positionRuler(),d||this.spaceCheck(),this.notifyLocation());this.fullScreen&&this.setFullScreenHeight()}};
m.prototype.setFullScreenHeight=function(){this.browserHolder.style.maxHeight=Math.max(300,window.innerHeight-(document.body.offsetHeight-this.browserHolder.offsetHeight)-20)+"px"};m.prototype.addTier=function(d){var a=this;d=g(d);d.disabled=!1;return this.makeTier(d).then(function(d){a.refreshTier(d);a.markSelectedTiers();a.positionRuler();a.notifyTier("added",d);return d})};m.prototype.removeTier=function(d,a){var b=-1;if("undefined"!==typeof d.index&&0<=d.index&&d.index<this.tiers.length)b=d.index;
else for(var l=0;l<this.tiers.length;++l)if(B(d,this.tiers[l].dasSource)){b=l;break}if(0>b)throw"Couldn't find requested tier";l=this.tiers[b];this.tiers.splice(b,1);for(var c=[],f=0;f<this.selectedTiers.length;++f){var g=this.selectedTiers[f];g<b?c.push(g):g>b&&c.push(g-1)}this.selectedTiers=c;this.markSelectedTiers();l.destroy();this.knownSpace&&(this.knownSpace.featureCache[l]=null);this.reorderTiers();this.notifyTier("removed",l)};m.prototype.removeAllTiers=function(){var d=this;this.selectedTiers=
[];this.markSelectedTiers();this.tiers.forEach(function(a){a.destroy();d.knownSpace&&(d.knownSpace.featureCache[a]=null)});this.tiers.length=0;this.reorderTiers();this.notifyTier("removedAll",null)};m.prototype.getSequenceSource=function(){void 0===this._sequenceSource&&(this._sequenceSource=this._getSequenceSource());return this._sequenceSource};m.prototype._getSequenceSource=function(){for(var d=0;d<this.tiers.length;++d)if(this.tiers[d].sequenceSource)return this.tiers[d].sequenceSource;for(d=
0;d<this.defaultSources.length;++d){var a=this.defaultSources[d];if(a.provides_entrypoints||"sequence"==a.tier_type||a.twoBitURI||a.twoBitBlob)return a.twoBitURI||a.twoBitBlob?new w(a):new G(a)}};m.prototype.setLocation=function(d,a,b,l,c){if("number"!==typeof a)throw Error("minimum must be a number (got "+JSON.stringify(a)+")");if("number"!==typeof b)throw Error("maximum must be a number (got "+JSON.stringify(b)+")");if(a>b){var f=a;a=b;b=f}else a===b&&(b+=1);l||(l=function(d){if(d)throw d;});var g=
this;if((!d||d==this.chr)&&0<this.currentSeqMax)return this._setLocation(null,a,b,null,l,c);var q=this.getSequenceSource();if(!q)return l("Need a sequence source");var n=d||this.chr;q.getSeqInfo(n,function(f){if(f)return g._setLocation(d,a,b,f,l,c);var w;w=0==n.indexOf("chr")?n.substr(3):"chr"+n;q.getSeqInfo(w,function(f){return!f&&d?l("Couldn't find sequence '"+d+"'"):f?g._setLocation(w,a,b,f,l,c):g._setLocation(null,a,b,null,l,c)})})};m.prototype._setLocation=function(d,a,b,l,c,f){var g=!1;d&&(0==
d.indexOf("chr")&&(d=d.substring(3)),this.chr!=d&&(g=!0),this.chr=d,this.currentSeqMax=l.length);a=parseFloat(a);b=parseFloat(b);d=Math.max(10,b-a+1);f||(f=this.currentSeqMax,0>=f&&(f=1E12),1>a&&(a=1,b=a+d-1),b>f&&(b=f,a=Math.max(1,b-d+1)));this.viewStart=a;this.viewEnd=b;a=Math.max(this.featurePanelWidth||this.offscreenInitWidth,50)/(this.viewEnd-this.viewStart);f=1E-6<Math.abs(a-this.scale);this.scale=a;b=this.zoomSliderValue;this.zoomSliderValue=a=this.zoomExpt*Math.log((this.viewEnd-this.viewStart+
1)/this.zoomBase);if(f||g){for(g=0;g<this.tiers.length;++g)this.tiers[g].viewportHolder.style.left="5000px",this.tiers[g].overlay.style.left="5000px";this.refresh();this.savedZoom?(a-=this.zoomMin,b-=this.zoomMin,g=a-this.savedZoom,Math.abs(a-b)>Math.abs(g)&&(this.isSnapZooming=!this.isSnapZooming,this.savedZoom=b)):(this.isSnapZooming=!1,this.savedZoom=null)}else for(g=0;g<this.tiers.length;++g)this.tiers[g].viewportHolder.style.left=""+((-((this.viewStart-this.tiers[g].norigin)*this.scale)|0)-1E3)+
"px",this.tiers[g].drawOverlay();this.notifyLocation();this.spaceCheck();this.instrumentActivity&&(this.activityStartTime=Date.now()|0);return c()};m.prototype.setCenterLocation=function(d,a){var b=(this.viewEnd-this.viewStart)/2;this.setLocation(d,a-b,a+b)};m.prototype.pingActivity=function(){if(this.instrumentActivity&&this.activityStartTime){for(var d=0,a=0;a<this.tiers.length;++a)"none"!==this.tiers[a].loaderButton.style.display&&++d;0==d&&(d=Date.now()|0,console.log("Loading took "+(d-this.activityStartTime)+
"ms"),this.activityStartTime=null)}};m.prototype.addInitListener=function(d){this.initListeners.push(d)};m.prototype.addFeatureListener=function(d,a){this.featureListeners.push(d)};m.prototype.removeFeatureListener=function(d,a){var b=arrayIndexOf(this.featureListeners,d);0<=b&&this.featureListeners.splice(b,1)};m.prototype.notifyFeature=function(d,a,b,l){for(var c=0;c<this.featureListeners.length;++c)try{if(this.featureListeners[c](d,a,b,l))break}catch(f){console.log(f.stack)}};m.prototype.addFeatureHoverListener=
function(d,a){this.featureHoverListeners.push(d)};m.prototype.removeFeatureHoverListener=function(d,a){var b=arrayIndexOf(this.featureHoverListeners,d);0<=b&&this.featureHoverListeners.splice(b,1)};m.prototype.notifyFeatureHover=function(d,a,b,l){for(var c=0;c<this.featureHoverListeners.length;++c)try{this.featureHoverListeners[c](d,a,b,l)}catch(f){console.log(f.stack)}};m.prototype.addViewListener=function(d,a){this.viewListeners.push(d)};m.prototype.removeViewListener=function(d,a){var b=arrayIndexOf(this.viewListeners,
d);0<=b&&this.viewListeners.splice(b,1)};m.prototype.notifyLocation=function(){var d=Math.max(1,this.viewStart|0),a=this.viewEnd|0;0<this.currentSeqMax&&a>this.currentSeqMax&&(a=this.currentSeqMax);for(var b=0;b<this.viewListeners.length;++b)try{this.viewListeners[b](this.chr,d,a,this.zoomSliderValue,{current:this.zoomSliderValue,alternate:this.savedZoom+this.zoomMin||this.zoomMin,isSnapZooming:this.isSnapZooming,min:this.zoomMin,max:this.zoomMax},this.viewStart,this.viewEnd)}catch(l){console.log(l.stack)}};
m.prototype.addTierListener=function(d){this.tierListeners.push(d)};m.prototype.removeTierListener=function(d){d=arrayIndexOf(this.tierListeners,d);0<=d&&this.tierListeners.splice(d,1)};m.prototype.notifyTier=function(d,a){for(var b=0;b<this.tierListeners.length;++b)try{this.tierListeners[b](d,a)}catch(l){console.log(l.stack)}};m.prototype.addRegionSelectListener=function(d){this.regionSelectListeners.push(d)};m.prototype.removeRegionSelectListener=function(d){d=arrayIndexOf(this.regionSelectListeners,
d);0<=d&&this.regionSelectListeners.splice(d,1)};m.prototype.notifyRegionSelect=function(d,a,b){for(var l=0;l<this.regionSelectListeners.length;++l)try{this.regionSelectListeners[l](d,a,b)}catch(c){console.log(c.stack)}};m.prototype.highlightRegion=function(d,a,b){var l=this;if(d==this.chr)return this._highlightRegion(d,a,b);var c=this.getSequenceSource();if(!c)throw"Need a sequence source";c.getSeqInfo(d,function(f){if(f)return l._highlightRegion(d,a,b);var g;g=0==d.indexOf("chr")?d.substr(3):"chr"+
d;c.getSeqInfo(g,function(d){if(d)return l._highlightRegion(g,a,b)})})};m.prototype._highlightRegion=function(d,a,b){for(var l=0;l<this.highlights.length;++l){var c=this.highlights[l];if(c.chr==d&&c.min==a&&c.max==b)return}this.highlights.push(new p(d,a,b));l=this.viewStart-1E3/this.scale;c=this.viewEnd+1E3/this.scale;(d==this.chr||d=="chr"+this.chr)&&a<c&&b>l&&this.drawOverlays();this.notifyLocation()};m.prototype.clearHighlights=function(){this.highlights=[];this.drawOverlays();this.notifyLocation()};
m.prototype.drawOverlays=function(){for(var d=0;d<this.tiers.length;++d)this.tiers[d].drawOverlay()};m.prototype.featuresInRegion=function(d,a,b){var l=[];if(d!==this.chr)return[];for(d=0;d<this.tiers.length;++d)for(var c=this.tiers[d].currentFeatures||[],f=0;f<c.length;++f){var g=c[f];g.min<=b&&g.max>=a&&l.push(g)}return l};m.prototype.getSelectedTier=function(){return 0<this.selectedTiers.length?this.selectedTiers[0]:-1};m.prototype.setSelectedTier=function(d){this.selectedTiers=null==d?[]:[d];
this.markSelectedTiers();this.notifyTierSelection()};m.prototype.markSelectedTiers=function(){for(var d=0;d<this.tiers.length;++d){var a=this.tiers[d].nameButton;0<=this.selectedTiers.indexOf(d)?a.classList.add("active"):a.classList.remove("active")}0<this.selectedTiers.length&&(d=this.browserHolder.offsetTop+this.browserHolder.offsetHeight/2,d>document.body.scrollTop&&d+100<document.body.scrollTop+window.innerHeight&&this.browserHolder.focus())};m.prototype.addTierSelectionListener=function(d){this.tierSelectionListeners.push(d)};
m.prototype.removeTierSelectionListener=function(d){d=arrayIndexOf(this.tierSelectionListeners,d);0<=d&&this.tierSelectionListeners.splice(d,1)};m.prototype.notifyTierSelection=function(){for(var d=0;d<this.tierSelectionListeners.length;++d)try{this.tierSelectionListeners[d](this.selectedTiers)}catch(a){console.log(a.stack)}};m.prototype.addTierSelectionWrapListener=function(d){this.tierSelectionWrapListeners.push(d)};m.prototype.removeTierSelectionWrapListener=function(d){d=arrayIndexOf(this.tierSelectionWrapListeners,
d);0<=d&&this.tierSelectionWrapListeners.splice(d,1)};m.prototype.notifyTierSelectionWrap=function(d){for(var a=0;a<this.tierSelectionWrapListeners.length;++a)try{this.tierSelectionWrapListeners[a](d)}catch(b){console.log(b.stack)}};m.prototype.positionRuler=function(){var d="none",a="",b="";"center"==this.rulerLocation?(d="block",a=""+(this.featurePanelWidth/2|0)+"px"):"left"==this.rulerLocation?(d="block",a="0px"):"right"==this.rulerLocation?(d="block",b="0px"):d="none";this.ruler.style.display=
d;this.ruler.style.left=a;this.ruler.style.right=b;this.singleBaseHighlight?(this.ruler2.style.display="block",this.ruler2.style.borderWidth="1px",1>this.scale?(this.ruler2.style.width="0px",this.ruler2.style.borderRightWidth="0px"):(this.ruler2.style.width=this.scale+"px",this.ruler2.style.borderRightWidth="1px"),this.locSingleBase.style.visibility="visible",this.locSingleBase.style.left=""+(this.featurePanelWidth/2-this.locSingleBase.offsetWidth/2+this.ruler2.offsetWidth/2|0)+"px"):(this.locSingleBase.style.visibility=
"hidden",this.ruler2.style.width="1px",this.ruler2.style.borderWidth="0px",this.ruler2.style.display="center"==this.rulerLocation?"none":"block");this.ruler2.style.left=""+(this.featurePanelWidth/2|0)+"px";for(var l=0;l<this.tiers.length;++l){var c=this.tiers[l],f=c.quantOverlay,g;c.subtiers&&0<c.subtiers.length&&(g=c.subtiers[0].quant);f&&(f.style.display=g?d:"none",f.style.left=a,f.style.right=b)}};m.prototype.featureDoubleClick=function(d,a,b){if(d&&0!=d.length&&(b=d[d.length-1],b.min&&b.max)){var l=
((b.min|0)-(this.viewStart|0))*this.scale,c=(b.max-b.min+1)*this.scale;d=((b.min|0)+(b.max|0))/2;10<c&&(a=1*(a-l)/c,0.3>a?d=b.min|0:0.7<a&&(d=(b.max|0)+1));a=this.viewEnd-this.viewStart;this.setLocation(null,d-a/2,d+a/2)}};m.prototype.zoomForScale=function(d){return 0.2<d?"high":0.01<d?"medium":"low"};m.prototype.zoomForCurrentScale=function(){return this.zoomForScale(this.scale)};m.prototype.updateHeight=function(){for(var d=0,a=0;a<this.tiers.length;++a)d+=this.tiers[a].currentHeight||30;this.ruler.style.height=
""+d+"px";this.ruler2.style.height=""+d+"px";this.browserHolder.style.display="block";this.browserHolder.style.display="flex"};m.prototype.scrollArrowKey=function(d,a){this.reverseKeyScrolling&&(a=-a);if(d.ctrlKey||d.metaKey){var b=!1;d.shiftKey&&(b=!0);this.leap(a,b)}else if(1<this.scale){var b=(this.viewStart+this.viewEnd)/2,b=b-Math.round(b),l=1;d.shiftKey&&(l*=10);0<a?(l=-l-b,0<b&&(l+=1)):(l-=b,0>b&&(l-=1));this.setLocation(null,this.viewStart+l,this.viewEnd+l)}else this.move(d.shiftKey?100*a:
25*a)};m.prototype.leap=function(d,a){var b=this,l=(b.viewStart+b.viewEnd+1)/2|0;0<d&&1>=b.viewStart?l-=1E8:0>d&&b.viewEnd>=b.currentSeqMax&&(l+=1E8);var c=b.getSelectedTier();0>c||((c=b.tiers[c])&&(c.featureSource&&this.sourceAdapterIsCapable(c.featureSource,"quantLeap")&&"number"==typeof c.quantLeapThreshold||c.featureSource&&this.sourceAdapterIsCapable(c.featureSource,"leap"))?c.findNextFeature(b.chr,l,-d,a,function(c){if(c){var f=c.min,g=c.max;a&&(0<d?f>l+1?g=f:(g++,f=g):g<l-1?(g++,f=g):g=f);
var q=b.viewEnd-b.viewStart+1;parseFloat(q/2)==parseInt(q/2)&&q--;f=(f+g-q)/2+1;b.setLocation(c.segment,f,f+q-1)}else alert("no next feature")}):this.move(100*d))};m.prototype.nameForCoordSystem=function(d){var a=null,b=null;this.assemblyNamePrimary&&(a=""+d.auth,"undefined"!==typeof d.version&&(a+=d.version));this.assemblyNameUcsc&&(b=d.ucscName);return null!=a&&null!=b?a+"/"+b:a||b||"unknown"};m.prototype.makeLoader=function(d){var a=1<window.devicePixelRatio;return 20>(d||16)?c("img",null,{src:this.resolveURL("$$img/spinner_"+
(a?16:32)+".gif"),width:"16",height:"16"}):c("img",null,{src:this.resolveURL("$$img/spinner_"+(a?24:48)+".gif"),width:"24",height:"24"})};m.prototype.canFetchPlainHTTP=function(){var d=this;if(!this._plainHTTPPromise){var a=this.getWorker();this._plainHTTPPromise=a?new t(function(b,l){a.postCommand({command:"textxhr",uri:d.httpCanaryURL},function(d,a){d?b(!0):b(!1)})}):new t(function(a,b){q(d.httpCanaryURL,function(d,b){d?a(!0):a(!1)},{timeout:2E3})})}return this._plainHTTPPromise};m.prototype.getWorker=
function(){if(!this.useFetchWorkers||!this.fetchWorkers||0==this.fetchWorkers.length)return null;this.nextWorker>=this.fetchWorkers.length&&(this.nextWorker=0);return this.fetchWorkers[this.nextWorker++]};v.prototype.postCommand=function(d,a,b){var l="x"+ ++this.tagSeed;d.tag=l;this.callbacks[l]=a;this.worker.postMessage(d,b)};if("undefined"!==typeof s){s.exports={Browser:m};e("./browser-ui");e("./track-adder");e("./feature-popup");e("./tier-actions");e("./domui");e("./search");s=e("./sourceadapters");
var w=s.TwoBitSequenceSource,G=s.DASSequenceSource,P=e("./kspace").KnownSpace,D=e("./das").DASRegistry}E.prototype.get=function(d){var a=this.sourcesByURI[J(d)];if(a)for(var b=0;b<a.configs.length;++b)if(C(a.configs[b],d))return a.sources[b]};E.prototype.put=function(d,a){var b=J(d),l=this.sourcesByURI[b];l||(l={configs:[],sources:[]},this.sourcesByURI[b]=l);l.configs.push(d);l.sources.push(a)}},{"./browser-ui":5,"./chainset":7,"./das":10,"./domui":11,"./feature-popup":19,"./kspace":23,"./numformats":26,
"./search":30,"./sha1":33,"./sourceadapters":34,"./sourcecompare":35,"./thub":42,"./tier":45,"./tier-actions":43,"./track-adder":46,"./utils":49,"./version":51,"es6-promise":53}],7:[function(e,s,r){function p(a,b,c,g){"string"==typeof a?(this.uri=a,this.srcTag=b,this.destTag=c,this.coords=g):(this.uri=a.uri,this.srcTag=a.srcTag,this.destTag=a.destTag,this.coords=f(a.coords),this.type=a.type,this.credentials=a.credentials);this.chainsBySrc={};this.chainsByDest={};this.postFetchQueues={};this.fetchedTiles=
{};this.granularity=1E6;this.chainFetcher="bigbed"==this.type?new h(this.uri,this.credentials):"alias"==this.type?new E(a):new m(this.uri,this.srcTag,this.destTag)}function m(b,c,f){this.source=new a(b);this.srcTag=c;this.destTag=f}function h(a,b){var c=this;this.uri=a;this.credentials=b;this.bwg=new x(function(a,b){n(new q(c.uri,{credentials:c.credentials}),function(c,f){c?a(c):b(f)})});this.bwg.then(function(a,b){b&&console.log(b)})}function k(a){return parseInt(a)}function v(a){return 0==a.indexOf("chr")?
a.substr(3):a}function y(a){var b={srcChr:v(a.srcChrom),srcMin:parseInt(a.srcStart),srcMax:parseInt(a.srcEnd),srcOri:a.srcOri,destChr:v(a.segment),destMin:a.min-1,destMax:a.max,destOri:a.ori,blocks:[]},c=a.srcStarts.split(",").map(k),f=a.destStarts.split(",").map(k);a=a.blockLens.split(",").map(k);for(var g=0;g<c.length;++g)b.blocks.push([c[g],f[g],a[g]]);return b}function E(a){this.conf=a;this.forwardAliases={};a=a.sequenceAliases||[];for(var b=0;b<a.length;++b){var c=a[b];if(!(2>c.length)){for(var f=
[],g=0;g<c.length-1;++g)f.push(c[g]);this.forwardAliases[c[c.length-1]]=f}}}if("undefined"!==typeof e){r=e("./das");var a=r.DASSource,c=r.DASSegment;r=e("./utils");var b=r.pusho,f=r.shallowCopy,g=e("./cigar").parseCigar,q=e("./bin").URLFetchable,n=e("./bigwig").makeBwg,x=e("es6-promise").Promise}p.prototype.exportConfig=function(){return{uri:this.uri,srcTag:this.srcTag,destTag:this.destTag,coords:this.coords,type:this.type,credentials:this.credentials}};p.prototype.mapPoint=function(a,b){for(var c=
this.chainsBySrc[a]||[],f=0;f<c.length;++f){var g=c[f];if(b>=g.srcMin&&b<=g.srcMax){var q;q="-"==g.srcOri?g.srcMax-b:b-g.srcMin;for(var n=g.blocks,h=0;h<n.length;++h){var k=n[h],d=k[0],w=k[1],k=k[2];if(q>=d&&q<=d+k)return c=q-d,{seq:g.destChr,pos:"-"==g.destOri?g.destMax-w-c:c+w+g.destMin,flipped:g.srcOri!=g.destOri}}}}return null};p.prototype.mapSegment=function(a,b,c){a=this.chainsBySrc[a]||[];for(var f=[],g=0;g<a.length;++g){var q=a[g];if(c>=q.srcMin&&b<=q.srcMax){var n,h;"-"==q.srcOri?(n=q.srcMax-
c,h=q.srcMax-b):(n=b-q.srcMin,h=c-q.srcMin);for(var k=q.blocks,d=0;d<k.length;++d){var w=k[d],G=w[0],e=w[1],w=w[2];if(h>=G&&n<=G+w){var x={segment:q.destChr,flipped:"-"==q.srcOri^"-"==q.destOri};"-"==q.destOri?(n>=G?x.max=q.destMax-e-n+G:(x.max=q.destMax-e,x.partialMax=G-n),h<=G+w?x.min=q.destMax-e-h+G:(x.min=q.destMax-e-w,x.partialMin=h-G-w)):(n>=G?x.min=q.destMin+e+n-G:(x.min=q.destMin+e,x.partialMin=G-n),h<=G+w?x.max=q.destMin+e+h-G:(x.max=q.destMin+e+w,x.partialMax=h-G-w));f.push(x)}}}}return f};
p.prototype.unmapPoint=function(a,b){for(var c=this.chainsByDest[a]||[],f=0;f<c.length;++f){var g=c[f];if(b>=g.destMin&&b<=g.destMax){var q;q="-"==g.srcOri?g.destMax-b:b-g.destMin;for(var n=g.blocks,h=0;h<n.length;++h){var k=n[h],d=k[0],w=k[1],k=k[2];if(q>=w&&q<=w+k)return c=q-w,f=c+d+g.srcMin,f="-"==g.destOri?g.srcMax-d-c:c+d+g.srcMin,{seq:g.srcChr,pos:f,flipped:g.srcOri!=g.destOri}}}}return null};p.prototype.sourceBlocksForRange=function(a,f,g,q){for(var n=this,h=f/this.granularity|0,k=g/this.granularity|
0,C=!1,e=h;e<=k;++e){var d=a+"_"+e;2!=this.fetchedTiles[d]&&(C=!0,1!=this.fetchedTiles[d]&&(this.fetchedTiles[d]=1))}if(C)this.postFetchQueues[a]||this.chainFetcher.fetchChains(a,h*this.granularity,(k+1)*this.granularity-1).then(function(d){n.chainsByDest||(n.chainsByDest[a]=[]);for(var b=0;b<d.length;++b){var l=d[b],c=n.chainsBySrc[l.srcChr];if(c){for(var f=!1,g=0;g<c.length;++g){var q=c[g];if(q.srcMin==l.srcMin&&q.srcMax==l.srcMax){f=!0;break}}f||c.push(l)}else n.chainsBySrc[l.srcChr]=[l];if(c=
n.chainsByDest[l.destChr]){f=!1;for(g=0;g<c.length;++g)if(q=c[g],q.destMin==l.destMin&&q.destMax==l.destMax){f=!0;break}f||c.push(l)}else n.chainsByDest[l.destChr]=[l]}for(d=h;d<=k;++d)n.fetchedTiles[a+"_"+d]=2;if(n.postFetchQueues[a]){d=n.postFetchQueues[a];for(b=0;b<d.length;++b)d[b]();n.postFetchQueues[a]=null}}).catch(function(d){console.log(d)}),b(this.postFetchQueues,a,function(){n.sourceBlocksForRange(a,f,g,q)});else{C=[];e=this.chainsByDest[a]||[];for(d=0;d<e.length;++d){var w=e[d];if(f<=
w.destMax&&g>=w.destMin){var G,x;"-"==w.srcOri?(G=w.destMax-g,x=w.destMax-f):(G=f-w.destMin,x=g-w.destMin);for(var m=w.blocks,z=0;z<m.length;++z){var p=m[z],E=p[0],l=p[1],L=p[2];x>=l&&G<=l+L&&(p=Math.max(G,l)-l,l=Math.min(x,l+L)-l,"-"==w.destOri?C.push(new c(w.srcChr,w.srcMax-E-l,w.srcMax-E-p)):C.push(new c(w.srcChr,w.srcMin+p+E,w.srcMin+l+E)))}}}q(C)}};m.prototype.fetchChains=function(a,b,c){var f=this;return new x(function(b,c){f.source.alignments(a,{},function(a){for(var c=[],q=0;q<a.length;++q)for(var d=
a[q],n=0;n<d.blocks.length;++n){for(var h=d.blocks[n],k,e,x=0;x<h.segments.length;++x){var t=h.segments[x],m=d.objects[t.object];m.dbSource===f.srcTag?k=t:m.dbSource===f.destTag&&(e=t)}if(k&&e){for(var h={srcChr:d.objects[k.object].accession,srcMin:k.min|0,srcMax:k.max|0,srcOri:k.strand,destChr:d.objects[e.object].accession,destMin:e.min|0,destMax:e.max|0,destOri:e.strand,blocks:[]},x=g(k.cigar),t=g(e.cigar),l=m=0,L=0,A=0;L<x.length&&A<t.length;)if("M"==x[L].op&&"M"==t[A].op){var p=Math.min(x[L].cnt,
t[A].cnt);h.blocks.push([m,l,p]);x[L].cnt==p?++L:x[L].cnt-=p;t[A].cnt==p?++A:t[A]-=p;m+=p;l+=p}else"I"==x[L].op?l+=x[L++].cnt:"I"==t[A].op&&(m+=t[A++].cnt);c.push(h)}}b(c)})})};h.prototype.fetchChains=function(a,b,c){return this.bwg.then(function(f,g){if(!f)throw Error("No BWG");return new x(function(g,q){f.getUnzoomedView().readWigData(a,b,c,function(a){g(a.map(y))})})})};E.prototype.fetchChains=function(a,b,c){b=[];c=this.forwardAliases[a]||[];for(var f=0;f<c.length;++f)b.push({srcChr:c[f],srcMin:1,
srcMax:1E9,srcOri:"+",destChr:a,destMin:1,destMax:1E9,destOri:"+",blocks:[[1,1,1E9]]});return x.resolve(b)};"undefined"!==typeof s&&(s.exports={Chainset:p})},{"./bigwig":3,"./bin":4,"./cigar":8,"./das":10,"./utils":49,"es6-promise":53}],8:[function(e,s,r){function p(h){for(var k=[],e;null!=(e=m.exec(h));){var p=e[1];0==p.length&&(p=1);k.push({cnt:p|0,op:e[2]})}return k}var m=/([0-9]*)([MIDS])/g;"undefined"!==typeof s&&(s.exports={parseCigar:p})},{}],9:[function(e,s,r){function p(a,b,f,g){this.red=
a|0;this.green=b|0;this.blue=f|0;g&&(this.name=g)}function m(a){a="00"+a.toString(16);return a.substring(a.length-2)}function h(c){var b=y[c];b||((b=E.exec(c))?b=new p("0x"+b[1]|0,"0x"+b[2]|0,"0x"+b[3]|0,c):(b=a.exec(c))?b=new p(b[1]|0,b[2]|0,b[3]|0,c):(console.log("couldn't handle color: "+c),b=y.black),y[c]=b);return b}function k(a,b,f){for(var g=[],q=0;q<f.length;++q)g.push(h(f[q]));f=[];q=0;a:for(;q<a;++q){for(var n=b[0]+1*q/(a-1)*(b[b.length-1]-b[0]),k=0;k<b.length-1;++k)if(n>=b[k]&&n<=b[k+1]){var n=
(n-b[k])/(b[k+1]-b[k]),e=g[k],k=g[k+1],k=(new p(e.red*(1-n)+k.red*n|0,e.green*(1-n)+k.green*n|0,e.blue*(1-n)+k.blue*n|0)).toSvgString();f.push(k);continue a}throw"Bad step";}return f}function v(a,b,f,g){return g?k(a,[0,0.5,1],[b,f,g]):k(a,[0,1],[b,f])}p.prototype.toSvgString=function(){this.name||(this.name="rgb("+this.red+","+this.green+","+this.blue+")");return this.name};p.prototype.toHexString=function(){return"#"+m(this.red)+m(this.green)+m(this.blue)};var y={red:new p(255,0,0,"red"),green:new p(0,
255,0,"green"),blue:new p(0,0,255,"blue"),yellow:new p(255,255,0,"yellow"),white:new p(255,255,255,"white"),black:new p(0,0,0,"black"),gray:new p(180,180,180,"gray"),grey:new p(180,180,180,"grey"),lightskyblue:new p(135,206,250,"lightskyblue"),lightsalmon:new p(255,160,122,"lightsalmon"),hotpink:new p(255,105,180,"hotpink")},E=/^#([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})$/,a=/rgb\(([0-9]+),([0-9]+),([0-9]+)\)/;"undefined"!==typeof s&&(s.exports={makeColourSteps:k,makeGradient:v,dasColourForName:h})},
{}],10:[function(e,s,r){function p(a,b,d,c){this.name=a;this.start=b;this.end=d;this.description=c}function m(a,b){var d;"string"==typeof a?(this.uri=a,d=b||{}):d=a||{};for(var c in d)"function"!=typeof d[c]&&(this[c]=d[c]);this.coords||(this.coords=[]);this.props||(this.props={});(this.dasBaseURI=this.uri)&&"/"!=this.dasBaseURI.substr(this.uri.length-1)&&(this.dasBaseURI+="/")}function h(){}function k(a,b){return a.taxon==b.taxon&&a.auth==b.auth&&a.version==b.version}function v(a,b,d,c,f){this.name=
a;this.start=b;this.end=d;this.alphabet=c;this.seq=f}function y(){}function E(a){a&&(this.id=a)}function a(a,b){this.desc=a;this.uri=b}function c(a){this.type=a;this.objects={};this.blocks=[]}function b(){this.styles=[]}function f(){}function g(a,b){b=b||{};this.uri=a;this.opts=b}function q(a,b){var d=a.getElementsByTagName(b);if(0<d.length&&d[0].firstChild){d=d[0];if(1==d.childNodes.length)return d.firstChild.nodeValue;for(var c="",f=0;f<d.childNodes.length;++f)c+=d.childNodes[f].nodeValue;return c}return null}
function n(b){for(var c=[],d=b.getElementsByTagName("LINK"),f=0;f<d.length;++f){var g=d[f];g.parentNode==b&&c.push(new a(g.firstChild?g.firstChild.nodeValue:"Unknown",g.getAttribute("href")))}return c}function x(a){var b=[];a=a.getElementsByTagName("NOTE");for(var d=0;d<a.length;++d)a[d].firstChild&&b.push(a[d].firstChild.nodeValue);return b}function S(a,b,d,c){if(window.XDomainRequest){var f=new XDomainRequest;f.onload=function(){var d=new ActiveXObject("Microsoft.XMLDOM");d.async=!1;d.loadXML(f.responseText);
b(d)};f.open("get",a);f.send("")}else try{var f=new XMLHttpRequest,g=setTimeout(function(){console.log("timing out "+a);f.abort();b(null,f)},5E3);f.timeout=5E3;f.ontimeout=function(){console.log("timeout on "+a)};f.onreadystatechange=function(){4==f.readyState&&(clearTimeout(g),(200<=f.status||0==f.status)&&b(f.responseXML,f))};f.open("get",a,!0);d&&(f.withCredentials=!0);c&&f.setRequestHeader("X-DAS-Authorisation",c);f.overrideMimeType("text/xml");f.setRequestHeader("Accept","application/xml,*/*");
f.send("")}catch(q){b(null,f,q)}}function N(a){a=(""+a).toLowerCase();return"yes"===a||"true"===a}function A(a){if(!a)return!1;a=(""+a).toLowerCase();return"no"!==a||"false"!==a}function u(a){var b=I(a);b.styles=[];for(var d=0;d<a.styles.length;++d){var c=b.styles[d]=I(a.styles[d]);c._methodRE=c._labelRE=c._typeRE=void 0;c.style=I(c.style);c.style.id=void 0;c.style._gradient=void 0}return b}if("undefined"!==typeof e){r=e("./utils");var I=r.shallowCopy,t=r.pusho,B=e("./color").makeColourSteps}p.prototype.toString=
function(){return this.name+":"+this.start+".."+this.end};p.prototype.isBounded=function(){return this.start&&this.end};p.prototype.toDASQuery=function(){var a="segment="+this.name;this.start&&this.end&&(a+=":"+this.start+","+this.end);return a};m.prototype.entryPoints=function(a){this.doCrossDomainRequest(this.dasBaseURI+"entry_points",function(b){if(!b)return a([]);var d=[];b=b.getElementsByTagName("SEGMENT");for(var c=0;c<b.length;++c){var f=b[c],g=f.getAttribute("id"),q=f.getAttribute("size"),
n;q?(n=1,q|=0):((n=f.getAttribute("start"))&&(n|=0),(q=f.getAttribute("stop"))&&(q|=0));var h=null;f.firstChild&&(h=f.firstChild.nodeValue);d.push(new p(g,n,q,h))}a(d)})};m.prototype.sequence=function(a,b){var d=this.dasBaseURI+"sequence?"+a.toDASQuery();this.doCrossDomainRequest(d,function(d){if(d){var a=[];d=d.getElementsByTagName("SEQUENCE");for(var c=0;c<d.length;++c){var f=d[c],g=f.getAttribute("id"),q=f.getAttribute("start"),n=f.getAttribute("stop"),l=null;if(f.firstChild)for(var f=f.firstChild.nodeValue,
l="",h=0;;){var k=f.indexOf("\n",h);if(0<=k)l+=f.substring(h,k).toUpperCase(),h=k+1;else{l+=f.substring(h).toUpperCase();break}}a.push(new v(g,q,n,"DNA",l))}b(a)}else b([])})};m.prototype.features=function(a,b,d){b=b||{};var c;if(this.features_uri)c=this.features_uri;else{var f=[];if(a)f.push(a.toDASQuery());else if(b.group)if(a=b.group,"string"==typeof a)f.push("group_id="+a);else for(var g=0;g<a.length;++g)f.push("group_id="+a[g]);if(b.adjacent)for(a=b.adjacent,"string"==typeof a&&(a=[a]),g=0;g<
a.length;++g)f.push("adjacent="+a[g]);if(b.type)if("string"==typeof b.type)f.push("type="+b.type);else for(a=0;a<b.type.length;++a)f.push("type="+b.type[a]);b.maxbins&&f.push("maxbins="+b.maxbins);0<f.length?c=this.dasBaseURI+"features?"+f.join(";"):d([],"No filters specified")}this.doCrossDomainRequest(c,function(a,b){if(a){for(var c=[],f={},l=a.getElementsByTagName("SEGMENT"),g=0;g<l.length;++g){var h=l[g],w=h.getAttribute("id");f[w]={min:h.getAttribute("start"),max:h.getAttribute("stop")};for(var h=
h.getElementsByTagName("FEATURE"),k=0;k<h.length;++k){var e=h[k],t=new y;t.segment=w;t.id=e.getAttribute("id");t.label=e.getAttribute("label");var u=q(e,"START"),G=q(e,"END");(u|0)>(G|0)?(t.min=G|0,t.max=u|0):(t.min=u|0,t.max=G|0);u=e.getElementsByTagName("TYPE");0<u.length&&(u=u[0],u.firstChild&&(t.type=u.firstChild.nodeValue),t.typeId=u.getAttribute("id"),t.typeCv=u.getAttribute("cvId"));t.type=q(e,"TYPE");!t.type&&t.typeId&&(t.type=t.typeId);t.method=q(e,"METHOD");(u=q(e,"ORIENTATION"))||(u="0");
t.orientation=u;t.score=q(e,"SCORE");t.links=n(e);t.notes=x(e);u=e.getElementsByTagName("GROUP");for(G=0;G<u.length;++G){var C=u[G],m=new E;m.type=C.getAttribute("type");m.id=C.getAttribute("id");m.links=n(C);m.notes=x(C);t.groups?t.groups.push(m):t.groups=Array(m)}if(t.notes)for(u=0;u<t.notes.length;++u)G=t.notes[u],0==G.indexOf("Genename=")&&(C=new E,C.type="gene",C.id=G.substring(9),t.groups?t.groups.push(C):t.groups=Array(C));u=e.getElementsByTagName("PART");if(0<u.length){C=[];for(G=0;G<u.length;++G)C.push(u[G].getAttribute("id"));
t.parts=C}u=e.getElementsByTagName("PARENT");if(0<u.length){e=[];for(G=0;G<u.length;++G)e.push(u[G].getAttribute("id"));t.parents=e}c.push(t)}}d(c,void 0,f)}else d([],"Failed request: "+(0==b.status?"server may not support CORS":"status="+b.status))},function(a){d([],a)})};m.prototype.alignments=function(a,b,d){var f=this.dasBaseURI+"alignment?query="+a;this.doCrossDomainRequest(f,function(a){if(a){var b=[];a=a.getElementsByTagName("alignment");for(var g=0;g<a.length;++g){for(var n=a[g],h=new c(n.getAttribute("alignType")),
k=n.getElementsByTagName("alignObject"),l=0;l<k.length;++l){var e=k[l],e={id:e.getAttribute("intObjectId"),accession:e.getAttribute("dbAccessionId"),version:e.getAttribute("objectVersion"),dbSource:e.getAttribute("dbSource"),dbVersion:e.getAttribute("dbVersion")};h.objects[e.id]=e}n=n.getElementsByTagName("block");for(k=0;k<n.length;++k){for(var e=n[k],l={order:e.getAttribute("blockOrder"),segments:[]},e=e.getElementsByTagName("segment"),t=0;t<e.length;++t){var u=e[t],u={object:u.getAttribute("intObjectId"),
min:u.getAttribute("start"),max:u.getAttribute("end"),strand:u.getAttribute("strand"),cigar:q(u,"cigar")};l.segments.push(u)}h.blocks.push(l)}b.push(h)}d(b)}else d([],"Failed request "+f)})};b.prototype.pushStyle=function(a,b,d){a||(a={type:"default"});a=I(a);b&&(a.zoom=b);a.style=d;this.styles.push(a)};m.prototype.stylesheet=function(a,c){var d,g=this.credentials;this.stylesheet_uri?(d=this.stylesheet_uri,g=!1):d=this.dasBaseURI+"stylesheet";S(d,function(d){if(d){var g=new b;d=d.getElementsByTagName("TYPE");
for(var q=0;q<d.length;++q){var n=d[q],h={};h.type=n.getAttribute("id");h.label=n.getAttribute("label");h.method=n.getAttribute("method");for(var n=n.getElementsByTagName("GLYPH"),w=0;w<n.length;++w){var l=n[w],e=l.getAttribute("zoom"),k;a:{if(l.hasChildNodes()){l=l.firstChild;do{if(l.nodeType==Node.ELEMENT_NODE){k=l;break a}l=l.nextSibling}while(null!=l)}k=null}l=new f;l.glyph=k.localName;for(k=k.firstChild;k;){if(k.nodeType==Node.ELEMENT_NODE)if("BGGRAD"==k.localName){var t=l,u=k.localName,x,m=
k;x=(x=m.getAttribute("steps"))?x|0:50;for(var p=[],A=[],m=m.getElementsByTagName("STOP"),E=0;E<m.length;++E){var v=m[E];p.push(1*v.getAttribute("score"));A.push(v.firstChild.nodeValue)}x=B(x,p,A);t[u]=x}else l[k.localName]=k.firstChild.nodeValue;k=k.nextSibling}g.pushStyle(h,e,l)}}a(g)}else c&&c()},g)};g.prototype.sources=function(a,b,d){d||(d={});var c=[];d.taxon&&c.push("organism="+d.taxon);d.auth&&c.push("authority="+d.auth);d.version&&c.push("version="+d.version);d=this.uri;0<c.length&&(d=d+
"?"+c.join("&"));S(d,function(d){if(!d&&b)b();else{var c=[];d=d.getElementsByTagName("SOURCE");for(var f=0;f<d.length;++f){var g=d[f],q=g.getElementsByTagName("VERSION");if(!(1>q.length)){for(var n=q[0],l=n.getElementsByTagName("COORDINATES"),q=[],k=0;k<l.length;++k){var w=l[k],e=new h;e.auth=w.getAttribute("authority");e.taxon=w.getAttribute("taxid");e.version=w.getAttribute("version");q.push(e)}for(var l=[],w=n.getElementsByTagName("CAPABILITY"),u,k=0;k<w.length;++k)e=w[k],l.push(e.getAttribute("type")),
"das1:features"==e.getAttribute("type")&&(u=e.getAttribute("query_uri"),u=u.substring(0,u.length-8));k={};n=n.getElementsByTagName("PROP");for(w=0;w<n.length;++w)t(k,n[w].getAttribute("name"),n[w].getAttribute("value"));u&&(g=new m(u,{source_uri:g.getAttribute("uri"),name:g.getAttribute("title"),desc:g.getAttribute("description"),coords:q,props:k,capabilities:l}),c.push(g))}}a(c)}})};m.prototype.doCrossDomainRequest=function(a,b,d){var c;this.xUser&&(c="Basic "+btoa(this.xUser+":"+this.xPass));try{return S(a,
b,this.credentials,c)}catch(f){if(d)d(f);else throw f;}};"undefined"!==typeof s&&(s.exports={DASGroup:E,DASFeature:y,DASStylesheet:b,DASStyle:f,DASSource:m,DASSegment:p,DASRegistry:g,DASSequence:v,DASLink:a,isDasBooleanTrue:N,isDasBooleanNotFalse:A,copyStylesheet:u,coordsMatch:k})},{"./color":9,"./utils":49}],11:[function(e,s,r){function p(k,e,m){function a(){m?(c.className="fa fa-caret-down",e.style.display="table"):(c.className="fa fa-caret-right",e.style.display="none")}var c=h("i");a();c.addEventListener("click",
function(b){b.preventDefault();b.stopPropagation();m=!m;a()},!1);k=h("h6",[c," ",k],{},{display:"block",background:"gray",color:"white",width:"100%",padding:"5px 2px",margin:"0px"});return h("div",[k,e],{})}if("undefined"!==typeof e){var m=e("./cbrowser").Browser;e=e("./utils");var h=e.makeElement,k=e.removeChildren}m.prototype.removeAllPopups=function(){k(this.hPopupHolder);k(this.popupHolder)};m.prototype.makeTooltip=function(k,e){var m=!1,a=this,c=null,b;b=function(a){m=!1;c&&(clearTimeout(c),
c=null);k.removeEventListener("mouseout",b,!1)};var f=function(b){var q=b.clientX+window.scrollX,n=b.clientY+window.scrollY;c||(c=setTimeout(function(){var b;b="function"===typeof e?e():e;var g=h("div",[h("div",null,{className:"tooltip-arrow"}),h("div",b,{className:"tooltip-inner"})],{className:"tooltip bottom in"},{display:"block",top:""+(n+20)+"px",left:""+Math.max(q-30,20)+"px"});a.hPopupHolder.appendChild(g);var p;p=function(b){try{a.hPopupHolder.removeChild(g)}catch(c){}window.removeEventListener("mousemove",
p,!1);m&&null!=k.offsetParent&&f(b)};window.addEventListener("mousemove",p,!1);c=null},1E3))};k.addEventListener("mouseover",function(a){m=!0;k.addEventListener("mouseout",b,!1);f(a)},!1);k.addEventListener("DOMNodeRemovedFromDocument",function(a){m=!1;c&&(clearTimeout(c),c=null)},!1)};m.prototype.popit=function(k,e,m,a){var c=this;a||(a={});k||(k={});var b=a.width||200,f;k.clientX?(a=k.clientX,f=k.clientY):(a=500,f=50);a+=document.documentElement.scrollLeft||document.body.scrollLeft;f+=document.documentElement.scrollTop||
document.body.scrollTop;var g=window.innerWidth,q=f,n=Math.min(a-b/2-4,g-b-30),x=h("div");x.className="popover fade "+(k.clientX?"bottom ":"")+"in";x.style.display="block";x.style.position="absolute";x.style.top=""+q+"px";x.style.left=""+n+"px";x.style.width=b+"px";276<b&&(x.style.maxWidth=b+"px");x.appendChild(h("div",null,{className:"arrow"}));if(e){var p=h("button","",{className:"close"});p.innerHTML="&times;";p.addEventListener("mouseover",function(a){p.style.color="red"},!1);p.addEventListener("mouseout",
function(a){p.style.color="black"},!1);p.addEventListener("click",function(a){a.preventDefault();a.stopPropagation();c.removeAllPopups()},!1);k=h("h4",[h("span",e,null,{maxWidth:"200px"}),p],{},{paddingLeft:"10px",paddingRight:"10px"});var N,A,u,I;u=function(a){a.stopPropagation();a.preventDefault();n+=a.clientX-N;8>n&&(n=8);n>g-b-32&&(n=g-b-26);q+=a.clientY-A;q=Math.max(10,q);x.style.top=""+q+"px";x.style.left=""+Math.min(n,g-b-10)+"px";N=a.clientX;A=a.clientY};I=function(a){a.stopPropagation();
a.preventDefault();window.removeEventListener("mousemove",u,!1);window.removeEventListener("mouseup",I,!1)};k.addEventListener("mousedown",function(a){a.preventDefault();a.stopPropagation();N=a.clientX;A=a.clientY;window.addEventListener("mousemove",u,!1);window.addEventListener("mouseup",I,!1)},!1);x.appendChild(k)}x.appendChild(h("div",m,{className:"popover-content"},{padding:"0px"}));this.hPopupHolder.appendChild(x);var t={node:x,displayed:!0};x.addEventListener("DOMNodeRemoved",function(a){a.target==
x&&(t.displayed=!1)},!1);return t};"undefined"!==typeof s&&(s.exports={makeTreeTableSection:p})},{"./cbrowser":6,"./utils":49}],12:[function(e,s,r){function p(h,e){0>h.indexOf("?")&&(h+="?soft=true");return new k(function(k,a){var c=new XMLHttpRequest;c.onreadystatechange=function(){if(4==c.readyState)if(300<=c.status)a("Error code "+c.status);else{var b=JSON.parse(c.response);k(e?b:b.location)}};c.open("GET",h,!0);c.setRequestHeader("Accept","application/json");c.responseType="text";c.send("")})}
function m(h){this.rawurl=h}function h(h,k,e,a){a||("object"===typeof k?(a=k,k=void 0):a={});this.url="string"===typeof h?new m(h):h;this.start=k||0;e&&(this.end=e);this.opts=a}if("undefined"!==typeof e)var k=e("es6-promise").Promise;m.prototype.getURLPromise=function(){this.urlPromise&&this.urlPromiseValidity>Date.now()||(this.urlPromise=p(this.rawurl,!0).then(function(h){return h.location}),this.urlPromiseValidity=Date.now()+432E5);return this.urlPromise};h.prototype.slice=function(k,e){if(0>k)throw"Bad slice "+
k;var m=this.start,a=this.end,m=m&&k?m+k:k||m;return new h(this.url,m,e&&m?m+e-1:a||e-1,this.opts)};h.prototype.fetchAsText=function(h){var k=this,e=new XMLHttpRequest;k.url.getURLPromise().then(function(a){e.open("GET",a,!0);if(k.end){if(1E8<k.end-k.start)throw"Monster fetch!";e.setRequestHeader("Range","bytes="+k.start+"-"+k.end)}e.onreadystatechange=function(){if(4==e.readyState)return 200==e.status||206==e.status?h(e.responseText):h(null)};k.opts.credentials&&(e.withCredentials=!0);e.send("")}).catch(function(a){console.log(a);
return h(null)})};h.prototype.salted=function(){return this};h.prototype.fetch=function(h,k,e){var a=this;k=k||1;if(3<k)return h(null);a.url.getURLPromise().then(function(c){var b=new XMLHttpRequest,f;b.open("GET",c,!0);b.overrideMimeType("text/plain; charset=x-user-defined");if(a.end){if(1E8<a.end-a.start)throw"Monster fetch!";b.setRequestHeader("Range","bytes="+a.start+"-"+a.end);f=a.end-a.start+1}b.responseType="arraybuffer";b.onreadystatechange=function(){if(4==b.readyState){if(200==b.status||
206==b.status){if(b.response){var c=b.response.byteLength;return!f||f==c||e&&c==e?h(b.response):a.fetch(h,k+1,c)}if(b.mozResponseArrayBuffer)return h(b.mozResponseArrayBuffer);c=b.responseText;if(!f||f==c.length||e&&c.length==e){if(c=b.responseText){for(var q=new Uint8Array(c.length),n=0;n<q.length;++n)q[n]=c.charCodeAt(n);c=q.buffer}else c=null;return h(c)}return a.fetch(h,k+1,c.length)}return a.fetch(h,k+1)}};a.opts.credentials&&(b.withCredentials=!0);b.send("")}).catch(function(a){console.log(a)})};
"undefined"!==typeof s&&(s.exports={lookupEncodeURI:p,EncodeFetchable:h})},{"es6-promise":53}],13:[function(e,s,r){function p(a){h.call(this);this.source=a;this.base=a.uri||"//rest.ensembl.org";if(0===this.base.indexOf("//")){var c=window.location.protocol;"http:"!=c&&"https:"!=c&&(this.base="http:"+this.base)}this.species=a.species||"human";this.type="string"===typeof a.type?[a.type]:a.type||["regulatory"]}if("undefined"!==typeof e){s=e("./sourceadapters");var m=s.registerSourceAdapterFactory,h=
s.FeatureSourceBase;e=e("./das");var k=e.DASStylesheet,v=e.DASStyle,y=e.DASFeature,E=e.DASGroup}p.prototype=Object.create(h.prototype);p.prototype.constructor=p;p.prototype.getStyleSheet=function(a){var c=new k,b=new v;b.glyph="__NONE";0<=this.type.indexOf("exon")&&c.pushStyle({type:"transcript"},null,b);(0<=this.type.indexOf("exon")||0<=this.type.indexOf("transcript"))&&c.pushStyle({type:"gene"},null,b);b=new v;b.glyph="BOX";b.FGCOLOR="black";b.BGCOLOR="red";b.HEIGHT=8;b.BUMP=!0;b.LABEL=!0;b.ZINDEX=
10;c.pushStyle({type:"cds"},null,b);b=new v;b.glyph="SQUARE";b.BUMP="yes";b.LABEL="no";b.FGCOLOR="blue";c.pushStyle({type:"variation",method:".+_UTR_variant"},null,b);b=new v;b.glyph="TRIANGLE";b.DIRECTION="S";b.BUMP="yes";b.LABEL="no";b.FGCOLOR="blue";c.pushStyle({type:"variation",method:"missense_variant"},null,b);b=new v;b.glyph="TRIANGLE";b.DIRECTION="N";b.BUMP="yes";b.LABEL="no";b.FGCOLOR="blue";c.pushStyle({type:"variation",method:"splice_.+_variant"},null,b);b=new v;b.glyph="STAR";b.POINTS=
6;b.BUMP="yes";b.LABEL="no";b.FGCOLOR="blue";c.pushStyle({type:"variation",method:"regulatory_region_variant"},null,b);b=new v;b.glyph="PLIMSOLL";b.BUMP="yes";b.LABEL="no";b.FGCOLOR="rgb(50,80,255)";b.STROKECOLOR="black";c.pushStyle({type:"variation"},null,b);b=new v;b.glyph="SQUARE";b.BUMP="yes";b.LABEL="no";b.BGCOLOR="#888888";b.FGCOLOR="red";c.pushStyle({type:"indel",method:".+_UTR_variant"},null,b);b=new v;b.glyph="TRIANGLE";b.DIRECTION="S";b.BUMP="yes";b.LABEL="no";b.BGCOLOR="#888888";b.FGCOLOR=
"red";c.pushStyle({type:"indel",method:"missense_variant"},null,b);b=new v;b.glyph="TRIANGLE";b.DIRECTION="N";b.BUMP="yes";b.LABEL="no";b.BGCOLOR="#888888";b.FGCOLOR="red";c.pushStyle({type:"indel",method:"splice_.+_variant"},null,b);b=new v;b.glyph="STAR";b.POINTS=6;b.BUMP="yes";b.LABEL="no";b.BGCOLOR="#888888";b.FGCOLOR="red";c.pushStyle({type:"indel",method:"regulatory_region_variant"},null,b);b=new v;b.glyph="PLIMSOLL";b.BUMP="yes";b.LABEL="no";b.BGCOLOR="#888888";b.FGCOLOR="red";b.STROKECOLOR=
"black";c.pushStyle({type:"indel"},null,b);b=new v;b.glyph="BOX";b.FGCOLOR="black";b.BGCOLOR="orange";b.HEIGHT=8;b.BUMP=!0;b.LABEL=!0;b.ZINDEX=20;c.pushStyle({type:"default"},null,b);return a(c)};p.prototype.getScales=function(){return[]};p.prototype.fetch=function(a,c,b,f,g,q,n){var h=this;c=this.base+"/overlap/region/"+this.species+"/"+a+":"+c+"-"+b;b=[];for(f=0;f<this.type.length;++f)b.push("feature="+this.type[f]);b.push("content-type=application/json");c=c+"?"+b.join(";");var k=new XMLHttpRequest;
k.onreadystatechange=function(){if(4==k.readyState)if(h.busy--,h.notifyActivity(),300<=k.status){var b="Error code "+k.status;try{var c=JSON.parse(k.response);c.error&&(b=c.error)}catch(f){}n(b,null)}else{for(var b=JSON.parse(k.response),c=[],g=0;g<b.length;++g){var q=b[g],e=[],m=new y;m.segment=a;m.min=q.start|0;m.max=q.end|0;m.type=q.feature_type||"unknown";m.id=q.ID;if(q.Parent){var p=new E;p.id=q.Parent;m.groups=[p]}q.strand&&(0>q.strand?m.orientation="-":0<q.strand&&(m.orientation="+"));q.consequence_type&&
(m.method=q.consequence_type);q.alt_alleles&&(e.push("Alleles="+q.alt_alleles.join("/")),1<q.alt_alleles.length&&(q.alt_alleles[1].length!=q.alt_alleles[0].length||"-"==q.alt_alleles[1])&&(m.type="indel"));0<e.length&&(m.notes=e);c.push(m)}n(null,c)}};h.busy++;h.notifyActivity();k.open("GET",c,!0);k.responseType="text";k.send("")};m("ensembl",function(a){return{features:new p(a)}})},{"./das":10,"./sourceadapters":34}],14:[function(e,s,r){if("undefined"!==typeof e)var p=e("./cbrowser").Browser,m=e("./utils").shallowCopy,
h=e("./sha1").hex_sha1,k=e("./das").copyStylesheet;p.prototype.exportFullConfig=function(k){k={chr:this.chr,viewStart:this.viewStart|0,viewEnd:this.viewEnd|0,cookieKey:"dalliance_"+h(Date.now()),coordSystem:this.coordSystem,sources:this.exportSourceConfig(),chains:this.exportChains()};this.prefix&&(k.prefix=this.prefix);return k};p.prototype.exportChains=function(){var k={},h=this.chains||{},e;for(e in h)k[e]=h[e].exportConfig();return k};p.prototype.exportSourceConfig=function(h){h=[];for(var e=
0;e<this.tiers.length;++e){var p=this.tiers[e],a=m(p.dasSource);a.noPersist||(a.coords=void 0,a.props=void 0,a.disabled||(a.disabled=void 0),p.config.stylesheet?(a.style=k(p.config.stylesheet).styles,a.stylesheet_uri=void 0):a.style&&(a.style=k({styles:a.style}).styles),"string"===typeof p.config.name&&(a.name=p.config.name),void 0!==p.config.height&&(a.forceHeight=p.config.height),void 0!==p.config.forceMin&&(a.forceMin=p.config.forceMin),p.config.forceMinDynamic&&(a.forceMinDynamic=p.config.forceMinDynamic),
void 0!==p.config.forceMax&&(a.forceMax=p.config.forceMax),void 0!==p.config.bumped&&(a.bumped=p.config.bumped),p.config.forceMaxDynamic&&(a.forceMaxDynamic=p.config.forceMaxDynamic),h.push(a))}return h};p.prototype.exportPageTemplate=function(h){h=h||{};return'<html>\n  <head>\n    <script language="javascript" src="'+this.resolveURL("$$dalliance-compiled.js")+'">\x3c/script>\n    <script language="javascript">\n      var dalliance_browser = new Browser('+JSON.stringify(this.exportFullConfig(h),
null,2)+');\n    \x3c/script>\n  </head>\n  <body>\n    <div id="svgHolder">Dalliance goes here</div>\n  </body>\n<html>\n'}},{"./cbrowser":6,"./das":10,"./sha1":33,"./utils":49}],15:[function(e,s,r){if("undefined"!==typeof e)var p=e("./cbrowser").Browser,m=e("./glyphs").OverlayLabelCanvas,h=e("./numformats").formatQuantLabel,k=e("./sequence-draw").drawSeqTierGC;p.prototype.exportImage=function(e){e=e||{};for(var p=this.featurePanelWidth,E=0,a=0;a<this.tiers.length;++a){0<a&&(E+=3);var c=this.tiers[a];
void 0!==c.layoutHeight&&(E+=c.layoutHeight)}var b=e.resolutionMultiplier||1,a=(p+200)*b|0,c=E*b|0,E=makeElement("canvas",null,{width:a,height:c}),f=E.getContext("2d");f.fillStyle="white";f.fillRect(0,0,a,c);f.scale(b,b);for(a=b=0;a<this.tiers.length;++a){var c=this.tiers[a],g=(c.glyphCacheOrigin-this.viewStart)*this.scale,q=new m;f.save();f.translate(0,b);f.save();f.beginPath();f.moveTo(200,0);f.lineTo(200+p,0);f.lineTo(200+p,c.layoutHeight);f.lineTo(200,c.layoutHeight);f.closePath();f.clip();f.translate(200,
0);f.save();f.translate(g,0);c.subtiers?c.paintToContext(f,q,g+1E3):k(c,c.currentSequence,f);f.restore();f.save();f.translate(g,0);q.draw(f,-g,p-g);f.restore();f.restore();for(var q=!1,n=0,x=c.subtiers||[],S=0;S<x.length;++S){var N=x[S];if(N.quant){var q=!0,A=N.quant,u=N.height,I=2;40<u&&(I=1+(u/20|0));var u=u/(I-1),t=(A.max-A.min)/(I-1);f.beginPath();f.moveTo(205,n);f.lineTo(200,n);f.lineTo(200,n+N.height);f.lineTo(205,n+N.height);for(var B=1;B<I-1;++B){var C=B*u;f.moveTo(200,n+C);f.lineTo(203,n+
C)}f.strokeStyle="black";f.strokeWidth=2;f.stroke();f.fillStyle="black";var B=h(A.max),J=n+7;f.fillText(B,197-f.measureText(B).width,J);B=h(A.min);J=n+N.height;f.fillText(B,197-f.measureText(B).width,J);for(B=1;B<I-1;++B)C=B*u,J=h(1*A.max-B*t),C=n+C+3,f.fillText(J,197-f.measureText(J).width,C)}n+=N.height+3}n="string"===typeof c.config.name?c.config.name:c.dasSource.name;x=f.measureText(n).width;f.fillStyle="black";f.fillText(n,200-(q?22:12)-x,(c.layoutHeight+6)/2);f.restore();b+=c.layoutHeight+3}if(e.highlights){f.save();
f.beginPath();f.moveTo(200,0);f.lineTo(200+p,0);f.lineTo(200+p,b);f.lineTo(200,b);f.closePath();f.clip();f.translate(200+g,0);g=p=this.viewStart;a=this.viewEnd;for(c=0;c<this.highlights.length;++c)u=this.highlights[c],(u.chr===this.chr||u.chr==="chr"+this.chr)&&u.min<a&&u.max>g&&(f.globalAlpha=this.defaultHighlightAlpha,f.fillStyle=this.defaultHighlightFill,f.fillRect((u.min-p)*this.scale,0,(u.max-u.min)*this.scale,b));f.restore()}p=-1;"center"==e.ruler?p=200+(this.viewEnd-this.viewStart+1)*this.scale/
2:"left"==e.ruler?p=200:"right"==e.ruler&&(p=200+(this.viewEnd-this.viewStart+1)*this.scale);0<=p&&(f.strokeStyle="blue",f.beginPath(),f.moveTo(p,0),f.lineTo(p,b),f.stroke());return E.toDataURL("image/png")}},{"./cbrowser":6,"./glyphs":21,"./numformats":26,"./sequence-draw":31}],16:[function(e,s,r){if("undefined"!==typeof e){var p=e("./cbrowser").Browser;e=e("./utils");var m=e.makeElement,h=e.removeChildren}p.prototype.openExportPanel=function(){var k=this;if("export"===this.uiMode)this.hideToolPanel(),
this.setUiMode("none");else{var e=m("div",null,{className:"export-form"}),p=m("select");p.appendChild(m("option","SVG",{value:"svg"}));p.appendChild(m("option","Image",{value:"png"}));p.appendChild(m("option","Dalliance config",{value:"config"}));p.appendChild(m("option","Dalliance sources",{value:"sources"}));p.appendChild(m("option","Dalliance page",{value:"page"}));p.value="svg";p.addEventListener("change",function(a){h(f);S()},!1);e.appendChild(m("p",["Export as: ",p]));var E=m("input",null,{type:"checkbox",
checked:this.exportHighlights});E.addEventListener("change",function(a){k.exportHighlights=E.checked;k.storeStatus()},!1);var a=m("input",null,{type:"checkbox",checked:this.exportRuler});a.addEventListener("change",function(b){k.exportRuler=a.checked;k.storeStatus()},!1);var c=m("input",null,{type:"text",value:"1.0"}),b=m("button","Export",{className:"btn btn-primary"});b.addEventListener("click",function(b){h(f);var g,q,n,e;if("svg"===p.value)g=URL.createObjectURL(k.makeSVG({highlights:E.checked,
ruler:a.checked?k.rulerLocation:"none"})),q="SVG",n="image/svg",e="dalliance-view.svg";else if("png"===p.value){n=parseFloat(c.value);if(0.1>n||10<n){alert("bad scale "+n);return}g=k.exportImage({highlights:E.checked,ruler:a.checked?k.rulerLocation:"none",resolutionMultiplier:n});q="Image";n="image/png";e="dalliance-view.png"}else"config"===p.value?(n=JSON.stringify(k.exportFullConfig(),null,2),q=new Blob([n],{type:"text/plain"}),g=URL.createObjectURL(q),q="Configuration",n="text/plain",e="dalliance-config.json"):
"sources"===p.value?(n=JSON.stringify(k.exportSourceConfig(),null,2),q=new Blob([n],{type:"text/plain"}),g=URL.createObjectURL(q),q="Source array",n="text/plain",e="dalliance-sources.json"):"page"===p.value&&(q=k.exportPageTemplate(),n="text/html",q=new Blob([q],{type:n}),g=URL.createObjectURL(q),q="Page template",e="dalliance-view.html");g&&(b=m("a","[Download]",{href:g,download:e,type:n}),n=m("a","[Preview in browser]",{href:g,type:n,target:"_new"}),f.appendChild(m("p",[""+q+" created: ",b,n])))},
!1);k.addViewListener(function(){h(f)});k.addTierListener(function(){h(f)});var f=m("p",""),g=m("tr",[m("th","Include highlights",{},{width:"200px",textAlign:"right"}),m("td",E)]),q=m("tr",[m("th","Include vertical guideline"),m("td",a)]),n=m("tr",[m("th","Scale multiplier"),m("td",c)]),x=m("table",[g,q,n]),S=function(){var a=p.value;g.style.display="svg"==a||"png"==a?"table-row":"none";q.style.display="svg"==a||"png"==a?"table-row":"none";n.style.display="png"==a?"table-row":"none"};S();e.appendChild(x);
e.appendChild(b);e.appendChild(f);"none"!==this.uiMode&&this.hideToolPanel();this.browserHolder.insertBefore(e,this.svgHolder);this.activeToolPanel=e;this.setUiMode("export")}}},{"./cbrowser":6,"./utils":49}],17:[function(e,s,r){s=e("./cbrowser");r=e("./chainset");var p=e("./sourceadapters"),m=e("./utils"),h=e("./das");e=e("./sourcecompare");window.Browser=s.Browser;window.sourcesAreEqual=e.sourcesAreEqual;window.Chainset=r.Chainset;window.makeElement=m.makeElement;window.dalliance_registerSourceAdapterFactory=
p.registerSourceAdapterFactory;window.dalliance_registerParserFactory=p.registerParserFactory;window.dalliance_makeParser=p.makeParser;window.DASSequence=h.DASSequence;window.DASFeature=h.DASFeature;window.DASGroup=h.DASGroup;window.DASStylesheet=h.DASStylesheet;window.DASStyle=h.DASStyle;window.DASSource=h.DASSource},{"./cbrowser":6,"./chainset":7,"./das":10,"./sourceadapters":34,"./sourcecompare":35,"./utils":49}],18:[function(e,s,r){function p(){this.glyphs=[];this.height=0;this.quant=null}function m(d){Date.now();
aa=d.viewport.getContext("2d");d.padding="number"===typeof d.dasSource.padding?d.dasSource.padding:R;var b=[],c={},l={},f;for(f in d.ungroupedFeatures)for(var g=d.ungroupedFeatures[f],q=0;q<g.length;++q){var n=g[q];if(!n.parts){var e=d.styleForFeature(n);if(e)if("LINEPLOT"==e.glyph)a(c,e.id,n),l[e.id]=e;else{var w=k(n,0,e,d);w&&b.push(w)}}}for(var u in c)f=c[u],e=l[u],"LINEPLOT"==e.glyph&&b.push(v(f,e,d));if(d.dasSource.collapseSuperGroups&&!d.bumped)for(var t in d.superGroups){c=d.superGroups[t];
d.groups[t]=E(d.groups[t]);d.groups[t].isSuperGroup=!0;l={};u=1E10;g=-1E10;q=null;for(w=0;w<c.length;++w)if(f=d.groupedFeatures[c[w]]){for(e=0;e<f.length;++e)n=f[e],a(l,n.type,n),u=Math.min(n.min,u),g=Math.max(n.max,g),n.segment&&!q&&(q=n.segment);if(d.groups[t]&&!d.groups[t].links||0==d.groups[t].links.length)d.groups[t].links=d.groups[c[0]].links;delete d.groupedFeatures[c[w]]}d.groups[t].max=g;d.groups[t].min=u;d.groups[t].segment=q;for(var m in l){f=l[m];u=f[0];g=null;for(e=0;e<f.length;++e)n=
f[e],n=new L(n.min,n.max),g=g?M(g,n):n;g=g.ranges();for(q=0;q<g.length;++q){for(var x=g[q],G=((x.max()|0)-(x.min()|0)+1)*c.length,C=0,e=0;e<f.length;++e)if(n=f[e],(n.min|0)<=x.max()&&(n.max|0)>=x.min())var A=Math.max(n.min|0,x.min()),n=Math.min(n.max|0,x.max()),C=C+(n-A+1);var n=new O,z;for(z in u)n[z]=u[z];n.min=x.min();n.max=x.max();n.label&&1<c.length&&(n.label+=" ("+c.length+" vars)");n.visualWeight=1*C/G;a(d.groupedFeatures,t,n)}}delete d.superGroups[t]}z=[];for(var B in d.groupedFeatures)z.push(B);
z.sort(function(a,b){var c=d.groupedFeatures[a][0].score-d.groupedFeatures[b][0].score;return 0<c?-1:0==c?0:1});m={};for(n=0;n<z.length;++n)if(B=z[n],w=h(d.groupedFeatures[B],0,d.groups[B],d,d.dasSource.collapseSuperGroups&&!d.bumped?"collapsed_gene":"tent"))w.group=d.groups[B],m[B]=w;for(t in d.superGroups){c=d.superGroups[t];B=[];u=1E10;g=-1E10;for(z=0;z<c.length;++z)n=m[c[z]],m[c[z]]=null,n&&(B.push(n),u=Math.min(u,n.min()),g=Math.max(g,n.max()));for(z=0;z<B.length;++z)n=B[z],b.push(new N(n,u,
g))}for(w in m)(n=m[w])&&b.push(n);t=new p;B=[];m=d.subtierMax||d.dasSource.subtierMax||d.browser.defaultSubtierMax;z=!1;n=0;a:for(;n<b.length;++n)if(w=b[n],w.bump&&(d.bumped||d.dasSource.collapseSuperGroups)){for(c=0;c<B.length;++c)if(l=B[c],l.hasSpaceFor(w)){l.add(w);continue a}B.length>=m?z=!0:(l=new p,l.add(w),B.push(l))}else t.add(w);0<t.glyphs.length&&(B=[t].concat(B));for(c=0;c<B.length;++c)l=B[c],l.quant&&l.glyphs.unshift(new D(l.height));for(c=0;c<B.length;++c)l=B[c],l.glyphs.sort(function(d,
a){return(d.zindex||0)-(a.zindex||0)});d.subtiers=B;d.glyphCacheOrigin=d.browser.viewStart;z?d.updateStatus("Bumping limit exceeded, use the track editor to see more features"):d.updateStatus()}function h(d,a,c,l,f){f=l.styleForFeature(c);var n,q=!1,e=[];a=null;for(var h=0;h<d.length;++h){var w=d[h];w.orientation&&null==a&&(a=w.orientation);!n&&w.label&&(n=w.label);var u=l.styleForFeature(w);u&&!w.parts&&(V(u.LABEL)&&(q=!0),(w=k(w,0,u,l,null,!0))&&e.push(w))}if(0==e.length)return null;d="flat";f&&
"LINE"===f.glyph||(l.dasSource.collapseSuperGroups&&!l.bumped?"+"===a?d="collapsed+":"-"===a&&(d="collapsed-"):"+"===a?d="hat+":"-"===a&&(d="hat-"));l=null;if(n&&q||f&&(V(f.LABEL)||V(f.LABELS)))l=c.label||n;c=new b(e,d);l&&("+"===a?l=">"+l:"-"===a&&(l="<"+l),c=new g(aa,c,l,!1));c.bump=!0;return c}function k(a,f,e,h,k,L){function p(a,d,b){var c=null;if(a.currentSequence){var l=a.currentSequence.start|0,f=a.currentSequence.end|0;if(l<=b&&f>=d){for(var g=Math.max(d,l),f=Math.min(b,f),c=a.currentSequence.seq.substr(g-
l,f-g+1);d<g;)c="N"+c,g--;for(;b>f;)c+="N",f++}}return c}var m=h.browser.scale,E=h.browser.viewStart,F=e.glyph||"BOX",D=a.min,v=a.max,M=a.orientation,y=a.score,O=a.label||a.id,K=(D-E)*m,r=Math.max((v-E+1)*m,K+1),s=h.forceHeight||e.HEIGHT||k||12,U=s*=1,E=e.BUMP&&V(e.BUMP),X;if("CROSS"===F||"EX"===F||"TRIANGLE"===F||"DOT"===F||"SQUARE"===F||"STAR"===F||"PLIMSOLL"===F){var R=e.FGCOLOR||"black",Q=e.BGCOLOR||"none",D=e.STROKECOLOR;e.BGITEM&&a.itemRgb?R=a.itemRgb:V(e.COLOR_BY_SCORE2)&&(m=e.BGGRAD||e._gradient,
m||(m=l(50,e.COLOR1,e.COLOR2,e.COLOR3),e._gradient=m),s=a.score2,void 0==s&&R||(U=e.MIN2?1*e.MIN2:0,v=(1*(s||0)-U)/((e.MAX2?1*e.MAX2:1)-U)*m.length|0,0>v&&(v=0),v>=m.length&&(v=m.length-1),R=m[v]));s=h.forceHeight||e.HEIGHT||k||12;U=s*=1;v=e.SIZE||s;e.RSIZE&&(v=1*e.RSIZE*s);e.STROKETHRESHOLD&&v<1*e.STROKETHRESHOLD&&(D=null);v*=1;s=(K+r)/2;m=v/2;"EX"===F?D=new n(s,v,R):"TRIANGLE"===F?D=new x(s,v,e.DIRECTION||"N",e.LINEWIDTH||v,R,D):"DOT"===F?D=new S(s,v,R,D):"PLIMSOLL"===F?D=new H(s,v,0.2*v,R,D):"SQUARE"===
F?D=new c(s-m,0,v,v,R,D):"STAR"===F?(F=5,e.POINTS&&(F=e.POINTS|0),D=new z(s,m,F,R,D)):D=new q(s,v,R);Q&&"none"!=Q&&5<r-K&&(K=new c(K,0,r-K,v,Q),D=new b([K,D]));if(V(e.SCATTER)){Q=h.quantMin(e);(v=h.quantMax(e))||(v=0>Q?0:10);Q||(Q=0);h=(1*y-Q)/(v-Q);y=-1*Q/(v-Q);if(0>h||1<h)return null;h>=y?(s=Math.max(1,(h-y)*U),f=f+(1-y)*U-s):(s=Math.max(1,(h-y)*U),f+=(1-y)*U);X={min:Q,max:v};K=0;r="undefined"!==typeof a.forceLabel?a.forceLabel:e.LABEL;Y(r)&&O&&!L&&(D=new g(aa,D,O,!0,null,"above"==r?"above":"below"),
"above"==r&&(K=D.textHeight+2),L=!0);D=new G(D,0,f-m-K,U)}}else if("HISTOGRAM"===F||"GRADIENT"===F&&"undefined"!==y)Q=h.quantMin(e),(v=h.quantMax(e))||(v=0>Q?0:10),Q||(Q=0),1*y<1*Q&&(y=Q),1*y>1*v&&(y=v),h=(1*y-Q)/(v-Q),y=-1*Q/(v-Q),"HISTOGRAM"===F&&(h>=y?(s=(h-Math.max(0,y))*U,f=f+(1-Math.max(0,y))*U-s):(s=(Math.max(0,y)-h)*U,f+=(1-Math.max(0,y))*U),X={min:Q,max:v}),R=e.FGCOLOR||null,Q=e.BGCOLOR||e.COLOR1||"green",e.BGITEM&&a.itemRgb&&(Q=a.itemRgb),y=e.ALPHA?1*e.ALPHA:null,e.BGGRAD&&(m=e.BGGRAD,v=
h*m.length|0,0>v&&(v=0),v>=m.length&&(v=m.length-1),Q=m[v]),e.COLOR2&&(m=e._gradient,m||(m=l(50,e.COLOR1,e.COLOR2,e.COLOR3),e._gradient=m),v=h*m.length|0,0>v&&(v=0),v>=m.length&&(v=m.length-1),Q=m[v]),D=new c(K,f,r-K,s,Q,R,y),D=new G(D,0,0,U);else if("HIDDEN"===F)D=new N(null,K,r),L=!0;else if("ARROW"===F)h=e.FGCOLOR||"purple",f=V(e.PARALLEL),U=V(e.SOUTHWEST),y=V(e.NORTHEAST),D=new B(K,r,s,h,f,U,y);else if("ANCHORED_ARROW"===F)R=e.FGCOLOR||"none",Q=e.BGCOLOR||"green",D=new A(K,r,s,Q,R,M),D.bump=!0;
else if("SPAN"===F)R=e.FGCOLOR||"black",D=new u(K,r,s,R);else if("LINE"===F)R=e.FGCOLOR||"black",D=new I(K,r,s,e.STYLE||"solid",M,R);else if("PRIMERS"===F)R=e.FGCOLOR||"black",Q=e.BGCOLOR||"red",D=new t(K,r,s,Q,R);else if("TEXT"===F)h=e.STRING||"text",Q=e.FGCOLOR||"black",D=new J(aa,K,r,s,Q,h);else if("TOOMANY"===F)R=e.FGCOLOR||"gray",Q=e.BGCOLOR||"orange",D=new C(K,r,s,Q,R);else if("POINT"===F)s=h.forceHeight||e.HEIGHT||30,Q=h.quantMin(e),v=h.quantMax(e),h=(1*y-Q)/(v-Q),f=1*s/(v-Q)*(y-1*Q)|0,X={min:Q,
max:v},Q=e.FGCOLOR||e.COLOR1||"black",e.COLOR2&&(m=e._gradient,m||(m=l(50,e.COLOR1,e.COLOR2,e.COLOR3),e._gradient=m),v=h*m.length|0,0>v&&(v=0),v>=m.length&&(v=m.length-1),Q=m[v]),D=new P((K+r)/2,s-f,s,Q);else if("__SEQUENCE"===F){y=F=a.seq;Q=R=a.quals;f=V(e.__INSERTIONS);U=[];if(a.cigar){k=$(a.cigar);for(var Q=y="",na=M=0;na<k.length;++na){var W=k[na];if("M"==W.op)y+=F.substr(M,W.cnt),Q+=R.substr(M,W.cnt),M+=W.cnt;else if("D"==W.op)for(var ha=0;ha<W.cnt;++ha)y+="-",Q+="Z";else if("I"==W.op){var ta=
F.substr(M,W.cnt),ha=new x(K+y.length*m,5,"S",5,h.browser.baseColors.I);f&&(ha=new g(aa,ha,ta,!1,"center","above","7px sans-serif"));ha.feature={label:"Insertion: "+ta,type:"insertion",method:"insertion"};U.push(ha);M+=W.cnt}else"S"==W.op?M+=W.cnt:console.log("unknown cigop"+W.op)}}m=p(h,D,v);if(y&&m&&("mismatch"===e.__SEQCOLOR||"mismatch-all"===e.__SEQCOLOR)){D=[];v="-"===a.orientation?",":".";for(F=0;F<y.length;++F)D.push(y[F]==m[F]?v:y[F]);y=D.join("")}D="-"===a.orientation?e._minusColor||"lightskyblue":
e._plusColor||"lightsalmon";e.__disableQuals&&(Q=!1);D=new d(h.browser.baseColors,D,K,r,s,y,m,e.__SEQCOLOR,Q,!V(e.__CLEARBG));f&&(D=new G(D,0,7));0<U.length&&(U.splice(0,0,D),D=new b(U))}else if("__INSERTION"===F)ha=new x(K,5,"S",5,h.browser.baseColors.I),D=new g(aa,ha,a.insertion||a.altAlleles[0],!1,"center","above","7px sans-serif"),1<r-K&&(Q=e.BGCOLOR||e.COLOR1||"green",K=new c(K,5,r-K,s,Q,R),D=new b([K,D]));else{if("__NONE"===F)return null;R=e.FGCOLOR||null;Q=e.BGCOLOR||e.COLOR1||"green";e.BGITEM&&
a.itemRgb&&(Q=a.itemRgb);m=(r-K)/(v-D);"translation"==a.type&&("protein_coding"==a.method||a.readframeExplicit)&&(!a.tags||0>a.tags.indexOf("cds_start_NF")||a.readframeExplicit)&&(!h.dasSource.collapseSuperGroups||h.bumped)&&0.5<=m?(m=p(h,D,v),D=new w(K,r,s,Q,m,a.orientation,a.readframe)):D=new c(K,0,r-K,s,Q,R)}(V(e.LABEL)||a.forceLabel)&&O&&!L&&(D=new g(aa,D,O,!1));E&&(D.bump=!0);D.feature=a;X&&(D.quant=X);e.ZINDEX&&(D.zindex=e.ZINDEX|0);return D}function v(a,d,b){var c=b.browser.viewStart,l=b.browser.scale,
g=b.forceHeight||d.HEIGHT||30,n=b.quantMin(d);b=b.quantMax(d);for(var q=1*g/(b-n),e=d.FGCOLOR||d.COLOR1||"black",h=[],k=0;k<a.length;++k){var w=a[k],m=g-((w.score-1*n)*q|0);h.push((((w.min|0)+(w.max|0))/2-c)*l);h.push(m)}a=new f(h,e,g);a.quant={min:n,max:b};d.ZINDEX&&(a.zindex=d.ZINDEX|0);return a}if("undefined"!==typeof e){var y=e("./utils"),E=y.shallowCopy,a=y.pusho,y=e("./tier").DasTier;r=e("./glyphs");var c=r.BoxGlyph,b=r.GroupGlyph,f=r.LineGraphGlyph,g=r.LabelledGlyph,q=r.CrossGlyph,n=r.ExGlyph,
x=r.TriangleGlyph,S=r.DotGlyph,N=r.PaddedGlyph,A=r.AArrowGlyph,u=r.SpanGlyph,I=r.LineGlyph,t=r.PrimersGlyph,B=r.ArrowGlyph,C=r.TooManyGlyph,J=r.TextGlyph,d=r.SequenceGlyph,w=r.AminoAcidGlyph,G=r.TranslatedGlyph,P=r.PointGlyph,D=r.GridGlyph,z=r.StarGlyph,H=r.PlimsollGlyph,F=r.OverlayLabelCanvas,l=e("./color").makeGradient;r=e("./spans");var L=r.Range,M=r.union;r=e("./das");var O=r.DASFeature,V=r.isDasBooleanTrue,Y=r.isDasBooleanNotFalse,$=e("./cigar").parseCigar,X=e("./numformats").formatQuantLabel}var R=
3;p.prototype.indexFor=function(a){a=a.min();for(var d=0,b=this.glyphs.length;b>d;){var c=(d+b)/2|0;if(c>=this.glyphs.length)return this.glyphs.length;a<this.glyphs[c].min()?b=c:d=c+1}return b};p.prototype.add=function(a){var d=this.indexFor(a);this.glyphs.splice(d,0,a);this.height=Math.max(this.height,a.height());a.quant&&null==this.quant&&(this.quant=a.quant)};p.prototype.hasSpaceFor=function(a){var d=this.indexFor(a);return 0<d&&this.glyphs[d-1].max()>=a.min()||d<this.glyphs.length&&this.glyphs[d].min()<=
a.max()?!1:!0};var aa;y.prototype.paint=function(){var a=this.browser.retina&&1<window.devicePixelRatio,d=this.subtiers;if(d){var b=this.browser.featurePanelWidth+2E3;a&&(b*=2);var c=this.viewport.width|0;c<b-50&&(this.viewport.width=c=b);for(var b=this.padding,l=0;l<d.length;++l)b=b+d[l].height+this.padding;l=b=Math.max(b+6,this.browser.minTierHeight);a&&(l*=2);l!=this.viewport.height&&(this.viewport.height=l);Math.max(b,this.browser.minTierHeight);this.viewportHolder.style.left="-1000px";this.viewport.style.width=
a?""+c/2+"px":""+c+"px";this.viewport.style.height=""+b+"px";this.layoutHeight=Math.max(b,this.browser.minTierHeight);this.updateHeight();this.norigin=this.browser.viewStart;d=this.viewport.getContext("2d");d.clearRect(0,0,c,l);d.save();a&&d.scale(2,2);c=this.browser.viewStart-1E3/this.browser.scale;l=this.browser.viewEnd+1E3/this.browser.scale;a=[];if(this.knownCoverage)for(var f=this.knownCoverage.ranges(),g=0;g<f.length;++g){var n=f[g];0==g?n.min()>c&&a.push({min:c,max:n.min()-1}):a.push({min:f[g-
1].max()+1,max:n.min()-1});g==f.length-1&&n.max()<l&&a.push({min:n.max()+1,max:l})}if(0<a.length)for(d.fillStyle="gray",c=0;c<a.length;++c)l=a[c],f=(l.min-this.browser.viewStart)*this.browser.scale+1E3,d.fillRect(f,0,(l.max-this.browser.viewStart)*this.browser.scale+1E3-f,b);b=new F;a=(this.glyphCacheOrigin-this.browser.viewStart)*this.browser.scale+1E3;d.translate(a,this.padding);b.translate(0,this.padding);this.paintToContext(d,b,a);this.overlayLabelCanvas=0<b.glyphs.length?b:null;d.restore();this.drawOverlay();
this.paintQuant()}};y.prototype.paintToContext=function(a,d,b){var c=this.subtiers,l=this.viewport.width|0;a.save();for(var f=0;f<c.length;++f){for(var g=null,n=c[f].glyphs,q=0;q<n.length;++q){var e=n[q];e.min()<l-b&&e.max()>-b&&(e=n[q],e.draw(a,d),e.quant&&(g=e.quant))}a.translate(0,c[f].height+this.padding);d.translate(0,c[f].height+this.padding)}a.restore();g&&this.quantLeapThreshold&&this.featureSource&&this.browser.sourceAdapterIsCapable(this.featureSource,"quantLeap")&&(d=c[0].height*(1-(this.quantLeapThreshold-
g.min)/(g.max-g.min)),a.save(),a.strokeStyle="red",a.lineWidth=0.3,a.beginPath(),a.moveTo(-1E3,d),a.lineTo(l+1E3,d),a.stroke(),a.restore())};y.prototype.paintQuant=function(){if(this.quantOverlay){var a=this.browser.retina&&1<window.devicePixelRatio,d;this.subtiers&&0<this.subtiers.length&&(d=this.subtiers[0].quant);if(d){var b=this.subtiers[0].height;this.quantOverlay.height=this.viewport.height;this.quantOverlay.width=a?100:50;this.quantOverlay.style.height=""+(a?this.quantOverlay.height/2:this.quantOverlay.height)+
"px";this.quantOverlay.style.width="50px";this.quantOverlay.style.display="block";var c=this.quantOverlay.getContext("2d");a&&c.scale(2,2);a=2;40<b&&(a=1+(b/20|0));var l=(b+2*this.padding)/(a-1),f=(d.max-d.min)/(a-1);c.fillStyle="white";c.globalAlpha=0.6;"right"==this.browser.rulerLocation?c.fillRect(20,0,30,b+2*this.padding):c.fillRect(0,0,30,b+2*this.padding);c.globalAlpha=1;c.strokeStyle="black";c.lineWidth=1;c.beginPath();if("right"==this.browser.rulerLocation){c.moveTo(42,this.padding);c.lineTo(50,
this.padding);c.lineTo(50,b+this.padding);c.lineTo(42,b+this.padding);for(var g=1;g<a-1;++g){var n=g*l;c.moveTo(50,n);c.lineTo(45,n)}}else for(c.moveTo(8,this.padding),c.lineTo(0,this.padding),c.lineTo(0,b+this.padding),c.lineTo(8,b+this.padding),g=1;g<a-1;++g)n=g*l,c.moveTo(0,n),c.lineTo(5,n);c.stroke();c.fillStyle="black";if("right"==this.browser.rulerLocation)for(c.textAlign="right",c.fillText(X(d.max),41,8),c.fillText(X(d.min),41,b+this.padding),g=1;g<a-1;++g)n=g*l,c.fillText(X(1*d.max-g*f),41,
n+3);else for(c.textAlign="left",c.fillText(X(d.max),9,8),c.fillText(X(d.min),9,b+this.padding),g=1;g<a-1;++g)n=g*l,c.fillText(X(1*d.max-g*f),9,n+3)}else this.quantOverlay.style.display="none"}};y.prototype.styleForFeature=function(a){var d=this.browser.zoomForCurrentScale();if(!this.stylesheet)return null;for(var b=null,c=this.stylesheet.styles,l=0;l<c.length;++l){var f=c[l];if(!(f.zoom&&f.zoom!=d||f.orientation&&f.orientation!=a.orientation)){var g=f._labelRE;g&&g.test||(g=new RegExp("^"+f.label+
"$"),f._labelRE=g);if(!f.label||g.test(a.label))if(g=f._methodRE,g&&g.test||(g=new RegExp("^"+f.method+"$"),f._methodRE=g),!f.method||g.test(a.method)){if(f.type)if("default"==f.type){b||(b=f.style);continue}else if(g=f._typeRE,g&&g.test||(g=new RegExp("^"+f.type+"$"),f._typeRE=g),!g.test(a.type))continue;return f.style}}}return b};y.prototype.quantMin=function(a){return this.forceMinDynamic?this.currentFeaturesMinScore||0:"number"===typeof this.forceMin?this.forceMin:a.MIN||this.currentFeaturesMinScore||
0};y.prototype.quantMax=function(a){return this.forceMaxDynamic?this.currentFeaturesMaxScore||0:"number"===typeof this.forceMax?this.forceMax:a.MAX||this.currentFeaturesMaxScore||0};"undefined"!==typeof s&&(s.exports={drawFeatureTier:m})},{"./cigar":8,"./color":9,"./das":10,"./glyphs":21,"./numformats":26,"./spans":36,"./tier":45,"./utils":49}],19:[function(e,s,r){function p(a,c,b){var f=k(b.type,c.type),g=k(b.label,c.label,b.id,c.id);g&&0!=g.indexOf("__dazzle")&&(f=f+": "+g);this.hit=a;this.feature=
c;this.group=b;this.title=f;this.sections=[]}function m(a,c){var b=[];if(a)for(var f=0;f<a.length;++f)v(b,a[f]);if(c)for(f=0;f<c.length;++f)v(b,c[f]);return b}if("undefined"!==typeof e){var h=e("./cbrowser").Browser;e=e("./utils");var k=e.pick,v=e.pushnew,y=e.makeElement}var E=/^([A-Za-z_-]+)=(.+)/;h.prototype.addFeatureInfoPlugin=function(a){this.featureInfoPlugins||(this.featureInfoPlugins=[]);this.featureInfoPlugins.push(a)};p.prototype.setTitle=function(a){this.title=a};p.prototype.add=function(a,
c){"string"===typeof c&&(c=y("span",c));this.sections.push({label:a,info:c})};h.prototype.featurePopup=function(a,c,b,f){var g=b.length;c=0<=--g?b[g]:{};var q=0<=--g?b[g]:{};b=new p(b,c,q);b.tier=f;for(var g=this.featureInfoPlugins||[],n=0;n<g.length;++n)try{g[n](c,b)}catch(e){console.log(e.stack||e)}g=f.featureInfoPlugins||[];for(n=0;n<g.length;++n)try{g[n](c,b)}catch(h){console.log(h.stack||h)}this.removeAllPopups();f=y("table",null,{className:"table table-striped table-condensed"});f.style.width=
"100%";f.style.margin="0px";g=0;c.method&&(n=y("tr",[y("th","Method"),y("td",c.method)]),f.appendChild(n),++g);n=q.segment?q:c;n=y("tr",[y("th","Location"),y("td",n.segment+":"+n.min+"-"+n.max,{},{minWidth:"200px"})]);f.appendChild(n);++g;void 0===c.score||null===c.score||"-"==c.score||c.suppressScore||(n=y("tr",[y("th","Score"),y("td",""+c.score)]),f.appendChild(n),++g);(n=m(q.links,c.links))&&0<n.length&&(n=y("tr",[y("th","Links"),y("td",n.map(function(a){return y("div",y("a",a.desc,{href:a.uri,
target:"_new"}))}))]),f.appendChild(n),++g);c=m(q.notes,c.notes);for(q=0;q<c.length;++q){var n="Note",k=c[q],A=k.match(E);A&&(n=A[1],k=A[2]);n=y("tr",[y("th",n),y("td",k)]);f.appendChild(n);++g}for(c=0;c<b.sections.length;++c)g=b.sections[c],f.appendChild(y("tr",[y("th",g.label),y("td",g.info)]));this.popit(a,b.title||"Feature",f,{width:450})}},{"./cbrowser":6,"./utils":49}],20:[function(e,s,r){function p(e){for(var p=e.browser.drawnStart,y=e.browser.drawnEnd,E={},a={},c={},b={},f={},g={},q={},n=
{},x=[],S,r,A,u=function(){A={};for(var a=0;a<e.currentFeatures.length;++a){var d=e.currentFeatures[a];d.id&&(A[d.id]=d)}},I=function(a){var d=[];if(a.parents)for(var b=0;b<a.parents.length;++b){var c=a.parents[b],f=A[c];f&&"SO:0000704"==f.typeCv&&pushnew(d,c)}return d},t=0;t<e.currentFeatures.length;++t){var B=e.currentFeatures[t];if(!B.parts){var C=B.min<=y&&B.max>=p;if(B.min&&B.max){if(B.score&&"."!=B.score&&"-"!=B.score){var J=1*B.score;if(!S||J<S)S=J;if(!r||J>r)r=J}var J=[],d=null;if(B.groups)for(var w=
0;w<B.groups.length;++w){var G=B.groups[w],P=G.id;if("gene"==G.type)d=P,g[P]=G;else if("translation"!=G.type){m(a,P,B);g[P]=G;J.push(P);G=b[P];if(!G||B.min<G)b[P]=B.min;G=f[P];if(!G||B.max>G)f[P]=B.max}}if(B.parents)for(A||u(),w=0;w<B.parents.length;++w){var D=B.parents[w],z=A[D];if(z){z.parts||(z.parts=[B]);h(a,D,z);m(a,D,B);g[D]||(g[D]={type:z.type,id:z.id,label:z.label||z.id});J.push(D);G=b[D];if(!G||B.min<G)b[D]=B.min;G=f[D];if(!G||B.max>G)f[D]=B.max;G=I(z);0<G.length&&(d=G[0],D=A[G[0]],g[G[0]]=
{type:D.type,id:D.id,label:D.label||D.id},e.dasSource.collapseSuperGroups||(e.dasSource.collapseSuperGroups=!0))}}if(0==J.length)C&&m(E,B.type,B);else if(d)for(G=0;G<J.length;++G)P=J[G],h(q,d,P),n[P]=d}else x.push(B)}}for(P in a)x=g[P],"number"!==typeof x.min&&(x.min=b[P]),"number"!==typeof x.max&&(x.max=f[P]),f[P]>=p&&b[P]<=y&&(c[P]=a[P]);e.ungroupedFeatures=E;e.groupedFeatures=c;e.groups=g;e.superGroups=q;e.groupsToSupers=n;S&&(0<S?S=0:0>r&&(r=0),e.currentFeaturesMinScore=S,e.currentFeaturesMaxScore=
r)}if("undefined"!==typeof e){e=e("./utils");var m=e.pusho,h=e.pushnewo}"undefined"!==typeof s&&(s.exports={sortFeatures:p})},{"./utils":49}],21:[function(e,s,r){function p(a,d){this._stroke=a;this._fill=d}function m(a,d,b,c,f,g,n,e){this.x=a;this.y=d;this._width=b;this._height=c;this.fill=f;this.stroke=g;this._alpha=n;this._radius=e||0}function h(a,d){this.glyphs=a;this.connector=d;this.h=a[0].height();for(var b=[],c=0;c<a.length;++c){var f=a[c];b.push(new P(f.min(),f.max()));this.h=Math.max(this.h,
f.height())}this.coverage=G(b)}function k(a,d,b){this.points=a;this.color=d;this._height=b||50}function v(a,d,b,c,f,g,n){this.glyph=d;this.text=b;this.anchor=f||"left";this.align=g||"below";n&&(this.font=n);this.font&&(a.save(),a.font=this.font);b=a.measureText(b);this.font&&a.restore();this.textLen=b.width;this.textHeight=5;this.bump=d.bump;this.measured=!c}function y(a,d,b){this._x=a;this._height=d;this._stroke=b}function E(a,d,b){this._x=a;this._height=d;this._stroke=b}function a(a,d,b,c,f,g){p.call(this,
g,f);this._x=a;this._height=d;this._dir=b;this._width=c}function c(a,d,b,c){this._x=a;this._height=d;this._fill=b;this._stroke=c}function b(a,d,b){this.glyph=a;this._min=d;this._max=b;a&&(this.bump=a.bump)}function f(a,d,b,c,f,g){p.call(this,f,c);this._min=a;this._max=d;this._height=b;this._ori=g}function g(a,d,b,c){p.call(this,c,null);this._min=a;this._max=d;this._height=b}function q(a,d,b,c,f,g){this._min=a;this._max=d;this._height=b;this._style=c;this._strand=f;this._stroke=g}function n(a,d,b,
c,f){this._min=a;this._max=d;this._height=b;this._fill=c;this._stroke=f}function x(a,d,b,c,f,g,n){p.call(this,null,c);this._min=a;this._max=d;this._height=b;this._color=c;this._parallel=f;this._sw=g;this._ne=n}function S(a,d,b,c,f){this._min=a;this._max=d;this._height=b;this._fill=c;this._stroke=f}function N(a,d,b,c,f,g){this._min=d;this._max=b;this._height=c;this._fill=f;this._string=g;this._textLen=a.measureText(g).width}function A(a,d,b){var c={red:"darkred",purple:"mediumpurple",blue:"darkblue",
green:"darkgreen"}[b.toLowerCase()];b=c?[b,c]:["rgb(73, 68, 149)","rgb(9, 0, 103)"];return"?"==a?"black":"M"==a?"greenyellow":"*"==a?"crimson":b[d%2]}function u(a){var d={A:"T",T:"A",G:"C",C:"G"};a=a.split("").reverse().join("");for(var b=[],c=0;c<a.length;++c){var f=a.substr(c,1).toUpperCase();b.push(f in d?d[f]:"N")}return b.join("")}function I(a,d,b,c,f,g,n){this._min=a;this._max=d;this._height=b;this._fill=c;this._seq=f;this._orientation=g;this._readframe=n}function t(a,d,b,c){this.glyph=a;this._height=
c;this._x=d;this._y=b}function B(a,d,b,c){this._x=a;this._y=d;this._height=b;this._fill=c}function C(a){this._height=a||50}function J(a,d,b,c,f){p.call(this,f,c);this._x=a;this._r=d;this._points=b}function d(a,d,b,c,f){this._x=a;this._height=d;this._overhang=b;this._fill=c;this._stroke=f;this._hh=d/2}function w(){this.oy=this.ox=0;this.glyphs=[]}if("undefined"!==typeof e){r=e("./spans");var G=r.union,P=r.Range;r=e("./utils");var D=r.makeElementNS,z=r.AMINO_ACID_TRANSLATION;e=e("./svg-utils");var H=
e.NS_SVG,F=e.SVGPath}p.prototype.draw=function(a){a.beginPath();this.drawPath(a);this._fill&&(a.fillStyle=this._fill,a.fill());this._stroke&&(a.strokeStyle=this._stroke,a.stroke())};p.prototype.toSVG=function(){var a=new F;this.drawPath(a);return D(H,"path",null,{d:a.toPathData(),fill:this._fill||"none",stroke:this._stroke||"none"})};p.prototype.drawPath=function(a){throw"drawPath method on PathGlyphBase must be overridden";};m.prototype.draw=function(a){var d=this._radius;0<d?(a.beginPath(),a.moveTo(this.x+
d,this.y),a.lineTo(this.x+this._width-d,this.y),a.arcTo(this.x+this._width,this.y,this.x+this._width,this.y+d,d),a.lineTo(this.x+this._width,this.y+this._height-d),a.arcTo(this.x+this._width,this.y+this._height,this.x+this._width-d,this.y+this._height,d),a.lineTo(this.x+d,this.y+this._height),a.arcTo(this.x,this.y+this._height,this.x,this.y+this._height-d,d),a.lineTo(this.x,this.y+d),a.arcTo(this.x,this.y,this.x+d,this.y,d),a.closePath(),null!=this._alpha&&(a.save(),a.globalAlpha=this._alpha),this.fill&&
(a.fillStyle=this.fill,a.fill()),this.stroke&&(a.strokeStyle=this.stroke,a.lineWidth=0.5,a.stroke())):(null!=this._alpha&&(a.save(),a.globalAlpha=this._alpha),this.fill&&(a.fillStyle=this.fill,a.fillRect(this.x,this.y,this._width,this._height)),this.stroke&&(a.strokeStyle=this.stroke,a.lineWidth=0.5,a.strokeRect(this.x,this.y,this._width,this._height)));null!=this._alpha&&a.restore()};m.prototype.toSVG=function(){var a=D(H,"rect",null,{x:this.x,y:this.y,width:this._width,height:this._height,stroke:this.stroke||
"none",strokeWidth:0.5,fill:this.fill||"none"});null!=this._alpha&&a.setAttribute("opacity",this._alpha);return a};m.prototype.min=function(){return this.x};m.prototype.max=function(){return this.x+this._width};m.prototype.height=function(){return this.y+this._height};h.prototype.drawConnectors=function(a){for(var d=this.coverage.ranges(),b=1;b<d.length;++b){var c=d[b],f=d[b-1];if(f&&c.min()>f.max()){var f=f.max(),c=c.min(),g=(f+c)/2;"hat+"===this.connector?(a.moveTo(f,this.h/2),a.lineTo(g,0),a.lineTo(c,
this.h/2)):"hat-"===this.connector?(a.moveTo(f,this.h/2),a.lineTo(g,this.h),a.lineTo(c,this.h/2)):"collapsed+"===this.connector?(a.moveTo(f,this.h/2),a.lineTo(c,this.h/2),4<c-f&&(a.moveTo(g-2,this.h/2-3),a.lineTo(g+2,this.h/2),a.lineTo(g-2,this.h/2+3))):"collapsed-"===this.connector?(a.moveTo(f,this.h/2),a.lineTo(c,this.h/2),4<c-f&&(a.moveTo(g+2,this.h/2-3),a.lineTo(g-2,this.h/2),a.lineTo(g+2,this.h/2+3))):(a.moveTo(f,this.h/2),a.lineTo(c,this.h/2))}}};h.prototype.draw=function(a,d){for(var b=0;b<
this.glyphs.length;++b)this.glyphs[b].draw(a,d);a.strokeStyle="black";a.beginPath();this.drawConnectors(a);a.stroke()};h.prototype.toSVG=function(){for(var a=D(H,"g"),d=0;d<this.glyphs.length;++d)a.appendChild(this.glyphs[d].toSVG());d=new F;this.drawConnectors(d);0<d.toPathData().length&&(d=D(H,"path",null,{d:d.toPathData(),fill:"none",stroke:"black",strokeWidth:0.5}),a.appendChild(d));return a};h.prototype.min=function(){return this.coverage.min()};h.prototype.max=function(){return this.coverage.max()};
h.prototype.height=function(){return this.h};k.prototype.min=function(){return this.points[0]};k.prototype.max=function(){return this.points[this.points.length-2]};k.prototype.height=function(){return this._height};k.prototype.draw=function(a){a.save();a.strokeStyle=this.color;a.lineWidth=2;a.beginPath();for(var d=0;d<this.points.length;d+=2){var b=this.points[d],c=this.points[d+1];0==d?a.moveTo(b,c):a.lineTo(b,c)}a.stroke();a.restore()};k.prototype.toSVG=function(){for(var a=new F,d=0;d<this.points.length;d+=
2){var b=this.points[d],c=this.points[d+1];0==d?a.moveTo(b,c):a.lineTo(b,c)}return D(H,"path",null,{d:a.toPathData(),fill:"none",stroke:this.color,strokeWidth:"2px"})};v.prototype.toSVG=function(){var a=this.glyph.toSVG(),d={};"above"==this.align?(a=D(H,"g",a,{transform:"translate(0, "+(this.textHeight|2)+")"}),d.y=this.textHeight):d.y=this.glyph.height()+15;this.font&&(d.fontSize=7);d.x="center"==this.anchor?(this.glyph.min()+this.glyph.max()-this.textLen)/2:this.glyph.min();return D(H,"g",[a,D(H,
"text",this.text,d)])};v.prototype.min=function(){return this.glyph.min()};v.prototype.max=function(){return this.measured?Math.max(this.glyph.max(),1*this.glyph.min()+this.textLen+10):this.glyph.max()};v.prototype.height=function(){var a=this.glyph.height();this.measured&&(a="above"==this.align?a+(this.textHeight+2):a+20);return a};v.prototype.draw=function(a,d){"above"==this.align&&(a.save(),a.translate(0,this.textHeight+2));this.glyph.draw(a);"above"==this.align&&a.restore();d.registerGlyph(this)};
v.prototype.drawOverlay=function(a,d,b){a.fillStyle="black";this.font&&(a.save(),a.font=this.font);"center"==this.anchor?b=(this.glyph.min()+this.glyph.max()-this.textLen)/2:(b=this.glyph.min(),b<d&&(b=Math.min(d,this.glyph.max()-this.textLen)));a.fillText(this.text,b,"above"==this.align?this.textHeight:this.glyph.height()+15);this.font&&a.restore()};y.prototype.draw=function(a){var d=this._height/2;a.beginPath();a.moveTo(this._x,0);a.lineTo(this._x,this._height);a.moveTo(this._x-d,d);a.lineTo(this._x+
d,d);a.strokeStyle=this._stroke;a.lineWidth=1;a.stroke()};y.prototype.toSVG=function(){var a=this._height/2,d=new F;d.moveTo(this._x,0);d.lineTo(this._x,this._height);d.moveTo(this._x-a,a);d.lineTo(this._x+a,a);return D(H,"path",null,{d:d.toPathData(),fill:"none",stroke:this._stroke,strokeWidth:"1px"})};y.prototype.min=function(){return this._x-this._height/2};y.prototype.max=function(){return this._x+this._height/2};y.prototype.height=function(){return this._height};E.prototype.draw=function(a){var d=
this._height/2;a.beginPath();a.moveTo(this._x-d,0);a.lineTo(this._x+d,this._height);a.moveTo(this._x-d,this._height);a.lineTo(this._x+d,0);a.strokeStyle=this._stroke;a.lineWidth=1;a.stroke()};E.prototype.toSVG=function(){var a=this._height/2,d=new F;d.moveTo(this._x-a,0);d.lineTo(this._x+a,this._height);d.moveTo(this._x-a,this._height);d.lineTo(this._x+a,0);return D(H,"path",null,{d:d.toPathData(),fill:"none",stroke:this._stroke,strokeWidth:"1px"})};E.prototype.min=function(){return this._x-this._height/
2};E.prototype.max=function(){return this._x+this._height/2};E.prototype.height=function(){return this._height};a.prototype=Object.create(p.prototype);a.prototype.drawPath=function(a){var d=this._height/2,b=this._width/2;"S"===this._dir?(a.moveTo(this._x,this._height),a.lineTo(this._x-b,0),a.lineTo(this._x+b,0)):"W"===this._dir?(a.moveTo(this._x+b,d),a.lineTo(this._x-b,0),a.lineTo(this._x-b,this._height)):"E"===this._dir?(a.moveTo(this._x-b,d),a.lineTo(this._x+b,0),a.lineTo(this._x+b,this._height)):
(a.moveTo(this._x,0),a.lineTo(this._x+b,this._height),a.lineTo(this._x-b,this._height));a.closePath()};a.prototype.min=function(){return this._x-this._height/2};a.prototype.max=function(){return this._x+this._height/2};a.prototype.height=function(){return this._height};c.prototype.draw=function(a){var d=this._height/2;a.fillStyle=this._stroke;a.beginPath();a.arc(this._x,d,d,0,6.29);this._fill&&(a.fillStyle=this._fill,a.fill());this._stroke&&(a.strokeStyle=this._stroke,a.stroke())};c.prototype.toSVG=
function(){var a=this._height/2;return D(H,"circle",null,{cx:this._x,cy:a,r:a,fill:this._fill||"none",stroke:this._stroke||"none",strokeWidth:"1px"})};c.prototype.min=function(){return this._x-this._height/2};c.prototype.max=function(){return this._x+this._height/2};c.prototype.height=function(){return this._height};b.prototype.draw=function(a,d){this.glyph&&this.glyph.draw(a,d)};b.prototype.toSVG=function(){return this.glyph?this.glyph.toSVG():D(H,"g")};b.prototype.min=function(){return this._min};
b.prototype.max=function(){return this._max};b.prototype.height=function(){return this.glyph?this.glyph.height():1};f.prototype=Object.create(p.prototype);f.prototype.min=function(){return this._min};f.prototype.max=function(){return this._max};f.prototype.height=function(){return this._height};f.prototype.drawPath=function(a){var d=this._max,b=this._min,c=this._height,f=0,g=0,n=this._height+2,e=0.333333*this._height;this._ori&&("+"===this._ori?g=0.5*this._height:"-"===this._ori&&(f=0.5*this._height));
d-b<n&&(b=(d+b-n)/2,d=b+n);a.moveTo(b+f,0+e);a.lineTo(d-g,0+e);a.lineTo(d-g,0);a.lineTo(d,0+this._height/2);a.lineTo(d-g,0+c);a.lineTo(d-g,0+e+e);a.lineTo(b+f,0+e+e);a.lineTo(b+f,0+c);a.lineTo(b,0+c/2);a.lineTo(b+f,0);a.lineTo(b+f,0+e)};g.prototype=Object.create(p.prototype);g.prototype.min=function(){return this._min};g.prototype.max=function(){return this._max};g.prototype.height=function(){return this._height};g.prototype.drawPath=function(a){var d=this._min,b=this._max,c=this._height,f=c/2;a.moveTo(d,
f);a.lineTo(b,f);a.moveTo(d,0);a.lineTo(d,c);a.moveTo(b,0);a.lineTo(b,c)};q.prototype.min=function(){return this._min};q.prototype.max=function(){return this._max};q.prototype.height=function(){return this._height};q.prototype.drawPath=function(a){var d=this._min,b=this._max,c=this._height,f=c/2;"hat"===this._style?(a.moveTo(d,f),a.lineTo((d+b)/2,"-"===this._strand?c:0)):a.moveTo(d,f);a.lineTo(b,f)};q.prototype.draw=function(a){a.beginPath();this.drawPath(a);a.strokeStyle=this._stroke;"dashed"===
this._style&&a.setLineDash?(a.save(),a.setLineDash([3]),a.stroke(),a.restore()):a.stroke()};q.prototype.toSVG=function(){var a=new F;this.drawPath(a);a={d:a.toPathData(),stroke:this._stroke||"none"};"dashed"===this._style&&(a.strokeDasharray="3");return D(H,"path",null,a)};n.prototype.min=function(){return this._min};n.prototype.max=function(){return this._max};n.prototype.height=function(){return this._height};n.prototype.drawStemPath=function(a){var d=this._max,b=this._height/2;a.moveTo(this._min,
b);a.lineTo(d,b)};n.prototype.drawTrigsPath=function(a){var d=this._min,b=this._max,c=this._height,f=c/2;a.moveTo(d,0);a.lineTo(d+c,f);a.lineTo(d,c);a.lineTo(d,0);a.moveTo(b,0);a.lineTo(b-c,f);a.lineTo(b,c);a.lineTo(b,0)};n.prototype.draw=function(a){a.beginPath();this.drawStemPath(a);a.strokeStyle=this._stroke;a.stroke();a.beginPath();this.drawTrigsPath(a);a.fillStyle=this._fill;a.fill()};n.prototype.toSVG=function(){var a=new F;this.drawStemPath(a);var d=new F;this.drawTrigsPath(d);return D(H,"g",
[D(H,"path",null,{d:a.toPathData(),stroke:this._stroke||"none"}),D(H,"path",null,{d:d.toPathData(),fill:this._fill||"none"})])};x.prototype=Object.create(p.prototype);x.prototype.min=function(){return this._min};x.prototype.max=function(){return this._max};x.prototype.height=function(){return this._height};x.prototype.drawPath=function(a){var d=this._min,b=this._max,c=this._height;if(this._parallel){var f=c/2,g=0.4*c;this._sw?(a.moveTo(d+f,c-g),a.lineTo(d+f,c),a.lineTo(d,f),a.lineTo(d+f,0),a.lineTo(d+
f,g)):(a.moveTo(d,c-g),a.lineTo(d,g));this._ne?(a.lineTo(b-f,g),a.lineTo(b-f,0),a.lineTo(b,f),a.lineTo(b-f,c),a.lineTo(b-f,c-g)):(a.lineTo(b,g),a.lineTo(b,c-g))}else{var f=(d+b)/2,g=0.4*(b-d),n=c/3;this._ne?(a.moveTo(d+g,n),a.lineTo(d,n),a.lineTo(f,0),a.lineTo(b,n),a.lineTo(b-g,n)):(a.moveTo(d+g,0),a.lineTo(b-g,0));this._sw?(a.lineTo(b-g,c-n),a.lineTo(b,c-n),a.lineTo(f,c),a.lineTo(d,c-n),a.lineTo(d+g,c-n)):(a.lineTo(b-g,c),a.lineTo(d+g,c))}a.closePath()};S.prototype.min=function(){return this._min};
S.prototype.max=function(){return this._max};S.prototype.height=function(){return this._height};S.prototype.toSVG=function(){return D(H,"rect",null,{x:this._min,y:0,width:this._max-this._min,height:this._height,stroke:this._stroke||"none",fill:this._fill||"none"})};S.prototype.draw=function(a){this._fill&&(a.fillStyle=this._fill,a.fillRect(this._min,0,this._max-this._min,this._height));if(this._stroke){a.strokeStyle=this._stroke;a.strokeRect(this._min,0,this._max-this._min,this._height);a.beginPath();
for(var d=2;d<this._height;d+=3)a.moveTo(this._min,d),a.lineTo(this._max,d);a.stroke()}};N.prototype.min=function(){return this._min};N.prototype.max=function(){return Math.max(this._max,this._min+this._textLen)};N.prototype.height=function(){return this._height};N.prototype.draw=function(a){a.fillStyle=this._fill;a.fillText(this._string,this._min,this._height-4)};N.prototype.toSVG=function(){return D(H,"text",this._string,{x:this._min,y:this._height-4})};I.prototype.min=function(){return this._min};
I.prototype.max=function(){return this._max};I.prototype.height=function(){return this._height};I.prototype.draw=function(a){var d=this._seq,b=this._fill;if(d){var c=(this._max-this._min+1)/d.length,f=(3-this._readframe)%3,g=(d.length-f)%3,f="+"==this._orientation?f:g;0<f&&(a.fillStyle=b,a.fillRect(this._min,0,c*f,this._height));for(;f<d.length;f+=3){g=d.substr(f,3).toUpperCase();"-"==this._orientation&&(g=u(g));var n=g in z?z[g]:"?",b=3==g.length?A(n,f,this._fill):this._fill;a.fillStyle=b;a.fillRect(this._min+
f*c,0,c*g.length,this._height);8<=c&&3==g.length&&(a.fillStyle="white",a.fillText(n,this._min+(f+1)*c,this._height))}}};I.prototype.toSVG=function(){var a=D(H,"g"),d=this._seq,b=this._fill;if(!d)return a;var c=(this._max-this._min+1)/d.length,f=(3-this._readframe)%3,g=(d.length-f)%3,f="+"==this._orientation?f:g;for(0<f&&a.appendChild(D(H,"rect",null,{x:this._min,y:0,width:c*f,height:this._height,fill:b}));f<d.length;f+=3){g=d.substr(f,3).toUpperCase();"-"==this._orientation&&(g=u(g));var n=g in z?
z[g]:"?",b=3==g.length?A(n,f,this._fill):this._fill;a.appendChild(D(H,"rect",null,{x:this._min+f*c,y:0,width:c*g.length,height:this._height,fill:b}));8<=c&&3==g.length&&a.appendChild(D(H,"text",n,{x:this._min+(f+1)*c,y:this._height,fill:"white"}))}return a};(function(a){function d(a,b,c,f,g,l,n,e,q,h){this.baseColors=a;this._strandColor=b;this._min=c;this._max=f;this._height=g;this._seq=l;this._ref=n;this._scheme=e;this._quals=q;this._fillbg=h}var b=1<window.devicePixelRatio,c={},f=/^[ACGT-]$/;d.prototype.min=
function(){return this._min};d.prototype.max=function(){return this._max};d.prototype.height=function(){return this._height};d.prototype.alphaForQual=function(a){return 0.1+0.9*Math.max(0,Math.min(1*a/30,1))};d.prototype.draw=function(a){var d=this._seq,g=this._ref,l="mismatch-all"===this._scheme,n=d?d.length:this._max-this._min+1,e=(this._max-this._min+1)/n;"mismatch"!==this._scheme&&"mismatch-all"!==this._scheme||8<=e||(a.fillStyle=this._strandColor,a.fillRect(this._min,this._height/4,this._max-
this._min,this._height/2));for(var q=0;q<n;++q){var h=d?d.substr(q,1).toUpperCase():"N";if(f.test(h)||8<=e){var k=this.baseColors[h];if(this._quals){var w=this._quals.charCodeAt(q)-33,m=a.globalAlpha;a.globalAlpha=this.alphaForQual(w)}k||(w=g?g.substr(q,1).toUpperCase():"N",k="N"==h||"N"==w?"gray":this._strandColor,l&&(h=w));a.fillStyle=k;w=f.test(h);!this._fillbg&&8<=e&&w||a.fillRect(this._min+q*e,0,e,this._height);if(8<=e&&w){var w=k+"_"+h,u=c[w];if(!u){u=document.createElement("canvas");b?(u.width=
16,u.height=20):(u.width=8,u.height=10);var t=u.getContext("2d");b&&t.scale(2,2);t.fillStyle=this._fillbg?"black":k;k=t.measureText(h).width;t.fillText(h,0.5*(8-k),8);c[w]=u}b?a.drawImage(u,this._min+q*e+0.5*(e-8),0,8,10):a.drawImage(u,this._min+q*e+0.5*(e-8),0)}this._quals&&(a.globalAlpha=m)}}};d.prototype.toSVG=function(){for(var a=this._seq,d=this._ref,b="mismatch-all"===this._scheme,c=(this._max-this._min+1)/this._seq.length,g=D(H,"g"),l=0;l<a.length;++l){var n=a?a.substr(l,1).toUpperCase():"N",
e=this.baseColors[n];if(!e){var q=d?d.substr(l,1).toUpperCase():"N",e="N"==n||"N"==q?"gray":this._strandColor;b&&(n=q)}q=1;this._quals&&(q=this._quals.charCodeAt(l)-33,q=this.alphaForQual(q));var h=f.test(n);!this._fillbg&&8<=c&&h||g.appendChild(D(H,"rect",null,{x:this._min+l*c,y:0,width:c,height:this._height,fill:e,fillOpacity:q}));8<=c&&h&&g.appendChild(D(H,"text",n,{x:this._min+(0.5+l)*c,y:8,textAnchor:"middle",fill:this._fillbg?"black":e,fillOpacity:q}))}return g};a.SequenceGlyph=d})(this);t.prototype.height=
function(){return this._height?this._height:this.glyph.height()+this._y};t.prototype.min=function(){return this.glyph.min()+this._x};t.prototype.max=function(){return this.glyph.max()+this._x};t.prototype.minY=function(){return this._y};t.prototype.maxY=function(){return this._y+this.glyph.height()};t.prototype.draw=function(a,d){a.save();a.translate(this._x,this._y);this.glyph.draw(a,d);a.restore()};t.prototype.toSVG=function(){var a=this.glyph.toSVG();a.setAttribute("transform","translate("+this._x+
","+this._y+")");return a};B.prototype.min=function(){return this._x-2};B.prototype.max=function(){return this._x+2};B.prototype.height=function(){return this._height};B.prototype.draw=function(a){a.save();a.globalAlpha=0.3;a.fillStyle=this._fill;a.beginPath();a.arc(this._x,this._y,1.5,0,6.29);a.fill();a.restore()};B.prototype.toSVG=function(){return D(H,"circle",null,{cx:this._x,cy:this._y,r:2,fill:this._fill,stroke:"none"})};C.prototype.notSelectable=!0;C.prototype.min=function(){return-1E5};C.prototype.max=
function(){return 1E5};C.prototype.height=function(){return this._height};C.prototype.draw=function(a){a.save();a.strokeStyle="black";a.lineWidth=0.1;a.beginPath();for(var d=0;d<=this._height;d+=10)a.moveTo(-5E3,d),a.lineTo(5E3,d);a.stroke();a.restore()};C.prototype.toSVG=function(){for(var a=new F,d=0;d<=this._height;d+=10)a.moveTo(-5E3,d),a.lineTo(5E3,d);return D(H,"path",null,{d:a.toPathData(),fill:"none",stroke:"black",strokeWidth:"0.1px"})};J.prototype=Object.create(p.prototype);J.prototype.min=
function(){return this._x-this._r};J.prototype.max=function(){return this._x+this._r};J.prototype.height=function(){return 2*this._r};J.prototype.drawPath=function(a){for(var d=this._x,b=this._r,c=this._r,f=0;f<this._points;++f){var g=6.28*f/this._points,n=d+c*Math.sin(g),g=b-c*Math.cos(g);0==f?a.moveTo(n,g):a.lineTo(n,g);g=6.28*(f+0.5)/this._points;n=d+0.4*c*Math.sin(g);g=b-0.4*c*Math.cos(g);a.lineTo(n,g)}a.closePath()};d.prototype.draw=function(a){var d=this._height/2;a.fillStyle=this._stroke;a.beginPath();
a.arc(this._x,d,d-this._overhang,0,6.29);a.moveTo(this._x,0);a.lineTo(this._x,this._height);this._fill&&(a.fillStyle=this._fill,a.fill());this._stroke&&(a.strokeStyle=this._stroke,a.stroke())};d.prototype.toSVG=function(){var a=this._hh;return D(H,"g",[D(H,"circle",null,{cx:this._x,cy:a,r:a-this._overhang}),D(H,"line",null,{x1:this._x,y1:0,x2:this._x,y2:this._height})],{fill:this._fill||"none",stroke:this._stroke||"none",strokeWidth:"1px"})};d.prototype.min=function(){return this._x-this._hh};d.prototype.max=
function(){return this._x+this._hh};d.prototype.height=function(){return this._height};w.prototype.translate=function(a,d){this.ox+=a;this.oy+=d};w.prototype.registerGlyph=function(a){this.glyphs.push({x:this.ox,y:this.oy,glyph:a})};w.prototype.draw=function(a,d,b){for(var c=0;c<this.glyphs.length;++c){var f=this.glyphs[c];a.save();a.translate(f.x,f.y);f.glyph.drawOverlay(a,d,b);a.restore()}};"undefined"!==typeof s&&(s.exports={BoxGlyph:m,GroupGlyph:h,LineGraphGlyph:k,LabelledGlyph:v,CrossGlyph:y,
ExGlyph:E,TriangleGlyph:a,DotGlyph:c,PaddedGlyph:b,AArrowGlyph:f,SpanGlyph:g,LineGlyph:q,PrimersGlyph:n,ArrowGlyph:x,TooManyGlyph:S,TextGlyph:N,SequenceGlyph:this.SequenceGlyph,AminoAcidGlyph:I,TranslatedGlyph:t,GridGlyph:C,StarGlyph:J,PointGlyph:B,PlimsollGlyph:d,OverlayLabelCanvas:w})},{"./spans":36,"./svg-utils":39,"./utils":49}],22:[function(e,s,r){function p(e,k){this.base=e;this.query=k}if("undefined"!==typeof e)var m=e("./das").DASFeature;p.prototype.features=function(e,k,p){url=this.base+
"/features/"+e.name;k=[];this.query&&k.push(this.query);e.isBounded&&(k.push("start="+e.start),k.push("end="+e.end));0<k.length&&(url=url+"?"+k.join("&"));var y=new XMLHttpRequest;y.onreadystatechange=function(){if(4==y.readyState)if(300<=y.status)p(null,"Error code "+y.status);else{var k=JSON.parse(y.response).features,a=[];for(fi=0;fi<k.length;++fi){var c=k[fi],b=new m;b.segment=e;b.min=(c.start|0)+1;b.max=c.end|0;c.name&&(b.label=c.name);b.type=c.type||"unknown";a.push(b)}p(a)}};y.open("GET",url,
!0);y.responseType="text";y.send("")};"undefined"!==typeof s&&(s.exports={JBrowseStore:p})},{"./das":10}],23:[function(e,s,r){function p(){var a=this;this.reqs=[];this.awaitedFeatures={};this.requestsIssued=new t(function(b,c){a.notifyRequestsIssued=b})}function m(a,b,c,d,f,g,n){this.chr=a;this.min=b;this.max=c;this.coverage=n;this.scale=d;this.features=f||[];this.status=g}function h(a,b,c,d,f,g){this.tierMap=a;this.chr=b;this.min=c;this.max=d;this.scale=f;this.seqSource=g||new q;this.viewCount=0;
this.featureCache={};this.latestViews={}}function k(a,b,c){for(var d=[],f={},g=0;g<a.length;++g){var n=a[g];n.min&&n.max?n.groups&&0<n.groups.length?y(f,n.groups[0].id,n):n.min<=c&&n.max>=b&&d.push(n):d.push(n)}for(var e in f){a=f[e];for(var q=1E11,h=-1E11,g=0;g<a.length;++g)n=a[g],q=Math.min(q,n.min),h=Math.max(h,n.max);if(q<=c||h>=b)for(g=0;g<a.length;++g)d.push(a[g])}return d}if("undefined"!==typeof e){r=e("./utils");var v=r.Awaited,y=r.pusho;r=e("./sourceadapters");var E=r.MappedFeatureSource,
a=r.CachingFeatureSource,c=r.BWGFeatureSource,b=r.RemoteBWGFeatureSource,f=r.BAMFeatureSource,g=r.RemoteBAMFeatureSource,q=r.DummySequenceSource,n=r.DummyFeatureSource,x=e("./overlay").OverlayFeatureSource;r=e("./spans");var S=r.Range,N=r.intersection;r=e("./sample");var A=r.downsample,u=r.getBaseCoverage,I=e("./das").DASSequence,t=e("es6-promise").Promise}p.prototype.addRequest=function(a){this.reqs.push(a)};p.prototype.abortAll=function(){for(var a=0;a<this.reqs.length;++a)this.reqs[a].abort()};
m.prototype.toString=function(){return this.chr+":"+this.min+".."+this.max+";scale="+this.scale};h.prototype.cancel=function(){this.cancelled=!0};h.prototype.bestCacheOverlapping=function(a,b,c){return(a=this.featureCache[this.tierMap[0]])?a:null};h.prototype.retrieveFeatures=function(a,b,c,d,f,g){if(f!=f)throw"retrieveFeatures called with silly scale";if(b!=this.chr)throw"Can't extend Known Space to a new chromosome";1>c&&(c=1);this.min=c;this.max=d;this.scale=f;this.pool&&this.pool.abortAll();this.pool=
new p;this.awaitedSeq=new v;this.seqWasFetched=!1;this.viewCount++;this.startFetchesForTiers(a,g);this.pool.notifyRequestsIssued()};h.prototype.invalidate=function(a,b){this.pool&&(this.featureCache[a]=null,this.startFetchesForTiers([a],b))};h.prototype.startFetchesForTiers=function(a,b){for(var c=this,d=this.awaitedSeq,f=!1,g,n=0;n<a.length;++n)try{this.startFetchesFor(a[n],d,b)&&(f=!0)}catch(e){var q=a[n];q.currentFeatures=[];q.currentSequence=null;console.log("Error fetching tier source");console.log(e);
g=e;b(e,q)}if(f&&!this.seqWasFetched){this.seqWasFetched=!0;var h=this.min,k=this.max;if(this.cs&&this.cs.start<=h&&this.cs.end>=k)return f=this.cs.start==h&&this.cs.end==k?this.cs:new I(this.cs.name,h,k,this.cs.alphabet,this.cs.seq.substring(h-this.cs.start,k+1-this.cs.start)),d.provide(f);this.seqSource.fetch(this.chr,h,k,this.pool,function(a,b){if(b){if(!c.cs||h<=c.cs.start&&k>=c.cs.end||h>=c.cs.end||k<=c.cs.start||k-h>c.cs.end-c.cs.start)c.cs=b;d.provide(b)}else console.log("Sequence loading failed",
a),d.provide(null)})}if(g)throw g;};h.prototype.startFetchesFor=function(a,b,c){var d=this,f=this.viewCount,g=a.getSource()||new n,e=a.needsSequence(this.scale),q=d.featureCache[a],h=a.getActiveStyleFilters(this.scale),u;h&&(u=h.typeList());var t=this.chr,l=this.min,p=this.max;if(void 0===u)return!1;if(q&&q.chr===this.chr&&q.min<=l&&q.max>=p){var x=q.features;if(q.min<l||q.max>p)x=k(x,l,p);d.provision(a,q.chr,N(q.coverage,new S(l,p)),q.scale,u,x,q.status,e?b:null,c);x=g.getScales();if(q.scale<=this.scale||
!x)return e}g.instrument&&console.log("Starting  fetch "+f+" ("+l+", "+p+")");g.fetch(t,l,p,this.scale,u,this.pool,function(n,h,k,x){g.instrument&&console.log("Finishing fetch "+f);var A=d.latestViews[a]||-1;if(!(d.cancelled||A>f)){x||(x=new S(l,p));if(!q||l<q.min||p>q.max)d.featureCache[a]=new m(t,l,p,k,h,n,x);d.latestViews[a]=f;d.provision(a,t,x,k,u,h,n,e?b:null,c)}},h);return e};h.prototype.provision=function(n,e,q,d,h,k,m,t,p){m&&n.setFeatures(e,q,d,[],null);if(!m){for(var v=!1,F=!1,l=n.getSource();E.prototype.isPrototypeOf(l)||
a.prototype.isPrototypeOf(l)||x.prototype.isPrototypeOf(l);)l=x.prototype.isPrototypeOf(l)?l.sources[0]:l.source;if(c.prototype.isPrototypeOf(l)||b.prototype.isPrototypeOf(l)||f.prototype.isPrototypeOf(l)||g.prototype.isPrototypeOf(l))v=!0;l.opts&&(l.opts.forceReduction||l.opts.noDownsample)||v&&h&&1==h.length&&0<=h.indexOf("density")&&(k=A(k,this.scale));h&&1==h.length&&0<=h.indexOf("base-coverage")&&(F=!0);t?t.await(function(a){F&&(k=u(k,a,n.browser.baseColors));n.setFeatures(e,q,d,k,a)}):n.setFeatures(e,
q,d,k)}p(m,n)};"undefined"!==typeof s&&(s.exports={KnownSpace:h})},{"./das":10,"./overlay":27,"./sample":29,"./sourceadapters":34,"./spans":36,"./utils":49,"es6-promise":53}],24:[function(e,s,r){function p(a,b){this.block=a;this.offset=b}function m(a,b){var f=4294967296*(a[b+6]&255)+16777216*(a[b+5]&255)+65536*(a[b+4]&255)+256*(a[b+3]&255)+(a[b+2]&255),g=a[b+1]<<8|a[b];return 0==f&&0==g?null:new p(f,g)}function h(c,b){b=Math.min(b||1,c.byteLength-50);for(var f=[],g=[0],e=0;g[0]<b;){var n=new Uint8Array(c,
g[0],12),n=n[11]<<8|n[10],n=E(c,12+n+g[0],Math.min(65536,c.byteLength-12-n-g[0]),g);g[0]+=8;e+=n.byteLength;f.push(n)}if(1==f.length)return f[0];g=new Uint8Array(e);for(n=e=0;n<f.length;++n){var h=new Uint8Array(f[n]);a(h,0,g,e,h.length);e+=h.length}return g.buffer}function k(a,b){this.minv=a;this.maxv=b}function v(a,b){--b;return a>>14==b>>14?4681+(a>>14):a>>17==b>>17?585+(a>>17):a>>20==b>>20?73+(a>>20):a>>23==b>>23?9+(a>>23):a>>26==b>>26?1+(a>>26):0}function y(a,b){var f,g=[];--b;g.push(0);for(f=
1+(a>>26);f<=1+(b>>26);++f)g.push(f);for(f=9+(a>>23);f<=9+(b>>23);++f)g.push(f);for(f=73+(a>>20);f<=73+(b>>20);++f)g.push(f);for(f=585+(a>>17);f<=585+(b>>17);++f)g.push(f);for(f=4681+(a>>14);f<=4681+(b>>14);++f)g.push(f);return g}if("undefined"!==typeof e){e=e("jszlib");var E=e.inflateBuffer,a=e.arrayCopy}p.prototype.toString=function(){return""+this.block+":"+this.offset};"undefined"!==typeof s&&(s.exports={unbgzf:h,readVob:m,reg2bin:v,reg2bins:y,Chunk:k})},{jszlib:65}],25:[function(e,s,r){function p(){this.featuresByChr=
{};this.maxLength=1;this.chrRing=null}function m(a){this.source=a;v.call(this);this.storeHolder=new y;this.parser=k(a.payload);if(!this.parser)throw"Unsupported memstore payload: "+a.payload;var c=this;this._load(function(a,f){if(a){for(var g=new p,e=[],n=a.split("\n"),h=c.parser.createSession(function(a){e.push(a)}),k=0;k<n.length;++k){var m=n[k];0<m.length&&h.parse(m)}h.flush();g.addFeatures(e);c.storeHolder.provide(g)}else c.error=f||"No data",c.storeHolder.provide(null)})}if("undefined"!==typeof e){s=
e("./sourceadapters");var h=s.registerSourceAdapterFactory,k=s.makeParser,v=s.FeatureSourceBase;e("./das");e=e("./utils");var y=e.Awaited,E=e.textXHR}p.prototype.addFeatures=function(a){for(var c={},b=0;b<a.length;++b){var f=a[b],g=f.segment||f.chr,e=this.featuresByChr[g];e||(e=[],this.featuresByChr[g]=e);e.push(f);c[g]=!0;f=f.max-f.min+1;f>this.maxLength&&(this.maxLength=f)}for(g in c)e=this.featuresByChr[g],e.sort(function(a,b){var c=a.min-b.min;return 0!=c?c:a.max-b.max});this.chrRing=null};p.prototype._indexFor=
function(a,c){for(var b=0,f=a.length;f>b;){var g=(b+f)/2|0;if(g>=a.length)return a.length;c<a[g].min?f=g:b=g+1}return f};p.prototype.fetch=function(a,c,b){var f=this.featuresByChr[a];f||(f=0==a.indexOf("chr")?this.featuresByChr[a.substring(3)]:this.featuresByChr["chr"+a]);if(!f)return[];var g=Math.max(0,this._indexFor(f,c-this.maxLength-1));a=Math.min(f.length-1,this._indexFor(f,b));for(var e=[];g<=a;++g){var n=f[g];n.min<=b&&n.max>=c&&e.push(n)}return e};p.prototype.findNextFeature=function(a,c,
b){if(null==this.chrRing){this.chrRing=[];for(a in this.featuresByChr)this.chrRing.push(a);this.chrRing.sort()}var f=this.featuresByChr[a];f||(a=0==a.indexOf("chr")?a.substring(3):"chr"+a,f=this.featuresByChr[a]);if(!f)return null;var g=Math.max(0,Math.min(this._indexFor(f,c),f.length-1));if(0<b){for(;g<f.length;){var e=f[g++];if(e.min>c)return e}a=this.chrRing.indexOf(a)+1;a>=this.chrRing.length&&(a=0);return this.findNextFeature(this.chrRing[a],0,b)}for(;0<=g;)if(e=f[g--],e.max<c)return e;a=this.chrRing.indexOf(a)-
1;0>a&&(a=this.chrRing.length-1);return this.findNextFeature(this.chrRing[a],1E10,b)};m.prototype=Object.create(v.prototype);m.prototype._load=function(a){if(this.source.blob){var c=new FileReader;c.onloadend=function(){return a(c.result,c.error)};c.readAsText(this.source.blob)}else{if(this.source.credentials)var b={credentials:this.source.credentials};E(this.source.uri,a,b)}};m.prototype.fetch=function(a,c,b,f,g,e,n){var h=this;this.storeHolder.await(function(f){return f?(f=f.fetch(a,c,b),n(null,
f,1E8)):n(h.error)})};m.prototype.getStyleSheet=function(a){this.parser&&this.parser.getStyleSheet&&this.parser.getStyleSheet(a)};m.prototype.getDefaultFIPs=function(a){this.parser&&this.parser.getDefaultFIPs&&this.parser.getDefaultFIPs(a)};m.prototype.getScales=function(){return 1E8};m.prototype.findNextFeature=function(a,c,b,f){var g=this;this.storeHolder.await(function(e){return e?f(e.findNextFeature(a,c,b)):f(null,g.error)})};m.prototype.capabilities=function(){return{leap:!0}};h("memstore",function(a){return{features:new m(a)}})},
{"./das":10,"./sourceadapters":34,"./utils":49}],26:[function(e,s,r){function p(e){return(e|0).toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")}function m(e){e=""+e;var k=e.indexOf(".");if(0>k)return e;var m=2;"-"==e.substring(0,1)&&++m;return k>=m?e.substring(0,k):e.substring(0,k+2)}"undefined"!==typeof s&&(s.exports={formatLongInt:p,formatQuantLabel:m})},{}],27:[function(e,s,r){function p(e,a){this.sources=e;this.opts=a||{};this.activityListeners=[];this.readinessListeners=[];this.changeListeners=
[];this.business=[];this.readiness=[];for(var c=0;c<this.sources.length;++c)this.initN(c);"function"===typeof a.merge?this.merge=a.merge:"concat"==a.merge?this.merge=k:"alternates"==a.merge?(this.merge=k,this.filterDispatchOnMethod=!0):this.merge=h}function m(e,a,c){this.source=e;this.callback=a;this.sources=c;this.count=c.length;this.statusCount=this.returnCount=0;this.returns=[];this.features=[];this.statuses=[];this.scale=null}function h(e){for(var a=[],c=1;c<e.length;++c){for(var b={},f=e[c],
g=0;g<f.length;++g)b[this.keyForFeature(f[g])]=f[g];a.push(b)}c=[];e=e[0];for(g=0;g<e.length;++g){for(var q=e[g],n=0;n<a.length;++n)if(b=a[n],f=b[this.keyForFeature(q)])for(var h in f)"score"===h?q.score2=f.score:"min"!==h&&"max"!==h&&"segment"!==h&&"_cachedStyle"!==h&&(q[h]=f[h]);c.push(q)}return c}function k(e,a){for(var c=[],b=0;b<e.length;++b)for(var f=e[b],g=a[b].name,q=0;q<f.length;++q){var n=f[q];n.method=g;c.push(n)}return c}if("undefined"!==typeof e){e=e("./utils");var v=e.shallowCopy,y=
e.arrayIndexOf}p.prototype.initN=function(e){var a=this.sources[e],c=this;this.business[e]=0;a.addActivityListener&&a.addActivityListener(function(a){c.business[e]=a;c.notifyActivity()});a.addChangeListener&&a.addChangeListener(function(){c.notifyChange()});a.addReadinessListener&&a.addReadinessListener(function(a){c.readiness[e]=a;c.notifyReadiness()})};p.prototype.addReadinessListener=function(e){this.readinessListeners.push(e);this.notifyReadinessListener(e)};p.prototype.removeReadinessListener=
function(e){e=y(this.readinessListeners,e);0<=e&&this.readinessListeners.splice(e,1)};p.prototype.notifyReadiness=function(){for(var e=0;e<this.readinessListeners.length;++e)this.notifyReadinessListener(this.readinessListeners[e])};p.prototype.notifyReadinessListener=function(e){for(var a=null,c=0;c<this.readiness.length;++c)if(null!=this.readiness[c]){a=this.readiness[c];break}try{e(a)}catch(b){console.log(b)}};p.prototype.addActivityListener=function(e){this.activityListeners.push(e)};p.prototype.removeActivityListener=
function(e){e=y(this.activityListeners,e);0<=e&&this.activityListeners.splice(e,1)};p.prototype.notifyActivity=function(){for(var e=0,a=0;a<this.business.length;++a)e+=this.business[a];for(a=0;a<this.activityListeners.length;++a)try{this.activityListeners[a](e)}catch(c){console.log(c)}};p.prototype.addChangeListener=function(e){this.changeListeners.push(e)};p.prototype.removeChangeListener=function(e){e=y(this.changeListeners,e);0<=e&&this.changeListeners.splice(e,1)};p.prototype.notifyChange=function(){for(var e=
0;e<this.changeListeners.length;++e)try{this.changeListeners[e](this.busy)}catch(a){console.log(a)}};p.prototype.getScales=function(){return this.sources[0].getScales()};p.prototype.getStyleSheet=function(e){return this.sources[0].getStyleSheet(e)};p.prototype.capabilities=function(){var e={},a=this.sources[0];a.capabilities&&(e=v(a.capabilities()));for(a=1;a<this.sources.length;++a){var c=this.sources[a];c.capabilities&&(c=c.capabilities(),c.search&&(e.search=c.search))}return e};p.prototype.search=
function(e,a){for(var c=0;c<this.sources.length;++c){var b;b=this.sources[c];b=b.capabilities?b.capabilities().search:!1;if(b)return this.sources[c].search(e,a)}};p.prototype.fetch=function(e,a,c,b,f,g,q,n){var h;if(this.filterDispatchOnMethod){h=[];for(var k=n.list(),p=0;p<this.sources.length;++p)for(var A=this.sources[p],u=0;u<k.length;++u){var v=k[u];if(!v.method||v.method==A.name){h.push(A);break}}}else h=this.sources;q=new m(this,q,h);for(p=0;p<h.length;++p)this.fetchN(q,p,h[p],e,a,c,b,f,g,n)};
p.prototype.fetchN=function(e,a,c,b,f,g,q,n,h,k){c.fetch(b,f,g,q,n,h,function(b,c,f){return e.completed(a,b,c,f)},k)};p.prototype.quantFindNextFeature=function(e,a,c,b,f){return this.sources[0].quantFindNextFeature(e,a,c,b,f)};p.prototype.findNextFeature=function(e,a,c,b){return this.sources[0].findNextFeature(e,a,c,b)};m.prototype.completed=function(e,a,c,b){if(null==this.scale||0==e)this.scale=b;if(this.returns[e])throw"Multiple returns for source "+e;this.returns[e]=!0;this.returnCount++;this.features[e]=
c;a&&(this.statuses[e]=a,this.statusCount++);if(this.returnCount==this.count){if(0<this.statusCount){e="";for(a=0;a<this.count;++a)if(c=this.statuses[a])0<e.length&&(e+=", "),e+=c;return this.callback(e,null,this.scale)}this.callback(null,this.source.merge(this.features,this.sources),this.scale)}};p.prototype.getDefaultFIPs=function(e){for(var a=0;a<this.sources.length;++a){var c=this.sources[a];c.getDefaultFIPs&&c.getDefaultFIPs(e)}};p.prototype.keyForFeature=function(e){return""+e.min+".."+e.max};
"undefined"!==typeof s&&(s.exports={OverlayFeatureSource:p})},{"./utils":49}],28:[function(e,s,r){function p(e,n,x){var r=/^\w+\s[0-9]+\s[0-9]+.*$/,s=/([^=]+)=\"?([^\"]+)\"?/,A=/^##\s*fileformat=VCFv4\..+/;(e.blob?new k(e.blob):"encode"==e.transport?new g(e.uri):new h(e.uri,{credentials:e.credentials})).slice(0,65536).salted().fetch(function(g,h){if(!g)return x||(e.credentials=!0,p(e,n,!0)),n(e,"Couldn't fetch data");var k=new Uint8Array(g),B=(new Uint32Array(g,0,1))[0];if(B==y||B==E){e.tier_type=
"bwg";k=/\/?([^/]+?)(.bw|.bb|.bigWig|.bigBed)?$/;if(k=k.exec(e.uri||e.blob.name))e.name=k[1];return n(e,null)}if(B==b)return e.tier_type="bai",n(e,null);if(31==k[0]||139==k[1]){k=a(g);k=new Uint8Array(k);B=v(k,0);if(B==c){e.tier_type="bam";k=/\/?([^/]+?)(.bam)?$/;if(k=k.exec(e.uri||e.blob.name))e.name=k[1];return n(e,null)}if(B==f)return e.tier_type="tabix-index",n(e,null);if(1768301347==B){e.tier_type="tabix";e.payload="vcf";k=/\/?([^/]+?)(.vcf)?(.gz)?$/;if(k=k.exec(e.uri||e.blob.name))e.name=k[1];
return n(e,null)}console.log("magic = "+B.toString(16));return n(e,"Unsupported format")}k=String.fromCharCode.apply(null,k).split("\n");if(0<k.length&&A.test(k[0]))return e.tier_type="memstore",e.payload="vcf",k=/\/?([^/]+?)(.vcf)?$/,(k=k.exec(e.uri||e.blob.name))&&!e.name&&(e.name=k[1]),n(e,null);for(var C=0;C<k.length;++C)if(B=k[C].replace("\r",""),0!=B.length&&0!=B.indexOf("browser")){if(0==B.indexOf("track")){k="bed";B=B.split(/\s/);for(C=1;C<B.length;++C){var J=s.exec(B[C]);J&&("type"==J[1]&&
"wiggle_0"==J[2]?k="wig":"name"==J[0]&&(e.name=J[2]))}m(e,k);return n(e,null)}if(0==B.indexOf("fixedStep")||0==B.indexOf("variableStep"))return m(e,"wig"),n(e,null);if(r.test(B))return m(e,null),n(e,null);break}return n(e,"Unsupported format")},{timeout:1500})}function m(a,b){a.tier_type="memstore";var c=/\/?([^/]+?)(.(bed|wig))?$/.exec(a.uri||a.blob.name);c&&(a.name||(a.name=c[1]),!b&&c[3]&&(b=c[3]));a.payload=b||"bed"}if("undefined"!==typeof e){r=e("./bin");var h=r.URLFetchable,k=r.BlobFetchable,
v=r.readInt;r=e("./bigwig");var y=r.BIG_WIG_MAGIC,E=r.BIG_BED_MAGIC,a=e("./lh3utils").unbgzf;r=e("./bam");var c=r.BAM_MAGIC,b=r.BAI_MAGIC,f=e("./tabix").TABIX_MAGIC,g=e("./encode").EncodeFetchable}"undefined"!==typeof s&&(s.exports={probeResource:p})},{"./bam":1,"./bigwig":3,"./bin":4,"./encode":12,"./lh3utils":24,"./tabix":41}],29:[function(e,s,r){function p(a){return b[a%b.length]*Math.pow(10,a/b.length|0)}function m(a,b,c){this.scale=a;this.cnt=this.tot=0;this.hasScore=!1;this.min=b;this.max=c;
this.features=[]}function h(a,b){return a.min<b.min?-1:a.min>b.min?1:a.max<b.max?-1:b.max>a.max?1:0}function k(a,b){for(var c=0;p(c+1)<b;)++c;for(var c=p(c),e=[],h=-1E10,k=1E10,v=0;v<a.length;++v){var A=a[v];if(A.groups&&0<A.groups.length)return a;for(var u=A.min/c|0,I=A.max/c|0,h=Math.max(h,I),k=Math.min(k,u);u<=I;++u){var t=e[u];t||(t=new m(c,u*c,(u+1)*c-1),e[u]=t);t.feature(A)}}v=[];for(u=k;u<=h;++u)if(t=e[u])A=new E,A.segment=a[0].segment,A.min=u*c+1,A.max=(u+1)*c,A.score=t.score(),A.type="density",
v.push(A);Date.now();return v}function v(a){this._pos=a;this._bases={};this._totalCount=0}function y(b,e,h){for(var n,k,m=null,p=null,A=[],u=0;u<b.length;++u){var I=b[u];if(I.groups&&0<I.groups.length)return b;n=I.seq;var t=I.quals,B=a(I.cigar),C=[];k=[];for(var y=0,d=0;d<B.length;++d){var w=B[d];if("M"==w.op)C.push(n.substr(y,w.cnt)),k.push(t.substr(y,w.cnt)),y+=w.cnt;else if("D"==w.op)for(var G=0;G<w.cnt;++G)C.push("-"),k.push("Z");else"I"==w.op?y+=w.cnt:"S"==w.op?y+=w.cnt:console.log("unknown cigop"+
w.op)}n=C.join("");k=k.join("");C=n;y=k;d=I.orientation;w=I.min||0;I=I.max||0;k=0;for(n=w;n<=I;++n)B=A[n],B||(B=new v(n),A[n]=B),t=C.charAt(k),G=y.charCodeAt(k)-33,B.recordBase(t,G,d),k++;m=m?Math.min(m,w):w;p=p?Math.max(p,I):I}I=m;u=p;k=[];if(e&&(n=e.start|0,B=e.end|0,n<=u&&B>=I)){t=Math.max(I,n);B=Math.min(u,B);for(C=0;C<t-I;C++)k.push("N");k.push(e.seq.substr(t-n,B-t+1));for(C=0;C<u-B;C++)k.push("N")}e=k.join("");u=[];k=0;for(n=m;n<=p;++n){if(B=A[n])if(I=new E,I.segment=b[0].segment,I.min=B.pos(),
I.max=I.min,I.notes=[],I.notes=I.notes.concat(B.infoList()),I.type="base-coverage",I.suppressScore=!0,e)for(m=e.charAt(k),I.notes.unshift("Ref="+m),B=B.baseScoreList(m,0.2),C=0;C<B.length;C++){t=B[C].base;y=B[C].score;d=c(I);d.score=y;if(1<B.length||t!=m)d.itemRgb=h[t];u.push(d)}else u.push(I);k++}return u}if("undefined"!==typeof e)var E=e("./das").DASFeature,a=e("./cigar").parseCigar,c=e("./utils").shallowCopy;var b=[1,2,5];m.prototype.score=function(){if(0==this.cnt)return 0;if(this.hasScore)return this.tot/
this.cnt;var a=this.features;a.sort(h);for(var b=-1E10,c=0,e=0,k=1;k<a.length;++k){var m=a[k],p=Math.max(m.min,this.min),m=Math.min(m.max,this.max),e=e+(m-p+1);p>b?(c+=m-p+1,b=m):m>b&&(c+=m-b,b=m)}return 0<c?1*e/c:0};m.prototype.feature=function(a){void 0!==a.score&&(this.tot+=a.score,this.hasScore=!0);++this.cnt;this.features.push(a)};v.prototype.recordBase=function(a,b,c){if(this._bases[a])a=this._bases[a],a.cnt++,a.totalQual+=b,a.strandCnt[c]++;else{var e={"+":0,"-":0};e[c]++;this._bases[a]={cnt:1,
totalQual:b,strandCnt:e}}this._totalCount++};v.prototype.totalCount=function(){return this._totalCount};v.prototype.pos=function(){return this._pos};v.prototype.infoList=function(){var a=[],b=this._totalCount;a.push("Depth="+b.toString());for(var c in this._bases){var e=this._bases[c],h=e.cnt,k=e.strandCnt["+"],m=e.strandCnt["-"],e=e.totalQual/h,h=[c,"=",h," (",(100*h/b).toFixed(0),"%, ",k," +, ",m," -, Qual: ",e.toFixed(0),")"];a.push(h.join(""))}return a};v.prototype.baseScoreList=function(a,b){var c=
[],e=this._totalCount,h=b*e,k;for(k in this._bases){var m=this._bases[k].cnt;m<h||k==a||(c.push({base:k,score:e}),e-=m)}c.push({base:a,score:e});return c};"undefined"!==typeof s&&(s.exports={downsample:k,getBaseCoverage:y})},{"./cigar":8,"./das":10,"./utils":49}],30:[function(e,s,r){function p(e,h){var a=parseFloat(e.replace(/,/g,""));return"k"===h||"K"===h?1E3*a|0:"m"==h||"M"===h?1E6*a|0:a|0}if("undefined"!==typeof e)var m=e("./cbrowser").Browser,h=e("./bin").URLFetchable,k=e("./trix").connectTrix;
var v=/^([\d+,\w,\.,\_,\-]+):([0-9,\.]+?)([KkMmGg])?((-|\.\.)+([0-9,\.]+)([KkMmGg])?)?$/;m.prototype.search=function(e,m){var a=this,c=v.exec(e);if(c){var b=c[1],f;if(c[6])f=p(c[2],c[3]),c=p(c[6],c[7]);else{var g=this.viewEnd-this.viewStart+1;f=p(c[2],c[3])-g/2|0;c=f+g-1}this.setLocation(b,f,c,m)}else{if(!e||0==e.length)return!1;var q=0,n=!1,x=function(b,c){--q;if(c)return m(c);b||(b=[]);for(var f=5E8,g=-1E8,h=null,k=0;k<b.length;++k){var p=b[k];null==h&&(h=p.segment);f=Math.min(f,p.min);g=Math.max(g,
p.max)}if(h)n=!0,a.highlightRegion(h,f,g),k=Math.max(2500,0.3*(g-f+1)|0),a.setLocation(h,f-k,g+k,m);else if(0==q&&!n)return m("no match for '"+e+"'")},r=function(a,b){b.lookup(e,function(b,c){if(null==b||2>b.length)return a.featureSource.search(e,x);var f=b[1].split(",")[0];return a.featureSource.search(f,x)})};if(this.searchEndpoint)return q=1,this.doDasSearch(a.searchEndpoint,e,x);for(b=0;b<this.tiers.length;++b)(function(b){a.sourceAdapterIsCapable(b.featureSource,"search")?b.dasSource.trixURI?
(++q,b.trix?r(b,b.trix):k(new h(b.dasSource.trixURI),new h(b.dasSource.trixURI+"x"),function(a){b.trix=a;r(b,a)})):(++q,b.featureSource.search(e,x)):b.dasSource.provides_search&&(++q,a.doDasSearch(b.dasSource,e,x))})(this.tiers[b])}};m.prototype.doDasSearch=function(e,h,a){e.features(null,{group:h,type:"transcript"},function(c){c||(c=[]);for(var b=[],f=0;f<c.length;++f){var e=c[f];e.label.toLowerCase()==h.toLowerCase()&&b.push(e)}return a(b)},!1)}},{"./bin":4,"./cbrowser":6,"./trix":47}],31:[function(e,
s,r){function p(b,f){f||(f=a);for(var e=c.length;b*c[e%c.length]*Math.pow(10,e/c.length|0)<f;)++e;return c[e%c.length]*Math.pow(10,e/c.length|0)}function m(a,c){var e=a.viewport.getContext("2d"),k=a.browser.retina&&1<window.devicePixelRatio,n=a.browser.featurePanelWidth+2E3;k&&(n*=2);var m=a.viewport.width|0;m<n-50&&(a.viewport.width=m=n);n=50;c&&c.seq&&(n+=25);var p=n;k&&(p*=2);a.viewport.height=p;a.viewport.style.height=""+n+"px";a.viewport.style.width=k?""+m/2+"px":""+m+"px";a.layoutHeight=n;a.updateHeight();
a.background&&(e.fillStyle=a.background,e.fillRect(0,0,m,a.viewport.height));k&&e.scale(2,2);e.translate(1E3,0);h(a,c,e);a.norigin=a.browser.viewStart;a.viewportHolder.style.left="-1000px"}function h(a,c,e){var h=a.browser.scale,n=a.browser.viewStart-1E3/h|0,k=a.browser.viewEnd+2E3/h,m=a.browser.currentSeqMax,y=k;0<m&&m<k&&(y=m);for(var A=p(h),u=Math.max(0,(n/A|0)*A),m=a.browser.viewStart;u<=y;)e.fillStyle=0==u/A%2?"white":"black",e.strokeStyle="black",e.fillRect((u-m)*h,8,A*h,3),e.strokeRect((u-
m)*h,8,A*h,3),e.fillStyle="black",e.fillText(v(u),(u-m)*h,22),u+=A;if(c&&c.seq)for(;n<=k;++n)n>=c.start&&n<=c.end&&(y=c.seq.substr(n-c.start,1).toUpperCase(),(A=a.browser.baseColors[y])||(A="gray"),e.fillStyle=A,8<=h?(A=e.measureText(y).width,e.fillText(y,(n-m)*h+0.5*(h-A),52)):e.fillRect((n-m)*h,42,h,12))}function k(a,c){var e=a.browser.scale,h=a.browser.viewStart-1E3/e|0,n=a.browser.viewEnd+2E3/e,k=a.browser.currentSeqMax,m=n;0<k&&k<n&&(m=k);for(var r=p(e),A=Math.max(0,(h/r|0)*r),k=a.browser.viewStart,
u=y(E,"g",[],{fontSize:"8pt"});A<=m;)u.appendChild(y(E,"rect",null,{x:(A-k)*e,y:8,width:r*e,height:3,fill:0==A/r%2?"white":"black",stroke:"black"})),u.appendChild(y(E,"text",v(A),{x:(A-k)*e,y:28,fill:"black",stroke:"none"})),A+=r;if(c&&c.seq)for(;h<=n;++h)h>=c.start&&h<=c.end&&(m=c.seq.substr(h-c.start,1).toUpperCase(),(r=a.browser.baseColors[m])||(r="gray"),8<=e?u.appendChild(y(E,"text",m,{x:(0.5+h-k)*e,y:52,textAnchor:"middle",fill:r})):u.appendChild(y(E,"rect",null,{x:(h-k)*e,y:42,width:e,height:12,
fill:r})));return u}if("undefined"!==typeof e){r=e("./utils");var v=r.formatLongInt,y=r.makeElementNS,E=e("./svg-utils").NS_SVG,v=e("./numformats").formatLongInt}var a=100,c=[1,2,5],E="http://www.w3.org/2000/svg";"undefined"!==typeof s&&(s.exports={drawSeqTier:m,drawSeqTierGC:h,svgSeqTier:k})},{"./numformats":26,"./svg-utils":39,"./utils":49}],32:[function(e,s,r){if("undefined"!=typeof e){var p=e("./cbrowser").Browser;s=e("./sourcecompare");var m=s.sourceDataURI,h=s.sourcesAreEqual,k=e("./version"),
v=e("./utils").miniJSONify,y=e("./sha1").hex_sha1}p.prototype.nukeStatus=function(){delete localStorage["dalliance."+this.cookieKey+".view-chr"];delete localStorage["dalliance."+this.cookieKey+".view-start"];delete localStorage["dalliance."+this.cookieKey+".view-end"];delete localStorage["dalliance."+this.cookieKey+".current-seq-length"];delete localStorage["dalliance."+this.cookieKey+".showing-alt-zoom"];delete localStorage["dalliance."+this.cookieKey+".saved-zoom"];delete localStorage["dalliance."+
this.cookieKey+".sources"];delete localStorage["dalliance."+this.cookieKey+".hubs"];delete localStorage["dalliance."+this.cookieKey+".version"];delete localStorage["dalliance."+this.cookieKey+".reverse-scrolling"];delete localStorage["dalliance."+this.cookieKey+".reverse-key-scrolling"];delete localStorage["dalliance."+this.cookieKey+".ruler-location"]};p.prototype.storeStatus=function(){this.storeViewStatus();this.storeTierStatus()};p.prototype.storeViewStatus=function(){!this.cookieKey||this.noPersist||
this.noPersistView||(localStorage["dalliance."+this.cookieKey+".view-chr"]=this.chr,localStorage["dalliance."+this.cookieKey+".view-start"]=this.viewStart|0,localStorage["dalliance."+this.cookieKey+".view-end"]=this.viewEnd|0,localStorage["dalliance."+this.cookieKey+".showing-alt-zoom"]=""+this.isSnapZooming,localStorage["dalliance."+this.cookieKey+".saved-zoom"]=this.savedZoom,this.currentSeqMax&&(localStorage["dalliance."+this.cookieKey+".current-seq-length"]=this.currentSeqMax))};p.prototype.storeTierStatus=
function(){if(this.cookieKey&&!this.noPersist){for(var e=[],a=0;a<this.tiers.length;++a){var c=this.tiers[a];c.dasSource.noPersist||e.push({source:c.dasSource,config:c.config||{}})}localStorage["dalliance."+this.cookieKey+".sources"]=JSON.stringify(e);e={};a=[];for(c=0;c<this.hubObjects.length;++c){var b=this.hubObjects[c],f={url:b.hub.url,genome:b.genome};b.credentials&&(f.credentials=b.credentials);b.mapping&&(f.mapping=b.mapping);e[f.url]=!0;a.push(f)}for(c=0;c<this.hubs.length;++c)f=this.hubs[c],
"string"===typeof f&&(f={url:f}),e[f.url]||a.push(f);localStorage["dalliance."+this.cookieKey+".hubs"]=JSON.stringify(a);localStorage["dalliance."+this.cookieKey+".reverse-scrolling"]=this.reverseScrolling;localStorage["dalliance."+this.cookieKey+".reverse-key-scrolling"]=this.reverseKeyScrolling;localStorage["dalliance."+this.cookieKey+".single-base-highlight"]=this.singleBaseHighlight;localStorage["dalliance."+this.cookieKey+".ruler-location"]=this.rulerLocation;localStorage["dalliance."+this.cookieKey+
".export-ruler"]=this.exportRuler;localStorage["dalliance."+this.cookieKey+".export-highlights"]=this.exportHighlights;localStorage["dalliance."+this.cookieKey+".version"]=k.CONFIG}};p.prototype.restoreStatus=function(){if(!this.noPersist){var e=localStorage["dalliance."+this.cookieKey+".version"];if(k.CONFIG==(e?e|0:-100)){var e=localStorage["dalliance."+this.cookieKey+".configHash"]||"",a=y(v({sources:this.sources,hubs:this.hubs}));if(a!=e)localStorage["dalliance."+this.cookieKey+".configHash"]=
a;else{e={};for(a=0;a<this.sources.length;++a){var c=this.sources[a];if(c){var b=m(c),f=e[b];f||(e[b]=f=[]);f.push(c)}}if(!this.noPersistView&&(a=localStorage["dalliance."+this.cookieKey+".view-chr"],c=localStorage["dalliance."+this.cookieKey+".view-start"]|0,f=localStorage["dalliance."+this.cookieKey+".view-end"]|0,a&&c&&f)){this.chr=a;this.viewStart=c;this.viewEnd=f;if(a=localStorage["dalliance."+this.cookieKey+".current-seq-length"])this.currentSeqMax=a|0;this.isSnapZooming="true"==localStorage["dalliance."+
this.cookieKey+".showing-alt-zoom"];a=parseFloat(localStorage["dalliance."+this.cookieKey+".saved-zoom"]);"number"!==typeof a||isNaN(a)||(this.savedZoom=a)}this.reverseScrolling=(a=localStorage["dalliance."+this.cookieKey+".reverse-scrolling"])&&"true"==a;this.reverseKeyScrolling=(a=localStorage["dalliance."+this.cookieKey+".reverse-key-scrolling"])&&"true"==a;this.singleBaseHighlight=(a=localStorage["dalliance."+this.cookieKey+".single-base-highlight"])&&"true"==a;if(a=localStorage["dalliance."+
this.cookieKey+".ruler-location"])this.rulerLocation=a;if(a=localStorage["dalliance."+this.cookieKey+".export-ruler"])this.exportRuler="true"===a;if(a=localStorage["dalliance."+this.cookieKey+".export-highlights"])this.exportHighlights="true"===a;if(a=localStorage["dalliance."+this.cookieKey+".sources"]){var g=JSON.parse(a);this.sources=[];this.restoredConfigs=[];for(a=0;a<g.length;++a)for(c=this.sources[a]=g[a].source,this.restoredConfigs[a]=g[a].config,b=m(c),f=e[b]||[],b=0;b<f.length;++b){var q=
f[b];if(h(c,q))for(var n in q)q.hasOwnProperty(n)&&("function"===typeof q[n]||q[n]instanceof Blob)&&(c[n]=q[n])}}if(n=localStorage["dalliance."+this.cookieKey+".hubs"])this.hubs=JSON.parse(n);return!0}}}};p.prototype.reset=function(){for(var e=this.tiers.length-1;0<=e;--e)this.removeTier({index:e},!0);for(e=0;e<this.defaultSources.length;++e)this.defaultSources[e].disabled||this.addTier(this.defaultSources[e]);this.highlights.splice(0,this.highlights.length);this.setLocation(this.defaultChr,this.defaultStart,
this.defaultEnd)}},{"./cbrowser":6,"./sha1":33,"./sourcecompare":35,"./utils":49,"./version":51}],33:[function(e,s,r){function p(a){a=h(k(a));for(var c=y?"0123456789ABCDEF":"0123456789abcdef",b="",f,e=0;e<a.length;e++)f=a.charCodeAt(e),b+=c.charAt(f>>>4&15)+c.charAt(f&15);return b}function m(a){a=h(k(a));for(var c="",b=a.length,f=0;f<b;f+=3)for(var e=a.charCodeAt(f)<<16|(f+1<b?a.charCodeAt(f+1)<<8:0)|(f+2<b?a.charCodeAt(f+2):0),q=0;4>q;q++)c=8*f+6*q>8*a.length?c+E:c+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(e>>>
6*(3-q)&63);return c}function h(a){for(var c=Array(a.length>>2),b=0;b<c.length;b++)c[b]=0;for(b=0;b<8*a.length;b+=8)c[b>>5]|=(a.charCodeAt(b/8)&255)<<24-b%32;a=8*a.length;c[a>>5]|=128<<24-a%32;c[(a+64>>9<<4)+15]=a;a=Array(80);for(var b=1732584193,f=-271733879,e=-1732584194,h=271733878,n=-1009589776,k=0;k<c.length;k+=16){for(var m=b,p=f,A=e,u=h,I=n,t=0;80>t;t++){if(16>t)a[t]=c[k+t];else{var B=a[t-3]^a[t-8]^a[t-14]^a[t-16];a[t]=B<<1|B>>>31}var B=b<<5|b>>>27,C;C=20>t?f&e|~f&h:40>t?f^e^h:60>t?f&e|f&h|
e&h:f^e^h;B=v(v(B,C),v(v(n,a[t]),20>t?1518500249:40>t?1859775393:60>t?-1894007588:-899497514));n=h;h=e;e=f<<30|f>>>2;f=b;b=B}b=v(b,m);f=v(f,p);e=v(e,A);h=v(h,u);n=v(n,I)}c=[b,f,e,h,n];a="";for(b=0;b<32*c.length;b+=8)a+=String.fromCharCode(c[b>>5]>>>24-b%32&255);return a}function k(a){for(var c="",b=-1,f,e;++b<a.length;)f=a.charCodeAt(b),e=b+1<a.length?a.charCodeAt(b+1):0,55296<=f&&56319>=f&&56320<=e&&57343>=e&&(f=65536+((f&1023)<<10)+(e&1023),b++),127>=f?c+=String.fromCharCode(f):2047>=f?c+=String.fromCharCode(192|
f>>>6&31,128|f&63):65535>=f?c+=String.fromCharCode(224|f>>>12&15,128|f>>>6&63,128|f&63):2097151>=f&&(c+=String.fromCharCode(240|f>>>18&7,128|f>>>12&63,128|f>>>6&63,128|f&63));return c}function v(a,c){var b=(a&65535)+(c&65535);return(a>>16)+(c>>16)+(b>>16)<<16|b&65535}var y=0,E="";"undefined"!==typeof s&&(s.exports={b64_sha1:m,hex_sha1:p})},{}],34:[function(e,s,r){function p(a,d){ka[a]=d}function m(a,d){fa[a]=d}function h(a){if(fa[a])return fa[a](a)}function k(a){var d=this;this.source=a;this.cfsid=
"cfs"+ ++la;a.name&&(this.name=a.name);a.addChangeListener&&a.addChangeListener(function(){d.cfsid="cfs"+ ++la})}function v(){this.busy=0;this.activityListeners=[];this.readinessListeners=[];this.readiness=null}function y(a){this.dasSource=new w(a);this.busy=0;this.activityListeners=[]}function E(a){this.dasSource=new w(a);this.awaitedEntryPoints=new I;var d=this;this.dasSource.entryPoints(function(a){d.awaitedEntryPoints.provide(a)})}function a(a){var d=this;this.source=a;this.twoBit=new I;if(a.twoBitURI)a=
new H(a.twoBitURI);else if(a.twoBitBlob)a=new F(a.twoBitBlob);else throw Error("No twoBitURI or twoBitBlob parameter");l(a,function(a,b){b?console.log(b):d.twoBit.provide(a)})}function c(a){v.call(this);var d=this;this.readiness="Connecting";this.bwgSource=this.opts=a;d.bwgHolder=new I;if(this.opts.preflight){var b=da[this.opts.preflight];if(!b){b=new I;da[this.opts.preflight]=b;var c=new XMLHttpRequest;c.onreadystatechange=function(){4==c.readyState&&(200==c.status?b.provide("success"):b.provide("failure"))};
c.open("get",this.opts.preflight+"?"+hex_sha1("salt"+Date.now()),!0);this.opts.credentials&&(c.withCredentials=!0);c.send("")}b.await(function(a){"success"===a&&d.init()})}else d.init()}function b(a,d){v.call(this);this.worker=d;this.readiness="Connecting";this.bwgSource=this.opts=a;this.keyHolder=new I;this.init()}function f(a,d){if(!(a.flag&O.SEGMENT_UNMAPPED)){var b;b=a.seq?a.seq.length:a.seqLength;if(a.cigar){b=0;for(var c=$(a.cigar),f=0;f<c.length;++f){var e=c[f];if("M"==e.op||"D"==e.op)b+=e.cnt}}c=
new P;c.min=a.pos+1;c.max=a.pos+b;c.segment=a.segment;c.type="bam";c.id=a.readName;c.notes=["MQ="+a.mq];c.cigar=a.cigar;c.seq=a.seq;c.quals=a.quals;c.orientation=a.flag&O.REVERSE_COMPLEMENT?"-":"+";c.bamRecord=a;d&&a.flag&O.MULTIPLE_SEGMENTS&&(c.groups=[{id:a.readName,type:"readpair"}]);return c}}function g(a){v.call(this);var d=this;this.bamSource=a;this.opts={credentials:a.credentials,preflight:a.preflight,bamGroup:a.bamGroup};this.bamHolder=new I;if(this.opts.preflight){var b=da[this.opts.preflight];
if(!b){b=new I;da[this.opts.preflight]=b;var c=new XMLHttpRequest;c.onreadystatechange=function(){4==c.readyState&&(200==c.status?b.provide("success"):b.provide("failure"))};c.open("get",this.opts.preflight+"?"+hex_sha1("salt"+Date.now()),!0);this.opts.credentials&&(c.withCredentials="true");c.send("")}b.await(function(a){"success"===a&&d.init()})}else d.init()}function q(a,d){v.call(this);this.bamSource=a;this.worker=d;this.opts={credentials:a.credentials,preflight:a.preflight,bamGroup:a.bamGroup};
this.keyHolder=new I;this.init()}function n(a,d){this.source=a;this.mapping=d;this.activityListeners=[];this.busy=0}function x(){}function S(){}function N(a){this.store=new R(a.jbURI,a.jbQuery)}if("undefined"!==typeof e){var A=e("./cbrowser").Browser,u=e("./tier").DasTier;r=e("./utils");var I=r.Awaited,t=r.arrayIndexOf,B=r.shallowCopy,C=r.resolveUrlToPage;r=e("./das");var J=r.DASStylesheet,d=r.DASStyle,w=r.DASSource,G=r.DASSegment,P=r.DASFeature,D=r.DASSequence,z=r.DASLink;r=e("./bin");var H=r.URLFetchable,
F=r.BlobFetchable,l=e("./twoBit").makeTwoBit,L=e("./bigwig").makeBwg;r=e("./bam");var M=r.makeBam,O=r.BamFlags;r=e("./spans");var V=r.Range,Y=r.union,$=e("./cigar").parseCigar,X=e("./overlay").OverlayFeatureSource,R=e("./jbjson").JBrowseStore,aa=e("./chainset").Chainset;e("./style");var ia=e("./encode").EncodeFetchable}var ka={},fa={};u.prototype.initSources=function(){var a=this,d=this.browser.createSources(this.dasSource);this.featureSource=d.features||new x;this.sequenceSource=d.sequence;this.featureSource&&
this.featureSource.addChangeListener&&this.featureSource.addChangeListener(function(){a.browser.refreshTier(a)})};A.prototype.createSources=function(d){var f=this.sourceCache.get(d);if(f)return f;var e,l;if("sequence"==d.tier_type||d.twoBitURI||d.twoBitBlob)l=d.twoBitURI||d.twoBitBlob?new a(d):new E(d);else if(d.tier_type&&ka[d.tier_type])l=(0,ka[d.tier_type])(d),e=l.features,l=l.sequence;else if(d.bwgURI||d.bwgBlob)e=(e=this.getWorker())?new b(d,e):new c(d);else if(d.bamURI||d.bamBlob)e=(e=this.getWorker())?
new q(d,e):new g(d);else if(d.jbURI)e=new N(d);else if(d.uri||d.features_uri)e=new y(d);if(d.overlay){f=[];e&&f.push(new k(e));for(e=0;e<d.overlay.length;++e){var h=this.createSources(d.overlay[e]);h&&h.features&&f.push(h.features)}e=new X(f,d)}d.sequenceAliases&&(e=new n(e,new aa({type:"alias",sequenceAliases:d.sequenceAliases})));d.mapping&&(e=new n(e,this.chains[d.mapping]));d.name&&e&&!e.name&&(e.name=d.name);null!=e&&(e=new k(e));if(null!=e||null!=l)f={features:e,sequence:l},this.sourceCache.put(d,
f);return f};u.prototype.fetchStylesheet=function(a){(this.dasSource.stylesheet_uri||!(this.dasSource.tier_type||this.dasSource.bwgURI||this.dasSource.bwgBlob||this.dasSource.bamURI||this.dasSource.bamBlob||this.dasSource.twoBitURI||this.dasSource.twoBitBlob||this.dasSource.jbURI||this.dasSource.overlay)?new y(this.dasSource):this.getSource()).getStyleSheet(a)};var la=0;k.prototype.addReadinessListener=function(a){if(this.source.addReadinessListener)return this.source.addReadinessListener(a);a(null)};
k.prototype.removeReadinessListener=function(a){if(this.source.removeReadinessListener)return this.source.removeReadinessListener(a)};k.prototype.search=function(a,d){if(this.source.search)return this.source.search(a,d)};k.prototype.getDefaultFIPs=function(a){if(this.source.getDefaultFIPs)return this.source.getDefaultFIPs(a)};k.prototype.getStyleSheet=function(a){this.source.getStyleSheet(a)};k.prototype.getScales=function(){return this.source.getScales()};k.prototype.addActivityListener=function(a){this.source.addActivityListener&&
this.source.addActivityListener(a)};k.prototype.removeActivityListener=function(a){this.source.removeActivityListener&&this.source.removeActivityListener(a)};k.prototype.addChangeListener=function(a){this.source.addChangeListener&&this.source.addChangeListener(a)};k.prototype.removeChangeListener=function(a){this.source.removeChangeListener&&this.source.removeChangeListener(a)};k.prototype.findNextFeature=function(a,d,b,c){this.source.findNextFeature(a,d,b,c)};k.prototype.quantFindNextFeature=function(a,
d,b,c,f){this.source.quantFindNextFeature(a,d,b,c,f)};k.prototype.capabilities=function(){return this.source.capabilities?this.source.capabilities():{}};k.prototype.fetch=function(a,d,b,c,f,e,g,l){if(!e)throw Error("Fetch pool is null");var n=this,h=this.cfsid,k=e.awaitedFeatures[h];if(k&&k.started){if(k.styleFilters.doesNotContain(l)){n.source.fetch(a,d,b,c,f,e,g,l);return}}else k?k.styleFilters.addAll(l):(k=new I,k.styleFilters=l,e.awaitedFeatures[h]=k,e.requestsIssued.then(function(){k.started=
!0;n.source.fetch(a,d,b,c,k.styleFilters.typeList(),e,function(a,d,b,c){k.res||k.provide({status:a,features:d,scale:b,coverage:c})},k.styleFilters)}).catch(function(a){console.log(a)}));k.await(function(a){g(a.status,a.features,a.scale,a.coverage)})};v.prototype.addReadinessListener=function(a){this.readinessListeners.push(a);a(this.readiness)};v.prototype.removeReadinessListener=function(a){a=t(this.readinessListeners,a);0<=a&&this.readinessListeners.splice(a,1)};v.prototype.notifyReadiness=function(){for(var a=
0;a<this.readinessListeners.length;++a)try{this.readinessListeners[a](this.readiness)}catch(d){console.log(d)}};v.prototype.addActivityListener=function(a){this.activityListeners.push(a)};v.prototype.removeActivityListener=function(a){a=t(this.activityListeners,a);0<=a&&this.activityListeners.splice(a,1)};v.prototype.notifyActivity=function(){for(var a=0;a<this.activityListeners.length;++a)try{this.activityListeners[a](this.busy)}catch(d){console.log(d)}};v.prototype.getScales=function(){return null};
v.prototype.fetch=function(a,d,b,c,f,e,g){return g(null,[],1E9)};v.prototype.getStyleSheet=function(a){var b=new J,c=new d;c.glyph="BOX";c.BGCOLOR="blue";c.FGCOLOR="black";b.pushStyle({type:"default"},null,c);return a(b)};y.prototype.addActivityListener=function(a){this.activityListeners.push(a)};y.prototype.removeActivityListener=function(a){a=t(this.activityListeners,a);0<=a&&this.activityListeners.splice(a,1)};y.prototype.notifyActivity=function(){for(var a=0;a<this.activityListeners.length;++a)try{this.activityListeners[a](this.busy)}catch(d){console.log(d)}};
y.prototype.getStyleSheet=function(a){this.dasSource.stylesheet(function(d){a(d)},function(){a(null,"Couldn't fetch DAS stylesheet")})};y.prototype.fetch=function(a,d,b,c,f,e,g){if(f&&0==f.length)g(null,[],c);else if(this.dasSource.uri||this.dasSource.features_uri){if(this.dasSource.dasStaticFeatures&&this.cachedStaticFeatures)return g(null,this.cachedStaticFeatures,this.cachedStaticScale);var l=!1!==this.dasSource.maxbins;f={type:f};l&&(f.maxbins=1+((b-d)/c|0));var n=this;n.busy++;n.notifyActivity();
this.dasSource.features(new G(a,d,b),f,function(a,d){n.busy--;n.notifyActivity();var b=c;l||(b=0.1);!d&&n.dasSource.dasStaticFeatures&&(n.cachedStaticFeatures=a,n.cachedStaticScale=b);g(d,a,b)})}};y.prototype.findNextFeature=this.sourceFindNextFeature=function(a,d,b,c){if(this.dasSource.capabilities&&0<=t(this.dasSource.capabilities,"das1:adjacent-feature")){var f=this;if(this.dasAdjLock)return console.log("Already looking for a next feature, be patient!");this.dasAdjLock=!0;a={adjacent:a+":"+(d|
0)+":"+(0<b?"F":"B")};if(d=thisTier.getDesiredTypes(thisTier.browser.scale))a.types=d;thisTier.dasSource.features(null,a,function(a){f.dasAdjLock=!1;0<a.length&&null!=a[0]&&c(a[0])})}};E.prototype.fetch=function(a,d,b,c,f){this.dasSource.sequence(new G(a,d,b),function(a){return 1==a.length?f(null,a[0]):f("Didn't get sequence")})};E.prototype.getSeqInfo=function(a,d){this.awaitedEntryPoints.await(function(b){for(var c=0;c<b.length;++c)if(b[c].name==a)return d({length:b[c].end});return d()})};a.prototype.fetch=
function(a,d,b,c,f){this.twoBit.await(function(c){c.fetch(a,d,b,function(c,e){if(e)return f(e,null);var g=new D(a,d,b,"DNA",c);return f(null,g)})})};a.prototype.getSeqInfo=function(a,d){this.twoBit.await(function(b){b.getSeq(a)?b.getSeq(a).length(function(a){d({length:a})}):d()})};y.prototype.getScales=function(){return[]};var da={};c.prototype=Object.create(v.prototype);c.prototype.init=function(){var a=this,d;d=(d=this.bwgSource.uri||this.bwgSource.bwgURI)?"encode"===this.bwgSource.transport?new ia(d,
{credentials:this.opts.credentials}):new H(d,{credentials:this.opts.credentials}):new F(this.bwgSource.bwgBlob);L(d,function(d,b){b?(a.error=b,a.readiness=null,a.notifyReadiness(),a.bwgHolder.provide(null)):(a.bwgHolder.provide(d),a.readiness=null,a.notifyReadiness(),"bigbed"==d.type&&d.getExtraIndices(function(d){a.extraIndices=d}))})};c.prototype.capabilities=function(){var a={leap:!0};this.bwgHolder.res&&"bigwig"==this.bwgHolder.res.type&&(a.quantLeap=!0);if(this.extraIndices&&0<this.extraIndices.length){a.search=
[];for(var d=0;d<this.extraIndices.length;++d)a.search.push(this.extraIndices[d].field)}return a};c.prototype.fetch=function(a,d,b,c,f,e,g){var l=this;this.bwgHolder.await(function(e){if(null==e)return g(l.error||"Can't access binary file",null,null);var n;n=!f||0==f.length||0<=t(f,"density");l.opts.clientBin&&(n=!1);if("bigwig"==e.type||n||"undefined"!==typeof l.opts.forceReduction){n=-1;for(var h=0;h<e.zoomLevels.length;++h)if(e.zoomLevels[h].reduction<=c)n=h;else break;"undefined"!==typeof l.opts.forceReduction&&
(n=l.opts.forceReduction);n=0>n?e.getUnzoomedView():e.getZoomedView(n)}else n=e.getUnzoomedView();l.busy++;l.notifyActivity();n.readWigData(a,d,b,function(a){l.busy--;l.notifyActivity();var c=1E9;if("bigwig"===e.type){var f=(b-d)/a.length/2;f<c&&(c=f)}if(l.opts.link)for(f=0;f<a.length;++f){var n=a[f];n.label&&(n.links=[new z("Link",l.opts.link.replace(/\$\$/,n.label))])}g(null,a,c)})})};c.prototype.quantFindNextFeature=function(a,d,b,c,f){var e=this;e.busy++;e.notifyActivity();this.bwgHolder.res.thresholdSearch(a,
d,b,c,function(a,d){e.busy--;e.notifyActivity();return f(a,d)})};c.prototype.findNextFeature=function(a,d,b,c){var f=this;f.busy++;f.notifyActivity();this.bwgHolder.res.getUnzoomedView().getFirstAdjacent(a,d,b,function(a){f.busy--;f.notifyActivity();0<a.length&&null!=a[0]&&c(a[0])})};c.prototype.getScales=function(){var a=this.bwgHolder.res;if(a){for(var d=[1],b=0;b<a.zoomLevels.length;++b)d.push(a.zoomLevels[b].reduction);return d}return null};c.prototype.search=function(a,d){return this.extraIndices&&
0!=this.extraIndices.length?this.extraIndices[0].lookup(a,d):d(null,"No indices available")};c.prototype.getDefaultFIPs=function(a){if(this.opts.noExtraFeatureInfo)return!0;this.bwgHolder.await(function(d){d&&d.schema&&d.definedFieldCount<d.schema.fields.length&&a(function(a,b){for(var c=0;c<b.hit.length;++c)if(b.hit[c].isSuperGroup)return;for(c=d.definedFieldCount;c<d.schema.fields.length;++c){var f=d.schema.fields[c];b.add(f.comment,a[f.name])}})})};c.prototype.getStyleSheet=function(a){this.bwgHolder.await(function(b){if(!b)return a(null,
"bbi error");var c=new J;if("bigbed"==b.type){var f=new d;f.glyph="BOX";f.FGCOLOR="black";f.BGCOLOR="blue";f.HEIGHT=8;f.BUMP=!0;f.LABEL=!0;f.ZINDEX=20;c.pushStyle({type:"bigwig"},null,f);f.glyph="BOX";f.FGCOLOR="black";f.BGCOLOR="red";f.HEIGHT=10;f.BUMP=!0;f.ZINDEX=20;c.pushStyle({type:"translation"},null,f);f=new d;f.glyph="BOX";f.FGCOLOR="black";f.BGCOLOR="white";f.HEIGHT=10;f.ZINDEX=10;f.BUMP=!0;f.LABEL=!0;c.pushStyle({type:"transcript"},null,f);f=new d;f.glyph="HISTOGRAM";f.COLOR1="white";f.COLOR2=
"black";f.HEIGHT=30;c.pushStyle({type:"density"},null,f)}else f=new d,f.glyph="HISTOGRAM",f.COLOR1="white",f.COLOR2="black",f.HEIGHT=30,c.pushStyle({type:"default"},null,f);12==b.definedFieldCount&&14<=b.fieldCount&&(c.geneHint=!0);return a(c)})};b.prototype=Object.create(v.prototype);b.prototype.init=function(){var a=this,d=this.uri||this.bwgSource.uri||this.bwgSource.bwgURI,b=this.bwgSource.blob||this.bwgSource.bwgBlob,c=function(d,b){a.readiness=null;a.notifyReadiness();d?a.worker.postCommand({command:"meta",
connection:d},function(b,c){c?(a.error=c,a.keyHolder.provide(null)):(a.meta=b,a.keyHolder.provide(d))}):(a.error=b,a.keyHolder.provide(null))};b?this.worker.postCommand({command:"connectBBI",blob:b},c):this.worker.postCommand({command:"connectBBI",uri:C(d),transport:this.bwgSource.transport,credentials:this.bwgSource.credentials},c)};b.prototype.capabilities=function(){var a={leap:!0};this.meta&&"bigwig"==this.meta.type&&(a.quantLeap=!0);if(this.meta&&this.meta.extraIndices&&0<this.meta.extraIndices.length){a.search=
[];for(var d=0;d<this.meta.extraIndices.length;++d)a.search.push(this.meta.extraIndices[d].field)}return a};b.prototype.fetch=function(a,d,b,c,f,e,g){var l=this;l.busy++;l.notifyActivity();this.keyHolder.await(function(e){if(!e)return l.busy--,l.notifyActivity(),g(l.error||"Can't access binary file",null,null);var n=-1,h=!f||0==f.length||0<=t(f,"density");l.opts.clientBin&&(h=!1);if("bigwig"==l.meta.type||h||"undefined"!==typeof l.opts.forceReduction){for(h=1;h<l.meta.zoomLevels.length;++h)if(l.meta.zoomLevels[h]<=
c)n=h-1;else break;"undefined"!==typeof l.opts.forceReduction&&(n=l.opts.forceReduction)}l.worker.postCommand({command:"fetch",connection:e,chr:a,min:d,max:b,zoom:n},function(a,c){l.busy--;l.notifyActivity();var f=1E9;if("bigwig"===l.meta.type){var e=(b-d)/a.length/2;e<f&&(f=e)}if(l.opts.link)for(e=0;e<a.length;++e){var n=a[e];n.label&&(n.links=[new z("Link",l.opts.link.replace(/\$\$/,n.label))])}g(c,a,f)})})};b.prototype.quantFindNextFeature=function(a,d,b,c,f){var e=this;this.busy++;this.notifyActivity();
this.worker.postCommand({command:"quantLeap",connection:this.keyHolder.res,chr:a,pos:d,dir:b,threshold:c,under:!1},function(a,d){console.log(a,d);e.busy--;e.notifyActivity();return f(a,d)})};b.prototype.findNextFeature=function(a,d,b,c){var f=this;this.busy++;this.notifyActivity();this.worker.postCommand({command:"leap",connection:this.keyHolder.res,chr:a,pos:d,dir:b},function(a,d){f.busy--;f.notifyActivity();0<a.length&&null!=a[0]&&c(a[0])})};b.prototype.getScales=function(){var a=this.meta;return a?
a.zoomLevels:null};b.prototype.search=function(a,d){if(!this.meta.extraIndices||0==this.meta.extraIndices.length)return d(null,"No indices available");var b=this;this.busy++;this.notifyActivity();this.worker.postCommand({command:"search",connection:this.keyHolder.res,query:a,index:this.meta.extraIndices[0]},function(a,c){b.busy--;b.notifyActivity();d(a,c)})};b.prototype.getDefaultFIPs=function(a){if(this.opts.noExtraFeatureInfo)return!0;var d=this;this.keyHolder.await(function(b){var c=d.meta;c&&
c.schema&&c.definedFieldCount<c.schema.fields.length&&a(function(a,d){for(var b=0;b<d.hit.length;++b)if(d.hit[b].isSuperGroup)return;for(b=c.definedFieldCount;b<c.schema.fields.length;++b){var f=c.schema.fields[b];d.add(f.comment,a[f.name])}})})};b.prototype.getStyleSheet=function(a){var b=this;this.keyHolder.await(function(c){c=b.meta;if(!c)return a(null,"bbi error");var f=new J;if("bigbed"==c.type){var e=new d;e.glyph="BOX";e.FGCOLOR="black";e.BGCOLOR="blue";e.HEIGHT=8;e.BUMP=!0;e.LABEL=!0;e.ZINDEX=
20;f.pushStyle({type:"bigwig"},null,e);e.glyph="BOX";e.FGCOLOR="black";e.BGCOLOR="red";e.HEIGHT=10;e.BUMP=!0;e.ZINDEX=20;f.pushStyle({type:"translation"},null,e);e=new d;e.glyph="BOX";e.FGCOLOR="black";e.BGCOLOR="white";e.HEIGHT=10;e.ZINDEX=10;e.BUMP=!0;e.LABEL=!0;f.pushStyle({type:"transcript"},null,e);e=new d;e.glyph="HISTOGRAM";e.COLOR1="white";e.COLOR2="black";e.HEIGHT=30;f.pushStyle({type:"density"},null,e)}else e=new d,e.glyph="HISTOGRAM",e.COLOR1="white",e.COLOR2="black",e.HEIGHT=30,f.pushStyle({type:"default"},
null,e);12==c.definedFieldCount&&14<=c.fieldCount&&(f.geneHint=!0);return a(f)})};g.prototype=Object.create(v.prototype);g.prototype.init=function(){var a=this,d,b;this.bamSource.bamBlob?(d=new F(this.bamSource.bamBlob),b=new F(this.bamSource.baiBlob)):(d=new H(this.bamSource.bamURI,{credentials:this.opts.credentials}),b=new H(this.bamSource.baiURI||this.bamSource.bamURI+".bai",{credentials:this.opts.credentials}));M(d,b,null,function(d,b){a.readiness=null;a.notifyReadiness();d?a.bamHolder.provide(d):
(a.error=b,a.bamHolder.provide(null))})};g.prototype.fetch=function(a,d,b,c,e,g,l){var n=e&&1==e.length&&"density"==e[0],h=this;h.busy++;h.notifyActivity();this.bamHolder.await(function(c){if(!c)return h.busy--,h.notifyActivity(),l(h.error||"Couldn't fetch BAM");c.fetch(a,d,b,function(a,d){h.busy--;h.notifyActivity();if(d)l(d,null,null);else{for(var b=[],c=0;c<a.length;++c){var e=f(a[c],h.opts.bamGroup);e&&b.push(e)}l(null,b,1E9)}},{light:n})})};g.prototype.getScales=function(){return 1E9};g.prototype.getStyleSheet=
function(a){this.bamHolder.await(function(b){b=new J;var c=new d;c.glyph="HISTOGRAM";c.COLOR1="black";c.COLOR2="red";c.HEIGHT=30;b.pushStyle({type:"density"},"low",c);b.pushStyle({type:"density"},"medium",c);c=new d;c.glyph="__SEQUENCE";c.FGCOLOR="black";c.BGCOLOR="blue";c.HEIGHT=8;c.BUMP=!0;c.LABEL=!1;c.ZINDEX=20;b.pushStyle({type:"bam"},"high",c);return a(b)})};q.prototype=Object.create(v.prototype);q.prototype.init=function(){var a=this,d=this.bamSource.uri||this.bamSource.bamURI,b=this.bamSource.indexUri||
this.bamSource.baiURI||d+".bai",c=this.bamSource.bamBlob||this.bamSource.blob,f=this.bamSource.baiBlob||this.bamSource.indexBlob,e=function(d,b){a.readiness=null;a.notifyReadiness();d?a.keyHolder.provide(d):(a.error=b,a.keyHolder.provide(null))};c?this.worker.postCommand({command:"connectBAM",blob:c,indexBlob:f},e):this.worker.postCommand({command:"connectBAM",uri:C(d),indexUri:C(b),credentials:this.bamSource.credentials,indexChunks:this.bamSource.indexChunks},e)};q.prototype.fetch=function(a,d,b,
c,e,g,l){var n=e&&1==e.length&&"density"==e[0],h=this;h.busy++;h.notifyActivity();this.keyHolder.await(function(c){if(!c)return h.busy--,h.notifyActivity(),l(h.error||"Couldn't fetch BAM");h.worker.postCommand({command:"fetch",connection:c,chr:a,min:d,max:b,opts:{light:n}},function(a,d){h.busy--;h.notifyActivity();if(d)l(d,null,null);else{for(var b=[],c=0;c<a.length;++c){var e=f(a[c],h.opts.bamGroup);e&&b.push(e)}l(null,b,1E9)}})})};q.prototype.getScales=function(){return 1E9};q.prototype.getStyleSheet=
function(a){this.keyHolder.await(function(b){b=new J;var c=new d;c.glyph="HISTOGRAM";c.COLOR1="black";c.COLOR2="red";c.HEIGHT=30;b.pushStyle({type:"density"},"low",c);b.pushStyle({type:"density"},"medium",c);c=new d;c.glyph="__SEQUENCE";c.FGCOLOR="black";c.BGCOLOR="blue";c.HEIGHT=8;c.BUMP=!0;c.LABEL=!1;c.ZINDEX=20;b.pushStyle({type:"bam"},"high",c);return a(b)})};n.prototype.addActivityListener=function(a){this.activityListeners.push(a)};n.prototype.removeActivityListener=function(a){a=t(this.activityListeners,
a);0<=a&&this.activityListeners.splice(a,0)};n.prototype.notifyActivity=function(){for(var a=0;a<this.activityListeners.length;++a)try{this.activityListeners[a](this.busy)}catch(d){console.log(d)}};n.prototype.getStyleSheet=function(a){return this.source.getStyleSheet(a)};n.prototype.getScales=function(){return this.source.getScales()};n.prototype.getDefaultFIPs=function(a){if(this.source.getDefaultFIPs)return this.source.getDefaultFIPs(a)};n.prototype.simplifySegments=function(a,d){if(0==a.length)return a;
a.sort(function(a,d){var b=a.name-d.name;return b?b:(b=a.start-d.start)?b:a.end-d.end});for(var b=[],c=a[0],f=0;f<a.length;++f){var e=a[f];e.name!=c.name||e.start>c.end+d?(b.push(c),c=e):c=new G(c.name,Math.min(c.start,e.start),Math.max(c.end,e.end))}b.push(c);return b};n.prototype.fetch=function(a,d,b,c,f,e,g,l){var n=this,h=b-d+1;n.busy++;n.notifyActivity();this.mapping.sourceBlocksForRange(a,d,b,function(a){if(0==a.length)n.busy--,n.notifyActivity(),g("No mapping available for this regions",[],
c);else{a=n.simplifySegments(a,Math.max(100,0.05*h));var d=[],b=null,k=a.length,q;a.map(function(a){n.source.fetch(a.name,a.start,a.end,c,f,e,function(c,f,e){c&&!q&&(q=c);if(f)for(c=0;c<f.length;++c){var l=f[c],h=l.segment;0==h.indexOf("chr")&&(h=h.substr(3));h=n.mapping.mapSegment(h,l.min,l.max);if(0==h.length)l.parts&&0<l.parts.length&&d.push(l);else for(var m=0;m<h.length;++m){var w=h[m],p=B(l);p.segment=w.segment;p.min=w.min;p.max=w.max;w.partialMin&&(p.partialMin=w.partialMin);w.partialMax&&
(p.partialMax=w.partialMax);w.flipped&&("-"==l.orientation?p.orientation="+":"+"==l.orientation&&(p.orientation="-"));d.push(p)}}f=n.mapping.mapPoint(a.name,a.start);c=n.mapping.mapPoint(a.name,a.end);f&&c&&(f=new V(f.pos,c.pos),b=b?Y(b,f):f);--k;0==k&&(n.busy--,n.notifyActivity(),g(q,d,e,b))},l)})}})};x.prototype.getScales=function(){return null};x.prototype.fetch=function(a,d,b,c,f,e,g){return g(null,[],1E9)};x.prototype.getStyleSheet=function(a){var b=new J,c=new d;c.glyph="BOX";c.BGCOLOR="blue";
c.FGCOLOR="black";b.pushStyle({type:"default"},null,c);return a(b)};S.prototype.fetch=function(a,d,b,c,f){return f(null,null)};N.prototype.getScales=function(){return null};N.prototype.getStyleSheet=function(a){var b=new J,c=new d;c.glyph="BOX";c.FGCOLOR="black";c.BGCOLOR="green";c.HEIGHT=8;c.BUMP=!0;c.LABEL=!0;c.ZINDEX=20;b.pushStyle({type:"default"},null,c);return a(b)};N.prototype.fetch=function(a,d,b,c,f,e,g){f&&0==f.length?g(null,[],c):this.store.features(new G(a,d,b),{},function(a,d){g(d,a,
1E5)})};A.prototype.sourceAdapterIsCapable=function(a,d){return a.capabilities?a.capabilities()[d]:!1};"undefined"!==typeof s&&(s.exports={FeatureSourceBase:v,TwoBitSequenceSource:a,DASSequenceSource:E,MappedFeatureSource:n,CachingFeatureSource:k,BWGFeatureSource:c,RemoteBWGFeatureSource:b,BAMFeatureSource:g,RemoteBAMFeatureSource:q,DummyFeatureSource:x,DummySequenceSource:S,registerSourceAdapterFactory:p,registerParserFactory:m,makeParser:h},e("./ensembljson"),e("./tabix-source"),e("./memstore"),
e("./bedwig"),e("./vcf"))},{"./bam":1,"./bedwig":2,"./bigwig":3,"./bin":4,"./cbrowser":6,"./chainset":7,"./cigar":8,"./das":10,"./encode":12,"./ensembljson":13,"./jbjson":22,"./memstore":25,"./overlay":27,"./spans":36,"./style":37,"./tabix-source":40,"./tier":45,"./twoBit":48,"./utils":49,"./vcf":50}],35:[function(e,s,r){function p(e){return e.uri?e.uri:e.blob?"file:"+e.blob.name:e.bwgBlob?"file:"+e.bwgBlob.name:e.bamBlob?"file:"+e.bamBlob.name:e.twoBitBlob?"file:"+e.twoBitBlob.name:e.bwgURI||e.bamURI||
e.jbURI||e.twoBitURI||"https://www.biodalliance.org/magic/no_uri"}function m(e){return e.stylesheet_uri?e.stylesheet_uri:"sequence"==e.tier_type||e.twoBitURI||e.twoBitBlob?"https://www.biodalliance.org/magic/sequence":p(e)}function h(e,k){if(p(e)!=p(k)||e.mapping!=k.mapping||e.tier_type!=k.tier_type)return!1;if(e.overlay){if(!k.overlay||k.overlay.length!=e.overlay.length)return!1;for(var m=0;m<e.overlay.length;++m)if(!h(e.overlay[m],k.overlay[m]))return!1}else if(k.overlay)return!1;return!0}function k(e,
h){if(p(e)!=p(h)||m(e)!=m(h)||e.mapping!=h.mapping||e.tier_type!=h.tier_type)return!1;if(e.overlay){if(!h.overlay||h.overlay.length!=e.overlay.length)return!1;for(var r=0;r<e.overlay.length;++r)if(!k(e.overlay[r],h.overlay[r]))return!1}else if(h.overlay)return!1;return!0}"undefined"!==typeof s&&(s.exports={sourcesAreEqual:k,sourcesAreEqualModuloStyle:h,sourceDataURI:p,sourceStyleURI:m})},{}],36:[function(e,s,r){function p(a,c){if("number"!=typeof a||"number"!=typeof c)throw"Bad range "+a+","+c;this._min=
a;this._max=c}function m(a){this._ranges=a}function h(a,c){a instanceof Array||(a=[a],c&&a.push(c));if(0==a.length)return null;if(1==a.length)return a[0];for(var b=[],f=0;f<a.length;++f)a[f]._pushRanges(b);for(var b=b.sort(E),f=[],e=b[0],e=new p(e._min,e._max),h=1;h<b.length;++h){var n=b[h];n._min>e._max+1?(f.push(e),e=new p(n._min,n._max)):n._max>e._max&&(e._max=n._max)}f.push(e);return 1==f.length?f[0]:new m(f)}function k(a,c){for(var b=a.ranges(),e=c.ranges(),g=b.length,h=e.length,n=0,k=0,v=[];n<
g&&k<h;){a=b[n];c=e[k];var r=Math.max(a.min(),c.min()),A=Math.min(a.max(),c.max());A>=r&&v.push(new p(r,A));a.max()>c.max()?++k:++n}return 0==v.length?null:1==v.length?v[0]:new m(v)}function v(a){var c=0;a=a.ranges();for(var b=0;b<a.length;++b)var e=a[b],c=c+(e.max()-e.min()+1);return c}function y(a,c){return a.min()<c.min()?-1:a.min()>c.min()?1:a.max()<c.max()?-1:c.max()>a.max()?1:0}function E(a,c){return a._min<c._min?-1:a._min>c._min?1:a._max<c._max?-1:c._max>a._max?1:0}p.prototype.min=function(){return this._min};
p.prototype.max=function(){return this._max};p.prototype.contains=function(a){return a>=this._min&&a<=this._max};p.prototype.isContiguous=function(){return!0};p.prototype.ranges=function(){return[this]};p.prototype._pushRanges=function(a){a.push(this)};p.prototype.toString=function(){return"["+this._min+"-"+this._max+"]"};m.prototype.min=function(){return this._ranges[0].min()};m.prototype.max=function(){return this._ranges[this._ranges.length-1].max()};m.prototype.contains=function(a){for(var c=
0;c<this._ranges.length;++c)if(this._ranges[c].contains(a))return!0;return!1};m.prototype.isContiguous=function(){return 1<this._ranges.length};m.prototype.ranges=function(){return this._ranges};m.prototype._pushRanges=function(a){for(var c=0;c<this._ranges.length;++c)a.push(this._ranges[c])};m.prototype.toString=function(){for(var a="",c=0;c<this._ranges.length;++c)0<c&&(a+=","),a+=this._ranges[c].toString();return a};"undefined"!==typeof s&&(s.exports={Range:p,union:h,intersection:k,coverage:v,
rangeOver:y,_rangeOrder:E})},{}],37:[function(e,s,r){function p(e,k,m){this.type=e;this.method=k;this.label=m}function m(e){this._filters={};if(e)for(var k=0;k<e.length;++k)this.add(e[k])}p.prototype.equals=function(e){return this.type==e.type&&this.method==e.method&&this.label==e.label};p.prototype.toString=function(){var e=[];this.type&&e.push("type="+this.type);this.method&&e.push("method="+this.method);this.label&&e.push("label="+this.label);return"StyleFilter<"+e.join(";")+">"};m.prototype.add=
function(e){var k=e.toString();this._filters[k]||(this._filters[k]=e,this._list=null)};m.prototype.addAll=function(e){e=e.list();for(var k=0;k<e.length;++k)this.add(e[k])};m.prototype.doesNotContain=function(e){e=e.list();for(var k=0;k<e.length;++k)if(!this._filters[k.toString()])return!0;return!1};m.prototype.list=function(){if(!this._list){this._list=[];for(var e in this._filters)this._filters.hasOwnProperty(e)&&this._list.push(this._filters[e])}return this._list};m.prototype.typeList=function(){for(var e=
[],k=this.list(),m=0;m<k.length;++m){var p=k[m].type;if(!p||"default"==p)return null;0>e.indexOf(p)&&e.push(p)}return e};"undefined"!==typeof s&&(s.exports={StyleFilter:p,StyleFilterSet:m})},{}],38:[function(e,s,r){if("undefined"!==typeof e){var p=e("./cbrowser").Browser,m=e("./utils").makeElementNS,h=e("./version"),k=e("./sequence-draw").svgSeqTier;s=e("./svg-utils");var v=s.NS_SVG,y=s.NS_XLINK,E=s.SVGPath,a=e("./numformats").formatQuantLabel}p.prototype.makeSVG=function(c){c=c||{};var b=c.minTierHeight||
20,e=document.implementation.createDocument(v,"svg",null),g=m(v,"g",null,{fontFamily:"helvetica",fontSize:"8pt"});e.documentElement.appendChild(g);var q=m(v,"a",m(v,"text","Graphics from Dalliance "+h,{x:(this.featurePanelWidth+200+20)/2,y:30,strokeWidth:0,fontSize:"12pt",textAnchor:"middle",fill:"blue"}));q.setAttribute("xmlns:xlink",y);q.setAttribute("xlink:href","http://www.biodalliance.org/");g.appendChild(q);q=m(v,"rect",null,{x:200,y:50,width:this.featurePanelWidth,height:1E5});q=m(v,"clipPath",
q,{id:"featureClip"});g.appendChild(q);for(var q=70,n=m(v,"g",null,{}),p=0;p<this.tiers.length;++p){var r=this.tiers[p],s=m(v,"g",null,{clipPath:"url(#featureClip)",clipRule:"nonzero"}),A=m(v,"g"),u=q,I=m(v,"rect",null,{x:0,y:u,width:"10000",height:50,fill:r.background});s.appendChild(I);if(r.sequenceSource){var t=k(r,r.currentSequence);s.appendChild(m(v,"g",t,{transform:"translate(200, "+q+")"}));q+=80}else{if(!r.subtiers)continue;for(var t=(r.glyphCacheOrigin-this.viewStart)*this.scale,B=!1,C=0;C<
r.subtiers.length;++C){for(var q=q+3,J=r.subtiers[C],d=[],w=0;w<J.glyphs.length;++w)d.push(J.glyphs[w].toSVG());s.appendChild(m(v,"g",d,{transform:"translate("+(200+t)+", "+q+")"}));if(J.quant){var B=!0,d=J.quant,G=J.height,w=2;40<G&&(w=1+(G/20|0));var G=G/(w-1),P=(d.max-d.min)/(w-1),D=new E;D.moveTo(205,q);D.lineTo(200,q);D.lineTo(200,q+J.height);D.lineTo(205,q+J.height);for(var z=1;z<w-1;++z){var H=z*G;D.moveTo(200,q+H);D.lineTo(203,q+H)}A.appendChild(m(v,"path",null,{d:D.toPathData(),fill:"none",
stroke:"black",strokeWidth:"2px"}));A.appendChild(m(v,"text",a(d.max),{x:197,y:q+7,textAnchor:"end"}));A.appendChild(m(v,"text",a(d.min),{x:197,y:q+J.height,textAnchor:"end"}));for(z=1;z<w-1;++z)H=z*G,A.appendChild(m(v,"text",a(1*d.max-z*P),{x:197,y:q+H+3,textAnchor:"end"}))}q+=J.height+3}q-u<b&&(q=u+b)}A.appendChild(m(v,"text","string"===typeof r.config.name?r.config.name:r.dasSource.name,{x:200-(B?20:12),y:(q+u+8)/2,fontSize:"10pt",textAnchor:"end"}));I.setAttribute("height",q-u);n.appendChild(m(v,
"g",[s,A]))}if(c.highlights)for(b=this.highlights||[],B=0;B<b.length;++B)G=b[B],(G.chr==this.chr||G.chr=="chr"+this.chr)&&G.min<this.viewEnd&&G.max>this.viewStart&&(p=(Math.max(G.min,this.viewStart)-this.viewStart)*this.scale,r=(Math.min(G.max,this.viewEnd)-this.viewStart)*this.scale,n.appendChild(m(v,"rect",null,{x:200+p,y:70,width:r-p,height:q-70,stroke:"none",fill:this.defaultHighlightFill,fillOpacity:this.defaultHighlightAlpha})));b=-1;"center"==c.ruler?b=200+(this.viewEnd-this.viewStart)*this.scale/
2:"left"==c.ruler?b=200:"right"==c.ruler&&(b=200+(this.viewEnd-this.viewStart)*this.scale);0<=b&&n.appendChild(m(v,"line",null,{x1:b,y1:70,x2:b,y2:q,stroke:"blue"}));g.appendChild(n);e.documentElement.setAttribute("width",this.featurePanelWidth+20+200);e.documentElement.setAttribute("height",q+50);return new Blob([(new XMLSerializer).serializeToString(e)],{type:"image/svg+xml"})}},{"./cbrowser":6,"./numformats":26,"./sequence-draw":31,"./svg-utils":39,"./utils":49,"./version":51}],39:[function(e,
s,r){function p(){this.ops=[]}p.prototype.moveTo=function(e,h){this.ops.push("M "+e+" "+h)};p.prototype.lineTo=function(e,h){this.ops.push("L "+e+" "+h)};p.prototype.closePath=function(){this.ops.push("Z")};p.prototype.toPathData=function(){return this.ops.join(" ")};"undefined"!==typeof s&&(s.exports={NS_SVG:"http://www.w3.org/2000/svg",NS_XLINK:"http://www.w3.org/1999/xlink",SVGPath:p})},{}],40:[function(e,s,r){function p(c){k.call(this);this.readiness="Connecting";this.source=c;this.tabixHolder=
new E;var b=this,e=h(c.payload);if(e)this.parser=e;else throw"Unsuported tabix payload "+c.payload;var g;this.source.blob?(c=new y(this.source.blob),g=new y(this.source.indexBlob)):(c=new v(this.source.uri,{credentials:this.source.credentials}),g=new v(this.source.indexURI||this.source.uri+".tbi",{credentials:this.source.credentials}));a(c,g,function(a,c){b.tabixHolder.provide(a);a.fetchHeader(function(a,b){if(a){for(var c=e.createSession(function(){}),g=0;g<a.length;++g)c.parse(a[g]);c.flush()}});
b.readiness=null;b.notifyReadiness()})}if("undefined"!==typeof e){s=e("./sourceadapters");var m=s.registerSourceAdapterFactory,h=s.makeParser,k=s.FeatureSourceBase;s=e("./bin");var v=s.URLFetchable,y=s.BlobFetchable,E=e("./utils").Awaited,a=e("./tabix").connectTabix}p.prototype=Object.create(k.prototype);p.prototype.fetch=function(a,b,e,g,h,n,k){var m=this;m.busy++;m.notifyActivity();this.tabixHolder.await(function(g){g.fetch(a,b,e,function(a,b){m.busy--;m.notifyActivity();for(var c=[],e=m.parser.createSession(function(a){c.push(a)}),
f=0;f<a.length;++f)e.parse(a[f]);e.flush();k(null,c,1E9)})})};p.prototype.getStyleSheet=function(a){this.parser&&this.parser.getStyleSheet&&this.parser.getStyleSheet(a)};p.prototype.getDefaultFIPs=function(a){this.parser&&this.parser.getDefaultFIPs&&this.parser.getDefaultFIPs(a)};m("tabix",function(a){return{features:new p(a)}})},{"./bin":4,"./sourceadapters":34,"./tabix":41,"./utils":49}],41:[function(e,s,r){function p(){}function m(a,b,e){var g=new p;g.data=a;g.tbi=b;g.tbi.fetch(function(a){if(!a)return e(null,
"Couldn't access Tabix");a=y(a,a.byteLength);var b=new Uint8Array(a);if(k(b,0)!=h)return e(null,"Not a tabix index");var c=k(b,4);g.format=k(b,8);g.colSeq=k(b,12);g.colStart=k(b,16);g.colEnd=k(b,20);g.meta=k(b,24);g.skip=k(b,28);k(b,32);g.indices=[];var m=36;g.chrToIndex={};g.indexToChr=[];for(var p=0;p<c;++p){for(var A="";;){var u=b[m++];if(0==u)break;A+=String.fromCharCode(u)}g.chrToIndex[A]=p;0==A.indexOf("chr")?g.chrToIndex[A.substring(3)]=p:g.chrToIndex["chr"+A]=p;g.indexToChr.push(A)}A=1E9;
for(u=0;u<c;++u){for(var r=m,t=k(b,m),m=m+4,p=0;p<t;++p){k(b,m);var B=k(b,m+4),m=m+(8+16*B)}for(var B=k(b,m),C=m+=4,p=0;p<B;++p){var s=v(b,C),C=C+8;if(s){p=s.block;0<s.offset&&(p+=65536);p<A&&(A=p);break}}m+=8*B;0<t&&(g.indices[u]=new Uint8Array(a,r,m-r))}g.headerMax=A;e(g)},{timeout:5E3})}var h=21578324;if("undefined"!==typeof e){e("./spans");var k=e("./bin").readInt;e=e("./lh3utils");var v=e.readVob,y=e.unbgzf,E=e.reg2bins,a=e.Chunk}p.prototype.blocksForRange=function(c,b,e){var g=this.indices[c];
if(!g)return[];c=E(b,e);for(var h=[],n=0;n<c.length;++n)h[c[n]]=!0;c=[];for(var m=[],n=k(g,0),p=4,r=0;r<n;++r){var A=k(g,p),u=k(g,p+4),p=p+8;if(h[A])for(var I=0;I<u;++I){var t=v(g,p),B=v(g,p+8);(4681>A?m:c).push(new a(t,B));p+=16}else p+=16*u}n=k(g,p);h=null;b=Math.min(b>>14,n-1);e=Math.min(e>>14,n-1);for(n=b;n<=e;++n)(b=v(g,p+4+8*n))&&(!h||b.block<h.block||b.offset<h.offset)&&(h=b);g=[];if(null!=h)for(n=0;n<m.length;++n)e=m[n],e.maxv.block>=h.block&&e.maxv.offset>=h.offset&&g.push(e);m=g;g=[];for(n=
0;n<m.length;++n)g.push(m[n]);for(n=0;n<c.length;++n)g.push(c[n]);g.sort(function(a,b){var d=a.minv.block-b.minv.block;return 0!=d?d:a.minv.offset-b.minv.offset});c=[];if(0<g.length){m=g[0];for(n=1;n<g.length;++n)e=g[n],e.minv.block==m.maxv.block?m=new a(m.minv,e.maxv):(c.push(m),m=e);c.push(m)}return c};p.prototype.fetch=function(a,b,e,g){function h(){if(A>=m.length)return g(p);if(u){var a=new Uint8Array(u);n.readRecords(a,m[A].minv.offset,p,b,e,k);u=null;++A;return h()}var c=m[A],a=c.minv.block;
n.data.slice(a,c.maxv.block+65536-a).fetch(function(a){u=y(a,c.maxv.block-c.minv.block+1);return h()})}var n=this;a=this.chrToIndex[a];if(void 0==a)return g([]);var k=this.indexToChr[a],m;void 0===a?m=[]:(m=this.blocksForRange(a,b,e))||g(null,"Error in index fetch");var p=[],A=0,u;h()};p.prototype.readRecords=function(a,b,e,g,h,n){a:for(;;){for(var k="";b<a.length;){var m=a[b++];if(10==m){m=k.split("\t");if(m[this.colSeq-1]==n){var p=parseInt(m[this.colStart-1]),A=p;0<this.colEnd&&(A=parseInt(m[this.colEnd-
1]));this.format&65536&&++p;p<=h&&A>=g&&e.push(k)}continue a}else k+=String.fromCharCode(m)}break}};p.prototype.fetchHeader=function(a){var b=this;b.data.slice(0,b.headerMax).fetch(function(e){if(!e)return a(null,"Fetch failed");e=new Uint8Array(y(e,e.byteLength));for(var g=0,h="",n=[];g<e.length;){var k=e[g++];if(10==k)if(h.charCodeAt(0)==b.meta)n.push(h),h="";else return a(n);else h+=String.fromCharCode(k)}a(n)})};"undefined"!==typeof s&&(s.exports={connectTabix:m,TABIX_MAGIC:h})},{"./bin":4,"./lh3utils":24,
"./spans":36}],42:[function(e,s,r){function p(a){this.genomes={};this.url=a}function m(){}function h(a){this.hub=a}function k(a,b,c){c=c||{};c.salt=!0;y(a,function(e,k){if(k)return b(null,k);var m=e.split(g),q=new p(a);c.credentials&&(q.credentials=c.credentials);for(var t=0;t<m.length-2;t+=3)q[m[t+1]]=m[t+2];if(q.genomesFile){var r=E(a,q.genomesFile);y(r,function(a,e){if(e)return b(null,e);for(var d=a.split(f),n=0;n<d.length;++n){var k=d[n].split(g),m=new h(q);c.credentials&&(m.credentials=c.credentials);
for(var p=0;p<k.length-2;p+=3)m[k[p+1]]=k[p+2];m.twoBitPath&&(m.twoBitPath=E(r,m.twoBitPath));m.genome&&m.trackDb&&(m.absURL=E(r,m.trackDb),q.genomes[m.genome]=m)}b(q)},c)}else b(null,"No genomesFile")},c)}function v(a,b){return a.priority&&b.priority?1*a.priority-1*b.priority:a.priority?1:b.priority?-1:a.shortLabel.localeCompare(b.shortLabel)}if("undefined"!==typeof e){r=e("./utils");var y=r.textXHR,E=r.relativeURL,a=r.shallowCopy;e=e("./das");var c=e.DASStylesheet,b=e.DASStyle}var f=/\n\s*\n/,g=
/(\w+) +(.+)\n?/,q=/subGroup[1-9]/;m.prototype.get=function(a){if(this[a])return this[a];if(this._parent)return this._parent.get(a)};h.prototype.getTracks=function(a){var b=this;if(this._tracks)return a(this._tracks);y(this.absURL,function(c,e){if(e)return a(null,e);c=c.replace("\\\n"," ");for(var h=[],k={},p=c.split(f),t=0;t<p.length;++t){var r=p[t].replace(/\#.*/g,"").split(g),C=new m;C._db=b;for(var v=0;v<r.length-2;v+=3){var d=r[v+1],w=r[v+2];if(d.match(q)){C.subgroups||(C.subgroups={});for(var d=
w.split(/\s/),w=d[0],G={name:d[1],tags:[],titles:[]},y=2;y<d.length;++y){var D=d[y].split(/=/);G.tags.push(D[0]);G.titles.push(D[1])}C.subgroups[w]=G}else if("subGroups"===d)for(d=w.split(/(\w+)=(\w+)/),C.sgm={},y=0;y<d.length-2;y+=3)C.sgm[d[y+1]]=d[y+2];else C[r[v+1]]=r[v+2]}C.track&&(C.type||C.container||C.view||C.bigDataUrl)&&(h.push(C),k[C.track]=C)}p=[];t=[];for(d=0;d<h.length;++d)C=h[d],r=!0,C.parent&&(v=C.parent.split(/\s+/),(w=k[v[0]])?(C._parent=w,w.children||(w.children=[]),w.children.push(C),
w&&(r=!1)):console.log("Couldn't find parent "+v[0]+"("+C.parent+")")),C.compositeTrack?t.push(C):r&&p.push(C);for(h=0;h<t.length;++h)if(k=t[h],k.children){C=!1;for(r=0;r<k.children.length;++r)d=k.children[r],d.view&&(d.shortLabel=k.shortLabel+": "+d.shortLabel,p.push(d),C=!0);C||p.push(k)}b._tracks=p;return a(b._tracks,null)},{credentials:this.credentials,salt:!0})};m.prototype.toDallianceSource=function(){var a={name:this.shortLabel,desc:this.longLabel};this._db.mapping&&(a.mapping=this._db.mapping);
var b=this.get("pennantIcon");b&&(b=b.split(/\s+/),a.pennant="http://genome.ucsc.edu/images/"+b[0]);if(b=this.get("searchTrix"))a.trixURI=E(this._db.absURL,b);if("multiWig"==this.container){a.merge="concat";a.overlay=[];b=this.children||[];a.style=[];a.noDownsample=!0;for(var c=0;c<b.length;++c){var e=b[c],f=e.toDallianceSource();a.overlay.push(f);if(f.style)for(var g=0;g<f.style.length;++g){var h=f.style[g];h.method=e.shortLabel;"transparentOverlay"==this.aggregate&&(h.style.ALPHA=0.5);a.style.push(h)}}return a}b=
this.type;if(!b){for(b=this;b._parent&&!b.type;)b=b._parent;b=b.type}if(b){c=b.split(/\s+/);if("bigBed"==c[0]&&this.bigDataUrl)return b=c[1]|0,c="+"==c[2],a.bwgURI=E(this._db.absURL,this.bigDataUrl),a.style=this.bigbedStyles(),this._db.credentials&&(a.credentials=!0),12<=b&&c&&(a.collapseSuperGroups=!0),a;if("bigWig"==c[0]&&this.bigDataUrl)return a.bwgURI=E(this._db.absURL,this.bigDataUrl),a.style=this.bigwigStyles(),a.noDownsample=!0,this.yLineOnOff&&"on"==this.yLineOnOff&&(a.quantLeapThreshold=
void 0!==this.yLineMark?1*this.yLineMark:0),this._db.credentials&&(a.credentials=!0),a;if("bam"==c[0]&&this.bigDataUrl)return a.bamURI=E(this._db.absURL,this.bigDataUrl),this._db.credentials&&(a.credentials=!0),a;if("vcfTabix"==c[0]&&this.bigDataUrl)return a.uri=E(this._db.absURL,this.bigDataUrl),a.tier_type="tabix",a.payload="vcf",this._db.credentials&&(a.credentials=!0),a;console.log("Unsupported "+this.type)}};m.prototype.bigwigStyles=function(){var a=this.type;if(!a){for(a=this;a._parent&&!a.type;)a=
a._parent;a=a.type}if(a){var a=a.split(/\s+/),e,f;3<=a.length&&(e=1*a[1],f=1*a[2]);var g;this.maxHeightPixels&&(a=this.maxHeightPixels.split(/:/),3==a.length?g=a[1]|0:console.log("maxHeightPixels should be of the form max:default:min"));a="bars";this.graphTypeDefault&&(a=this.graphTypeDefault);var h="black",k=null;this.color&&(h="rgb("+this.color+")");this.altColor&&(k="rgb("+this.altColor+")");var m=new c,q=new b;q.glyph="points"==a?"POINT":"HISTOGRAM";k?(q.COLOR1=h,q.COLOR2=k):q.BGCOLOR=h;q.HEIGHT=
g||30;if(e||f)q.MIN=e,q.MAX=f;m.pushStyle({type:"default"},null,q);return m.styles}};m.prototype.bigbedStyles=function(){var e="on"==(""+this.get("itemRgb")).toLowerCase(),f=this.get("visibility")||"full",g=this.get("color"),g=g?"rgb("+g+")":"blue",h=new c,k=new b;k.glyph="BOX";k.FGCOLOR="black";k.BGCOLOR=g;k.HEIGHT="full"==f||"pack"==f?12:8;k.BUMP="full"==f||"pack"==f;k.LABEL="full"==f||"pack"==f;k.ZINDEX=20;e&&(k.BGITEM=!0);(f=this.get("colorByStrand"))?(f=f.split(/\s+/),g=a(k),g.BGCOLOR="rgb("+
f[0]+")",h.pushStyle({type:"bigwig",orientation:"+"},null,g),k=a(k),k.BGCOLOR="rgb("+f[1]+")",h.pushStyle({type:"bigwig",orientation:"-"},null,k)):h.pushStyle({type:"bigwig"},null,k);k=new b;k.glyph="BOX";k.FGCOLOR="black";e&&(k.BGITEM=!0);k.BGCOLOR="red";k.HEIGHT=10;k.BUMP=!0;k.ZINDEX=20;h.pushStyle({type:"translation"},null,k);e=new b;e.glyph="BOX";e.FGCOLOR="black";e.BGCOLOR="white";e.HEIGHT=10;e.ZINDEX=10;e.BUMP=!0;e.LABEL=!0;h.pushStyle({type:"transcript"},null,e);return h.styles};"undefined"!==
typeof s&&(s.exports={connectTrackHub:k,THUB_COMPARE:v})},{"./das":10,"./utils":49}],43:[function(e,s,r){if("undefined"!==typeof e)var p=e("./cbrowser").Browser,m=e("./utils").shallowCopy;p.prototype.mergeSelectedTiers=function(){for(var e=[],k=[],p=0;p<this.selectedTiers.length;++p){var r=this.tiers[this.selectedTiers[p]];e.push(m(r.dasSource));for(var s=r.stylesheet.styles,a=0;a<s.length;++a){var c=s[a],b=m(c);b.method=r.dasSource.name.replace(/[()+*?]/g,"\\$&");b._methodRE=null;b.style=m(c.style);
void 0===b.style.ZINDEX&&(b.style.ZINDEX=p);r.forceMin&&(b.style.MIN=r.forceMin);r.forceMax&&(b.style.MAX=r.forceMax);k.push(b)}}this.addTier({name:"Merged",merge:"concat",overlay:e,noDownsample:!0,style:k});this.setSelectedTier(this.tiers.length-1)}},{"./cbrowser":6,"./utils":49}],44:[function(e,s,r){function p(a){for(var c=0;c<a.styles.length;++c){var b=a.styles[c].style;if("__SEQUENCE"===b.glyph)return b}}if("undefined"!==typeof e){var m=e("./cbrowser").Browser,h=e("./utils").makeElement;s=e("./das");
var k=s.isDasBooleanTrue,v=s.copyStylesheet,y=e("./color").dasColourForName}var E={DOT:!0,EX:!0,STAR:!0,SQUARE:!0,CROSS:!0,TRIANGLE:!0,PLIMSOLL:!0};m.prototype.openTierPanel=function(a){if("tier"===this.uiMode&&this.manipulatingTier===a)this.hideToolPanel(),this.setUiMode("none");else{var c=function(a){a.BGGRAD||(1==w?("LINEPLOT"==a.glyph||E[a.glyph]?a.FGCOLOR=A.value:a.BGCOLOR=A.value,a.COLOR1=a.COLOR2=a.COLOR3=null):(a.COLOR1=A.value,a.COLOR2=u.value,a.COLOR3=2<w?I.value:null),a._gradient=null,
a._plusColor=t.value,a._minusColor=B.value)},b=function(d){for(var b=v(a.stylesheet),c=a.browser.zoomForCurrentScale(),e=0;e<b.styles.length;++e){var f=b.styles[e];f.zoom&&f.zoom!=c||d(f.style)}return b},e=function(d){a.mergeStylesheet(b(c))};this.manipulatingTier=a;var g=h("div",null,{className:"tier-edit"});if(a.dasSource.mapping){var m=this.chains[a.dasSource.mapping].coords;g.appendChild(h("div","Mapped from "+m.auth+m.version,null,{background:"gray",paddingBottom:"5px",marginBottom:"5px",textAlign:"center"}))}var n=
h("div","Editing styles for current zoom level",null,{background:"gray",paddingBottom:"5px",marginBottom:"5px",textAlign:"center",display:"none"});g.appendChild(n);var r=h("input",null,{type:"text"}),s=h("input",null,{type:"checkbox",disabled:this.disablePinning}),N=h("select");N.appendChild(h("option","Histogram",{value:"HISTOGRAM"}));N.appendChild(h("option","Line Plot",{value:"LINEPLOT"}));N.appendChild(h("option","Ribbon",{value:"GRADIENT"}));N.appendChild(h("option","Scatter",{value:"SCATTER"}));
var A=h("input",null,{type:"text",value:"#dd00dd"}),u=h("input",null,{type:"text",value:"#dd00dd"}),I=h("input",null,{type:"text",value:"#dd00dd"}),t=h("input",null,{type:"text",value:"#ffa07a"}),B=h("input",null,{type:"text",value:"#87cefa"});try{A.type=u.type=I.type="color",t.type=B.type="color"}catch(C){}var J=[A,u,I],m=h("i",null,{className:"fa fa-plus-circle"}),d=h("i",null,{className:"fa fa-minus-circle"}),w=1,G=h("td",J),P=function(a){w=a;for(var d=0;d<a;++d)J[d].style.display="block";for(d=
a;d<J.length;++d)J[d].style.display="none"};m.addEventListener("click",function(a){3>w&&(P(w+1),e(null))},!1);d.addEventListener("click",function(a){1<w&&(P(w-1),e(null))},!1);var D=h("input",null,{type:"text",value:"0.0"}),z=h("input",null,{type:"text",value:"10.0"}),H=h("input",null,{type:"checkbox"}),F=h("input",null,{type:"checkbox"}),l=h("input",null,{type:"checkbox",checked:void 0!==a.quantLeapThreshold}),L=h("input",null,{type:"text",value:a.quantLeapThreshold,disabled:!l.checked}),M=h("input",
null,{type:"text",value:"50"}),O=h("input",null,{type:"checkbox"}),V=h("input",null,{type:"text"}),Y=h("input",null,{type:"checkbox"}),$=null;0<a.stylesheet.styles.length&&($=a.stylesheet.styles[0].style);var X=function(){r.value="string"===typeof a.config.name?a.config.name:a.dasSource.name;s.checked=a.pinned;a.forceHeight?M.value=""+a.forceHeight:$&&$.HEIGHT&&(M.value=""+$.HEIGHT);"number"==typeof a.quantLeapThreshold?(l.checked=!0,L.disabled=!1,parseFloat(L.value)!=a.quantLeapThreshold&&(L.value=
a.quantLeapThreshold)):(l.checked=!1,L.disabled=!0);V.value="number"==typeof a.subtierMax?""+a.subtierMax:""+(a.dasSource.subtierMax||a.browser.defaultSubtierMax);if(0<a.stylesheet.styles.length){for(var d=null,b=!1,c=!1,c=a.browser.zoomForCurrentScale(),e=0,f=0;f<a.stylesheet.styles.length;++f){var g=a.stylesheet.styles[f];if(!g.zoom||g.zoom==c)if(++e,g=a.stylesheet.styles[f].style,d||(d=$=g),"LINEPLOT"==g.glyph||"HISTOGRAM"==g.glyph||"GRADIENT"==g.glyph||k(g.SCATTER))b||(d=$=g),b=!0}if(!d)return;
n.style.display=e==a.stylesheet.styles.length?"none":"block";c=b&&1==e;b?(ma.style.display="table-row",oa.style.display="table-row",ra.style.display="none",sa.style.display="none"):(ma.style.display="none",oa.style.display="none",ra.style.display="table-row",O.checked=k($.BUMP),V.disabled=!k($.BUMP),sa.style.display="table-row",Y.checked=k($.LABEL));c?(da.style.display="table-row",ja.style.display="table-row"):(da.style.display="none",ja.style.display="none");e=1;d.COLOR1?(A.value=y(d.COLOR1).toHexString(),
d.COLOR2&&(u.value=y(d.COLOR2).toHexString(),d.COLOR3?(I.value=y(d.COLOR3).toHexString(),e=3):e=2)):"LINEPLOT"==d.glyph||"DOT"==d.glyph&&d.FGCOLOR?A.value=y(d.FGCOLOR).toHexString():d.BGCOLOR&&(A.value=y(d.BGCOLOR).toHexString());P(e);d._plusColor&&(t.value=y(d._plusColor).toHexString()||d._plusColor);d._minusColor&&(B.value=y(d._minusColor).toHexString()||d._minusColor);k(d.SCATTER)?N.value="SCATTER":N.value=d.glyph;var h,m;void 0!==d.MIN&&(e=parseFloat(d.MIN),isNaN(e)||(h=e));a.forceMinDynamic||
void 0===d.MIN&&void 0===a.forceMin?(H.checked=!1,D.disabled=!0):(H.checked=!0,D.disabled=!1);void 0!==d.MAX&&(e=parseFloat(d.MAX),isNaN(e)||(m=e));a.forceMaxDynamic||void 0===d.MAX&&void 0===a.forceMax?(F.checked=!1,z.disabled=!0):(F.checked=!0,z.disabled=!1);void 0!=a.forceMin&&(h=a.forceMin);void 0!=a.forceMax&&(m=a.forceMax);"number"==typeof h&&h!=parseFloat(D.value)&&(D.value=h);"number"==typeof m&&m!=parseFloat(z.value)&&(z.value=m);(d=p(a.stylesheet))?(aa.style.display="table-row",R.checked=
"mismatch"===d.__SEQCOLOR,ka.style.display="table-row",ia.checked=k(d.__INSERTIONS),la.style.display="table-row",fa.checked=void 0===d.__disableQuals||!1===d.__disableQuals,console.log(d.__disableQuals)):(aa.style.display="none",ka.style.display="none",la.style.display="none");d&&R.checked&&!c?(ba.style.display="table-row",pa.style.display="table-row"):(ba.style.display="none",pa.style.display="none")}b&&a.browser.sourceAdapterIsCapable(a.featureSource,"quantLeap")?ea.style.display="table-row":ea.style.display=
"none"},R=h("input",null,{type:"checkbox"}),aa=h("tr",[h("th","Highlight mismatches & strands"),h("td",R)]);R.addEventListener("change",function(d){d=v(a.stylesheet);p(d).__SEQCOLOR=R.checked?"mismatch":"base";a.mergeStylesheet(d)});var ia=h("input",null,{type:"checkbox"}),ka=h("tr",[h("th","Show insertions"),h("td",ia)]);ia.addEventListener("change",function(d){d=v(a.stylesheet);p(d).__INSERTIONS=ia.checked?"yes":"no";a.mergeStylesheet(d)});var fa=h("input",null,{type:"checkbox"}),la=h("tr",[h("th",
"Reflect base quality as base color transparency"),h("td",fa)]);fa.addEventListener("change",function(d){d=v(a.stylesheet);var b=p(d);b.__disableQuals=!fa.checked;console.log(b.__disableQuals);a.mergeStylesheet(d)});var da=h("tr",[h("th","Style"),h("td",N)]),ja=h("tr",[h("th",["Colour(s)",m,d]),G]),ba=h("tr",[h("th","Plus Strand Color"),h("td",t)]),pa=h("tr",[h("th","Minus Strand Color"),h("td",B)]),ma=h("tr",[h("th","Min value"),h("td",[H," ",D])]),oa=h("tr",[h("th","Max value"),h("td",[F," ",z])]),
ea=h("tr",[h("th","Threshold leap:"),h("td",[l," ",L])]),ra=h("tr",[h("th","Bump overlaps"),h("td",[O," limit: ",V])]),sa=h("tr",[h("th","Label features"),h("td",Y)]),m=h("table",[h("tr",[h("th","Name",{},{width:"150px",textAlign:"right"}),r]),h("tr",[h("th","Pin to top"),s]),h("tr",[h("th","Height"),h("td",M)]),da,ja,ba,pa,ma,oa,ea,ra,sa,aa,ka,la]);X();g.appendChild(m);m=h("button","Reset track",{className:"btn"},{marginLeft:"auto",marginRight:"auto",display:"block"});m.addEventListener("click",
function(d){a.setConfig({})},!1);g.appendChild(m);r.addEventListener("input",function(d){a.mergeConfig({name:r.value})},!1);s.addEventListener("change",function(d){a.mergeConfig({pinned:s.checked})},!1);for(m=0;m<J.length;++m)J[m].addEventListener("change",e,!1);t.addEventListener("change",e,!1);B.addEventListener("change",e,!1);N.addEventListener("change",function(d){d=b(function(a){"SCATTER"===N.value?(a.SCATTER=!0,a.glyph="DOT",a.SIZE="3"):(a.glyph=N.value,a.SCATTER=void 0);c(a)});a.mergeStylesheet(d)},
!1);H.addEventListener("change",function(d){d={forceMinDynamic:!H.checked};D.disabled=!H.checked;var b=parseFloat(D.value);H.checked&&"number"==typeof b&&!isNaN(b)&&(d.forceMin=parseFloat(b));a.mergeConfig(d)});D.addEventListener("input",function(d){d=parseFloat(D.value);"number"!=typeof d||isNaN(d)||a.mergeConfig({forceMin:d})},!1);F.addEventListener("change",function(d){d={forceMaxDynamic:!F.checked};z.disabled=!F.checked;var b=parseFloat(z.value);F.checked&&"number"==typeof b&&!isNaN(b)&&(d.forceMax=
parseFloat(b));a.mergeConfig(d)});z.addEventListener("input",function(d){d=parseFloat(z.value);"number"!=typeof d||isNaN(d)||a.mergeConfig({forceMax:d})},!1);M.addEventListener("input",function(d){d=parseFloat(M.value);"number"!=typeof d||isNaN(d)||a.mergeConfig({height:Math.min(500,d|0)})},!1);var T=function(){L.disabled=!l.checked;if(l.checked){var d=parseFloat(L.value);"number"!=typeof d||isNaN(d)||a.mergeConfig({quantLeapThreshold:parseFloat(L.value)})}else a.mergeConfig({quantLeapThreshold:null})};
l.addEventListener("change",function(a){T()},!1);L.addEventListener("input",function(a){T()},!1);Y.addEventListener("change",function(d){d=b(function(a){a.LABEL=Y.checked?"yes":"no"});a.mergeStylesheet(d)},!1);O.addEventListener("change",function(d){d=b(function(a){a.BUMP=O.checked?"yes":"no"});a.mergeStylesheet(d)},!1);V.addEventListener("input",function(d){d=parseInt(V.value);"number"==typeof d&&0<d&&a.mergeConfig({subtierMax:d})},!1);this.showToolPanel(g);this.setUiMode("tier");a.addTierListener(X);
var Z=a.browser.scale;a.browser.addViewListener(function(){a.browser.scale!=Z&&(Z=a.browser.scale,X())})}}},{"./cbrowser":6,"./color":9,"./das":10,"./utils":49}],45:[function(e,s,r){function p(a,b,c,e){this.config=c||{};this.id="tier"+ ++x;this.browser=a;this.dasSource=k(b);this.background=e;this.viewport=m("canvas",null,{width:""+((this.browser.featurePanelWidth|0)+2E3),height:"30",className:"viewport_12_5"},{position:"inline-block",margin:"0px",border:"0px"});this.viewportHolder=m("div",this.viewport,
{className:"viewport-holder_12_5"},{background:e,position:"absolute",padding:"0px",margin:"0px",border:"0px",left:"-1000px",minHeight:"200px"});this.overlay=m("canvas",null,{width:+(this.browser.featurePanelWidth|0),height:"30",className:"viewport-overlay"});this.notifier=m("div","",{className:"notifier"});this.notifierHolder=m("div",this.notifier,{className:"notifier-holder"});this.quantOverlay=m("canvas",null,{width:"50",height:"56",className:"quant-overlay"});this.removeButton=m("i",null,{className:"fa fa-times"});
this.bumpButton=m("i",null,{className:"fa fa-plus-circle"});this.loaderButton=a.makeLoader(16);this.loaderButton.style.display="none";this.infoElement=m("div",this.dasSource.desc,{className:"track-label-info"});this.nameButton=m("div",[],{className:"tier-tab"});this.nameButton.appendChild(this.removeButton);b.pennant?this.nameButton.appendChild(m("img",null,{src:b.pennant,width:"16",height:"16"})):b.mapping&&(c=null,this.browser.chains[b.mapping]&&(c=this.browser.chains[b.mapping].coords.version),
c&&this.nameButton.appendChild(m("span",""+c,null,{fontSize:"8pt",background:"black",color:"white",paddingLeft:"3px",paddingRight:"3px",paddingTop:"1px",paddingBottom:"1px",marginLeft:"2px",borderRadius:"10px"})));this.nameElement=m("span",b.name);this.nameButton.appendChild(m("span",[this.nameElement,this.infoElement],{className:"track-name-holder"}));this.nameButton.appendChild(this.bumpButton);this.nameButton.appendChild(this.loaderButton);this.label=m("span",[this.nameButton],{className:"btn-group track-label"});
this.row=m("div",[this.viewportHolder,this.overlay,this.quantOverlay],{className:"tier"+(b.className?" "+b.className:"")});e||(this.row.style.background="none");a.noDefaultLabels||this.row.appendChild(this.label);this.row.appendChild(this.notifierHolder);this.layoutHeight=25;this.bumped=!0;this.styleIdSeed=0;b.quantLeapThreshold&&(this.quantLeapThreshold=b.quantLeapThreshold);this.dasSource.collapseSuperGroups&&(this.bumped=!1);this.layoutWasDone=!1;b.featureInfoPlugin&&this.addFeatureInfoPlugin(b.featureInfoPlugin);
this.initSources();var f=this;this.featureSource&&this.featureSource.getDefaultFIPs&&!b.noSourceFeatureInfo&&this.featureSource.getDefaultFIPs(function(a){a&&f.addFeatureInfoPlugin(a)});this.featureSource&&this.featureSource.addReadinessListener&&(this.readinessListener=function(a){f.notify(a,-1)},this.featureSource.addReadinessListener(this.readinessListener));this.featureSource&&this.featureSource.addActivityListener&&(this.activityListener=function(a){f.loaderButton.style.display=0<a?"inline-block":
"none";f.browser.pingActivity()},this.featureSource.addActivityListener(this.activityListener));this.listeners=[];this.featuresLoadedListeners=[]}if("undefined"!==typeof e){r=e("./utils");var m=r.makeElement,h=r.removeChildren,k=r.shallowCopy,v=r.miniJSONify,y=r.arrayIndexOf;r=e("./das");var E=r.DASStylesheet,a=r.DASStyle,c=e("./sha1").b64_sha1;r=e("./style");var b=r.StyleFilter,f=r.StyleFilterSet,g=e("./sourcecompare").sourceDataURI,q=e("es6-promise").Promise,n=e("./features").sortFeatures}var x=
0;p.prototype.destroy=function(){this.featureSource.removeReadinessListener&&this.featureSource.removeReadinessListener(this.readinessListener);this.featureSource.removeActivityListener&&this.featureSource.removeActivityListener(this.activityListener)};p.prototype.setBackground=function(a){this.background=a;this.viewportHolder.style.background=a};p.prototype.toString=function(){return this.id};p.prototype.addFeatureInfoPlugin=function(a){this.featureInfoPlugins||(this.featureInfoPlugins=[]);this.featureInfoPlugins.push(a)};
p.prototype.init=function(){var b=this;return new q(function(c,e){b.dasSource.style?(b.setStylesheet({styles:b.dasSource.style}),c(b)):(b.status="Fetching stylesheet",b.fetchStylesheet(function(e,f){if(f||!e){b.error="No stylesheet";e=new E;var g=new a;g.glyph="BOX";g.BGCOLOR="blue";g.FGCOLOR="black";e.pushStyle({type:"default"},null,g);b.setStylesheet(e)}else b.setStylesheet(e),e.geneHint&&(b.dasSource.collapseSuperGroups=!0,b.bumped=!1,b.updateLabel()),b._updateFromConfig();c(b)}))})};p.prototype.setStylesheet=
function(a){this.baseStylesheet=k(a);for(a=0;a<this.baseStylesheet.styles.length;++a){var b=this.baseStylesheet.styles[a]=k(this.baseStylesheet.styles[a]);b._methodRE=b._labelRE=b._typeRE=null;b.style=k(b.style);b.style.id="style"+ ++this.styleIdSeed}this.baseStylesheetValidity=c(v(this.baseStylesheet));this._updateFromConfig()};p.prototype.getSource=function(){return this.featureSource};p.prototype.getDesiredTypes=function(a){if(a=this.getActiveStyleFilters(a))return a.typeList()};p.prototype.getActiveStyleFilters=
function(a){a=this.browser.zoomForCurrentScale();if(this.stylesheet){for(var c=new f,e=this.stylesheet.styles,g=0;g<e.length;++g){var h=e[g];h.zoom&&h.zoom!=a||c.add(new b(h.type,h.method,h.label))}return c}};p.prototype.needsSequence=function(a){return this.sequenceSource&&5>a||(this.dasSource.bamURI||this.dasSource.bamBlob||this.dasSource.bwgURI||this.dasSource.bwgBlob)&&20>a?!0:!1};p.prototype.setFeatures=function(a,b,c,e,f){this.currentFeatures=e;this.currentSequence=f;this.knownChr=a;this.knownCoverage=
b;e&&(n(this),this.notifyFeaturesLoaded())};p.prototype.draw=function(){var a=this.currentSequence;this.sequenceSource?N(this,a):S(this);this.paint();this.originHaxx=0;this.browser.arrangeTiers()};p.prototype.findNextFeature=function(a,b,c,e,f){if(this.quantLeapThreshold)b=b+(this.browser.viewEnd-this.browser.viewStart+1)*c/2|0,this.featureSource.quantFindNextFeature(a,b,c,this.quantLeapThreshold,f);else{if(this.knownCoverage&&b>=this.knownCoverage.min()&&b<=this.knownCoverage.max()&&this.currentFeatures){for(var g=
null,h=0;h<this.currentFeatures.length;++h){var d=this.currentFeatures[h];if(d.min&&d.max&&!(d.parents&&0<d.parents.length))if(0>c)if(1==e&&d.max>=b&&d.min<b){if(!g||d.min>g.min||d.min==g.min&&d.max<g.max)g=d}else d.max<b&&(!g||d.max>g.max||d.max==g.max&&d.min<g.min||d.min==g.mmin&&g.max>=b)&&(g=d);else if(1==e&&d.min<=b&&d.max>b){if(!g||d.max<g.max||d.max==g.max&&d.min>g.min)g=d}else d.min>b&&(!g||d.min<g.min||d.min==g.min&&d.max>g.max||d.max==g.max&&g.min<=b)&&(g=d)}if(g)return f(g);b=0>c?this.browser.knownSpace.min:
this.browser.knownSpace.max}this.trySourceFNF(a,b,c,f)}};p.prototype.trySourceFNF=function(a,b,c,e){var f=this;this.featureSource.findNextFeature(a,b,c,function(a){a||e(a);var b=f.browser.getSequenceSource();b||e(a);b.getSeqInfo(a.segment,function(d){d?e(a):f.trySourceFNF(a.segment,0<c?1E10:0,c,e)})})};p.prototype.updateLabel=function(){this.bumpButton.className=this.bumped?"fa fa-minus-circle":"fa fa-plus-circle";this.bumpButton.style.display=this.dasSource.collapseSuperGroups?"inline-block":"none"};
p.prototype.updateHeight=function(){this.currentHeight=Math.max(Math.max(this.layoutHeight,this.label.clientHeight+2),this.browser.minTierHeight);this.row.style.height=""+this.currentHeight+"px";this.browser.updateHeight()};p.prototype.drawOverlay=function(){var a=this.browser,b=a.retina&&1<window.devicePixelRatio;this.overlay.height=this.viewport.height;this.overlay.width=b?2*a.featurePanelWidth:a.featurePanelWidth;var c=this.overlay.getContext("2d");b&&c.scale(2,2);var e=b=a.viewStart,f=a.viewEnd;
if(this.overlayLabelCanvas){var g=(this.glyphCacheOrigin-this.browser.viewStart)*this.browser.scale;c.save();c.translate(g,0);var h=-g+2;this.dasSource.tierGroup&&(h+=15);this.overlayLabelCanvas.draw(c,h,a.featurePanelWidth-g);c.restore()}for(g=0;g<a.highlights.length;++g)h=a.highlights[g],(h.chr===a.chr||h.chr==="chr"+a.chr)&&h.min<f&&h.max>e&&(c.globalAlpha=a.defaultHighlightAlpha,c.fillStyle=a.defaultHighlightFill,c.fillRect((h.min-b)*a.scale,0,(h.max-h.min)*a.scale,this.overlay.height));this.overlay.style.width=
a.featurePanelWidth;this.overlay.style.height=this.viewport.style.height;this.overlay.style.left="0px"};p.prototype.updateStatus=function(a){var b=this;a?(this.status=a,this._notifierToStatus(),g(this.dasSource),"https:"!==window.location.protocol||0!=g(this.dasSource).indexOf("http:")||this.checkedHTTP||(this.checkedHTTP=!0,this.browser.canFetchPlainHTTP().then(function(a){a||(b.warnHTTP=!0,b._notifierToStatus())}))):this.status&&(this.status=null,this._notifierToStatus())};p.prototype.notify=function(a,
b){"number"!==typeof b&&(b=2E3);this.notifierFadeTimeout&&(clearTimeout(this.notifierFadeTimeout),this.notifierFadeTimeout=null);if(a){if(this._notifierOn(a),0<b){var c=this;this.notifierFadeTimeout=setTimeout(function(){c._notifierToStatus()},b)}}else this._notifierToStatus()};p.prototype._notifierOn=function(a,b){h(this.notifier);b?this.notifier.appendChild(m("span",[m("a","[HTTP Warning] ",{href:this.browser.httpWarningURL,target:"_blank"}),a])):this.notifier.textContent=a;this.notifier.style.opacity=
0.8};p.prototype._notifierOff=function(){this.notifier.style.opacity=0};p.prototype._notifierToStatus=function(){this.status?this._notifierOn(this.status,this.warnHTTP):this._notifierOff()};p.prototype.setConfig=function(a){this.config=a||{};this._updateFromConfig();this.notifyTierListeners()};p.prototype.mergeStylesheet=function(a){this.mergeConfig({stylesheet:a,stylesheetValidity:this.baseStylesheetValidity})};p.prototype.mergeConfig=function(a){for(var b in a)this.config[b]=a[b];this._updateFromConfig();
this.notifyTierListeners()};p.prototype._updateFromConfig=function(){var a=!1,b=!1;this.nameElement.textContent="string"===typeof this.config.name?this.config.name:this.dasSource.name;var c=this.config.height||this.dasSource.forceHeight;c!=this.forceHeight&&(this.forceHeight=c,a=!0);this.forceMinDynamic!=this.config.forceMinDynamic&&(this.forceMinDynamic=this.config.forceMinDynamic,a=!0);c=void 0!=this.config.forceMin?this.config.forceMin:this.dasSource.forceMin;this.forceMin!=c&&(this.forceMin=c,
a=!0);this.forceMaxDynamic!=this.config.forceMaxDynamic&&(this.forceMaxDynamic=this.config.forceMaxDynamic,a=!0);c=void 0!=this.config.forceMax?this.config.forceMax:this.dasSource.forceMax;this.forceMax!=c&&(this.forceMax=c,a=!0);c=null;void 0!==this.config.quantLeapThreshold?c=this.config.quantLeapThreshold:void 0!==this.dasSource.quantLeapThreshold&&(c=this.dasSource.quantLeapThreshold);c!=this.quantLeapThreshold&&(this.quantLeapThreshold=c,a=!0);c=null;this.config.stylesheetValidity==this.baseStylesheetValidity&&
(c=this.config.stylesheet);c=c||this.baseStylesheet;this.stylesheet!==c&&(this.stylesheet=c,a=!0);c=void 0!==this.config.pinned?this.config.pinned:this.dasSource.pinned;c!==this.pinned&&(this.pinned=c,b=!0);c=typeof("number"===this.config.subtierMax)?this.config.subtierMax:this.dasSource.subtierMax||this.browser.defaultSubtierMax;c!=this.subtierMax&&(this.subtierMax=c,a=!0);c=void 0!==this.config.bumped?this.config.bumped:void 0!==this.dasSource.bumped?this.dasSource.bumped:this.dasSource.collapseSuperGroups?
!1:!0;c!==this.bumped&&(this.bumped=c,a=!0,this.updateLabel());a&&this.scheduleRedraw();b&&this.browser.reorderTiers()};p.prototype.scheduleRedraw=function(){if(this.currentFeatures){var a=this;this.redrawTimeout||(this.redrawTimeout=setTimeout(function(){a.draw();a.redrawTimeout=null},10))}};p.prototype.clearTierListeners=function(){this.listeners=[]};p.prototype.addTierListener=function(a){this.listeners.push(a)};p.prototype.removeTierListener=function(a){a=y(this.listeners,a);0<=a&&this.listeners.splice(a,
1)};p.prototype.notifyTierListeners=function(a){for(var b=0;b<this.listeners.length;++b)try{this.listeners[b](a)}catch(c){console.log(c)}this.browser.notifyTier()};p.prototype.clearFeaturesLoadedListeners=function(){this.featuresLoadedListeners=[]};p.prototype.addFeaturesLoadedListener=function(a){this.featuresLoadedListeners.push(a)};p.prototype.removeFeaturesLoadedListener=function(a){a=y(this.featuresLoadedListeners,a);0<=a&&this.featuresLoadedListeners.splice(a,1)};p.prototype.notifyFeaturesLoaded=
function(){for(var a=0;a<this.featuresLoadedListeners.length;++a)try{this.featuresLoadedListeners[a].call(this)}catch(b){console.log(b)}};if("undefined"!==typeof s){s.exports={DasTier:p};var S=e("./feature-draw").drawFeatureTier,N=e("./sequence-draw").drawSeqTier}},{"./das":10,"./feature-draw":18,"./features":20,"./sequence-draw":31,"./sha1":33,"./sourcecompare":35,"./style":37,"./utils":49,"es6-promise":53}],46:[function(e,s,r){function p(a,b){for(var c=0;c<a.length;++c){var d=a[c];d===b?d.classList.add("active"):
d.classList.remove("active")}}if("undefined"!==typeof e){var m=e("./cbrowser").Browser,h=e("./sourcecompare").sourcesAreEqual;s=e("./utils");var k=s.makeElement,v=s.removeChildren,y=s.Observed;s=e("./thub");var E=s.THUB_COMPARE,a=s.connectTrackHub,c=e("./domui").makeTreeTableSection,b=e("./probe").probeResource;s=e("./bin");var f=s.URLFetchable,g=s.BlobFetchable,q=s.readInt,n=e("./lh3utils").unbgzf,x=e("./bam").BAI_MAGIC,S=e("./tabix").TABIX_MAGIC;s=e("./das");var N=s.DASSource,A=s.DASSegment,u=s.DASRegistry,
I=s.coordsMatch,t=e("./encode").EncodeFetchable}m.prototype.currentlyActive=function(a){for(var b=0;b<this.tiers.length;++b)if(h(this.tiers[b].dasSource,a))return this.tiers[b];return!1};m.prototype.makeButton=function(a,b){var c=k("a",a,{href:"#"});b&&this.makeTooltip(c,b);return k("li",c)};m.prototype.showTrackAdder=function(e){function h(a){ca.style.display="none";U.style.display="none";ga.style.display="none";T=!1;v(K);for(var d=k("div",null,{},{width:"100%"}),b=[],e=0;e<a.length;++e)b.push(a[e]);
b.sort(function(a,d){return a.shortLabel.toLowerCase().trim().localeCompare(d.shortLabel.toLowerCase().trim())});a=[];for(var f=[],e=0;e<b.length;++e){var g=b[e];g.children&&0<g.children.length&&"multiWig"!=g.container?a.push(g):f.push(g)}0<f.length&&a.push({shortLabel:"Others",priority:-1E8,children:f});a.sort(E);for(var n=[],b=0;b<a.length;++b){g=f=a[b];!g.dimensions&&g._parent&&g._parent.dimensions&&(g=g._parent);e={};if(g.dimensions)for(var m=g.dimensions.split(/(\w+)=(\w+)/),q=0;q<m.length-2;q+=
3)e[m[q+1]]=m[q+2];if(e.dimX&&e.dimY){for(var p=e.dimX,w=e.dimY,e=g.subgroups[p],m=g.subgroups[w],q={},t=0;t<f.children.length;++t){var G=f.children[t],g=G.sgm[p],u=G.sgm[w];q[g]||(q[g]={});q[g][u]=G}w=k("table",null,{className:"table table-striped table-condensed"},{tableLayout:"fixed"});g=k("tr");g.appendChild(k("th",null,{},{width:"150px",height:"100px"}));for(u=0;u<e.titles.length;++u)p=k("th",k("div",e.titles[u],{},{transform:"rotate(-60deg)",transformOrigin:"0% 100%",webkitTransform:"rotate(-60deg) translate(20px,10px)",
webkitTransformOrigin:"0% 100%",textAlign:"left"}),{},{width:"35px",height:"100px",verticalAlign:"bottom"}),g.appendChild(p);w.appendChild(g);for(var z=k("tbody",null,{className:"table table-striped table-condensed"}),r=0;r<m.titles.length;++r){var u=m.tags[r],D=k("tr");D.appendChild(k("th",m.titles[r]),{});for(var F=0;F<e.titles.length;++F){var g=e.tags[F],C=k("td");if(q[g]&&q[g][u]){g=q[g][u];t=g.toDallianceSource();if(!t)continue;p=k("tr");G=k("td");G.style.textAlign="center";var s=k("input");
s.type="checkbox";s.dalliance_source=t;qa&&(s.dalliance_mapping=qa);n.push(s);C.appendChild(s);s.addEventListener("change",function(a){a.target.checked?l.addTier(a.target.dalliance_source):l.removeTier(a.target.dalliance_source)})}D.appendChild(C)}z.appendChild(D)}w.appendChild(z);d.appendChild(c(f.shortLabel,w,0==b))}else{m=k("tbody",null,{className:"table table-striped table-condensed"});q=k("table",m,{className:"table table-striped table-condensed"},{width:"100%",tableLayout:"fixed"});u=0;f.children.sort(E);
for(e=0;e<f.children.length;++e)if(g=f.children[e],t=g.toDallianceSource())p=k("tr"),G=k("td",null,{},{width:"30px"}),G.style.textAlign="center",s=k("input"),s.type="checkbox",s.dalliance_source=t,qa&&(s.dalliance_mapping=qa),n.push(s),G.appendChild(s),s.addEventListener("change",function(a){a.target.checked?l.addTier(a.target.dalliance_source):l.removeTier(a.target.dalliance_source)}),p.appendChild(G),w=k("td"),w.appendChild(document.createTextNode(g.shortLabel)),g.longLabel&&0<g.longLabel.length&&
l.makeTooltip(w,g.longLabel),p.appendChild(w),m.appendChild(p),++u;1<a.length||"Others"!==f.shortLabel?d.appendChild(c(f.shortLabel,q,0==b)):d.appendChild(q)}}var y=function(){for(var a=0;a<n.length;++a){var d=n[a],b=l.currentlyActive(d.dalliance_source);b?(d.checked=!0,d.disabled=null!=b.sequenceSource):d.checked=!1}};y();l.addTierListener(function(a){y()});K.appendChild(d)}function m(){p(s,la);T="bin";ca.style.display="none";U.style.display="inline";ga.style.display="none";v(K);var a=k("div",null,
{},{paddingLeft:"10px",paddingRight:"10px"});a.appendChild(k("h3","Add custom URL-based data"));a.appendChild(k("p",["You can add indexed binary data hosted on an web server that supports CORS (",k("a","full details",{href:"http://www.biodalliance.org/bin.html"}),").  Currently supported formats are bigwig, bigbed, and indexed BAM."]));a.appendChild(k("br"));a.appendChild(document.createTextNode("URL: "));ba=k("input","",{size:80,value:"http://www.biodalliance.org/datasets/ensGene.bb"},{width:"100%"});
a.appendChild(ba);a.appendChild(k("br"));a.appendChild(k("b","- or -"));a.appendChild(k("br"));a.appendChild(document.createTextNode("File: "));ea=k("input",null,{type:"file",multiple:"multiple"});a.appendChild(ea);a.appendChild(k("p",'Clicking the "Add" button below will initiate a series of test queries.'));K.appendChild(a);ba.focus()}function d(){p(s,da);ca.style.display="none";U.style.display="inline";ga.style.display="none";T="hub-connect";ca.style.visibility="hidden";v(K);var a=k("div",null,
{},{paddingLeft:"10px",paddingRight:"10px"});a.appendChild(k("h3","Connect to a track hub."));a.appendChild(k("p",['Enter the top-level URL (usually points to a file called "hub.txt") of a UCSC-style track hub']));ba=k("input","",{size:120,value:"http://www.biodalliance.org/datasets/testhub/hub.txt"},{width:"100%"});a.appendChild(ba);K.appendChild(a);ba.focus()}function w(){p(s,fa);ca.style.display="none";U.style.display="inline";ga.style.display="none";T="das";v(K);var a=k("div",null,{},{paddingLeft:"10px",
paddingRight:"10px"});a.appendChild(k("h3","Add custom DAS data"));a.appendChild(k("p","This interface is intended for adding custom or lab-specific data.  Public data can be added more easily via the registry interface."));a.appendChild(document.createTextNode("URL: "));a.appendChild(k("br"));ba=k("input","",{size:80,value:"http://www.derkholm.net:8080/das/medipseq_reads/"},{width:"100%"});a.appendChild(ba);a.appendChild(k("p",'Clicking the "Add" button below will initiate a series of test queries.  If the source is password-protected, you may be prompted to enter credentials.'));
K.appendChild(a);ba.focus()}function G(){if(T)if("das"===T){var a=ba.value.trim();/^.+:\/\//.exec(a)||(a="http://"+a);a=new N({name:"temporary",uri:a});va(a)}else if("bin"===T){var b=ea.files;if(b&&0<b.length){a=W=[];T="multiple";for(var c=0;c<b.length;++c){var e=b[c];e&&a.push({blob:e})}for(c=0;c<a.length;++c)ha(a[c]);ta()}else a=ba.value.trim(),/^.+:\/\//.exec(a)||(a="http://"+a),b={uri:a},a=a.toLowerCase(),0==a.indexOf("https://www.encodeproject.org/")&&0<=a.indexOf("@@download")&&(b.transport=
"encode"),Q(b)}else if("reset"===T)w();else if("reset-bin"===T)m();else if("reset-hub"===T)d();else if("prompt-bai"===T)(b=ea.files)&&0<b.length&&b[0]?(Z.baiBlob=b[0],z(Z)):(b=Z,ca.style.display="none",U.style.display="inline",ga.style.display="inline",v(K),T="prompt-bai",K.appendChild(k("h2","Select an index file")),K.appendChild(k("p","Dalliance requires a BAM index (.bai) file when displaying BAM data.  These normally accompany BAM files.  For security reasons, web applications like Dalliance can only access local files which you have explicity selected.  Please use the file chooser below to select the appropriate BAI file")),
K.appendChild(document.createTextNode("Index file: ")),ea=k("input",null,{type:"file"}),K.appendChild(ea),Z=b);else if("prompt-tbi"===T)(b=ea.files)&&0<b.length&&b[0]?(Z.indexBlob=b[0],H(Z)):(b=Z,ca.style.display="none",U.style.display="inline",ga.style.display="inline",v(K),T="prompt-tbi",K.appendChild(k("h2","Select an index file")),K.appendChild(k("p","Dalliance requires a Tabix index (.tbi) file when displaying VCF data.  For security reasons, web applications like Dalliance can only access local files which you have explicity selected.  Please use the file chooser below to select the appropriate BAI file")),
K.appendChild(document.createTextNode("Index file: ")),ea=k("input",null,{type:"file"}),K.appendChild(ea),Z=b);else if("finalize"===T||"finalize-bin"===T)Z.name=pa.value,b=ma.value,Z.mapping="__default__"!=b?b:void 0,oa&&(Z.maxbins=oa.checked),1<ra.value.length&&1<sa.value.length&&(Z.xUser=ra.value,Z.xPass=sa.value),l.addTier(Z),"finalize-bin"==T?m():w();else if("hub-connect"===T)a=ba.value.trim(),/^.+:\/\//.exec(a)||(a="http://"+a),r(a);else{if("multiple"===T){for(b=0;b<W.length;++b)if(a=W[b],!a.hidden&&
("bam"!=a.tier_type||a.indexBlob||a.indexUri)&&("tabix"!=a.tier_type||a.indexBlob||a.indexUri)&&(a=wa(a)))a.noPersist=!0,l.addTier(a);m()}}else l.removeAllPopups()}function r(d,b,c){b=b||{};for(var e=0;e<l.hubObjects.length;++e){var f=l.hubObjects[e];if(f.hub.url==d){for(e=0;e<s.length;++e)s[e].hub==f&&p(s,s[e]);f.getTracks(function(a,d){d&&console.log(d);h(a)});return}}a(d,function(a,e){if(e){if(!c)return r(d,{credentials:!0},!0);v(K);K.appendChild(k("h2","Error connecting to track hub"));K.appendChild(k("p",
e));T="reset-hub"}else{var f=null,g=null,n;for(n in a.genomes){var m=null,q=!1;if(n==l.coordSystem.ucscName)q=!0;else for(var w in l.chains)n==l.chains[w].coords.ucscName&&(m=w,q=!0);q&&(q={url:d,genome:n},b.credentials&&(q.credentials=!0),m&&(q.mapping=m,a.genomes[n].mapping=m),l.hubs.push(q),l.hubObjects.push(a.genomes[n]),q=aa(a.genomes[n]),ja.appendChild(q),m&&f||(f=a.genomes[n],g=q))}f?(l.notifyTier(),p(s,g),f.getTracks(function(a,d){h(a)})):(v(K),K.appendChild(k("h2","No data for this genome")),
K.appendChild(k("p","This URL appears to be a valid track-hub, but it doesn't contain any data for the coordinate system of this browser")),K.appendChild(k("p","coordSystem.ucscName = "+l.coordSystem.ucscName)),T="reset-hub")}},b)}function D(a,d){var b=a.uri;if(d){var c=/(.+)\/[^\/]+\/?/.exec(b);c&&(b=c[1]+"/sources")}(new u(b,{credentials:a.credentials})).sources(function(b){if(!b||0==b.length)return d?na(a):D(a,!0);var c=null;if(1==b.length)c=b[0];else for(var e=0;e<b.length;++e)if(b[e].uri===a.uri){c=
b[e];break}e=b=!1;if(c&&(a.name=c.name,a.desc=c.desc,a.maxbins=c.maxbins?!0:!1,c.capabilities&&(a.capabilities=c.capabilities),e=!0,c.coords&&1==c.coords.length))if(c=c.coords[0],I(c,l.coordSystem))b=!0;else if(l.chains)for(var f in l.chains)I(c,l.chains[f].coords)&&(a.mapping=f,b=!0);return na(a,b,e)},function(){return d?na(a):D(a,!0)})}function z(a){(a.baiBlob?new g(a.baiBlob):"encode"==a.transport?new t(a.bamURI+".bai"):new f(a.bamURI+".bai",{credentials:a.credentials})).slice(0,256).fetch(function(d){var b=
!1;d&&(d=new Uint8Array(d),b=q(d,0)==x);return b?na(a,!1,!1,!0):F("You have selected a valid BAM file, but a corresponding index (.bai) file was not found.  Please index your BAM (samtools index) and place the BAI file in the same directory")})}function H(a){(a.indexBlob?new g(a.indexBlob):new f(a.uri+".tbi")).slice(0,65536).fetch(function(d){var b=!1;if(d){var c=new Uint8Array(d);if(31==c[0]||139==c[1])d=n(d),c=new Uint8Array(d),b=q(c,0)==S}return b?na(a,!1,!1,!0):F('You have selected a valid VCF file, but a corresponding index (.tbi) file was not found.  Please index your VCF ("tabix -p vcf -f myfile.vcf.gz") and place the .tbi file in the same directory')})}
function F(a){ca.style.display="none";U.style.display="inline";ga.style.display="inline";v(K);a=a||"Custom data format not recognized";K.appendChild(k("h2","Error adding custom data"));K.appendChild(k("p",a));K.appendChild(k("p","Currently supported formats are bigBed, bigWig, and BAM."));T="reset-bin"}if("add"===this.uiMode)this.hideToolPanel(),this.setUiMode("none");else{var l=this;e=k("div",null,{className:"dalliance"},{width:"100%",display:"inline-block",boxSizing:"border-box",MozBoxSizing:"border-box",
verticalAlign:"top",paddingRight:"15px"});var s=[],M,O;if(!this.noRegistryTabs){var V=this.makeButton("Registry","Browse compatible datasources from the DAS registry");s.push(V);for(var Y in this.mappableSources)(function(a){var d=l.makeButton(l.chains[a].srcTag,"Browse datasources mapped from "+l.chains[a].srcTag);s.push(d);d.addEventListener("click",function(b){b.preventDefault();b.stopPropagation();p(s,d);M(l.mappableSources[a],a)},!1)})(Y)}Y={};for(var $=0;$<this.defaultSources.length;++$){var X=
this.defaultSources[$],R=X.group||"Defaults";Y[R]?Y[R].push(X):Y[R]=[X]}var aa=function(a){var b=a.hub,c=k("i",null,{className:"fa fa-list-alt"},{cursor:"context-menu"}),e=b.shortLabel||"Unknown";a.mapping&&(e=e+" ("+a.genome+")");var e=k("span",[e," ",c]),f=l.makeButton(e,b.longLabel);f.hub=a;s.push(f);f.addEventListener("click",function(d){d.preventDefault();d.stopPropagation();p(s,f);v(K);d=l.makeLoader(24);d.style.marginLeft="auto";d.style.marginRight="auto";d.style.marginTop="100px";K.appendChild(k("div",
d,null,{textAlign:"center"}));ca.style.display="none";U.style.display="none";ga.style.display="none";a.getTracks(function(a,d){d&&console.log(d);h(a)})},!1);c.addEventListener("click",function(b){b.preventDefault();b.stopPropagation();var c=k("li",k("a","Remove hub")),e=k("li",k("a","Enable all")),g=k("li",k("a","Disable all")),h=k("ul",[c,e,g],{className:"dropdown-menu"},{display:"block"}),n=b.clientX;b=b.clientY;n+=document.documentElement.scrollLeft||document.body.scrollLeft;b+=document.documentElement.scrollTop||
document.body.scrollTop;h.style.position="absolute";h.style.top=""+(b+10)+"px";h.style.left=""+(n-30)+"px";l.hPopupHolder.appendChild(h);var m=function(a){console.log("cc");document.body.removeEventListener("click",m,!0);l.hPopupHolder.removeChild(h)};document.body.addEventListener("click",m,!0);c.addEventListener("click",function(b){for(b=0;b<l.hubObjects.length;++b)if(l.hubObjects[b].absURL==a.absURL){l.hubObjects.splice(b,1);break}for(b=0;b<l.hubs.length;++b){var c=l.hubs[b];"string"===typeof c&&
(c={url:c});if(c.url==a.hub.url&&!c.genome||c.genome==a.genome){l.hubs.splice(b,1);break}}l.notifyTier();ja.removeChild(f);p(s,da);d()},!1);e.addEventListener("click",function(d){a.getTracks(function(a,d){d&&console.log(d);for(var b=0;b<a.length;++b){var c=a[b].toDallianceSource();l.currentlyActive(c)||l.addTier(c)}})},!1);g.addEventListener("click",function(d){a.getTracks(function(a,d){d&&console.log(d);for(var b=0;b<a.length;++b){var c=a[b].toDallianceSource();l.currentlyActive(c)&&l.removeTier(c)}})},
!1)},!1);return f},ia=null,ka=null;for(R in Y)(function(a,d){var b=l.makeButton(a,"Browse the default set of data for this browser");b.addEventListener("click",function(a){a.preventDefault();a.stopPropagation();p(s,b);M(new y(d))},!1);s.push(b);ia||(ia=b,ka=d)})(R,Y[R]);var fa=this.makeButton("DAS","Add arbitrary DAS data");s.push(fa);var la=this.makeButton("Binary","Add data in bigwig or bigbed format");s.push(la);for(R=0;R<this.hubObjects.length;++R)aa(this.hubObjects[R]);var da=this.makeButton("+",
"Connect to a new track-hub");s.push(da);var ja=k("ul",s,{className:"nav nav-tabs"},{marginBottom:"0px"});e.appendChild(ja);var ba,pa,ma,oa,ea,ra,sa,T=!1,Z=null,R=k("form",null,{},{display:"inline-block",width:"100%"});R.addEventListener("submit",function(a){a.stopPropagation();a.preventDefault();G();return!1},!0);var K=k("div");K.style.position="relative";K.style.overflow="scroll";R.appendChild(K);var qa,ua;M=function(a,d){ca.style.display="none";U.style.display="none";ga.style.display="none";ua&&
ua.removeListener(O);qa=d;ua=a;ua.addListenerAndFire(O)};O=function(a){T=!1;var d=[];v(K);if(a){for(var b=k("tbody",null,{className:"table table-striped table-condensed"},{width:"100%"}),c=k("table",b,{className:"table table-striped table-condensed"},{width:"100%",tableLayout:"fixed"}),e=0,f=[],g=0;g<a.length;++g)f.push(a[g]);f.sort(function(a,d){return a.name.toLowerCase().trim().localeCompare(d.name.toLowerCase().trim())});for(g=0;g<f.length;++g){a=f[g];var h=k("tr"),n=k("td",null,{},{width:"30px"});
n.style.textAlign="center";if(!a.props||a.props.cors){var m=k("input");m.type="checkbox";m.dalliance_source=a;qa&&(m.dalliance_mapping=qa);n.appendChild(m);d.push(m);m.addEventListener("change",function(a){a.target.checked?l.addTier(a.target.dalliance_source):l.removeTier(a.target.dalliance_source)})}else n.appendChild(document.createTextNode("!")),l.makeTooltip(n,k("span",["This data source isn't accessible because it doesn't support ",k("a","CORS",{href:"http://www.w3.org/TR/cors/"}),"."]));h.appendChild(n);
n=k("td");n.appendChild(document.createTextNode(a.name));a.desc&&0<a.desc.length&&l.makeTooltip(n,a.desc);h.appendChild(n);b.appendChild(h);++e}var q=function(){for(var a=0;a<d.length;++a){var b=d[a];l.currentlyActive(b.dalliance_source)?b.checked=!0:b.checked=!1}};q();l.addTierListener(function(a){q()});K.appendChild(c)}else K.appendChild(k("p","Dalliance was unable to retrieve data source information from the DAS registry, please try again later"))};V&&V.addEventListener("click",function(a){a.preventDefault();
a.stopPropagation();p(s,V);M(l.availableSources)},!1);la.addEventListener("click",function(a){a.preventDefault();a.stopPropagation();m()},!1);da.addEventListener("click",function(a){a.preventDefault();a.stopPropagation();d()},!1);fa.addEventListener("click",function(a){a.preventDefault();a.stopPropagation();w()},!1);var U=k("button","Add",{className:"btn btn-primary"});U.addEventListener("click",function(a){a.stopPropagation();a.preventDefault();G()},!1);var va=function(a,d){var b=l.knownSpace;if(b){var c=
Math.max(b.min,(b.min+b.max-100)/2)|0,b=new A(b.chr,c,Math.min(c+99,b.max));a.features(b,{},function(b,c){if(c)d?(v(K),K.appendChild(k("h2","Custom data not found")),K.appendChild(k("p","DAS uri: "+a.uri+" is not answering features requests")),T="reset"):(a.credentials=!0,va(a,!0));else{var e=/\/([^/]+)\/?$/.exec(a.uri);e&&(a.name=e[1]);D(a)}})}else alert("Can't confirm track-addition to an uninit browser.")},wa=function(a){var d={name:a.name};a.credentials&&(d.credentials=a.credentials);a.mapping&&
"__default__"!=a.mapping&&(d.mapping=a.mapping);a.transport&&(d.transport=a.transport);if("bwg"==a.tier_type)return a.blob?d.bwgBlob=a.blob:a.uri&&(d.bwgURI=a.uri),d;if("bam"==a.tier_type)return a.blob?(d.bamBlob=a.blob,d.baiBlob=a.indexBlob):(d.bamURI=a.uri,d.baiURI=a.indexUri),d;if("tabix"==a.tier_type)return d.tier_type="tabix",d.payload=a.payload,a.blob?(d.blob=a.blob,d.indexBlob=a.indexBlob):(d.uri=a.uri,d.indexUri=a.indexUri),d;if("memstore"==a.tier_type)return d.tier_type="memstore",d.payload=
a.payload,a.blob?d.blob=a.blob:d.uri=a.uri,d},Q=function(a){b(a,function(a,d){if(d){v(K);var b=k("div");b.appendChild(k("h2","Couldn't access custom data"));b.appendChild(k("p",""+d));K.appendChild(b);console.log(a);"https:"===window.location.protocol&&0==a.uri.indexOf("http:")&&l.canFetchPlainHTTP().then(function(a){a||b.appendChild(k("p",[k("strong","HTTP warning: "),"you may not be able to access HTTP resources from an instance of Biodalliance which you are accessing via HTTPS.",k("a","[More info]",
{href:l.httpWarningURL,target:"_blank"})]))});T="reset-bin"}else{var c=wa(a);return"bam"==a.tier_type?z(c):"tabix"==a.tier_type?H(c):na(c,!1,!1,!0)}})},na=function(a,d,b,c){ca.style.display="none";U.style.display="inline";ga.style.display="inline";v(K);K.appendChild(k("h2","Add custom data: step 2"));K.appendChild(document.createTextNode("Label: "));pa=k("input","",{value:a.name});K.appendChild(pa);ra=k("input","");sa=k("input","");K.appendChild(k("br"));K.appendChild(k("br"));K.appendChild(k("h4",
"Coordinate system: "));ma=k("select",null);ma.appendChild(k("option",l.nameForCoordSystem(l.coordSystem),{value:"__default__"}));if(l.chains)for(var e in l.chains)ma.appendChild(k("option",l.nameForCoordSystem(l.chains[e].coords),{value:e}));ma.value=a.mapping||"__default__";K.appendChild(ma);d?K.appendChild(k("p","(Based on server response, probably doesn't need changing.)")):(K.appendChild(k("p",[k("b","Warning: "),"unable to determine the correct value from server responses.  Please check carefully."])),
K.appendChild(k("p","If you don't see the mapping you're looking for, please contact thomas@biodalliance.org")));c||(K.appendChild(document.createTextNode("Quantitative: ")),oa=k("input",null,{type:"checkbox",checked:!0}),"undefined"!==typeof a.maxbins&&(oa.checked=a.maxbins),K.appendChild(oa),b?K.appendChild(k("p","(Based on server response, probably doesn't need changing.)")):K.appendChild(k("p",[k("b","Warning: "),"unable to determine correct value.  If in doubt, leave checked."])));a.bwgBlob&&
K.appendChild(k("p",[k("b","Warning: "),"data added from local file.  Due to the browser security model, the track will disappear if you reload Dalliance."]));pa.focus();T="bin"===T||"prompt-bai"===T||"prompt-tbi"===T?"finalize-bin":"finalize";Z=a},W=null,ha=function(a){b(a,function(a,d){d&&(a.error=d);for(var b=[],c={},e={},f=0;f<W.length;++f){var g=W[f];"bam"!=g.tier_type||g.indexBlob||(c[g.blob.name]=g);"tabix"!=g.tier_type||g.indexBlob||(e[g.blob.name]=g)}for(f=0;f<W.length;++f)if(g=W[f],"bai"===
g.tier_type){var h=/(.+)\.bai$/.exec(g.blob.name);h&&c[h[1]]&&(c[h[1]].indexBlob=g.blob,b.push(f))}else"tabix-index"===g.tier_type&&(h=/(.+)\.tbi$/.exec(g.blob.name))&&e[h[1]]&&(e[h[1]].indexBlob=g.blob,b.push(f));for(c=b.length-1;0<=c;--c)W.splice(b[c],1);ta()})},ta=function(){v(K);var a=!1,d=k("table",W.filter(function(a){return!a.hidden}).map(function(d){k("tr").appendChild(k("td",d.name||d.blob.name));var b;b=d.error?k("span","Error",null,{color:"red"}):d.tier_type?d.payload||d.tier_type:l.makeLoader(16);
var c,e="unknown";"bwg"==d.tier_type||"memstore"==d.tier_type?e="okay":"bam"==d.tier_type?e=d.indexBlob?"okay":"needs-index":"tabix"==d.tier_type&&(e=d.indexBlob?"okay":"needs-index");if("okay"==e){c=k("select",null,null,{width:"150px"});c.appendChild(k("option",l.nameForCoordSystem(l.coordSystem),{value:"__default__"}));if(l.chains)for(var f in l.chains)c.appendChild(k("option",l.nameForCoordSystem(l.chains[f].coords),{value:f}));c.value=d.mapping||"__default__";c.addEventListener("change",function(a){d.mapping=
c.value;console.log(d)},!1)}else"needs-index"==e&&(c=k("span","Needs index",{},{color:"red"}),a=!0);return k("tr",[k("td",d.name||d.blob.name),k("td",b),k("td",c)])}),{className:"table table-striped table-condensed"});K.appendChild(d);if(a){K.appendChild(k("p","Some of these files are missing required index (.bai or .tbi) files.  For security reasons, web applications like Dalliance can only access local files which you have explicity selected.  Please use the file chooser below to select the appropriate index file"));
K.appendChild(document.createTextNode("Index file(s): "));var b=k("input",null,{type:"file",multiple:"multiple"});K.appendChild(b);b.addEventListener("change",function(a){console.log("fileset changed");a=b.files||[];for(var d=0;d<a.length;++d){var c=a[d];c&&(c={blob:c,hidden:!0},W.push(c),ha(c))}},!1)}},ga=k("button","Cancel",{className:"btn"});ga.addEventListener("click",function(a){a.stopPropagation();a.preventDefault();"finalize-bin"===T?m():w()},!1);var ca=k("button","Refresh",{className:"btn"});
ca.addEventListener("click",function(a){a.stopPropagation();a.preventDefault();l.queryRegistry(qa)},!1);this.makeTooltip(ca,"Click to re-fetch data from the DAS registry");Y=k("div",[U," ",ga," ",ca]);Y.style.margin="10px";R.appendChild(Y);e.appendChild(R);M(l.availableSources);this.showToolPanel(e);this.setUiMode("add");ia&&(p(s,ia),M(new y(ka)))}}},{"./bam":1,"./bin":4,"./cbrowser":6,"./das":10,"./domui":11,"./encode":12,"./lh3utils":24,"./probe":28,"./sourcecompare":35,"./tabix":41,"./thub":42,
"./utils":49}],47:[function(e,s,r){function p(e,k,p){k.fetchAsText(function(k){if(!k)return p(null,"Couldn't fetch index-index");k=k.split(/(.+)([0-9A-F]{10})\n/);for(var r=[],a=[],c=1;c<k.length;c+=3)r.push(k[c]),a.push(parseInt(k[c+1],16));return p(new m(r,a,e))})}function m(e,k,m){this.keys=e;this.offsets=k;this.ix=m}m.prototype.lookup=function(e,k){for(var m,p=(e+"     ").substring(0,5).toLowerCase(),r=0;r<this.keys.length;++r)if(0>p.localeCompare(this.keys[r])){m=this.ix.slice(this.offsets[r-
1],this.offsets[r]-this.offsets[r-1]);break}m||(m=this.ix.slice(this.offsets[this.offsets.length-1]));m.fetchAsText(function(a){a=a.split("\n");for(var c=0;c<a.length;++c)if(0==a[c].indexOf(e.toLowerCase()+" "))return k(a[c].split(" "));return k(null)})};"undefined"!==typeof s&&(s.exports={connectTrix:p})},{}],48:[function(e,s,r){function p(){}function m(a,e){var f=new p;f.data=a;f.data.slice(0,12500).fetch(function(a){if(!a)return e(null,"Couldn't access data");var g=new Uint8Array(a);a=k(g,0);if(a==
c)f.readInt=k;else if(a==b)f.readInt=v;else return e(null,"Not a .2bit file, magic=0x"+a.toString(16));a=f.readInt(g,4);if(0!=a)return e(null,"Unsupported version "+a);f.seqCount=f.readInt(g,8);f.seqDict={};var m=16,p=0,u=0,r=function(){for(;p<f.seqCount;){var a=g[m];if(m+a+6>=g.length)return f.data.slice(u+m,12500).fetch(function(a){u+=m;m=0;g=new Uint8Array(a);r()});++m;for(var b="",c=1;c<=a;++c)b+=String.fromCharCode(g[m++]);a=f.readInt(g,m);m+=4;f.seqDict[b]=new h(f,a);++p}return e(f)};r()})}
function h(a,b){this.tbf=a;this.offset=b}if("undefined"!==typeof e){r=e("./bin");var k=r.readInt,v=r.readIntBE;e=e("./spans");var y=e.Range,E=e.union,a=e.intersection}var c=440477507,b=1126646042;p.prototype.getSeq=function(a){var b=this.seqDict[a];b||(b=this.seqDict["chr"+a]);return b};p.prototype.fetch=function(a,b,c,e){var f=this.getSeq(a);if(f){if(c<=b)return e("");f.fetch(b,c,e)}else return e(null,"Couldn't find "+a)};h.prototype.init=function(a){if(this.seqOffset)return a();var b=this;b.tbf.data.slice(b.offset,
8).fetch(function(c){if(!c)return a("Fetch failed");c=new Uint8Array(c);b._length=b.tbf.readInt(c,0);b.nBlockCnt=b.tbf.readInt(c,4);b.tbf.data.slice(b.offset+8,8*b.nBlockCnt+4).fetch(function(c){if(!c)return a("Fetch failed");c=new Uint8Array(c);for(var e=null,f=0;f<b.nBlockCnt;++f)var h=b.tbf.readInt(c,4*f),k=b.tbf.readInt(c,4*(f+b.nBlockCnt)),h=new y(h,h+k-1),e=e?E(e,h):h;b.nBlocks=e;b.mBlockCnt=b.tbf.readInt(c,8*b.nBlockCnt);b.seqLength=(b._length+3)/4|0;b.seqOffset=b.offset+16+8*(b.nBlockCnt+
b.mBlockCnt);return a()})})};var f=["T","C","A","G"];h.prototype.fetch=function(b,c,e){--b;--c;var h=this;this.init(function(k){if(k)return e(null,k);var m=b>>2;k=c+3>>2;if(0>m||k>h.seqLength)return e("Coordinates out of bounds: "+b+":"+c);h.tbf.data.slice(h.seqOffset+m,k-m).salted().fetch(function(k){function p(a){for(;v<=a;){var b=v&3,c=r[(v>>2)-m];s+=f[0==b?c>>6&3:1==b?c>>4&3:2==b?c>>2&3:c&3];++v}}if(null==k)return e("SeqFetch failed");var r=new Uint8Array(k);k=[];if(h.nBlocks){var t=a(new y(b,
c),h.nBlocks);t&&(k=t.ranges())}for(var s="",v=b,t=0;t<k.length;++t){var E=k[t];if(v>E.min())throw"N mismatch...";for(v<E.min()&&p(E.min()-1);v<=E.max();)s+="N",++v}v<=c&&p(c);return e(s)})})};h.prototype.length=function(a){var b=this;this.init(function(c){return c?a(null,c):a(b._length)})};"undefined"!==typeof s&&(s.exports={makeTwoBit:m})},{"./bin":4,"./spans":36}],49:[function(e,s,r){function p(a,b){for(var c=0;c<a.length;++c)if(a[c]==b)return;a.push(b)}function m(a,b,c){a[b]?a[b].push(c):a[b]=
[c]}function h(a,b,c){var e=a[b];if(e){for(a=0;a<e.length;++a)if(e[a]==c)return;e.push(c)}else a[b]=[c]}function k(a,b,c,e){if(a)return a;if(b)return b;if(c)return c;if(e)return e}function p(a,b){for(var c=0;c<a.length;++c)if(a[c]==b)return;a.push(b)}function v(a,b){if(!a)return-1;for(var c=0;c<a.length;++c)if(a[c]===b)return c;return-1}function y(a,b,c,e){a=document.createElement(a);if(b){b instanceof Array||(b=[b]);for(var f=0;f<b.length;++f){var g=b[f];g&&("string"==typeof g?g=document.createTextNode(g):
"number"==typeof g&&(g=document.createTextNode(""+g)),a.appendChild(g))}}if(c)for(var d in c)try{a[d]=c[d]}catch(h){throw console.log("error setting "+d),h;}if(e)for(d in e)a.style[d]=e[d];return a}function E(a,b,c,e){a=document.createElementNS(a,b);if(c)for(c instanceof Array||(c=[c]),b=0;b<c.length;++b){var f=c[b];"string"==typeof f&&(f=document.createTextNode(f));a.appendChild(f)}if(e)for(var g in e){c=a;b=g;var f=e[g],d=N[b];if(!d){for(var d="",h=0;h<b.length;++h)var k=b.substring(h,h+1),n=k.toLowerCase(),
d=n!=k?d+"-"+n:d+k;N[b]=d}c.setAttribute(d,f)}return a}function a(a){if(a&&a.childNodes)for(;0<a.childNodes.length;)a.removeChild(a.firstChild)}function c(a,b){if("undefined"===typeof a)return"undefined";if(null==a)return"null";if("string"==typeof a)return"'"+a+"'";if("number"==typeof a||"boolean"==typeof a)return""+a;if("object"==typeof a){if(a instanceof Array){for(var e=null,f=0;f<a.length;++f)e=(null==e?"":e+", ")+c(a[f],b);return"["+(e?e:"")+"]"}b=b||{};e=null;for(f in a)b[f]||void 0!=f&&"function"!=
typeof a[f]&&(e=(null==e?"":e+", ")+f+": "+c(a[f],b));return"{"+(e?e:"")+"}"}return typeof a}function b(a){var b={},c;for(c in a)b[c]=a[c];return b}function f(a){this.value=a;this.listeners=[]}function g(){this.queue=[]}function q(a,b,c){c&&c.salt&&(a=a+"?salt="+S(""+Date.now()+","+ ++A));try{var e;c.timeout&&(e=setTimeout(function(){console.log("timing out "+a);f.abort();return b(null,"Timeout")},c.timeout));var f=new XMLHttpRequest;f.onreadystatechange=function(){4==f.readyState&&(e&&clearTimeout(e),
200>f.status||300<=f.status?b(null,"Error code "+f.status):b(f.responseText))};f.open("GET",a,!0);f.responseType="text";c&&c.credentials&&(f.withCredentials=!0);f.send("")}catch(g){b(null,"Exception "+g)}}function n(a,b){if(0==b.indexOf("http:")||0==b.indexOf("https:"))return b;var c=a.lastIndexOf("/");return 0<=c?a.substr(0,c+1)+b:b}function x(a){return y("a",null,{href:a}).href}if("undefined"!==typeof e)var S=e("./sha1").b64_sha1;var N={};f.prototype.addListener=function(a){this.listeners.push(a)};
f.prototype.addListenerAndFire=function(a){this.listeners.push(a);a(this.value)};f.prototype.removeListener=function(a){var b=this.listeners;a=v(b,a);0<=a&&b.splice(a,1)};f.prototype.get=function(){return this.value};f.prototype.set=function(a){this.value=a;for(var b=0;b<this.listeners.length;++b)this.listeners[b](a)};g.prototype.provide=function(a){if(void 0!==this.res)throw"Resource has already been provided.";this.res=a;for(var b=0;b<this.queue.length;++b)this.queue[b](a);this.queue=null};g.prototype.await=
function(a){if(void 0!==this.res)return a(this.res),this.res;this.queue.push(a)};var A=0;e={TTT:"F",TTC:"F",TTA:"L",TTG:"L",CTT:"L",CTC:"L",CTA:"L",CTG:"L",ATT:"I",ATC:"I",ATA:"I",ATG:"M",GTT:"V",GTC:"V",GTA:"V",GTG:"V",TCT:"S",TCC:"S",TCA:"S",TCG:"S",CCT:"P",CCC:"P",CCA:"P",CCG:"P",ACT:"T",ACC:"T",ACA:"T",ACG:"T",GCT:"A",GCC:"A",GCA:"A",GCG:"A",TAT:"Y",TAC:"Y",TAA:"*",TAG:"*",CAT:"H",CAC:"H",CAA:"Q",CAG:"Q",AAT:"N",AAC:"N",AAA:"K",AAG:"K",GAT:"D",GAC:"D",GAA:"E",GAG:"E",TGT:"C",TGC:"C",TGA:"*",TGG:"W",
CGT:"R",CGC:"R",CGA:"R",CGG:"R",AGT:"S",AGC:"S",AGA:"R",AGG:"R",GGT:"G",GGC:"G",GGA:"G",GGG:"G"};"trim"in String.prototype||(String.prototype.trim=function(){return this.replace(/^\s+/,"").replace(/\s+$/,"")});"undefined"!==typeof s&&(s.exports={textXHR:q,relativeURL:n,resolveUrlToPage:x,shallowCopy:b,pusho:m,pushnew:p,pushnewo:h,arrayIndexOf:v,pick:k,makeElement:y,makeElementNS:E,removeChildren:a,miniJSONify:c,Observed:f,Awaited:g,AMINO_ACID_TRANSLATION:e})},{"./sha1":33}],50:[function(e,s,r){function p(){this.info=
[]}function m(a,c){this.parser=a;this.sink=c}if("undefined"!==typeof e){var h=e("./sourceadapters").registerParserFactory;e=e("./das");var k=e.DASStylesheet,v=e.DASStyle,y=e.DASFeature}var E=/([^;=]+)(=([^;]+))?;?/,a=/##INFO=<([^>]+)>/,c=/([^,=]+)=([^,]+|"[^"]+"),?/;p.prototype.createSession=function(a){return new m(this,a)};m.prototype.parse=function(b){if(0!=b.length)if("#"==b[0]){if(1<b.length&&"#"==b[1]&&(b=a.exec(b))){var e=b[1].split(c),g=null,h=null;for(b=0;b<e.length-1;b+=3){var k=e[b+1],
m=e[b+2].replace(/"/g,"");"ID"==k?g=m:"Description"==k&&(h=m)}g&&h&&this.parser.info.push({id:g,desc:h})}}else{e=b.split("\t");g=new y;g.segment=e[0];g.id=e[2];g.refAllele=e[3];g.altAlleles=e[4].split(",");g.min=parseInt(e[1]);g.max=g.min+g.refAllele.length-1;e=e[7].split(E);g.info={};for(b=0;b<e.length;b+=4)g.info[e[b+1]]=e[b+3];b=g.altAlleles[0];e=g.refAllele;b.length>e.length?(g.type="insertion",0==b.indexOf(e)?(g.insertion=b.substr(e.length),g.min+=e.length,g.max=g.min-1):g.insertion=b):g.type=
b.length<e.length?"deletion":"substitution";this.sink(g)}};m.prototype.flush=function(){};p.prototype.getStyleSheet=function(a){var c=new k,e=new v;e.glyph="__INSERTION";e.BUMP="yes";e.LABEL="no";e.FGCOLOR="rgb(50,80,255)";e.BGCOLOR="#888888";e.STROKECOLOR="black";c.pushStyle({type:"insertion"},null,e);e=new v;e.glyph="PLIMSOLL";e.BUMP="yes";e.LABEL="no";e.FGCOLOR="rgb(255, 60, 60)";e.BGCOLOR="#888888";e.STROKECOLOR="black";c.pushStyle({type:"deletion"},null,e);e=new v;e.glyph="PLIMSOLL";e.BUMP="yes";
e.LABEL="no";e.FGCOLOR="rgb(50,80,255)";e.BGCOLOR="#888888";e.STROKECOLOR="black";c.pushStyle({type:"default"},null,e);return a(c)};p.prototype.getDefaultFIPs=function(a){var c=this;a(function(a,b){b.add("Ref. allele",a.refAllele);b.add("Alt. alleles",a.altAlleles.join(","));if(a.info)for(var e=0;e<c.info.length;++e){var h=c.info[e],k=a.info[h.id];void 0!==k&&b.add(h.desc,k)}})};h("vcf",function(){return new p})},{"./das":10,"./sourceadapters":34}],51:[function(e,s,r){e={CONFIG:5,MAJOR:0,MINOR:13,
MICRO:5,PATCH:"",BRANCH:"dev",toString:function(){var e=""+this.MAJOR+"."+this.MINOR+"."+this.MICRO;this.PATCH&&(e+=this.PATCH);this.BRANCH&&""!=this.BRANCH&&(e=e+"-"+this.BRANCH);return e}};"undefined"!==typeof s&&(s.exports=e)},{}],52:[function(e,s,r){function p(e){function k(a){a=Math.min(a,s);b=a=Math.max(a,r);q.style.left=""+b+"px"}function p(a){a=Math.min(a,s);f=a=Math.max(a,r);n.style.left=""+f+"px"}e=e||{};var r=0,s=e.width||200,a=0,c=200,b=50,f=100,g=[];e=m("hr",null,{className:"slider-track"},
{width:""+(s|0)+"px"});var q=m("hr",null,{className:"slider-thumb active"}),n=m("hr",null,{className:"slider-thumb"}),x=m("div",[e,q,n],{className:"slider"},{width:""+((s|0)+10)+"px"});x.removeLabels=function(){for(var a=0;a<g.length;++a)x.removeChild(g[a]);g=[]};x.addLabel=function(b,e){var f=m("div",e,{className:"slider-label"},{left:""+(r+(b-a)*(s-r)/(c-a)|0)+"px"});x.appendChild(f);g.push(f)};var S=document.createEvent("HTMLEvents");S.initEvent("change",!0,!1);Object.defineProperty(x,"value",
{get:function(){return a+(b-r)*(c-a)/(s-r)},set:function(b){k(r+(b-a)*(s-r)/(c-a))}});Object.defineProperty(x,"value2",{get:function(){return a+(f-r)*(c-a)/(s-r)},set:function(b){p(r+(b-a)*(s-r)/(c-a))}});Object.defineProperty(x,"active",{get:function(){return q.classList.contains("active")?1:2},set:function(a){1==a?(q.classList.add("active"),n.classList.remove("active")):(n.classList.add("active"),q.classList.remove("active"))}});Object.defineProperty(x,"min",{get:function(){return a},set:function(b){a=
b}});Object.defineProperty(x,"max",{get:function(){return c},set:function(a){c=a}});var N,A;e=function(a){A=this==q?1:2;A!=x.active&&(x.active=A,x.dispatchEvent(S));a.stopPropagation();a.preventDefault();window.addEventListener("mousemove",u,!1);window.addEventListener("mouseup",I,!1);N=a.clientX-(1==A?b:f)};q.addEventListener("mousedown",e,!1);n.addEventListener("mousedown",e,!1);var u=function(a){1==A?k(a.clientX-N):p(a.clientX-N);x.dispatchEvent(S)},I=function(a){window.removeEventListener("mousemove",
u,!1);window.removeEventListener("mouseup",I,!1)};return x}if("undefined"!==typeof e)var m=e("./utils").makeElement;"undefined"!==typeof s&&(s.exports=p)},{"./utils":49}],53:[function(e,s,r){s=e("./promise/promise").Promise;e=e("./promise/polyfill").polyfill;r.Promise=s;r.polyfill=e},{"./promise/polyfill":58,"./promise/promise":59}],54:[function(e,s,r){var p=e("./utils").isArray,m=e("./utils").isFunction;r.all=function(e){if(!p(e))throw new TypeError("You must pass an array to all.");return new this(function(k,
p){function r(b){return function(c){s[b]=c;0===--a&&k(s)}}var s=[],a=e.length,c;0===a&&k([]);for(var b=0;b<e.length;b++)(c=e[b])&&m(c.then)?c.then(r(b),p):(s[b]=c,0===--a&&k(s))})}},{"./utils":63}],55:[function(e,s,r){(function(e,m){function h(){return function(){e.nextTick(y)}}function k(){var b=0,c=new a(y),e=document.createTextNode("");c.observe(e,{characterData:!0});return function(){e.data=b=++b%2}}function s(){return function(){c.setTimeout(y,1)}}function y(){for(var a=0;a<b.length;a++){var c=
b[a];(0,c[0])(c[1])}b=[]}var E="undefined"!==typeof window?window:{},a=E.MutationObserver||E.WebKitMutationObserver,c="undefined"!==typeof m?m:void 0===this?window:this,b=[],f;f="undefined"!==typeof e&&"[object process]"==={}.toString.call(e)?h():a?k():s();r.asap=function(a,c){1===b.push([a,c])&&f()}}).call(this,e("1YiZ5S"),"undefined"!==typeof self?self:"undefined"!==typeof window?window:{})},{"1YiZ5S":64}],56:[function(e,s,r){r.cast=function(e){return e&&"object"===typeof e&&e.constructor===this?
e:new this(function(m){m(e)})}},{}],57:[function(e,s,r){var p={instrument:!1};r.config=p;r.configure=function(e,h){if(2===arguments.length)p[e]=h;else return p[e]}},{}],58:[function(e,s,r){(function(p){var m=e("./promise").Promise,h=e("./utils").isFunction;r.polyfill=function(){var e;e="undefined"!==typeof p?p:"undefined"!==typeof window&&window.document?window:self;"Promise"in e&&"cast"in e.Promise&&"resolve"in e.Promise&&"reject"in e.Promise&&"all"in e.Promise&&"race"in e.Promise&&function(){var m;
new e.Promise(function(e){m=e});return h(m)}()||(e.Promise=m)}}).call(this,"undefined"!==typeof self?self:"undefined"!==typeof window?window:{})},{"./promise":59,"./utils":63}],59:[function(e,s,r){function p(a){if(!n(a))throw new TypeError("You must pass a resolver function as the first argument to the promise constructor");if(!(this instanceof p))throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.");this._subscribers=
[];m(a,this)}function m(a,b){function d(a){E(b,a)}function e(a){c(b,a)}try{a(d,e)}catch(f){e(f)}}function h(a,b,d,e){var f=n(d),g,h,k,m;if(f)try{g=d(e),k=!0}catch(p){m=!0,h=p}else g=e,k=!0;y(b,g)||(f&&k?E(b,g):m?c(b,h):a===t?E(b,g):a===B&&c(b,g))}function k(a,b,d,c){a=a._subscribers;var e=a.length;a[e]=b;a[e+t]=d;a[e+B]=c}function v(a,b){for(var d,c,e=a._subscribers,f=a._detail,g=0;g<e.length;g+=3)d=e[g],c=e[g+b],h(b,d,c,f);a._subscribers=null}function y(b,e){var d=null,f;try{if(b===e)throw new TypeError("A promises callback cannot return that same promise.");
if(q(e)&&(d=e.then,n(d)))return d.call(e,function(d){if(f)return!0;f=!0;e!==d?E(b,d):a(b,d)},function(a){if(f)return!0;f=!0;c(b,a)}),!0}catch(g){if(f)return!0;c(b,g);return!0}return!1}function E(b,c){b===c?a(b,c):y(b,c)||a(b,c)}function a(a,c){a._state===u&&(a._state=I,a._detail=c,g.async(b,a))}function c(a,b){a._state===u&&(a._state=I,a._detail=b,g.async(f,a))}function b(a){v(a,a._state=t)}function f(a){v(a,a._state=B)}var g=e("./config").config;e("./config");var q=e("./utils").objectOrFunction,
n=e("./utils").isFunction;e("./utils");s=e("./cast").cast;var x=e("./all").all,S=e("./race").race,N=e("./resolve").resolve,A=e("./reject").reject;e=e("./asap").asap;g.async=e;var u=void 0,I=0,t=1,B=2;p.prototype={constructor:p,_state:void 0,_detail:void 0,_subscribers:void 0,then:function(a,b){var d=this,c=new this.constructor(function(){});if(this._state){var e=arguments;g.async(function(){h(d._state,c,e[d._state-1],d._detail)})}else k(this,c,a,b);return c},"catch":function(a){return this.then(null,
a)}};p.all=x;p.cast=s;p.race=S;p.resolve=N;p.reject=A;r.Promise=p},{"./all":54,"./asap":55,"./cast":56,"./config":57,"./race":60,"./reject":61,"./resolve":62,"./utils":63}],60:[function(e,s,r){var p=e("./utils").isArray;r.race=function(e){if(!p(e))throw new TypeError("You must pass an array to race.");return new this(function(h,k){for(var p,r=0;r<e.length;r++)(p=e[r])&&"function"===typeof p.then?p.then(h,k):h(p)})}},{"./utils":63}],61:[function(e,s,r){r.reject=function(e){return new this(function(m,
h){h(e)})}},{}],62:[function(e,s,r){r.resolve=function(e){return new this(function(m,h){m(e)})}},{}],63:[function(e,s,r){function p(e){return"function"===typeof e}e=Date.now||function(){return(new Date).getTime()};r.objectOrFunction=function(e){return p(e)||"object"===typeof e&&null!==e};r.isFunction=p;r.isArray=function(e){return"[object Array]"===Object.prototype.toString.call(e)};r.now=e},{}],64:[function(e,s,r){function p(){}e=s.exports={};e.nextTick=function(){if("undefined"!==typeof window&&
window.setImmediate)return function(e){return window.setImmediate(e)};if("undefined"!==typeof window&&window.postMessage&&window.addEventListener){var e=[];window.addEventListener("message",function(h){var k=h.source;k!==window&&null!==k||"process-tick"!==h.data||(h.stopPropagation(),0<e.length&&e.shift()())},!0);return function(h){e.push(h);window.postMessage("process-tick","*")}}return function(e){setTimeout(e,0)}}();e.title="browser";e.browser=!0;e.env={};e.argv=[];e.on=p;e.addListener=p;e.once=
p;e.off=p;e.removeListener=p;e.removeAllListeners=p;e.emit=p;e.binding=function(e){throw Error("process.binding is not supported");};e.cwd=function(){return"/"};e.chdir=function(e){throw Error("process.chdir is not supported");}},{}],65:[function(e,s,r){function p(){}function m(){this.was=[0]}function h(a,b,e){this.hufts=new Int32Array(3*c);this.window=new Uint8Array(e);this.end=e;this.checkfn=b;this.mode=x;this.reset(a,null);this.index=this.table=this.left=0;this.blens=null;this.bb=new Int32Array(1);
this.tb=new Int32Array(1);this.codes=new k;this.check=this.write=this.read=this.bitb=this.bitk=this.last=0;this.inftree=new v}function k(){}function v(){}function y(a,b,c,e,f){if(0!=f){if(!a)throw"Undef src";if(!c)throw"Undef dest";if(0==b&&f==a.length)c.set(a,e);else if(J)a=a.subarray(b,b+f),c.set(a,e);else if(1==a.BYTES_PER_ELEMENT&&100<f)a=new Uint8Array(a.buffer,a.byteOffset+b,f),c.set(a,e);else for(var g=0;g<f;++g)c[e+g]=a[b+g]}}function E(d,c,e,h){d=c?e?new Uint8Array(d,c,e):new Uint8Array(d,
c,d.byteLength-c):new Uint8Array(d);e=new p;e.inflateInit(a,!0);e.next_in=d;e.next_in_index=0;e.avail_in=d.length;d=[];for(var k=0;;){var n=new Uint8Array(32E3);e.next_out=n;e.next_out_index=0;e.avail_out=n.length;var m=e.inflate(b);if(m!=f&&m!=g&&m!=q)throw e.msg;if(0!=e.avail_out){var r=new Uint8Array(n.length-e.avail_out);y(n,0,r,0,n.length-e.avail_out);n=r}d.push(n);k+=n.length;if(m==g||m==q)break}h&&(h[0]=(c||0)+e.next_in_index);if(1==d.length)return d[0].buffer;c=new Uint8Array(k);for(e=h=0;e<
d.length;++e)k=d[e],y(k,0,c,h,k.length),h+=k.length;return c.buffer}var a=15,c=1440,b=0,f=0,g=1,q=-5,n=[0,1,3,7,15,31,63,127,255,511,1023,2047,4095,8191,16383,32767,65535],x=0,S=[96,7,256,0,8,80,0,8,16,84,8,115,82,7,31,0,8,112,0,8,48,0,9,192,80,7,10,0,8,96,0,8,32,0,9,160,0,8,0,0,8,128,0,8,64,0,9,224,80,7,6,0,8,88,0,8,24,0,9,144,83,7,59,0,8,120,0,8,56,0,9,208,81,7,17,0,8,104,0,8,40,0,9,176,0,8,8,0,8,136,0,8,72,0,9,240,80,7,4,0,8,84,0,8,20,85,8,227,83,7,43,0,8,116,0,8,52,0,9,200,81,7,13,0,8,100,0,8,
36,0,9,168,0,8,4,0,8,132,0,8,68,0,9,232,80,7,8,0,8,92,0,8,28,0,9,152,84,7,83,0,8,124,0,8,60,0,9,216,82,7,23,0,8,108,0,8,44,0,9,184,0,8,12,0,8,140,0,8,76,0,9,248,80,7,3,0,8,82,0,8,18,85,8,163,83,7,35,0,8,114,0,8,50,0,9,196,81,7,11,0,8,98,0,8,34,0,9,164,0,8,2,0,8,130,0,8,66,0,9,228,80,7,7,0,8,90,0,8,26,0,9,148,84,7,67,0,8,122,0,8,58,0,9,212,82,7,19,0,8,106,0,8,42,0,9,180,0,8,10,0,8,138,0,8,74,0,9,244,80,7,5,0,8,86,0,8,22,192,8,0,83,7,51,0,8,118,0,8,54,0,9,204,81,7,15,0,8,102,0,8,38,0,9,172,0,8,6,0,
8,134,0,8,70,0,9,236,80,7,9,0,8,94,0,8,30,0,9,156,84,7,99,0,8,126,0,8,62,0,9,220,82,7,27,0,8,110,0,8,46,0,9,188,0,8,14,0,8,142,0,8,78,0,9,252,96,7,256,0,8,81,0,8,17,85,8,131,82,7,31,0,8,113,0,8,49,0,9,194,80,7,10,0,8,97,0,8,33,0,9,162,0,8,1,0,8,129,0,8,65,0,9,226,80,7,6,0,8,89,0,8,25,0,9,146,83,7,59,0,8,121,0,8,57,0,9,210,81,7,17,0,8,105,0,8,41,0,9,178,0,8,9,0,8,137,0,8,73,0,9,242,80,7,4,0,8,85,0,8,21,80,8,258,83,7,43,0,8,117,0,8,53,0,9,202,81,7,13,0,8,101,0,8,37,0,9,170,0,8,5,0,8,133,0,8,69,0,9,
234,80,7,8,0,8,93,0,8,29,0,9,154,84,7,83,0,8,125,0,8,61,0,9,218,82,7,23,0,8,109,0,8,45,0,9,186,0,8,13,0,8,141,0,8,77,0,9,250,80,7,3,0,8,83,0,8,19,85,8,195,83,7,35,0,8,115,0,8,51,0,9,198,81,7,11,0,8,99,0,8,35,0,9,166,0,8,3,0,8,131,0,8,67,0,9,230,80,7,7,0,8,91,0,8,27,0,9,150,84,7,67,0,8,123,0,8,59,0,9,214,82,7,19,0,8,107,0,8,43,0,9,182,0,8,11,0,8,139,0,8,75,0,9,246,80,7,5,0,8,87,0,8,23,192,8,0,83,7,51,0,8,119,0,8,55,0,9,206,81,7,15,0,8,103,0,8,39,0,9,174,0,8,7,0,8,135,0,8,71,0,9,238,80,7,9,0,8,95,0,
8,31,0,9,158,84,7,99,0,8,127,0,8,63,0,9,222,82,7,27,0,8,111,0,8,47,0,9,190,0,8,15,0,8,143,0,8,79,0,9,254,96,7,256,0,8,80,0,8,16,84,8,115,82,7,31,0,8,112,0,8,48,0,9,193,80,7,10,0,8,96,0,8,32,0,9,161,0,8,0,0,8,128,0,8,64,0,9,225,80,7,6,0,8,88,0,8,24,0,9,145,83,7,59,0,8,120,0,8,56,0,9,209,81,7,17,0,8,104,0,8,40,0,9,177,0,8,8,0,8,136,0,8,72,0,9,241,80,7,4,0,8,84,0,8,20,85,8,227,83,7,43,0,8,116,0,8,52,0,9,201,81,7,13,0,8,100,0,8,36,0,9,169,0,8,4,0,8,132,0,8,68,0,9,233,80,7,8,0,8,92,0,8,28,0,9,153,84,7,
83,0,8,124,0,8,60,0,9,217,82,7,23,0,8,108,0,8,44,0,9,185,0,8,12,0,8,140,0,8,76,0,9,249,80,7,3,0,8,82,0,8,18,85,8,163,83,7,35,0,8,114,0,8,50,0,9,197,81,7,11,0,8,98,0,8,34,0,9,165,0,8,2,0,8,130,0,8,66,0,9,229,80,7,7,0,8,90,0,8,26,0,9,149,84,7,67,0,8,122,0,8,58,0,9,213,82,7,19,0,8,106,0,8,42,0,9,181,0,8,10,0,8,138,0,8,74,0,9,245,80,7,5,0,8,86,0,8,22,192,8,0,83,7,51,0,8,118,0,8,54,0,9,205,81,7,15,0,8,102,0,8,38,0,9,173,0,8,6,0,8,134,0,8,70,0,9,237,80,7,9,0,8,94,0,8,30,0,9,157,84,7,99,0,8,126,0,8,62,0,
9,221,82,7,27,0,8,110,0,8,46,0,9,189,0,8,14,0,8,142,0,8,78,0,9,253,96,7,256,0,8,81,0,8,17,85,8,131,82,7,31,0,8,113,0,8,49,0,9,195,80,7,10,0,8,97,0,8,33,0,9,163,0,8,1,0,8,129,0,8,65,0,9,227,80,7,6,0,8,89,0,8,25,0,9,147,83,7,59,0,8,121,0,8,57,0,9,211,81,7,17,0,8,105,0,8,41,0,9,179,0,8,9,0,8,137,0,8,73,0,9,243,80,7,4,0,8,85,0,8,21,80,8,258,83,7,43,0,8,117,0,8,53,0,9,203,81,7,13,0,8,101,0,8,37,0,9,171,0,8,5,0,8,133,0,8,69,0,9,235,80,7,8,0,8,93,0,8,29,0,9,155,84,7,83,0,8,125,0,8,61,0,9,219,82,7,23,0,8,
109,0,8,45,0,9,187,0,8,13,0,8,141,0,8,77,0,9,251,80,7,3,0,8,83,0,8,19,85,8,195,83,7,35,0,8,115,0,8,51,0,9,199,81,7,11,0,8,99,0,8,35,0,9,167,0,8,3,0,8,131,0,8,67,0,9,231,80,7,7,0,8,91,0,8,27,0,9,151,84,7,67,0,8,123,0,8,59,0,9,215,82,7,19,0,8,107,0,8,43,0,9,183,0,8,11,0,8,139,0,8,75,0,9,247,80,7,5,0,8,87,0,8,23,192,8,0,83,7,51,0,8,119,0,8,55,0,9,207,81,7,15,0,8,103,0,8,39,0,9,175,0,8,7,0,8,135,0,8,71,0,9,239,80,7,9,0,8,95,0,8,31,0,9,159,84,7,99,0,8,127,0,8,63,0,9,223,82,7,27,0,8,111,0,8,47,0,9,191,
0,8,15,0,8,143,0,8,79,0,9,255],N=[80,5,1,87,5,257,83,5,17,91,5,4097,81,5,5,89,5,1025,85,5,65,93,5,16385,80,5,3,88,5,513,84,5,33,92,5,8193,82,5,9,90,5,2049,86,5,129,192,5,24577,80,5,2,87,5,385,83,5,25,91,5,6145,81,5,7,89,5,1537,85,5,97,93,5,24577,80,5,4,88,5,769,84,5,49,92,5,12289,82,5,13,90,5,3073,86,5,193,192,5,24577],A=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],u=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,112,112],I=[1,2,3,4,5,7,9,
13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577],t=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13];p.prototype.inflateInit=function(d,b){d||(d=a);b&&(b=!1);this.istate=new m;return this.istate.inflateInit(this,b?-d:d)};p.prototype.inflate=function(a){return null==this.istate?-2:this.istate.inflate(this,a)};p.prototype.inflateEnd=function(){if(null==this.istate)return-2;var a=istate.inflateEnd(this);this.istate=null;return a};
p.prototype.inflateSync=function(){return istate.inflateSync(this)};p.prototype.inflateSetDictionary=function(a,b){return istate.inflateSetDictionary(this,a,b)};m.prototype.inflateReset=function(a){if(null==a||null==a.istate)return-2;a.total_in=a.total_out=0;a.msg=null;a.istate.mode=0!=a.istate.nowrap?7:0;a.istate.blocks.reset(a,null);return f};m.prototype.inflateEnd=function(a){null!=this.blocks&&this.blocks.free(a);this.blocks=null;return f};m.prototype.inflateInit=function(a,b){this.blocks=a.msg=
null;nowrap=0;0>b&&(b=-b,nowrap=1);if(8>b||15<b)return this.inflateEnd(a),-2;this.wbits=b;a.istate.blocks=new h(a,0!=a.istate.nowrap?null:this,1<<b);this.inflateReset(a);return f};m.prototype.inflate=function(a,b){var c,e;if(null==a||null==a.istate||null==a.next_in)return-2;b=4==b?q:f;for(c=q;;)switch(a.istate.mode){case 0:if(0==a.avail_in)return c;c=b;a.avail_in--;a.total_in++;if(8!=((a.istate.method=a.next_in[a.next_in_index++])&15)){a.istate.mode=13;a.msg="unknown compression method";a.istate.marker=
5;break}if((a.istate.method>>4)+8>a.istate.wbits){a.istate.mode=13;a.msg="invalid window size";a.istate.marker=5;break}a.istate.mode=1;case 1:if(0==a.avail_in)return c;c=b;a.avail_in--;a.total_in++;e=a.next_in[a.next_in_index++]&255;if(0!=((a.istate.method<<8)+e)%31){a.istate.mode=13;a.msg="incorrect header check";a.istate.marker=5;break}if(0==(e&32)){a.istate.mode=7;break}a.istate.mode=2;case 2:if(0==a.avail_in)return c;c=b;a.avail_in--;a.total_in++;a.istate.need=(a.next_in[a.next_in_index++]&255)<<
24&4278190080;a.istate.mode=3;case 3:if(0==a.avail_in)return c;c=b;a.avail_in--;a.total_in++;a.istate.need+=(a.next_in[a.next_in_index++]&255)<<16&16711680;a.istate.mode=4;case 4:if(0==a.avail_in)return c;c=b;a.avail_in--;a.total_in++;a.istate.need+=(a.next_in[a.next_in_index++]&255)<<8&65280;a.istate.mode=5;case 5:if(0==a.avail_in)return c;a.avail_in--;a.total_in++;a.istate.need+=a.next_in[a.next_in_index++]&255;a.adler=a.istate.need;a.istate.mode=6;return 2;case 6:return a.istate.mode=13,a.msg=
"need dictionary",a.istate.marker=0,-2;case 7:c=a.istate.blocks.proc(a,c);if(-3==c){a.istate.mode=13;a.istate.marker=0;break}c==f&&(c=b);if(c!=g)return c;c=b;a.istate.blocks.reset(a,a.istate.was);if(0!=a.istate.nowrap){a.istate.mode=12;break}a.istate.mode=8;case 8:if(0==a.avail_in)return c;c=b;a.avail_in--;a.total_in++;a.istate.need=(a.next_in[a.next_in_index++]&255)<<24&4278190080;a.istate.mode=9;case 9:if(0==a.avail_in)return c;c=b;a.avail_in--;a.total_in++;a.istate.need+=(a.next_in[a.next_in_index++]&
255)<<16&16711680;a.istate.mode=10;case 10:if(0==a.avail_in)return c;c=b;a.avail_in--;a.total_in++;a.istate.need+=(a.next_in[a.next_in_index++]&255)<<8&65280;a.istate.mode=11;case 11:if(0==a.avail_in)return c;c=b;a.avail_in--;a.total_in++;a.istate.need+=a.next_in[a.next_in_index++]&255;if(a.istate.was[0]!=a.istate.need){a.istate.mode=13;a.msg="incorrect data check";a.istate.marker=5;break}a.istate.mode=12;case 12:return g;case 13:return-3;default:return-2}};m.prototype.inflateSetDictionary=function(a,
b,c){var e=0,g=c;if(null==a||null==a.istate||6!=a.istate.mode)return-2;if(a._adler.adler32(1,b,0,c)!=a.adler)return-3;a.adler=a._adler.adler32(0,null,0,0);g>=1<<a.istate.wbits&&(g=(1<<a.istate.wbits)-1,e=c-g);a.istate.blocks.set_dictionary(b,e,g);a.istate.mode=7;return f};var B=[0,0,255,255];m.prototype.inflateSync=function(a){var b,c,e;if(null==a||null==a.istate)return-2;13!=a.istate.mode&&(a.istate.mode=13,a.istate.marker=0);if(0==(b=a.avail_in))return q;c=a.next_in_index;for(e=a.istate.marker;0!=
b&&4>e;)a.next_in[c]==B[e]?e++:e=0!=a.next_in[c]?0:4-e,c++,b--;a.total_in+=c-a.next_in_index;a.next_in_index=c;a.avail_in=b;a.istate.marker=e;if(4!=e)return-3;b=a.total_in;c=a.total_out;this.inflateReset(a);a.total_in=b;a.total_out=c;a.istate.mode=7;return f};m.prototype.inflateSyncPoint=function(a){return null==a||null==a.istate||null==a.istate.blocks?-2:a.istate.blocks.sync_point()};var C=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];h.prototype.reset=function(a,b){b&&(b[0]=this.check);6==this.mode&&
this.codes.free(a);this.mode=x;this.read=this.write=this.bitb=this.bitk=0;this.checkfn&&(a.adler=this.check=a._adler.adler32(0,null,0,0))};h.prototype.proc=function(a,b){var c,e,h,k,m,p,l;k=a.next_in_index;m=a.avail_in;e=this.bitb;h=this.bitk;p=this.write;for(l=p<this.read?this.read-p-1:this.end-p;;)switch(this.mode){case x:for(;3>h;){if(0!=m)b=f;else return this.bitb=e,this.bitk=h,a.avail_in=m,a.total_in+=k-a.next_in_index,a.next_in_index=k,this.write=p,this.inflate_flush(a,b);m--;e|=(a.next_in[k++]&
255)<<h;h+=8}c=e&7;this.last=c&1;switch(c>>>1){case 0:e>>>=3;h-=3;c=h&7;e>>>=c;h-=c;this.mode=1;break;case 1:var q=new Int32Array(1),r=new Int32Array(1),s=[],t=[];c=r;var u=s,v=t;q[0]=9;c[0]=5;u[0]=S;v[0]=N;this.codes.init(q[0],r[0],s[0],0,t[0],0,a);e>>>=3;h-=3;this.mode=6;break;case 2:e>>>=3;h-=3;this.mode=3;break;case 3:return e>>>=3,h-=3,this.mode=13,a.msg="invalid block type",b=-3,this.bitb=e,this.bitk=h,a.avail_in=m,a.total_in+=k-a.next_in_index,a.next_in_index=k,this.write=p,this.inflate_flush(a,
b)}break;case 1:for(;32>h;){if(0!=m)b=f;else return this.bitb=e,this.bitk=h,a.avail_in=m,a.total_in+=k-a.next_in_index,a.next_in_index=k,this.write=p,this.inflate_flush(a,b);m--;e|=(a.next_in[k++]&255)<<h;h+=8}if((~e>>>16&65535)!=(e&65535))return this.mode=13,a.msg="invalid stored block lengths",b=-3,this.bitb=e,this.bitk=h,a.avail_in=m,a.total_in+=k-a.next_in_index,a.next_in_index=k,this.write=p,this.inflate_flush(a,b);this.left=e&65535;e=h=0;this.mode=0!=this.left?2:0!=this.last?7:x;break;case 2:if(0==
m)return this.bitb=e,this.bitk=h,a.avail_in=m,a.total_in+=k-a.next_in_index,a.next_in_index=k,write=p,this.inflate_flush(a,b);if(0==l&&(p==end&&0!=read&&(p=0,l=p<this.read?this.read-p-1:this.end-p),0==l&&(this.write=p,b=this.inflate_flush(a,b),p=this.write,l=p<this.read?this.read-p-1:this.end-p,p==this.end&&0!=this.read&&(p=0,l=p<this.read?this.read-p-1:this.end-p),0==l)))return this.bitb=e,this.bitk=h,a.avail_in=m,a.total_in+=k-a.next_in_index,a.next_in_index=k,this.write=p,this.inflate_flush(a,
b);b=f;c=this.left;c>m&&(c=m);c>l&&(c=l);y(a.next_in,k,window,p,c);k+=c;m-=c;p+=c;l-=c;if(0!=(this.left-=c))break;this.mode=0!=this.last?7:x;break;case 3:for(;14>h;){if(0!=m)b=f;else return this.bitb=e,this.bitk=h,a.avail_in=m,a.total_in+=k-a.next_in_index,a.next_in_index=k,this.write=p,this.inflate_flush(a,b);m--;e|=(a.next_in[k++]&255)<<h;h+=8}this.table=c=e&16383;if(29<(c&31)||29<(c>>5&31))return this.mode=9,a.msg="too many length or distance symbols",b=-3,this.bitb=e,this.bitk=h,a.avail_in=m,
a.total_in+=k-a.next_in_index,a.next_in_index=k,this.write=p,this.inflate_flush(a,b);c=258+(c&31)+(c>>5&31);if(null==this.blens||this.blens.length<c)this.blens=new Int32Array(c);else for(l=0;l<c;l++)this.blens[l]=0;e>>>=14;h-=14;this.index=0;mode=4;case 4:for(;this.index<4+(this.table>>>10);){for(;3>h;){if(0!=m)b=f;else return this.bitb=e,this.bitk=h,a.avail_in=m,a.total_in+=k-a.next_in_index,a.next_in_index=k,this.write=p,this.inflate_flush(a,b);m--;e|=(a.next_in[k++]&255)<<h;h+=8}this.blens[C[this.index++]]=
e&7;e>>>=3;h-=3}for(;19>this.index;)this.blens[C[this.index++]]=0;this.bb[0]=7;c=this.inftree.inflate_trees_bits(this.blens,this.bb,this.tb,this.hufts,a);if(c!=f)return b=c,-3==b&&(this.blens=null,this.mode=9),this.bitb=e,this.bitk=h,a.avail_in=m,a.total_in+=k-a.next_in_index,a.next_in_index=k,write=p,this.inflate_flush(a,b);this.index=0;this.mode=5;case 5:for(;;){c=this.table;if(!(this.index<258+(c&31)+(c>>5&31)))break;for(c=this.bb[0];h<c;){if(0!=m)b=f;else return this.bitb=e,this.bitk=h,a.avail_in=
m,a.total_in+=k-a.next_in_index,a.next_in_index=k,this.write=p,this.inflate_flush(a,b);m--;e|=(a.next_in[k++]&255)<<h;h+=8}c=this.hufts[3*(this.tb[0]+(e&n[c]))+1];r=this.hufts[3*(this.tb[0]+(e&n[c]))+2];if(16>r)e>>>=c,h-=c,this.blens[this.index++]=r;else{l=18==r?7:r-14;for(q=18==r?11:3;h<c+l;){if(0!=m)b=f;else return this.bitb=e,this.bitk=h,a.avail_in=m,a.total_in+=k-a.next_in_index,a.next_in_index=k,this.write=p,this.inflate_flush(a,b);m--;e|=(a.next_in[k++]&255)<<h;h+=8}e>>>=c;h-=c;q+=e&n[l];e>>>=
l;h-=l;l=this.index;c=this.table;if(l+q>258+(c&31)+(c>>5&31)||16==r&&1>l)return this.blens=null,this.mode=9,a.msg="invalid bit length repeat",b=-3,this.bitb=e,this.bitk=h,a.avail_in=m,a.total_in+=k-a.next_in_index,a.next_in_index=k,this.write=p,this.inflate_flush(a,b);r=16==r?this.blens[l-1]:0;do this.blens[l++]=r;while(0!=--q);this.index=l}}this.tb[0]=-1;q=new Int32Array(1);r=new Int32Array(1);s=new Int32Array(1);t=new Int32Array(1);q[0]=9;r[0]=6;c=this.table;c=this.inftree.inflate_trees_dynamic(257+
(c&31),1+(c>>5&31),this.blens,q,r,s,t,this.hufts,a);if(c!=f)return-3==c&&(this.blens=null,this.mode=13),b=c,this.bitb=e,this.bitk=h,a.avail_in=m,a.total_in+=k-a.next_in_index,a.next_in_index=k,this.write=p,this.inflate_flush(a,b);this.codes.init(q[0],r[0],this.hufts,s[0],this.hufts,t[0],a);this.mode=6;case 6:this.bitb=e;this.bitk=h;a.avail_in=m;a.total_in+=k-a.next_in_index;a.next_in_index=k;this.write=p;if((b=this.codes.proc(this,a,b))!=g)return this.inflate_flush(a,b);b=f;this.codes.free(a);k=a.next_in_index;
m=a.avail_in;e=this.bitb;h=this.bitk;p=this.write;l=p<this.read?this.read-p-1:this.end-p;if(0==this.last){this.mode=x;break}this.mode=7;case 7:this.write=p;b=this.inflate_flush(a,b);p=this.write;if(this.read!=this.write)return this.bitb=e,this.bitk=h,a.avail_in=m,a.total_in+=k-a.next_in_index,a.next_in_index=k,this.write=p,this.inflate_flush(a,b);mode=12;case 8:return b=g,this.bitb=e,this.bitk=h,a.avail_in=m,a.total_in+=k-a.next_in_index,a.next_in_index=k,this.write=p,this.inflate_flush(a,b);case 9:return b=
-3,this.bitb=e,this.bitk=h,a.avail_in=m,a.total_in+=k-a.next_in_index,a.next_in_index=k,this.write=p,this.inflate_flush(a,b);default:return b=-2,this.bitb=e,this.bitk=h,a.avail_in=m,a.total_in+=k-a.next_in_index,a.next_in_index=k,this.write=p,this.inflate_flush(a,b)}};h.prototype.free=function(a){this.reset(a,null);this.hufts=this.window=null};h.prototype.set_dictionary=function(a,b,c){y(a,b,window,0,c);this.read=this.write=c};h.prototype.sync_point=function(){return 1==this.mode};h.prototype.inflate_flush=
function(a,b){var c,e,g;e=a.next_out_index;g=this.read;c=(g<=this.write?this.write:this.end)-g;c>a.avail_out&&(c=a.avail_out);0!=c&&b==q&&(b=f);a.avail_out-=c;a.total_out+=c;null!=this.checkfn&&(a.adler=this.check=a._adler.adler32(this.check,this.window,g,c));y(this.window,g,a.next_out,e,c);e+=c;g+=c;g==this.end&&(g=0,this.write==this.end&&(this.write=0),c=this.write-g,c>a.avail_out&&(c=a.avail_out),0!=c&&b==q&&(b=f),a.avail_out-=c,a.total_out+=c,null!=this.checkfn&&(a.adler=this.check=a._adler.adler32(this.check,
this.window,g,c)),y(this.window,g,a.next_out,e,c),e+=c,g+=c);a.next_out_index=e;this.read=g;return b};k.prototype.init=function(a,b,c,e,f,g,h){this.mode=0;this.lbits=a;this.dbits=b;this.ltree=c;this.ltree_index=e;this.dtree=f;this.dtree_index=g;this.tree=null};k.prototype.proc=function(a,b,c){var e,h,k=0,m=0,p=0,l,q,r,p=b.next_in_index;l=b.avail_in;k=a.bitb;m=a.bitk;q=a.write;for(r=q<a.read?a.read-q-1:a.end-q;;)switch(this.mode){case 0:if(258<=r&&10<=l&&(a.bitb=k,a.bitk=m,b.avail_in=l,b.total_in+=
p-b.next_in_index,b.next_in_index=p,a.write=q,c=this.inflate_fast(this.lbits,this.dbits,this.ltree,this.ltree_index,this.dtree,this.dtree_index,a,b),p=b.next_in_index,l=b.avail_in,k=a.bitb,m=a.bitk,q=a.write,r=q<a.read?a.read-q-1:a.end-q,c!=f)){this.mode=c==g?7:9;break}this.need=this.lbits;this.tree=this.ltree;this.tree_index=this.ltree_index;this.mode=1;case 1:for(e=this.need;m<e;){if(0!=l)c=f;else return a.bitb=k,a.bitk=m,b.avail_in=l,b.total_in+=p-b.next_in_index,b.next_in_index=p,a.write=q,a.inflate_flush(b,
c);l--;k|=(b.next_in[p++]&255)<<m;m+=8}e=3*(this.tree_index+(k&n[e]));k>>>=this.tree[e+1];m-=this.tree[e+1];h=this.tree[e];if(0==h){this.lit=this.tree[e+2];this.mode=6;break}if(0!=(h&16)){this.get=h&15;this.len=this.tree[e+2];this.mode=2;break}if(0==(h&64)){this.need=h;this.tree_index=e/3+this.tree[e+2];break}if(0!=(h&32)){this.mode=7;break}this.mode=9;b.msg="invalid literal/length code";c=-3;a.bitb=k;a.bitk=m;b.avail_in=l;b.total_in+=p-b.next_in_index;b.next_in_index=p;a.write=q;return a.inflate_flush(b,
c);case 2:for(e=this.get;m<e;){if(0!=l)c=f;else return a.bitb=k,a.bitk=m,b.avail_in=l,b.total_in+=p-b.next_in_index,b.next_in_index=p,a.write=q,a.inflate_flush(b,c);l--;k|=(b.next_in[p++]&255)<<m;m+=8}this.len+=k&n[e];k>>=e;m-=e;this.need=this.dbits;this.tree=this.dtree;this.tree_index=this.dtree_index;this.mode=3;case 3:for(e=this.need;m<e;){if(0!=l)c=f;else return a.bitb=k,a.bitk=m,b.avail_in=l,b.total_in+=p-b.next_in_index,b.next_in_index=p,a.write=q,a.inflate_flush(b,c);l--;k|=(b.next_in[p++]&
255)<<m;m+=8}e=3*(this.tree_index+(k&n[e]));k>>=this.tree[e+1];m-=this.tree[e+1];h=this.tree[e];if(0!=(h&16)){this.get=h&15;this.dist=this.tree[e+2];this.mode=4;break}if(0==(h&64)){this.need=h;this.tree_index=e/3+this.tree[e+2];break}this.mode=9;b.msg="invalid distance code";c=-3;a.bitb=k;a.bitk=m;b.avail_in=l;b.total_in+=p-b.next_in_index;b.next_in_index=p;a.write=q;return a.inflate_flush(b,c);case 4:for(e=this.get;m<e;){if(0!=l)c=f;else return a.bitb=k,a.bitk=m,b.avail_in=l,b.total_in+=p-b.next_in_index,
b.next_in_index=p,a.write=q,a.inflate_flush(b,c);l--;k|=(b.next_in[p++]&255)<<m;m+=8}this.dist+=k&n[e];k>>=e;m-=e;this.mode=5;case 5:for(e=q-this.dist;0>e;)e+=a.end;for(;0!=this.len;){if(0==r&&(q==a.end&&0!=a.read&&(q=0,r=q<a.read?a.read-q-1:a.end-q),0==r&&(a.write=q,c=a.inflate_flush(b,c),q=a.write,r=q<a.read?a.read-q-1:a.end-q,q==a.end&&0!=a.read&&(q=0,r=q<a.read?a.read-q-1:a.end-q),0==r)))return a.bitb=k,a.bitk=m,b.avail_in=l,b.total_in+=p-b.next_in_index,b.next_in_index=p,a.write=q,a.inflate_flush(b,
c);a.window[q++]=a.window[e++];r--;e==a.end&&(e=0);this.len--}this.mode=0;break;case 6:if(0==r&&(q==a.end&&0!=a.read&&(q=0,r=q<a.read?a.read-q-1:a.end-q),0==r&&(a.write=q,c=a.inflate_flush(b,c),q=a.write,r=q<a.read?a.read-q-1:a.end-q,q==a.end&&0!=a.read&&(q=0,r=q<a.read?a.read-q-1:a.end-q),0==r)))return a.bitb=k,a.bitk=m,b.avail_in=l,b.total_in+=p-b.next_in_index,b.next_in_index=p,a.write=q,a.inflate_flush(b,c);c=f;a.window[q++]=this.lit;r--;this.mode=0;break;case 7:7<m&&(m-=8,l++,p--);a.write=q;
c=a.inflate_flush(b,c);q=a.write;if(a.read!=a.write)return a.bitb=k,a.bitk=m,b.avail_in=l,b.total_in+=p-b.next_in_index,b.next_in_index=p,a.write=q,a.inflate_flush(b,c);this.mode=8;case 8:return c=g,a.bitb=k,a.bitk=m,b.avail_in=l,b.total_in+=p-b.next_in_index,b.next_in_index=p,a.write=q,a.inflate_flush(b,c);case 9:return c=-3,a.bitb=k,a.bitk=m,b.avail_in=l,b.total_in+=p-b.next_in_index,b.next_in_index=p,a.write=q,a.inflate_flush(b,c);default:return c=-2,a.bitb=k,a.bitk=m,b.avail_in=l,b.total_in+=
p-b.next_in_index,b.next_in_index=p,a.write=q,a.inflate_flush(b,c)}};k.prototype.free=function(a){};k.prototype.inflate_fast=function(a,b,c,e,h,k,m,p){var l,q,r,s,t,u,v,x,B,C,A,E;u=p.next_in_index;v=p.avail_in;s=m.bitb;t=m.bitk;x=m.write;B=x<m.read?m.read-x-1:m.end-x;a=n[a];C=n[b];do{for(;20>t;)v--,s|=(p.next_in[u++]&255)<<t,t+=8;l=s&a;q=c;r=e;E=3*(r+l);if(0==(b=q[E]))s>>=q[E+1],t-=q[E+1],m.window[x++]=q[E+2],B--;else{do{s>>=q[E+1];t-=q[E+1];if(0!=(b&16)){b&=15;A=q[E+2]+(s&n[b]);s>>=b;for(t-=b;15>
t;)v--,s|=(p.next_in[u++]&255)<<t,t+=8;l=s&C;q=h;r=k;E=3*(r+l);b=q[E];do if(s>>=q[E+1],t-=q[E+1],0!=(b&16)){for(b&=15;t<b;)v--,s|=(p.next_in[u++]&255)<<t,t+=8;l=q[E+2]+(s&n[b]);s>>=b;t-=b;B-=A;if(x>=l)l=x-l,m.window[x++]=m.window[l++],m.window[x++]=m.window[l++],A-=2;else{l=x-l;do l+=m.end;while(0>l);b=m.end-l;if(A>b){A-=b;if(0<x-l&&b>x-l){do m.window[x++]=m.window[l++];while(0!=--b)}else y(m.window,l,m.window,x,b),x+=b;l=0}}do m.window[x++]=m.window[l++];while(0!=--A);break}else if(0==(b&64))l+=
q[E+2],l+=s&n[b],E=3*(r+l),b=q[E];else return p.msg="invalid distance code",A=p.avail_in-v,A=t>>3<A?t>>3:A,v+=A,u-=A,t-=A<<3,m.bitb=s,m.bitk=t,p.avail_in=v,p.total_in+=u-p.next_in_index,p.next_in_index=u,m.write=x,-3;while(1);break}if(0==(b&64)){if(l+=q[E+2],l+=s&n[b],E=3*(r+l),0==(b=q[E])){s>>=q[E+1];t-=q[E+1];m.window[x++]=q[E+2];B--;break}}else{if(0!=(b&32))return A=p.avail_in-v,A=t>>3<A?t>>3:A,v+=A,u-=A,t-=A<<3,m.bitb=s,m.bitk=t,p.avail_in=v,p.total_in+=u-p.next_in_index,p.next_in_index=u,m.write=
x,g;p.msg="invalid literal/length code";A=p.avail_in-v;A=t>>3<A?t>>3:A;v+=A;u-=A;t-=A<<3;m.bitb=s;m.bitk=t;p.avail_in=v;p.total_in+=u-p.next_in_index;p.next_in_index=u;m.write=x;return-3}}while(1)}}while(258<=B&&10<=v);A=p.avail_in-v;A=t>>3<A?t>>3:A;u-=A;m.bitb=s;m.bitk=t-(A<<3);p.avail_in=v+A;p.total_in+=u-p.next_in_index;p.next_in_index=u;m.write=x;return f};v.prototype.huft_build=function(a,b,e,g,h,k,m,n,l,p,r){var t,s,u,v,x,A,B,C,E;A=0;s=e;do this.c[a[b+A]]++,A++,s--;while(0!=s);if(this.c[0]==
e)return m[0]=-1,n[0]=0,f;x=n[0];for(u=1;15>=u&&0==this.c[u];u++);v=u;x<u&&(x=u);for(s=15;0!=s&&0==this.c[s];s--);p=s;x>s&&(x=s);n[0]=x;for(n=1<<u;u<s;u++,n<<=1)if(0>(n-=this.c[u]))return-3;if(0>(n-=this.c[s]))return-3;this.c[s]+=n;this.x[1]=u=0;A=1;for(B=2;0!=--s;)this.x[B]=u+=this.c[A],B++,A++;A=s=0;do 0!=(u=a[b+A])&&(this.v[this.x[u]++]=s),A++;while(++s<e);e=this.x[p];A=this.x[0]=s=0;b=-1;C=-x;for(E=B=this.u[0]=0;v<=p;v++)for(a=this.c[v];0!=a--;){for(;v>C+x;){b++;C+=x;E=p-C;E=E>x?x:E;if((t=1<<
(u=v-C))>a+1&&(t-=a+1,B=v,u<E))for(;++u<E&&!((t<<=1)<=this.c[++B]);)t-=this.c[B];E=1<<u;if(this.hn[0]+E>c)return-3;this.u[b]=B=this.hn[0];this.hn[0]+=E;0!=b?(this.x[b]=s,this.r[0]=u,this.r[1]=x,u=s>>>C-x,this.r[2]=B-this.u[b-1]-u,y(this.r,0,l,3*(this.u[b-1]+u),3)):m[0]=B}this.r[1]=v-C;A>=e?this.r[0]=192:r[A]<g?(this.r[0]=256>this.v[A]?0:96,this.r[2]=this.v[A++]):(this.r[0]=k[this.v[A]-g]+16+64,this.r[2]=h[this.v[A++]-g]);t=1<<v-C;for(u=s>>>C;u<E;u+=t)y(this.r,0,l,3*(B+u),3);for(u=1<<v-1;0!=(s&u);u>>>=
1)s^=u;s^=u;for(u=(1<<C)-1;(s&u)!=this.x[b];)b--,C-=x,u=(1<<C)-1}return 0!=n&&1!=p?q:f};v.prototype.inflate_trees_bits=function(a,b,c,e,f){this.initWorkArea(19);this.hn[0]=0;a=this.huft_build(a,0,19,19,null,null,c,b,e,this.hn,this.v);if(-3==a)f.msg="oversubscribed dynamic bit lengths tree";else if(a==q||0==b[0])f.msg="incomplete dynamic bit lengths tree",a=-3;return a};v.prototype.inflate_trees_dynamic=function(a,b,c,e,g,h,k,m,l){this.initWorkArea(288);this.hn[0]=0;h=this.huft_build(c,0,a,257,A,u,
h,e,m,this.hn,this.v);if(h!=f||0==e[0])return-3==h?l.msg="oversubscribed literal/length tree":-4!=h&&(l.msg="incomplete literal/length tree",h=-3),h;this.initWorkArea(288);h=this.huft_build(c,a,b,0,I,t,k,g,m,this.hn,this.v);return h!=f||0==g[0]&&257<a?(-3==h?l.msg="oversubscribed distance tree":h==q?(l.msg="incomplete distance tree",h=-3):-4!=h&&(l.msg="empty distance tree with lengths",h=-3),h):f};v.prototype.initWorkArea=function(a){null==this.hn&&(this.hn=new Int32Array(1),this.v=new Int32Array(a),
this.c=new Int32Array(16),this.r=new Int32Array(3),this.u=new Int32Array(15),this.x=new Int32Array(16));this.v.length<a&&(this.v=new Int32Array(a));for(var b=0;b<a;b++)this.v[b]=0;for(b=0;16>b;b++)this.c[b]=0;for(b=0;3>b;b++)this.r[b]=0;y(this.c,0,this.u,0,15);y(this.c,0,this.x,0,16)};var J="function"===typeof(new Uint8Array(1)).subarray;"undefined"!==typeof s&&(s.exports={inflateBuffer:E,arrayCopy:y})},{}]},{},[17]);
