(function e$$0(u,r,p){function l(g,v){if(!r[g]){if(!u[g]){var z="function"==typeof require&&require;if(!v&&z)return z(g,!0);if(m)return m(g,!0);throw Error("Cannot find module '"+g+"'");}z=r[g]={exports:{}};u[g][0].call(z.exports,function(b){var a=u[g][1][b];return l(a?a:b)},z,z.exports,e$$0,u,r,p)}return r[g].exports}for(var m="function"==typeof require&&require,g=0;g<p.length;g++)l(p[g]);return l})({1:[function(e,u,r){function p(){}function l(c,d,t,q){function C(b){if(!b)return q(null,"Couldn't access BAM");
b=a(b,b.byteLength);b=new Uint8Array(b);var c=g(b,0);if(c!=h)return q(null,"Not a BAM file, magic=0x"+c.toString(16));for(var f=g(b,4),x="",c=0;c<f;++c)x+=String.fromCharCode(b[c+8]);x=g(b,f+8);f+=12;w.chrToIndex={};w.indexToChr=[];for(c=0;c<x;++c){for(var k=g(b,f),d="",s=0;s<k-1;++s)d+=String.fromCharCode(b[f+4+s]);g(b,f+k+4);w.chrToIndex[d]=c;0==d.indexOf("chr")?w.chrToIndex[d.substring(3)]=c:w.chrToIndex["chr"+d]=c;w.indexToChr.push(d);f=f+8+k}if(w.indices)return q(w)}var w=new p;w.data=c;w.bai=
d;w.indexChunks=t;var e=w.indexChunks?w.indexChunks.minBlockIndex:1E9;if(w.indexChunks){c=w.indexChunks.chunks;w.indices=[];for(d=0;d<c.length;d++)w.indices[d]=null;w.data.slice(0,e).fetch(C)}else w.bai.fetch(function(c){var a,f,x;if(c){var d=new Uint8Array(c),h=g(d,0);if(h!=k)c=q(null,"Not a BAI file, magic=0x"+h.toString(16));else{h=g(d,4);w.indices=[];for(var s=8,E=0;E<h;++E){var F=s;a=d;var A=x=F;f=g(a,A);for(var A=A+4,n=0;n<f;++n){g(a,A);var J=g(a,A+4),A=A+(8+16*J)}for(var n=g(a,A),A=A+4,J=1E9,
B=A,I=0;I<n;++I){var t=b(a,B),B=B+8;if(t){a=t.block;0<t.offset&&(a+=65536);a<J&&(J=a);break}}A+=8*n;a=J;x=A-x;s+=x;e=Math.min(a,e);0<f&&(w.indices[E]=new Uint8Array(c,F,s-F))}c=!0}}else c="Couldn't access BAI";!0!==c?q(null,c):w.data.slice(0,e).fetch(C)})}function m(){}if("undefined"!==typeof e){e("./spans");r=e("./bin");var g=r.readInt,y=r.readShort,v=r.readByte,z=r.readFloat;e=e("./lh3utils");var b=e.readVob,a=e.unbgzf,q=e.reg2bins,d=e.Chunk}var h=21840194,k=21578050;e={MULTIPLE_SEGMENTS:1,ALL_SEGMENTS_ALIGN:2,
SEGMENT_UNMAPPED:4,NEXT_SEGMENT_UNMAPPED:8,REVERSE_COMPLEMENT:16,NEXT_REVERSE_COMPLEMENT:32,FIRST_SEGMENT:64,LAST_SEGMENT:128,SECONDARY_ALIGNMENT:256,QC_FAIL:512,DUPLICATE:1024,SUPPLEMENTARY:2048};p.prototype.blocksForRange=function(c,a,k){var h=this.indices[c];if(!h)return[];c=q(a,k);for(var t=[],w=0;w<c.length;++w)t[c[w]]=!0;c=[];for(var e=[],w=g(h,0),K=4,H=0;H<w;++H){var f=g(h,K),x=g(h,K+4),K=K+8;if(t[f])for(var D=0;D<x;++D){var M=b(h,K),s=b(h,K+8);(4681>f?e:c).push(new d(M,s));K+=16}else K+=16*
x}w=g(h,K);t=null;a=Math.min(a>>14,w-1);k=Math.min(k>>14,w-1);for(w=a;w<=k;++w)(a=b(h,K+4+8*w))&&(!t||a.block<t.block||a.offset<t.offset)&&(t=a);h=[];if(null!=t)for(w=0;w<e.length;++w)k=e[w],k.maxv.block>=t.block&&k.maxv.offset>=t.offset&&h.push(k);e=h;h=[];for(w=0;w<e.length;++w)h.push(e[w]);for(w=0;w<c.length;++w)h.push(c[w]);h.sort(function(s,f){var c=s.minv.block-f.minv.block;return 0!=c?c:s.minv.offset-f.minv.offset});c=[];if(0<h.length){e=h[0];for(w=1;w<h.length;++w)k=h[w],k.minv.block==e.maxv.block?
e=new d(e.minv,k.maxv):(c.push(e),e=k);c.push(e)}return c};p.prototype.fetch=function(c,b,k,d,h){function t(){if(D>=H.length)return d(x);if(M){var s=new Uint8Array(M),s=q.readBamRecords(s,H[D].minv.offset,x,b,k,g,h);M=null;++D;return s?d(x):t()}var f=H[D],s=f.minv.block;q.data.slice(s,f.maxv.block+65536-s).fetch(function(s){M=a(s,f.maxv.block-f.minv.block+1);return t()})}var q=this;h=h||{};var g=this.chrToIndex[c],H;if(void 0===g)H=[];else{if(null===this.indices[g]&&this.indexChunks.chunks[g]){var f=
this.indexChunks.chunks[g];return this.bai.slice(f[0],f[1]).fetch(function(s){s=new Uint8Array(s);this.indices[g]=s;return this.fetch(c,b,k,d,h)}.bind(this))}(H=this.blocksForRange(g,b,k))||d(null,"Error in index fetch")}var x=[],D=0,M;t()};var c="=ACxGxxxTxxxxxxN".split(""),t="MIDNSHP=X???????".split("");p.prototype.readBamRecords=function(b,a,k,d,h,q,e){for(;;){var K=g(b,a),K=a+K+4;if(K>=b.length)return k;var H=new m,f=g(b,a+4),x=g(b,a+8),D=g(b,a+12),M=(D&65280)>>8,s=D&255,D=g(b,a+16),E=(D&4294901760)>>
16,F=D&65535,D=g(b,a+20),A=g(b,a+24),n=g(b,a+28);g(b,a+32);H.segment=this.indexToChr[f];H.flag=E;H.pos=x;H.mq=M;e.light&&(H.seqLength=D);if(!e.light){0<=A&&(H.nextSegment=this.indexToChr[A],H.nextPos=n);M="";for(x=0;x<s-1;++x)M+=String.fromCharCode(b[a+36+x]);H.readName=M;a=a+36+s;s="";for(x=0;x<F;++x)M=g(b,a),s=s+(M>>4)+t[M&15],a+=4;H.cigar=s;F="";s=D+1>>1;for(x=0;x<s;++x)M=b[a+x],F+=c[(M&240)>>4],F+=c[M&15];a+=s;H.seq=F;F="";for(x=0;x<D;++x)F+=String.fromCharCode(b[a+x]+33);a+=D;for(H.quals=F;a<
K;){F=String.fromCharCode(b[a],b[a+1]);s=String.fromCharCode(b[a+2]);if("A"==s)s=String.fromCharCode(b[a+3]),a+=4;else if("i"==s||"I"==s)s=g(b,a+3),a+=7;else if("c"==s||"C"==s)s=b[a+3],a+=4;else if("s"==s||"S"==s)s=y(b,a+3),a+=5;else if("f"==s)s=z(b,a+3),a+=7;else if("Z"==s||"H"==s)for(a+=3,s="";x=b[a++],0!=x;)s+=String.fromCharCode(x);else if("B"==s){s=String.fromCharCode(b[a+3]);x=g(b,a+4);if("i"==s||"I"==s||"f"==s)M=4,E="f"==s?z:g;else if("s"==s||"S"==s)M=2,E=y;else if("c"==s||"C"==s)M=1,E=v;else throw"Unknown array type "+
s;a+=8;s=[];for(A=0;A<x;++A)s.push(E(b,a)),a+=M}else throw"Unknown type "+s;H[F]=s}}if(!d||H.pos<=h&&H.pos+D>=d)void 0!==q&&f!=q||k.push(H);if(H.pos>h)return!0;a=K}};"undefined"!==typeof u&&(u.exports={makeBam:l,BAM_MAGIC:h,BAI_MAGIC:k,BamFlags:e})},{"./bin":4,"./lh3utils":23,"./spans":34}],2:[function(e,u,r){function p(b){this.type=b}function l(b,a){this.parser=b;this.sink=a}function m(b,a){this.parser=b;this.sink=a;this.wigState=null}if("undefined"!==typeof e){var g=e("./spans"),y=g.Range,v=g.union,
z=g.intersection,g=e("./sourceadapters").registerParserFactory;u=e("./das");var b=u.DASStylesheet,a=u.DASStyle,q=u.DASGroup,d=e("./utils").shallowCopy}p.prototype.createSession=function(b){return"wig"==this.type?new m(this,b):new l(this,b)};var h=/([^=]+)=(.+)/,k=/\s/,c=/^[0-9]+,[0-9]+,[0-9]+/;l.prototype.parse=function(b){var a=b.split(k);if(!(3>a.length)){var h=parseInt(a[1])+1;b=parseInt(a[2]);b={segment:a[0],min:h,max:b};3<a.length&&"."!==a[3]&&(b.label=a[3]);4<a.length&&(b.score=parseFloat(a[4]));
5<a.length&&(b.orientation=a[5]);if(8<a.length){var g=a[8];c.test(g)&&(b.itemRgb="rgb("+g+")")}if(12<=a.length){var g=parseInt(a[6]),e=parseInt(a[7]),C=parseInt(a[9]),w=a[10].split(",").map(function(f){return parseInt(f)}),m=a[11].split(",").map(function(f){return parseInt(f)});b.type="transcript";var K=new q;K.id=a[3];K.type="transcript";K.notes=[];b.groups=[K];if(12<a.length){var H=K=a[12];13<a.length&&(H=a[13]);a=new q;a.id=K;a.label=H;a.type="gene";b.groups.push(a)}a=null;for(K=0;K<C;++K)H=m[K]+
h,H=new y(H,H+w[K]),a=a?v(a,H):H;m=a.ranges();for(h=0;h<m.length;++h)w=m[h],C=d(b),C.min=w.min(),C.max=w.max(),this.sink(C);if(e>g&&(g="+"==b.orientation?new y(g,e+3):new y(g-3,e),g=z(a,g)))for(b.type="translation",g=g.ranges(),h=e=0;h<g.length;++h)C=h,"-"==b.orientation&&(C=g.length-h-1),w=g[C],C=d(b),C.min=w.min(),C.max=w.max(),b.readframe=e,w=w.max()-w.min(),e=(e+w)%3,this.sink(C)}else this.sink(b)}};l.prototype.flush=function(){};m.prototype.parse=function(a){a=a.split(k);if("fixedStep"==a[0]){this.wigState=
"fixedStep";this.chr=this.pos=this.step=null;for(var b=this.span=1;b<a.length;++b){var c=h.exec(a[b]);c&&("chrom"==c[1]?this.chr=c[2]:"start"==c[1]?this.pos=parseInt(c[2]):"step"==c[1]?this.step=parseInt(c[2]):"span"==c[1]&&(this.span=parseInt(c[2])))}}else if("variableStep"==a[0])for(this.wigState="variableStep",this.chr=null,b=this.span=1;b<a.length;++b)c=h.exec(a[b]),"chrom"==c[1]?this.chr=c[2]:"span"==c[1]&&(this.span=parseInt(c[2]));else this.wigState?"fixedStep"==this.wigState?1==a.length&&
(a=parseFloat(a[0]),a={segment:this.chr,min:this.pos,max:this.pos+this.span-1,score:a},this.pos+=this.step,this.sink(a)):"variableStep"==this.wigState&&2==a.length&&(b=parseInt(a[0]),a=parseFloat(a[1]),a={segment:this.chr,min:b,max:b+this.span-1,score:a},this.sink(a)):4>a.length||(a={segment:a[0],min:parseInt(a[1])+1,max:parseInt(a[2]),score:parseFloat(a[3])},this.sink(a))};m.prototype.flush=function(){};p.prototype.getStyleSheet=function(c){var k=new b;if("wig"==this.type){var d=new a;d.glyph="HISTOGRAM";
d.BGCOLOR="blue";d.HEIGHT=30;k.pushStyle({type:"default"},null,d)}else d=new a,d.glyph="BOX",d.FGCOLOR="black",d.BGCOLOR="blue",d.HEIGHT=8,d.BUMP=!0,d.LABEL=!0,d.ZINDEX=20,k.pushStyle({type:"default"},null,d),d=new a,d.glyph="BOX",d.FGCOLOR="black",d.BGCOLOR="red",d.HEIGHT=10,d.BUMP=!0,d.ZINDEX=20,k.pushStyle({type:"translation"},null,d),d=new a,d.glyph="BOX",d.FGCOLOR="black",d.BGCOLOR="white",d.HEIGHT=10,d.ZINDEX=10,d.BUMP=!0,d.LABEL=!0,k.pushStyle({type:"transcript"},null,d),d=new a,d.glyph="HISTOGRAM",
d.COLOR1="white",d.COLOR2="black",d.HEIGHT=30,k.pushStyle({type:"density"},null,d);return c(k)};g("bed",function(a){return new p(a)});g("wig",function(a){return new p(a)})},{"./das":10,"./sourceadapters":33,"./spans":34,"./utils":47}],3:[function(e,u,r){function p(a,f){return a[f]+a[f+1]*O+a[f+2]*C+a[f+3]*w+a[f+4]*G}function l(){}function m(a,f,b,c){this.bwg=a;this.cirTreeOffset=f;this.cirTreeLength=b;this.isSummary=c}function g(a,f,b){var c=new l;c.data=a;c.name=b;c.data.slice(0,512).salted().fetch(function(a){if(!a)return f(null,
"Couldn't fetch file");var s=new Uint8Array(a),b=new Int16Array(a);a=new Int32Array(a);var k=s[0]+O*s[1]+C*s[2]+w*s[3];k==t?c.type="bigwig":k==Q?c.type="bigbed":k==B||k==N?f(null,"Currently don't support big-endian BBI files"):f(null,"Not a supported format, magic=0x"+k.toString(16));c.version=b[2];c.numZoomLevels=b[3];c.chromTreeOffset=p(s,8);c.unzoomedDataOffset=p(s,16);c.unzoomedIndexOffset=p(s,24);c.fieldCount=b[16];c.definedFieldCount=b[17];c.asOffset=p(s,36);c.totalSummaryOffset=p(s,44);c.uncompressBufSize=
a[13];c.extHeaderOffset=p(s,56);c.zoomLevels=[];for(b=0;b<c.numZoomLevels;++b){var k=a[6*b+16],A=p(s,24*b+72),n=p(s,24*b+80);c.zoomLevels.push({reduction:k,dataOffset:A,indexOffset:n})}c.readChromTree(function(){c.getAutoSQL(function(s){c.schema=s;return f(c)})})})}function y(a,f,b,c,k){this.bbi=a;this.type=f;this.fieldCount=b;this.offset=c;this.field=k}if("undefined"!==typeof e){r=e("./spans");var v=r.Range,z=r.union,b=r.intersection;r=e("./das");var a=r.DASFeature,q=r.DASGroup,d=e("./utils").shallowCopy,
h=e("./bin").readInt;e=e("jszlib");var k=e.inflateBuffer,c=e.arrayCopy}var t=2291137574,B=654086024,Q=2273964779,N=3958540679,O=256,C=65536,w=16777216,G=4294967296,K=/^[0-9]+,[0-9]+,[0-9]+/;l.prototype.readChromTree=function(a){var f=this;this.chromsToIDs={};this.idsToChroms={};this.maxID=0;var b=this.unzoomedDataOffset,b=b+4-(b-this.chromTreeOffset&3);this.data.slice(this.chromTreeOffset,b-this.chromTreeOffset).fetch(function(b){var c=new Uint8Array(b),s=new Int16Array(b),k=(new Int32Array(b))[2];
p(c,16);var d=function(a){var n=c[a],b=s[a/2+1];a+=4;for(var x=0;x<b;++x)if(0==n){a+=k;var I=p(c,a);a+=8;I-=f.chromTreeOffset;d(I)}else{for(var I="",h=0;h<k;++h){var D=c[a++];0!=D&&(I+=String.fromCharCode(D))}h=c[a+3]<<24|c[a+2]<<16|c[a+1]<<8|c[a+0];a+=8;f.chromsToIDs[I]=h;0==I.indexOf("chr")&&(f.chromsToIDs[I.substr(3)]=h);f.idsToChroms[h]=I;f.maxID=Math.max(f.maxID,h)}};d(32);a(f)})};m.prototype.readWigData=function(a,f,b,c){a=this.bwg.chromsToIDs[a];if(void 0===a)return c([]);this.readWigDataById(a,
f,b,c)};m.prototype.readWigDataById=function(a,f,b,c){var k=this;if(this.cirHeader){var s=[],d=0;Date.now();var F=function(s,n,c,k){return(0>a||s==a)&&n<=b&&c>=f},A=function(f,a){k.bwg.instrument&&console.log("level="+a+"; offset="+f+"; time="+(Date.now()|0));d+=f.length;if(1==f.length&&48==f[0]-k.cirTreeOffset&&k.cachedCirRoot)J(k.cachedCirRoot,0,a),--d,0==d&&k.fetchFeatures(F,s,c);else{for(var b=4+32*k.cirBlockSize,A,x=0;x<f.length;++x){var h=new v(f[x],f[x]+b);A=A?z(A,h):h}b=A.ranges();for(A=0;A<
b.length;++A)n(f,b[A],a)}},n=function(f,n,a,b){n.max();n.min();k.bwg.data.slice(n.min(),n.max()-n.min()).fetch(function(b){for(var A=0;A<f.length;++A)n.contains(f[A])&&(J(b,f[A]-n.min(),a),48==f[A]-k.cirTreeOffset&&0==f[A]-n.min()&&(k.cachedCirRoot=b),--d,0==d&&k.fetchFeatures(F,s,c))})},J=function(n,c,k){var d=new Uint8Array(n),F=new Int16Array(n);n=new Int32Array(n);var h=d[c],F=F[c/2+1];c+=4;if(0!=h)for(h=0;h<F;++h){var J=c/4,E=n[J],D=n[J+1],q=n[J+2],J=n[J+3],t=p(d,c+16);k=p(d,c+24);(0>a||E<a||
E==a&&D<=b)&&(0>a||q>a||q==a&&J>=f)&&s.push({offset:t,size:k});c+=32}else{for(var g=[],h=0;h<F;++h)J=c/4,E=n[J],D=n[J+1],q=n[J+2],J=n[J+3],t=p(d,c+16),(0>a||E<a||E==a&&D<=b)&&(0>a||q>a||q==a&&J>=f)&&g.push(t),c+=24;0<g.length&&A(g,k+1)}};A([k.cirTreeOffset+48],1)}else this.bwg.data.slice(this.cirTreeOffset,48).fetch(function(s){k.cirHeader=s;s=new Int32Array(k.cirHeader);k.cirBlockSize=s[1];k.readWigDataById(a,f,b,c)})};m.prototype.fetchFeatures=function(b,f,d){var h=this;f.sort(function(s,f){return(s.offset|
0)-(f.offset|0)});if(0==f.length)d([]);else{var q=[],s=function(s,f,n,b){b||(b={});var c=new a;c._chromId=s;c.segment=h.bwg.idsToChroms[s];c.min=f;c.max=n;c.type="bigwig";for(var k in b)c[k]=b[k];q.push(c)},E=function(){if(0==f.length)Date.now(),d(q);else{var a=f[0];if(a.data)h.parseFeatures(a.data,s,b),f.splice(0,1),E();else{for(var A=a.offset,n=a.size,a=1;a<f.length&&f[a].offset==A+n;)n+=f[a].size,++a;h.bwg.data.slice(A,n).fetch(function(s){for(var a=0,b=0;a<n;){var A=f[b],d;0<h.bwg.uncompressBufSize?
d=k(s,a+2,A.size-2):(d=new Uint8Array(A.size),c(new Uint8Array(s,a,A.size),0,d,0,A.size),d=d.buffer);A.data=d;a+=A.size;++b}E()})}}};E()}};m.prototype.parseFeatures=function(a,f,c){var k=new Uint8Array(a);if(this.isSummary)for(var h=new Int16Array(a),s=new Int32Array(a),E=new Float32Array(a),k=a.byteLength/32,h=0;h<k;++h){a=s[8*h];var F=s[8*h+1],A=s[8*h+2],n=s[8*h+3],J=E[8*h+5],t=E[8*h+6];c(a,F+1,A)&&(n={type:"bigwig",score:t/n,maxScore:J},"bigbed"==this.bwg.type&&(n.type="density"),f(a,F+1,A,n))}else if("bigwig"==
this.bwg.type)if(h=new Int16Array(a),s=new Int32Array(a),E=new Float32Array(a),a=s[0],J=s[1],t=s[3],n=s[4],F=k[20],k=h[11],3==F)for(h=0;h<k;++h){var I=E[h+6],s=J+h*t+1,F=J+h*t+n;c(a,s,F)&&f(a,s,F,{score:I})}else if(2==F)for(h=0;h<k;++h)F=s[2*h+6]+1,A=F+n-1,I=E[2*h+7],c(a,F,A)&&f(a,F,A,{score:I});else if(1==F)for(h=0;h<k;++h)F=s[3*h+6]+1,A=s[3*h+7],I=E[3*h+8],F>A&&(F=A),c(a,F,A)&&f(a,F,A,{score:I});else console.log("Currently not handling bwgType="+F);else if("bigbed"==this.bwg.type)for(h=0,n=this.bwg.definedFieldCount,
J=this.bwg.schema;h<k.length;){a=k[h+3]<<24|k[h+2]<<16|k[h+1]<<8|k[h+0];F=k[h+7]<<24|k[h+6]<<16|k[h+5]<<8|k[h+4];A=k[h+11]<<24|k[h+10]<<16|k[h+9]<<8|k[h+8];h+=12;for(I="";;)if(t=k[h++],0!=t)I+=String.fromCharCode(t);else break;var t={},g;g=0<I.length?I.split("\t"):[];0<g.length&&3<n&&(t.label=g[0]);1<g.length&&4<n&&(I=parseInt(g[1]),isNaN(I)||(t.score=I));2<g.length&&5<n&&(t.orientation=g[2]);5<g.length&&8<n&&(I=g[5],K.test(I)&&(t.itemRgb="rgb("+I+")"));if(g.length>n-3&&J)for(I=n-3;I<g.length;++I)t[J.fields[I+
3].name]=g[I];if(c(a,F+1,A,g))if(12>n)f(a,F+1,A,t);else{var I=g[3]|0,e=g[4]|0,B=g[6]|0,C=g[7].split(","),w=g[8].split(",");t.exonFrames&&(E=t.exonFrames.split(","),t.exonFrames=void 0);t.type="transcript";var m=new q;for(s in t)m[s]=t[s];m.id=g[0];m.segment=this.bwg.idsToChroms[a];m.min=F+1;m.max=A;m.notes=[];t.groups=[m];if(9<g.length){var l=A=t.geneName||g[9];10<g.length&&(l=g[10]);t.geneName2&&(l=t.geneName2);g=d(m);g.id=A;g.label=l;g.type="gene";t.groups.push(g)}A=[];for(g=0;g<B;++g)m=(w[g]|0)+
F,m=new v(m,m+(C[g]|0)),A.push(m);C=z(A);B=C.ranges();for(F=0;F<B.length;++F)A=B[F],f(a,A.min()+1,A.max(),t);if(e>I&&(F="+"==t.orientation?new v(I,e+3):new v(I-3,e),F=b(C,F))){t.type="translation";I=F.ranges();for(C=e=0;I[0].min()>B[C].max();)C++;for(F=0;F<I.length;++F)B=F,"-"==t.orientation&&(B=I.length-F-1),A=I[B],t.readframe=e,E&&(B=parseInt(E[B+C]),"number"===typeof B&&0<=B&&2>=B&&(t.readframe=B,t.readframeExplicit=!0)),B=A.max()-A.min(),e=(e+B)%3,f(a,A.min()+1,A.max(),t)}}}else throw Error("Don't know what to do with "+
this.bwg.type);};m.prototype.getFirstAdjacent=function(a,f,b,c){a=this.bwg.chromsToIDs[a];if(void 0===a)return c([]);this.getFirstAdjacentById(a,f,b,c)};m.prototype.getFirstAdjacentById=function(a,f,b,c){var k=this;if(this.cirHeader){var s=null,d=-1,h=-1,A=0;Date.now();var n=function(s,f){A+=s.length;for(var a=4+32*k.cirBlockSize,n,b=0;b<s.length;++b){var c=new v(s[b],s[b]+a);n=n?z(n,c):c}a=n.ranges();for(n=0;n<a.length;++n)J(s,a[n],f)},J=function(n,d,h,F){d.max();d.min();k.bwg.data.slice(d.min(),
d.max()-d.min()).fetch(function(F){for(var J=0;J<n.length;++J)if(d.contains(n[J])&&(q(F,n[J]-d.min(),h),--A,0==A)){if(!s)return 0<b&&(0!=a||0<f)?k.getFirstAdjacentById(0,0,b,c):0>b&&(a!=k.bwg.maxID||1E9>f)?k.getFirstAdjacentById(k.bwg.maxID,1E9,b,c):c([]);k.fetchFeatures(function(s,n,c,k){return 0>b&&(s<a||c<f)||0<b&&(s>a||n>f)},[s],function(s){for(var f=null,n=-1,a=-1,k=0;k<s.length;++k){var A=s[k],d=A._chromId,h=A.min,F=A.max;if(null==f||0>b&&(d>n||F>a)||0<b&&(d<n||h<a))f=A,a=0>b?F:h,n=d}return null!=
f?c([f]):c([])})}})},q=function(c,A,J){var q=new Uint8Array(c),t=new Int16Array(c);c=new Int32Array(c);var g=q[A],t=t[A/2+1];A+=4;if(0!=g)for(g=0;g<t;++g){var D=A/4,B=c[D],e=c[D+1],C=c[D+2],m=c[D+3],D=p(q,A+16);J=p(q,A+24);(0>b&&(B<a||B==a&&e<=f)||0<b&&(C>a||C==a&&m>=f))&&!/_random/.exec(k.bwg.idsToChroms[B])&&(null==s||0>b&&(C>d||C==d&&m>h)||0<b&&(B<d||B==d&&e<h))&&(s={offset:D,size:J},h=0>b?m:e,d=0>b?C:B);A+=32}else{for(var fa=q=-1,g=0;g<t;++g){D=A/4;B=c[D];e=c[D+1];C=c[D+2];m=c[D+3];D=c[D+4]<<
32|c[D+5];if(0>b&&(B<a||B==a&&e<=f)&&C>=a||0<b&&(C>a||C==a&&m>=f)&&B<=a)if(0>q||m>fa)q=D,fa=0>b?m:e;A+=24}0<=q&&n([q],J+1)}};n([k.cirTreeOffset+48],1)}else this.bwg.data.slice(this.cirTreeOffset,48).fetch(function(s){k.cirHeader=s;s=new Int32Array(k.cirHeader);k.cirBlockSize=s[1];k.getFirstAdjacentById(a,f,b,c)})};l.prototype.readWigData=function(a,f,b,c){this.getUnzoomedView().readWigData(a,f,b,c)};l.prototype.getUnzoomedView=function(){if(!this.unzoomedView){var a=4E3;this.zoomLevels[0]&&(a=this.zoomLevels[0].dataOffset-
this.unzoomedIndexOffset);this.unzoomedView=new m(this,this.unzoomedIndexOffset,a,!1)}return this.unzoomedView};l.prototype.getZoomedView=function(a){a=this.zoomLevels[a];a.view||(a.view=new m(this,a.indexOffset,4E3,!0));return a.view};l.prototype._tsFetch=function(a,f,b,c,k){var s=this;if(a>=this.zoomLevels.length-1){if(this.topLevelReductionCache){for(var d=[],h=this.topLevelReductionCache,A=0;A<h.length;++A)h[A]._chromId==f&&d.push(h[A]);return k(d)}this.getZoomedView(this.zoomLevels.length-1).readWigDataById(-1,
0,3E8,function(n){s.topLevelReductionCache=n;return s._tsFetch(a,f,b,c,k)})}else return(0>a?this.getUnzoomedView():this.getZoomedView(a)).readWigDataById(f,b,c,k)};l.prototype.thresholdSearch=function(a,f,b,c,k){function s(){if(0==h.length)return k(null);h.sort(function(a,s){var f=a.zoom-s.zoom;if(0!=f)return f;f=a.chrOrd-s.chrOrd;return 0!=f?f:a.min-s.min*b});var a=h.splice(0,1)[0];d._tsFetch(a.zoom,a.chr,a.min,a.max,function(n){var A=0<b?0:3E8;a.fromRef&&(A=f);for(var d=0;d<n.length;++d){var q=
n[d],E;E=void 0!=q.maxScore?q.maxScore:q.score;if(0<b){if(E>c)if(0>a.zoom){if(q.min>A)return k(q)}else q.max>A&&h.push({chr:a.chr,chrOrd:a.chrOrd,zoom:a.zoom-2,min:q.min,max:q.max,fromRef:a.fromRef})}else if(E>c)if(0>a.zoom){if(q.max<A)return k(q)}else q.min<A&&h.push({chr:a.chr,chrOrd:a.chrOrd,zoom:a.zoom-2,min:q.min,max:q.max,fromRef:a.fromRef})}s()})}b=0>b?-1:1;var d=this;a=this.chromsToIDs[a];for(var h=[{chrOrd:0,chr:a,zoom:d.zoomLevels.length-4,min:0,max:3E8,fromRef:!0}],A=1;A<=this.maxID+1;++A){var n=
(a+b*A)%(this.maxID+1);0>n&&(n+=this.maxID+1);h.push({chrOrd:A,chr:n,zoom:d.zoomLevels.length-1,min:0,max:3E8})}s()};l.prototype.getAutoSQL=function(a){if(!this.asOffset)return a(null);this.data.slice(this.asOffset,2048).fetch(function(f){var b=new Uint8Array(f);f="";for(var c=0;c<b.length&&0!=b[c];++c)f+=String.fromCharCode(b[c]);var b=/([\w\[\]]+)\s+(\w+)\s*;\s*("([^"]+)")?\s*/g,k=/(\w+)\s+(\w+)\s+("([^"]+)")?\s+\(\s*/.exec(f);if(k){c={declType:k[1],name:k[2],comment:k[4],fields:[]};f=f.substring(k[0]);
for(k=b.exec(f);null!=k;k=b.exec(f))c.fields.push({type:k[1],name:k[2],comment:k[4]});return a(c)}})};l.prototype.getExtraIndices=function(a){var f=this;if(4>this.version||0==this.extHeaderOffset||"bigbed"!=this.type)return a(null);this.data.slice(this.extHeaderOffset,64).fetch(function(b){if(!b)return a(null,"Couldn't fetch extension header");var c=new Uint8Array(b),k=new Int16Array(b);new Int32Array(b);var s=k[1];b=p(c,4);if(0==s)return a(null);f.data.slice(b,20*s).fetch(function(b){if(!b)return a(null,
"Couldn't fetch index info");var c=new Uint8Array(b),k=new Int16Array(b);new Int32Array(b);b=[];for(var n=0;n<s;++n){var d=k[10*n],h=k[10*n+1],x=p(c,20*n+4),d=new y(f,d,h,x,k[10*n+8]);b.push(d)}a(b)})})};y.prototype.lookup=function(a,f){var b=this;this.bbi.data.slice(this.offset,32).fetch(function(c){function k(s){b.bbi.data.slice(s,4+d*(F+A)).fetch(function(s){var n=new Uint8Array(s),c=new Uint16Array(s);new Uint32Array(s);c=c[1];s=4;if(0==n[0]){for(var d=null,q=0;q<c;++q){for(var E="",t=0;t<F;++t){var g=
n[s++];0!=g&&(E+=String.fromCharCode(g))}t=p(n,s);s+=8;if(0>a.localeCompare(E)&&d){k(d);return}d=t}k(d)}else{for(q=0;q<c;++q){E="";for(t=0;t<F;++t)g=n[s++],0!=g&&(E+=String.fromCharCode(g));if(E==a)return c=p(n,s),n=h(n,s+8),b.bbi.getUnzoomedView().fetchFeatures(function(s,n,f,c){if(c&&c.length>b.field-3)return c[b.field-3]==a},[{offset:c,size:n}],f);s+=A}return f([])}})}var s=new Uint8Array(c);new Int16Array(c);c=new Int32Array(c);var d=c[1],F=c[2],A=c[3];p(s,16);k(b.offset+32)})};"undefined"!==
typeof u&&(u.exports={makeBwg:g,BIG_BED_MAGIC:Q,BIG_WIG_MAGIC:t})},{"./bin":4,"./das":10,"./spans":34,"./utils":47,jszlib:63}],4:[function(e,u,r){function p(a){this.blob=a}function l(a,b,d,h){h||("object"===typeof b?(h=b,b=void 0):h={});this.url=a;this.start=b||0;d&&(this.end=d);this.opts=h}function m(a){if(!a)return null;for(var b=new Uint8Array(a.length),d=0;d<b.length;++d)b[d]=a.charCodeAt(d);return b.buffer}function g(a,b){return a[b+7]<<24|a[b+6]<<16|a[b+5]<<8|a[b+4]}function y(a,b){return a[b+
3]<<24|a[b+2]<<16|a[b+1]<<8|a[b]}function v(a,b){return a[b+1]<<8|a[b]}function z(a,b){return a[b]}function b(a,b){return a[b]<<24|a[b+1]<<16|a[b+2]<<8|a[b+3]}if("undefined"!==typeof e)var a=e("./utils").shallowCopy,q=e("./sha1").b64_sha1;p.prototype.slice=function(a,b){var d;d=this.blob.slice?b?this.blob.slice(a,a+b):this.blob.slice(a):b?this.blob.webkitSlice(a,a+b):this.blob.webkitSlice(a);return new p(d)};p.prototype.salted=function(){return this};p.prototype.fetch="undefined"!==typeof FileReader?
function(a){var b=new FileReader;b.onloadend=function(d){a(m(b.result))};b.readAsBinaryString(this.blob)}:function(a){var b=new FileReaderSync;try{var d=b.readAsArrayBuffer(this.blob);a(d)}catch(h){a(null,h)}};l.prototype.slice=function(a,b){if(0>a)throw"Bad slice "+a;var d=this.start,h=this.end,d=d&&a?d+a:a||d;return new l(this.url,d,b&&d?d+b-1:h||b-1,this.opts)};var d=0,h=0<=navigator.userAgent.indexOf("Safari")&&0>navigator.userAgent.indexOf("Chrome");l.prototype.fetchAsText=function(a){var b=
new XMLHttpRequest,g=this.url;if(h||this.opts.salt)g=g+"?salt="+q(""+Date.now()+","+ ++d);b.open("GET",g,!0);if(this.end){if(1E8<this.end-this.start)throw"Monster fetch!";b.setRequestHeader("Range","bytes="+this.start+"-"+this.end)}b.onreadystatechange=function(){if(4==b.readyState)return 200==b.status||206==b.status?a(b.responseText):a(null)};this.opts.credentials&&(b.withCredentials=!0);b.send("")};l.prototype.salted=function(){var b=a(this.opts);b.salt=!0;return new l(this.url,this.start,this.end,
b)};l.prototype.fetch=function(a,b,g){var e=this;b=b||1;if(3<b)return a(null);var v=new XMLHttpRequest,l,p=this.url;if(h||this.opts.salt)p=p+"?salt="+q(""+Date.now()+","+ ++d);v.open("GET",p,!0);v.overrideMimeType("text/plain; charset=x-user-defined");if(this.end){if(1E8<this.end-this.start)throw"Monster fetch!";v.setRequestHeader("Range","bytes="+this.start+"-"+this.end);l=this.end-this.start+1}v.responseType="arraybuffer";v.onreadystatechange=function(){if(4==v.readyState){if(200==v.status||206==
v.status){if(v.response){var d=v.response.byteLength;return!l||l==d||g&&d==g?a(v.response):e.fetch(a,b+1,d)}if(v.mozResponseArrayBuffer)return a(v.mozResponseArrayBuffer);d=v.responseText;return!l||l==d.length||g&&d.length==g?a(m(v.responseText)):e.fetch(a,b+1,d.length)}return e.fetch(a,b+1)}};this.opts.credentials&&(v.withCredentials=!0);v.send("")};(function(a){var b=new ArrayBuffer(8),d=new Uint8Array(b),h=new Float32Array(b);a.readFloat=function(a,b){d[0]=a[b];d[1]=a[b+1];d[2]=a[b+2];d[3]=a[b+
3];return h[0]}})(this);"undefined"!==typeof u&&(u.exports={BlobFetchable:p,URLFetchable:l,readInt:y,readIntBE:b,readInt64:g,readShort:v,readByte:z,readFloat:this.readFloat})},{"./sha1":32,"./utils":47}],5:[function(e,u,r){function p(g){var e="bp";1E9<g?(g/=1E9,e="Gb"):1E6<g?(g/=1E6,e="Mb"):1E3<g&&(g/=1E3,e="kb");return""+Math.round(g)+e}if("undefined"!==typeof e){var l=e("./cbrowser").Browser,m=e("./utils").makeElement,g=e("./numformats").formatLongInt,y=e("./zoomslider");e("./tier-edit");e("./export-config");
e("./export-ui");e("./export-image");e("./svg-export");e("./session")}l.prototype.initUI=function(e,l){this.noSourceCSS||["bootstrap-scoped.css","dalliance-scoped.css","font-awesome.min.css"].forEach(function(a){document.head.appendChild(m("link","",{rel:"stylesheet",href:this.resolveURL("$$css/"+a)}))}.bind(this));var b=this;b.disableDefaultFeaturePopup||this.addFeatureListener(function(a,s,f,c){b.featurePopup(a,s,f,c)});e.classList.add("dalliance");var a=b.toolbar=m("div",null,{className:"btn-toolbar toolbar"}),
q=b.coordSystem.speciesName+" "+b.nameForCoordSystem(b.coordSystem);this.setDocumentTitle&&(document.title=q+" :: dalliance");var d=m("input","",{className:"loc-field"});b.makeTooltip(d,"Enter a genomic location or gene name");var h=m("p","",{className:"loc-status"}),k=m("a",[m("i",null,{className:"fa fa-search-plus"})],{className:"btn"}),c=new y;b.makeTooltip(c,"Highlighted button shows current zoom level, gray button shows inactive zoom level (click or tap SPACE to toggle).");var t=m("a",[m("i",
null,{className:"fa fa-search-minus"})],{className:"btn"}),B=m("a",[m("i",null,{className:"fa fa-eraser"})],{className:"btn"}),Q=m("a",[m("i",null,{className:"fa fa-plus"})],{className:"btn"}),N=m("a",[m("i",null,{className:"fa fa-bookmark"})],{className:"btn"}),O=m("a",[m("i",null,{className:"fa fa-print"})],{className:"btn"});m("a",[m("i",null,{className:"fa fa-refresh"})],{className:"btn"});var C=m("a",[m("i",null,{className:"fa fa-cogs"})],{className:"btn"}),w=m("a",[m("i",null,{className:"fa fa-question"})],
{className:"btn"}),G=m("a",[m("i",null,{className:"fa fa-road"})],{className:"btn"});b.makeTooltip(G,"Configure currently selected track(s) (E)");var K=m("a",[m("i",null,{className:"fa fa-angle-left"})],{className:"btn"},{width:"5px"}),H=m("a",[m("i",null,{className:"fa fa-angle-right"})],{className:"btn pull-right"},{width:"5px"}),f=m("div",null,{className:"btn-group pull-right"});this.noTrackAdder||f.appendChild(Q);this.noTrackEditor||f.appendChild(G);this.noExport||f.appendChild(O);this.noOptions||
f.appendChild(C);this.noHelp||f.appendChild(w);this.setUiMode=function(a){this.uiMode=a;var s={help:w,add:Q,opts:C,"export":O,tier:G},b;for(b in s)b==a?s[b].classList.add("active"):s[b].classList.remove("active")};this.noLeapButtons||a.appendChild(H);f.firstChild&&a.appendChild(f);this.noLeapButtons||a.appendChild(K);this.noTitle||a.appendChild(m("div",m("h4",q,{},{margin:"0px"}),{className:"btn-group title"}));this.noLocationField||a.appendChild(m("div",[d,h],{className:"btn-group loc-group"}));
this.noClearHighlightsButton||a.appendChild(B);this.noZoomSlider||a.appendChild(m("div",[k,m("span",c,{className:"btn"}),t],{className:"btn-group"}));this.toolbarBelow?(e.appendChild(l),e.appendChild(a)):(e.appendChild(a),e.appendChild(l));var x=Math.log10(2),D=Math.log10(5),M=function(a){var s=(a/b.zoomExpt+Math.log(b.zoomBase))/Math.log(10);a=s|0;s-=a;return((0.01>s?a:s<=x+0.01?a+x:s<=D+0.01?a+D:a+1)*Math.log(10)-Math.log(b.zoomBase))*b.zoomExpt},s=function(a){c.addLabel(a,p(Math.exp(a/b.zoomExpt)*
b.zoomBase))};this.addViewListener(function(a,f,k,h,F){d.value=a+":"+g(f)+".."+g(k);c.min=F.min|0;c.max=F.max|0;F.isSnapZooming?(c.value=F.alternate,c.value2=F.current,c.active=2):(c.value=F.current,c.value2=F.alternate,c.active=1);c.removeLabels();a=F.min;F=F.max;f=F-a;s(M(a));s(M(a+1*f/3));s(M(a+2*f/3));s(M(F));b.storeStatus&&b.storeViewStatus();B.style.display=0<b.highlights.length?"inline-block":"none"});this.addTierListener(function(){b.storeStatus&&b.storeTierStatus()});d.addEventListener("keydown",
function(a){40==a.keyCode&&(a.preventDefault(),a.stopPropagation(),b.setSelectedTier(0));if(10==a.keyCode||13==a.keyCode)a.preventDefault(),b.search(d.value,function(a){h.textContent=a?""+a:""})},!1);var E;Q.addEventListener("click",function(a){E&&E.displayed?b.removeAllPopups():E=b.showTrackAdder(a)},!1);b.makeTooltip(Q,"Add a new track from the registry or an indexed file. (A)");k.addEventListener("click",function(a){a.stopPropagation();a.preventDefault();b.zoomStep(-10)},!1);b.makeTooltip(k,"Zoom in (+)");
t.addEventListener("click",function(a){a.stopPropagation();a.preventDefault();b.zoomStep(10)},!1);b.makeTooltip(t,"Zoom out (-)");c.addEventListener("change",function(a){a=2==c.active;a!=b.isSnapZooming&&(b.savedZoom=b.zoomSliderValue-b.zoomMin,b.isSnapZooming=a);a=1==c.active?c.value:c.value2;b.zoomSliderValue=1*a;b.zoom(Math.exp(1*a/b.zoomExpt))},!1);N.addEventListener("click",function(a){a.stopPropagation();a.preventDefault()},!1);b.makeTooltip(N,"Favourite regions");O.addEventListener("click",
function(a){a.stopPropagation();a.preventDefault();b.openExportPanel()},!1);b.makeTooltip(O,"Export publication-quality SVG. (X)");C.addEventListener("click",function(a){a.stopPropagation();a.preventDefault();b.toggleOptsPopup(a)},!1);b.makeTooltip(C,"Configure options.");w.addEventListener("click",function(a){a.stopPropagation();a.preventDefault();b.toggleHelpPopup(a)});b.makeTooltip(w,"Help; Keyboard shortcuts. (H)");G.addEventListener("click",function(a){a.stopPropagation();a.preventDefault();
1==b.selectedTiers.length&&b.openTierPanel(b.tiers[b.selectedTiers[0]])},!1);K.addEventListener("click",function(a){b.leap(b.reverseKeyScrolling?-1:1,!1)},!1);b.makeTooltip(K,function(a){a=b.getSelectedTier();var s;0<=a&&(s=b.tiers[a]);return s&&s.featureSource&&b.sourceAdapterIsCapable(s.featureSource,"quantLeap")&&"number"==typeof s.quantLeapThreshold?'Jump to the next region with a score above the threshold in the selected track "'+(s.config.name||s.dasSource.name)+'"" (ctrl+LEFT)':s&&s.featureSource&&
b.sourceAdapterIsCapable(s.featureSource,"leap")?'Jump to the next feature in the selected track "'+(s.config.name||s.dasSource.name)+'" (ctrl+LEFT)':"Jump left (shift+LEFT)"});H.addEventListener("click",function(a){b.leap(b.reverseKeyScrolling?1:-1,!1)},!1);b.makeTooltip(H,function(a){a=b.getSelectedTier();var s;0<=a&&(s=b.tiers[a]);return s&&s.featureSource&&b.sourceAdapterIsCapable(s.featureSource,"quantLeap")&&"number"==typeof s.quantLeapThreshold?'Jump to the next region with a score above the threshold in the selected track "'+
(s.config.name||s.dasSource.name)+'"" (ctrl+RIGHT)':s&&s.featureSource&&b.sourceAdapterIsCapable(s.featureSource,"leap")?'Jump to the next feature in the selected track "'+(s.config.name||s.dasSource.name)+'" (ctrl+RIGHT)':"Jump right (shift+RIGHT)"});b.addTierSelectionListener(function(){var a=b.getSelectedTier(),s;0<=a&&(s=b.tiers[a]);a=!1;s&&s.featureSource&&(b.sourceAdapterIsCapable(s.featureSource,"quantLeap")&&"number"==typeof s.quantLeapThreshold?a=!0:b.sourceAdapterIsCapable(s.featureSource,
"leap")&&(a=!0));K.firstChild.className=a?"fa fa-angle-double-left":"fa fa-angle-left";H.firstChild.className=a?"fa fa-angle-double-right":"fa fa-angle-right"});B.addEventListener("click",function(a){b.clearHighlights()},!1);b.makeTooltip(B,"Clear highlights (C)");b.addTierSelectionWrapListener(function(a){0>a&&(b.setSelectedTier(null),d.focus())});b.addTierSelectionListener(function(a){"tier"===b.uiMode&&(0==a.length?(b.hideToolPanel(),b.manipulatingTier=null,b.uiMode="none"):(a=b.tiers[a[0]],a!=
b.manipulatingTier&&b.openTierPanel(a)))});var F=function(a){if(65==a.keyCode||97==a.keyCode)a.preventDefault(),a.stopPropagation(),b.showTrackAdder();else if(72==a.keyCode||104==a.keyCode)a.stopPropagation(),a.preventDefault(),b.toggleHelpPopup(a);else if(69==a.keyCode||101==a.keyCode)a.stopPropagation(),a.preventDefault(),1==b.selectedTiers.length&&b.openTierPanel(b.tiers[b.selectedTiers[0]]);else if(88==a.keyCode||120==a.keyCode)a.stopPropagation(),a.preventDefault(),b.openExportPanel();else if(67==
a.keyCode||99==a.keyCode)a.stopPropagation(),a.preventDefault(),b.clearHighlights()};e.addEventListener("focus",function(a){e.addEventListener("keydown",F,!1)},!1);e.addEventListener("blur",function(a){e.removeEventListener("keydown",F,!1)},!1);e.addEventListener("keydown",function(a){27===a.keyCode&&"none"!==b.uiMode&&(a.preventDefault(),a.stopPropagation(),b.setUiMode("none"),b.hideToolPanel(),b.selectedTiers&&0<b.selectedTiers.length&&b.browserHolder.focus())},!1)};l.prototype.showToolPanel=function(g,
e){var b=this;this.activeToolPanel&&this.activeToolPanel.parentElement.removeChild(this.activeToolPanel);var a;a=e?g:m("div",g,{},{overflowY:"auto",width:"100%"});var q=m("div",m("i",null,{className:"fa fa-caret-right"}),{className:"tool-divider"});q.addEventListener("click",function(a){b.hideToolPanel();b.setUiMode("none")},!1);this.makeTooltip(q,"Close tool panel (ESC)");this.activeToolPanel=m("div",[q,a],{className:"tool-holder"});this.svgHolder.appendChild(this.activeToolPanel);this.resizeViewer();
b=this};l.prototype.hideToolPanel=function(){this.activeToolPanel&&this.activeToolPanel.parentElement.removeChild(this.activeToolPanel);this.svgHolder.style.width="100%";this.activeToolPanel=null;this.resizeViewer()};l.prototype.toggleHelpPopup=function(g){"help"===this.uiMode?(this.hideToolPanel(),this.setUiMode("none")):(g=m("iframe",null,{scrolling:"yes",seamless:"seamless",src:this.resolveURL("$$help/index.html"),className:"help-panel"}),this.showToolPanel(g,!1),this.setUiMode("help"))};l.prototype.toggleOptsPopup=
function(g){var e=this;if("opts"===this.uiMode)this.hideToolPanel(),this.setUiMode("none");else{g=m("div",null,{className:"form-horizontal"},{boxSizing:"border-box",MozBoxSizing:"border-box",display:"inline-block",verticalAlign:"top"});var b=m("table");b.cellPadding=5;var a=m("input","",{type:"checkbox",checked:e.reverseScrolling});a.addEventListener("change",function(b){e.reverseScrolling=a.checked;e.storeStatus()},!1);b.appendChild(m("tr",[m("td","Reverse trackpad scrolling",{align:"right"}),m("td",
a)]));var q=m("input","",{type:"checkbox",checked:e.reverseKeyScrolling});q.addEventListener("change",function(a){e.reverseKeyScrolling=q.checked;e.storeStatus()},!1);b.appendChild(m("tr",[m("td","Reverse scrolling buttons and keys",{align:"right"}),m("td",q)]));var d=m("select");d.appendChild(m("option","Left",{value:"left"}));d.appendChild(m("option","Center",{value:"center"}));d.appendChild(m("option","Right",{value:"right"}));d.appendChild(m("option","None",{value:"none"}));d.value=e.rulerLocation;
d.addEventListener("change",function(a){e.rulerLocation=d.value;e.positionRuler();for(a=0;a<e.tiers.length;++a)e.tiers[a].paintQuant();e.storeStatus()},!1);b.appendChild(m("tr",[m("td","Vertical guideline",{align:"right"}),m("td",d)]));var h=m("input","",{type:"checkbox",checked:e.singleBaseHighlight});h.addEventListener("change",function(a){e.singleBaseHighlight=h.checked;e.positionRuler();e.storeStatus()},!1);h.setAttribute("id","singleBaseHightlightButton");b.appendChild(m("tr",[m("td","Display and highlight current genome location",
{align:"right"}),m("td",h)]));g.appendChild(b);b=m("button","Reset browser",{className:"btn"},{marginLeft:"auto",marginRight:"auto",display:"block"});b.addEventListener("click",function(a){e.reset()},!1);g.appendChild(b);this.showToolPanel(g);this.setUiMode("opts")}}},{"./cbrowser":6,"./export-config":13,"./export-image":14,"./export-ui":15,"./numformats":25,"./session":31,"./svg-export":36,"./tier-edit":42,"./utils":47,"./zoomslider":50}],6:[function(e,u,r){function p(a,b,f){this.min=b;this.max=
f;this.chr=a}function l(a){a||(a={});this.prefix="//www.biodalliance.org/release-0.13/";this.sources=[];this.tiers=[];this.tierGroups={};this.featureListeners=[];this.featureHoverListeners=[];this.viewListeners=[];this.regionSelectListeners=[];this.tierListeners=[];this.tierSelectionListeners=[];this.tierSelectionWrapListeners=[];this.cookieKey="browser";this.registry="http://www.dasregistry.org/das/sources";this.chains={};this.pageName="svgHolder";this.maxExtra=2.5;this.minExtra=0.5;this.zoomFactor=
1;this.maxPixelsPerBase=10;this.origin=0;this.targetQuantRes=1;this.featurePanelWidth=750;this.zoomBase=100;this.zoomExpt=30;this.zoomSliderValue=100;this.entryPoints=null;this.currentSeqMax=-1;this.highlights=[];this.selectedTiers=[1];this.maxViewWidth=5E5;this.defaultSubtierMax=100;this.reverseScrolling=!1;this.rulerLocation="center";this.defaultHighlightFill="red";this.defaultHighlightAlpha=0.3;this.singleBaseHighlight=this.exportRuler=this.exportHighlights=!0;this.tierBackgroundColors=["rgb(245,245,245)",
"white"];this.minTierHeight=20;this.noDefaultLabels=!1;this.baseColors={A:"green",C:"blue",G:"orange",T:"red","-":"hotpink"};this.availableSources=new h;this.defaultSources=[];this.mappableSources={};this.hubs=[];this.hubObjects=[];this.sourceCache=new d;this.useFetchWorkers=this.retina=!0;this.maxWorkers=2;this.workerPath="$$worker-all.js";this.assemblyNameUcsc=this.assemblyNamePrimary=!0;this.initListeners=[];if(void 0!==a.viewStart&&"number"!==typeof a.viewStart)throw Error("viewStart must be an integer");
if(void 0!==a.viewEnd&&"number"!==typeof a.viewEnd)throw Error("viewEnd must be an integer");for(var b in a)this[b]=a[b];"string"===typeof a.uiPrefix&&"string"!==typeof a.prefix&&(this.prefix=a.uiPrefix);0===this.prefix.indexOf("//")&&"http:"!==window.location.prototol&&"https:"!==window.location.protocol&&(console.log("WARNING: prefix is set to a protocol-relative URL ("+this.prefix+" when loading from a non-HTTP source"),this.prefix="http:"+this.prefix);if(!this.coordSystem)throw Error("Coordinate system must be configured");
if(void 0===this.chr||void 0===this.viewStart||void 0===this.viewEnd)throw Error("Viewed region (chr:start..end) must be defined");var f=this;"complete"===document.readyState?f.realInit():window.addEventListener("load",function(a){f.realInit()},!1)}function m(a,b,f){if(f)for(var c=0;c<b.length;++c)b[c].mapping=f;a.set(b)}function g(a){return a.uri?a.uri:a.blob?"file:"+a.blob.name:a.bwgBlob?"file:"+a.bwgBlob.name:a.bamBlob?"file:"+a.bamBlob.name:a.twoBitBlob?"file:"+a.twoBitBlob.name:a.bwgURI||a.bamURI||
a.jbURI||a.twoBitURI||"http://www.biodalliance.org/magic/no_uri"}function y(a){return a.stylesheet_uri?a.stylesheet_uri:"sequence"==a.tier_type||a.twoBitURI||a.twoBitBlob?"http://www.biodalliance.org/magic/sequence":g(a)}function v(a,b){if(g(a)!=g(b)||a.mapping!=b.mapping||a.tier_type!=b.tier_type)return!1;if(a.overlay){if(!b.overlay||b.overlay.length!=a.overlay.length)return!1;for(var f=0;f<a.overlay.length;++f)if(!v(a.overlay[f],b.overlay[f]))return!1}else if(b.overlay)return!1;return!0}function z(a,
b){if(g(a)!=g(b)||y(a)!=y(b)||a.mapping!=b.mapping||a.tier_type!=b.tier_type)return!1;if(a.overlay){if(!b.overlay||b.overlay.length!=a.overlay.length)return!1;for(var f=0;f<a.overlay.length;++f)if(!z(a.overlay[f],b.overlay[f]))return!1}else if(b.overlay)return!1;return!0}function b(a,f,c,d){d=d||[];for(var n=a.length-1;0<=n;--n){var k=a[n];if(!k.notSelectable&&k.min()<=f&&k.max()>=f&&(!k.minY||!(c<k.minY()||c>k.maxY()))){k.feature?d.push(k.feature):k.group&&d.push(k.group);if(k.glyphs)return b(k.glyphs,
f,c,d);if(k.glyph)return b([k.glyph],f,c,d);break}}return d}function a(a,b){var f=this;this.tagSeed=0;this.callbacks={};this.browser=a;this.worker=b;this.worker.onmessage=function(a){var b=f.callbacks[a.data.tag];b&&(b(a.data.result,a.data.error),delete f.callbacks[a.data.tag])}}function q(b){var f=b.resolveURL(b.workerPath);0==f.indexOf("//")&&(f="https:"===window.location.prototype?"https:"+f:"http:"+f);var c=new Blob(['importScripts("'+f+'");'],{type:"application/javascript"});return new H(function(f,
n){var d=new Worker(URL.createObjectURL(c));d.onmessage=function(n){"init"===n.data.tag&&(console.log("Worker initialized"),f(new a(b,d)))};d.onerror=function(a){n(a.message)}})}function d(){this.sourcesByURI={}}if("undefined"!==typeof e){r=e("./utils");var h=r.Observed,k=r.makeElement,c=r.removeChildren,t=r.miniJSONify,B=r.shallowCopy,Q=e("./tier").DasTier,N=e("./sha1").hex_sha1,O=e("./thub").connectTrackHub,C=e("./version");r=e("./numformats");var w=r.formatQuantLabel,G=r.formatLongInt,K=e("./chainset").Chainset,
H=e("es6-promise").Promise}l.prototype.resolveURL=function(a){return a.replace("$$",this.prefix)};l.prototype.realInit=function(){var a=this;if(this.wasInitialized)console.log("Attemping to call realInit on an already-initialized Dalliance instance");else{this.wasInitialized=!0;var b=navigator.userAgent||"dummy";0<=b.indexOf("Trident")&&0<=b.indexOf("rv:11")&&(this.disablePinning=!0);this.defaultChr=this.chr;this.defaultStart=this.viewStart;this.defaultEnd=this.viewEnd;this.defaultSources=[];for(b=
0;b<this.sources.length;++b){var f=this.sources[b];f&&this.defaultSources.push(f)}this.restoreStatus&&(this.statusRestored=this.restoreStatus());var d=this;this.browserHolderHolder=document.getElementById(this.pageName);this.browserHolderHolder.classList.add("dalliance-injection-point");this.browserHolder=k("div",null,{className:"dalliance dalliance-root",tabIndex:-1});this.maxHeight?this.browserHolder.style.maxHeight=this.maxHeight+"px":void 0!=this.maxHeight&&(this.browserHolder.style.maxHeight=
null);c(this.browserHolderHolder);this.browserHolderHolder.appendChild(this.browserHolder);this.svgHolder=k("div",null,{className:"main-holder"});this.initUI(this.browserHolder,this.svgHolder);this.pinnedTierHolder=k("div",null,{className:"tier-holder tier-holder-pinned"});this.tierHolder=k("div",this.makeLoader(24),{className:"tier-holder tier-holder-rest"});this.locSingleBase=k("span","",{className:"loc-single-base"});b=k("div",this.locSingleBase,{className:"loc-single-base-holder"});this.addViewListener(function(b,
f,n,c,d,k,h){f=Math.round((h+k)/2);a.locSingleBase.appendChild(document.createTextNode(b+":"+G(f)));a.locSingleBase.removeChild(a.locSingleBase.firstChild)});this.disablePinning?this.tierHolderHolder=this.tierHolder:(this.tierHolderHolder=k("div",[b,this.pinnedTierHolder,this.tierHolder],{className:"tier-holder-holder"}),this.svgHolder.appendChild(this.tierHolderHolder));this.svgHolder.appendChild(this.tierHolderHolder);this.bhtmlRoot=k("div");this.disablePoweredBy||this.bhtmlRoot.appendChild(k("span",
["Powered by ",k("a","Biodalliance",{href:"http://www.biodalliance.org/"})," "+C],{className:"powered-by"}));this.browserHolder.appendChild(this.bhtmlRoot);window.addEventListener("resize",function(a){d.resizeViewer()},!1);this.ruler=k("div",null,{className:"guideline"});this.ruler2=k("div",null,{className:"single-base-guideline"});this.tierHolderHolder.appendChild(this.ruler);this.tierHolderHolder.appendChild(this.ruler2);this.chainConfigs=this.chains||{};this.chains={};for(var n in this.chainConfigs)b=
this.chainConfigs[n],b instanceof K&&console.log('WARNING: Should no longer use "new Chainset" in Biodalliance configurations.'),this.chains[n]=new K(b);if(0<this.maxWorkers){n=[];for(b=0;b<this.maxWorkers;++b)n.push(q(this));n=H.all(n)}else n=H.resolve([]);this.fetchWorkers=null;this.nextWorker=0;n.then(function(a){console.log("Booted "+a.length+" workers");d.fetchWorkers=a},function(a){console.log("Failed to boot workers",a)}).then(function(){if("none"!=window.getComputedStyle(d.browserHolderHolder).display)setTimeout(function(){d.realInit2()},
1);else var a=setInterval(function(){"none"!=window.getComputedStyle(d.browserHolderHolder).display&&(clearInterval(a),d.realInit2())},300)})}};l.prototype.realInit2=function(){var a=this;c(this.tierHolder);c(this.pinnedTierHolder);this.featurePanelWidth=this.tierHolder.getBoundingClientRect().width|0;this.scale=this.featurePanelWidth/(this.viewEnd-this.viewStart);this.zoomMax||(this.zoomMax=this.zoomExpt*Math.log(this.maxViewWidth/this.zoomBase),this.zoomMin=this.zoomExpt*Math.log(this.featurePanelWidth/
this.maxPixelsPerBase/this.zoomBase));this.zoomSliderValue=this.zoomExpt*Math.log((this.viewEnd-this.viewStart+1)/this.zoomBase);this.tierHolderHolder.addEventListener("mousewheel",function(b){b.stopPropagation();b.preventDefault();if(b.wheelDeltaX){var f=b.wheelDeltaX/5;a.reverseScrolling||(f=-f);a.move(f)}b.wheelDeltaY&&(f=b.wheelDeltaY,a.reverseScrolling&&(f=-f),a.tierHolder.scrollTop+=f)},!1);this.tierHolderHolder.addEventListener("MozMousePixelScroll",function(b){b.stopPropagation();b.preventDefault();
1==b.axis?0!=b.detail&&(b=b.detail/4,a.reverseScrolling&&(b=-b),a.move(b)):(b=b.detail,a.reverseScrolling||(b=-b),a.tierHolder.scrollTop+=b)},!1);this.tierHolderHolder.addEventListener("touchstart",function(b){return a.touchStartHandler(b)},!1);this.tierHolderHolder.addEventListener("touchmove",function(b){return a.touchMoveHandler(b)},!1);this.tierHolderHolder.addEventListener("touchend",function(b){return a.touchEndHandler(b)},!1);this.tierHolderHolder.addEventListener("touchcancel",function(b){return a.touchCancelHandler(b)},
!1);var b=function(b){if(13==b.keyCode){var f=!1;for(b=0;b<a.tiers.length;++b){var n=a.tiers[b];n.wantedLayoutHeight&&n.wantedLayoutHeight!=n.layoutHeight&&(n.layoutHeight=n.wantedLayoutHeight,n.clipTier(),f=!0)}f&&a.arrangeTiers()}else if(32==b.keyCode||32==b.charCode)a.isSnapZooming?(a.isSnapZooming=!1,f=(a.savedZoom||20)+a.zoomMin):(a.isSnapZooming=!0,f=(a.savedZoom||0)+a.zoomMin),a.savedZoom=a.zoomSliderValue-a.zoomMin,a.zoomSliderValue=f,a.zoom(Math.exp(1*f/a.zoomExpt)),b.stopPropagation(),b.preventDefault();
else if(85==b.keyCode)"opts"===a.uiMode&&(f=document.getElementById("singleBaseHightlightButton").checked,document.getElementById("singleBaseHightlightButton").checked=!f),a.singleBaseHighlight=!a.singleBaseHighlight,a.positionRuler(),b.stopPropagation(),b.preventDefault();else if(39==b.keyCode)b.stopPropagation(),b.preventDefault(),a.scrollArrowKey(b,-1);else if(37==b.keyCode)b.stopPropagation(),b.preventDefault(),a.scrollArrowKey(b,1);else if(38==b.keyCode||87==b.keyCode)if(b.stopPropagation(),
b.preventDefault(),b.shiftKey)b=a.getSelectedTier(),0>b||(f=a.tiers[b],b=f.forceHeight||f.subtiers[0].height,40<=b&&f.mergeConfig({height:b-10}));else if(b.ctrlKey||b.metaKey){if(b=a.getSelectedTier(),!(0>b)&&(f=a.tiers[b],f.quantLeapThreshold)){var n=f.subtiers[0].height,c=f.subtiers[0].quant;c&&(b=1*c.min,c=1*c.max,n=(c-b)/n,f.mergeConfig({quantLeapThreshold:b+((Math.round((f.quantLeapThreshold-b)/n)|0)+1)*n}),f.notify("Threshold: "+w(f.quantLeapThreshold)))}}else if(b.altKey){if(c=a.selectedTiers.length,
0!=c){b=a.selectedTiers[0];for(var d=!0,f=[],n=0;n<a.selectedTiers.length;++n)f.push(a.tiers[a.selectedTiers[n]]),0<n&&1!=a.selectedTiers[n]-a.selectedTiers[n-1]&&(d=!1);if(!(d&&0>=b)){for(n=a.selectedTiers.length-1;0<=n;--n)a.tiers.splice(a.selectedTiers[n],1);a.selectedTiers.splice(0,c);b=d?b-1:b;for(n=0;n<f.length;++n)a.tiers.splice(b+n,0,f[n]),a.selectedTiers.push(b+n);a.withPreservedSelection(a._ensureTiersGrouped);a.markSelectedTiers();a.notifyTierSelection();a.reorderTiers();a.notifyTier()}}}else if(b=
a.getSelectedTier(),0<b){if(a.setSelectedTier(b-1),b=a.tiers[a.getSelectedTier()],f=b.row.offsetTop,b=f+b.row.offsetHeight,f<a.tierHolder.scrollTop||b>a.tierHolder.scrollTop+a.tierHolder.offsetHeight)a.tierHolder.scrollTop=f}else a.notifyTierSelectionWrap(-1);else if(40==b.keyCode||83==b.keyCode)if(b.stopPropagation(),b.preventDefault(),b.shiftKey)b=a.getSelectedTier(),0>b||(f=a.tiers[b],b=f.forceHeight||f.subtiers[0].height,f.mergeConfig({height:b+10}));else if(b.ctrlKey||b.metaKey){if(b=a.getSelectedTier(),
!(0>b)&&(f=a.tiers[b],f.quantLeapThreshold&&(n=f.subtiers[0].height,c=f.subtiers[0].quant)))b=1*c.min,c=1*c.max,n=(c-b)/n,c=Math.round((f.quantLeapThreshold-b)/n)|0,1<c&&(f.mergeConfig({quantLeapThreshold:b+(c-1)*n}),f.notify("Threshold: "+w(f.quantLeapThreshold)))}else if(b.altKey){if(c=a.selectedTiers.length,0!=c){b=a.selectedTiers[0];for(var k=0,f=[],n=0;n<a.selectedTiers.length;++n)f.push(a.tiers[a.selectedTiers[n]]),0<n&&(k+=a.selectedTiers[n]-a.selectedTiers[n-1]-1);d=0==k;if(!(d&&b+c>=a.tiers.length)){for(n=
a.selectedTiers.length-1;0<=n;--n)a.tiers.splice(a.selectedTiers[n],1);a.selectedTiers.splice(0,c);b=d?b+1:b+k;for(n=0;n<f.length;++n)a.tiers.splice(b+n,0,f[n]),a.selectedTiers.push(b+n);a.withPreservedSelection(function(){a._ensureTiersGrouped(!0)});a.markSelectedTiers();a.notifyTierSelection();a.reorderTiers();a.notifyTier()}}}else{if(b=a.getSelectedTier(),b<a.tiers.length-1&&(a.setSelectedTier(b+1),b=a.tiers[a.getSelectedTier()],f=b.row.offsetTop,b=f+b.row.offsetHeight,f<a.tierHolder.scrollTop||
b>a.tierHolder.scrollTop+a.tierHolder.offsetHeight))a.tierHolder.scrollTop=Math.min(f,b-a.tierHolder.offsetHeight)}else if(187==b.keyCode||61==b.keyCode)b.stopPropagation(),b.preventDefault(),a.zoomStep(-10);else if(189==b.keyCode||173==b.keyCode)b.stopPropagation(),b.preventDefault(),a.zoomStep(10);else if(73==b.keyCode||105==b.keyCode)b.stopPropagation(),b.preventDefault(),b=a.getSelectedTier(),0>b||(n=a.tiers[b],n.infoVisible?(n.infoElement.style.display="none",n.updateHeight(),n.infoVisible=!1):
(n.infoElement.style.display="block",n.updateHeight(),n.infoVisible=!0));else if(84==b.keyCode||116==b.keyCode)if(b.shiftKey)for(b.stopPropagation(),b.preventDefault(),b=0;b<a.tiers.length;++b)n=a.tiers[b],n.dasSource.collapseSuperGroups&&(void 0===f&&(f=!n.bumped),n.mergeConfig({bumped:f}));else b.ctrlKey||b.metaKey||(b.stopPropagation(),b.preventDefault(),b=a.getSelectedTier(),0>b||(n=a.tiers[b],n.dasSource.collapseSuperGroups&&(void 0===f&&(f=!n.bumped),n.mergeConfig({bumped:f}))));else if(77==
b.keyCode||109==b.keyCode)b.stopPropagation(),b.preventDefault(),(b.ctrlKey||b.metaKey)&&1<a.selectedTiers.length&&a.mergeSelectedTiers();else if(68==b.keyCode||100==b.keyCode){if(b.stopPropagation(),b.preventDefault(),b.ctrlKey||b.metaKey)b=a.getSelectedTier(),0>b||a.addTier(a.tiers[b].dasSource)}else if(80==b.keyCode||112==b.keyCode)if(b.ctrlKey||b.metaKey){f=[];for(b=0;b<a.selectedTiers.length;++b)f.push(a.tiers[a.selectedTiers[b]]);for(b=0;b<f.length;++b)f[b].mergeConfig({pinned:!f[b].pinned})}};
this.browserHolder.addEventListener("focus",function(f){a.browserHolder.addEventListener("keydown",b,!1)},!1);this.browserHolder.addEventListener("blur",function(f){a.browserHolder.removeEventListener("keydown",b,!1)},!1);this.hPopupHolder=k("div");this.hPopupHolder.style["font-family"]="helvetica";this.hPopupHolder.style["font-size"]="12pt";this.hPopupHolder.classList.add("dalliance");document.body.appendChild(this.hPopupHolder);for(var f=0;f<this.sources.length;++f){var d=this.sources[f];if(d){var n=
{};this.restoredConfigs&&(n=this.restoredConfigs[f]);d.disabled||this.makeTier(d,n)}}a._ensureTiersGrouped();a.arrangeTiers();a.reorderTiers();a.refresh();a.setSelectedTier(1);a.positionRuler();(f=this.getSequenceSource())&&f.getSeqInfo(this.chr,function(b){a.currentSeqMax=b.length});this.queryRegistry();for(var h in this.chains)this.queryRegistry(h,!0);if(this.hubs)for(h=0;h<this.hubs.length;++h)f=this.hubs[h],"string"==typeof f&&(f={url:f}),function(b){O(b.url,function(f,n){if(n)console.log(n);
else{var c;if(c=b.genome?f.genomes[b.genome]:f.genomes[a.coordSystem.ucscName])b.mapping&&(c.mapping=b.mapping),a.hubObjects.push(c)}},b)}(f);this.fullScreen&&this.setFullScreenHeight();!this.statusRestored&&this.storeStatus&&this.storeStatus();for(h=0;h<this.initListeners.length;++h)try{this.initListeners[h].call(this)}catch(x){console.log(x)}};l.prototype.touchStartHandler=function(a){this.touchOriginX=a.touches[0].pageX;this.touchOriginY=a.touches[0].pageY;2==a.touches.length&&(a=Math.abs(a.touches[0].pageX-
a.touches[1].pageX),this.zooming=!0,this.zoomLastSep=this.zoomInitialSep=a,this.zoomInitialScale=this.scale)};l.prototype.touchMoveHandler=function(a){a.stopPropagation();a.preventDefault();if(1==a.touches.length){var b=a.touches[0].pageX;a=a.touches[0].pageY;this.touchOriginX&&b!=this.touchOriginX&&this.move(b-this.touchOriginX);this.touchOriginY&&a!=this.touchOriginY&&(this.tierHolder.scrollTop-=a-this.touchOriginY);this.touchOriginX=b;this.touchOriginY=a}else if(this.zooming&&2==a.touches.length){b=
Math.abs(a.touches[0].pageX-a.touches[1].pageX);if(b!=this.zoomLastSep){a=(a.touches[0].pageX+a.touches[1].pageX)/2;var f=this.viewStart+a/this.scale|0;this.scale=b/this.zoomInitialSep*this.zoomInitialScale;this.viewStart=f-a/this.scale|0;for(a=0;a<this.tiers.length;++a)this.tiers[a].draw()}this.zoomLastSep=b}};l.prototype.touchEndHandler=function(a){};l.prototype.touchCancelHandler=function(a){};l.prototype.makeTier=function(a,b){try{return this.realMakeTier(a,b)}catch(f){console.log("Error initializing",
a),console.log(f.stack||f)}};l.prototype.realMakeTier=function(a,f){var c=this,d=null;this.tierBackgroundColors&&(d=this.tierBackgroundColors[this.tiers.length%this.tierBackgroundColors.length]);var n=new Q(this,a,f,d);n.oorigin=this.viewStart;var k=!1,h,x,q,g=function(a,f){var d=n.subtiers;if(d){var s=0;for(f-=n.padding;s<d.length&&f>d[s].height&&s<d.length-1;)f=f-d[s].height-n.padding,++s;if(!(s>=d.length))return d=d[s].glyphs,a-=(n.glyphCacheOrigin-c.viewStart)*c.scale,b(d,a,f)}},e=function(a){a.preventDefault();
a.stopPropagation();a=a.clientX;a!=x&&(c.move(a-x,!0),x=a);c.isDragging=!0},t=function(a){window.removeEventListener("mousemove",e,!0);window.removeEventListener("mouseup",t,!0);c.move(a.clientX-x)};n.viewport.addEventListener("mousedown",function(a){c.browserHolder.focus();a.preventDefault();n.row.getBoundingClientRect();a=a.clientX;window.addEventListener("mousemove",e,!0);window.addEventListener("mouseup",t,!0);h=x=a;c.isDragging=!1},!1);n.viewport.addEventListener("mousemove",function(a){var b=
n.row.getBoundingClientRect(),f=a.clientX-b.left,d=a.clientY-b.top,b=g(f,d);n.row.style.cursor=b&&0<b.length?"pointer":"default";q&&clearTimeout(q);k||(q=setTimeout(function(){var b=g(f,d);b&&0<b.length&&c.notifyFeatureHover(a,b[b.length-1],b,n)},1E3))});var D=null;n.viewport.addEventListener("mouseup",function(a){var b=n.row.getBoundingClientRect(),f=a.clientX-b.left,b=a.clientY-b.top,d=g(f,b);d&&0<d.length&&!c.isDragging&&(D?(clearTimeout(D),D=null,c.featureDoubleClick(d,f,b)):D=setTimeout(function(){D=
null;c.notifyFeature(a,d[d.length-1],d,n)},500));if(c.isDragging&&f!=h&&n.sequenceSource){var b=c.viewStart+f/c.scale,s=c.viewStart+h/c.scale;b<s?(f=b|0,b=s|0):(f=s|0,b|=0);c.notifyRegionSelect(c.chr,f,b)}c.isDragging=!1},!1);n.viewport.addEventListener("mouseout",function(a){k=!1});n.removeButton.addEventListener("click",function(a){a.stopPropagation();a.preventDefault();for(a=0;a<c.tiers.length;++a)if(c.tiers[a]===n){c.removeTier({index:a});break}},!1);n.nameButton.addEventListener("click",function(a){a.stopPropagation();
a.preventDefault();if(a.shiftKey){a=-1;for(var b=0;b<c.tiers.length;++b)if(c.tiers[b]===n){a=b;break}0<=a&&(b=c.selectedTiers.indexOf(a),0<=b?c.selectedTiers.splice(b,1):(c.selectedTiers.push(a),c.selectedTiers.sort()),c.markSelectedTiers(),c.notifyTierSelection(),0<c.selectedTiers.length?c.browserHolder.focus():c.notifyTierSelectionWrap(-1))}else{for(b=0;b<c.tiers.length;++b)if(c.tiers[b]===n&&(c.browserHolder.focus(),1!=c.selectedTiers.length||c.selectedTiers[0]!=b)){c.setSelectedTier(b);return}n.infoVisible?
(n.infoElement.style.display="none",n.updateHeight(),n.infoVisible=!1):(n.infoElement.style.display="block",n.updateHeight(),n.infoVisible=!0)}},!1);n.bumpButton.addEventListener("click",function(a){a.stopPropagation();a.preventDefault();var b;n.dasSource.collapseSuperGroups&&(void 0===b&&(b=!n.bumped),n.mergeConfig({bumped:b}))},!1);var B,C,m,w,K,fa=!1,l=function(a){var b=n.label;a.stopPropagation();a.preventDefault();if(!B){C=n.pinned?c.pinnedTierHolder:c.tierHolder;m=C.scrollHeight-C.offsetHeight;
B=b.cloneNode(!0);B.style.cursor="pointer";C.appendChild(B);b.style.visibility="hidden";for(var f=0;f<c.tiers.length;++f)if(c.tiers[f]===n){w=f;break}K=a.clientY}var d=C.getBoundingClientRect();B.style.left=b.getBoundingClientRect().left-d.left+"px";B.style.top=a.clientY-d.top+C.scrollTop-10+"px";b=a.clientY-d.top+C.scrollTop;for(f=0;f<c.tiers.length;++f)if(d=c.tiers[f],!(d.pinned^n.pinned)&&(d=d.row.getBoundingClientRect(),b-=d.bottom-d.top,0>b)){if(f<w&&a.clientY<K||f>w&&a.clientY>K){c.withPreservedSelection(function(){c.tiers.splice(w,
1);c.tiers.splice(f,0,n);c._ensureTiersGrouped(f>w)});for(b=0;b<c.tiers.length;++b)c.tiers[b]==n&&(w=b);K=a.clientY;c.reorderTiers();C.appendChild(B);fa=!0}break}B.offsetTop<C.scrollTop?C.scrollTop-=C.scrollTop-B.offsetTop:B.offsetTop+B.offsetHeight>C.scrollTop+C.offsetHeight&&(C.scrollTop=Math.min(C.scrollTop+(B.offsetTop+B.offsetHeight)-(C.scrollTop+C.offsetHeight),m))},v=function(a){var b=n.label;a.stopPropagation();a.preventDefault();B&&(B.style.cursor="auto",C.removeChild(B),B=null,b.style.visibility=
"visible");document.removeEventListener("mousemove",l,!1);document.removeEventListener("mouseup",v,!1);if(fa){for(a=0;a<c.tiers.length;++a)if(c.tiers[a]==n){c.setSelectedTier(a);break}c.notifyTier()}};n.label.addEventListener("mousedown",function(a){a.stopPropagation();a.preventDefault();fa=!1;document.addEventListener("mousemove",l,!1);document.addEventListener("mouseup",v,!1)},!1);this.tiers.push(n);n.init();n.currentlyHeight=50;this.updateHeight();n.updateLabel();n.featureSource&&n.featureSource.addActivityListener&&
n.featureSource.addActivityListener(function(a){n.loaderButton.style.display=0<a?"inline-block":"none";c.pingActivity()});this.withPreservedSelection(c._ensureTiersGrouped);n._updateFromConfig();this.reorderTiers();return n};l.prototype.reorderTiers=function(){c(this.tierHolder);c(this.pinnedTierHolder);this.disablePinning&&(this.tierHolder.appendChild(this.ruler),this.tierHolder.appendChild(this.ruler2));for(var a=!1,b=[],f=[],d=0;d<this.tiers.length;++d){var n=this.tiers[d];n.pinned&&!this.disablePinning?
(b.push(n),this.pinnedTierHolder.appendChild(this.tiers[d].row),a=!0):(f.push(n),this.tierHolder.appendChild(this.tiers[d].row))}this.withPreservedSelection(function(){this.tiers.splice(0,this.tiers.length);for(var a=0;a<b.length;++a)this.tiers.push(b[a]);for(a=0;a<f.length;++a)this.tiers.push(f[a])});a?this.pinnedTierHolder.classList.add("tier-holder-pinned-full"):this.pinnedTierHolder.classList.remove("tier-holder-pinned-full");this.arrangeTiers()};l.prototype.withPreservedSelection=function(a){for(var b=
[],f=0;f<this.selectedTiers.length;++f)b.push(this.tiers[this.selectedTiers[f]]);a.call(this);this.selectedTiers=[];for(a=0;a<this.tiers.length;++a)0<=b.indexOf(this.tiers[a])&&this.selectedTiers.push(a)};l.prototype.refreshTier=function(a){this.knownSpace&&this.knownSpace.invalidate(a)};l.prototype._ensureTiersGrouped=function(a){for(var b={},f=0;f<this.tiers.length;++f){var c=this.tiers[f];c.dasSource.tierGroup&&pusho(b,c.dasSource.tierGroup,c)}var n=[];a&&this.tiers.reverse();for(f=0;f<this.tiers.length;++f)if(c=
this.tiers[f],c.dasSource.tierGroup){var d=b[c.dasSource.tierGroup];if(d){a&&d.reverse();for(var k=0;k<d.length;++k)n.push(d[k]);b[c.dasSource.tierGroup]=null}}else n.push(c);a&&n.reverse();this.tiers.splice(0,this.tiers.length);for(k=0;k<n.length;++k)this.tiers.push(n[k])};l.prototype.arrangeTiers=function(){for(var a=[],b={},f=0;f<this.tiers.length;++f){var c=this.tiers[f];c.pinned&&(a.push(c),c.dasSource.tierGroup&&pusho(b,c.dasSource.tierGroup,c))}for(f=0;f<this.tiers.length;++f)c=this.tiers[f],
c.pinned||(a.push(c),c.dasSource.tierGroup&&pusho(b,c.dasSource.tierGroup,c));for(var n in b){var c=b[n],d=this.tierGroups[n];d||(d={element:k("div",k("span",n,{className:"tier-group-label"}),{className:"tier-group"})},this.tierGroups[n]=d);d.element.parentNode&&d.element.parentNode.removeChild(d.element);for(var h=c[0].pinned?this.pinnedTierHolder:this.tierHolder,x=1E7,q=0,f=0;f<c.length;++f)var g=c[f].row,x=Math.min(x,g.offsetTop),q=Math.max(q,g.offsetTop+g.offsetHeight);d.element.style.top=x+"px";
d.element.style.left="0px";d.element.style.height=q-x+"px";h.appendChild(d.element)}if(this.tierBackgroundColors)for(f=0;f<a.length;++f)c=a[f],c.setBackground(this.tierBackgroundColors[f%this.tierBackgroundColors.length]),c.label.style.left=c.dasSource.tierGroup?"18px":"2px",c.background=this.tierBackgroundColors[f%this.tierBackgroundColors.length]};l.prototype.refresh=function(){this.notifyLocation();var a=100/this.scale|0,b=1E3/this.scale|0,f=(this.viewStart+this.viewEnd)/2,c=f-this.origin;this.origin=
f;this.scaleAtLastRedraw=this.scale;for(f=0;f<this.tiers.length;++f){var n=c;this.tiers[f].originHaxx&&(n+=this.tiers[f].originHaxx);this.tiers[f].originHaxx=n}c=this.targetQuantRes/this.scale;f=Math.max(1,(this.viewStart|0)-a);a=Math.min((this.viewEnd|0)+a,0<(this.currentSeqMax|0)?this.currentSeqMax|0:1E9);n=Math.max(1,(this.viewStart|0)-b);b=Math.min((this.viewEnd|0)+b,0<(this.currentSeqMax|0)?this.currentSeqMax|0:1E9);if(!this.knownSpace||this.knownSpace.chr!==this.chr){var d=this.getSequenceSource();
this.knownSpace&&this.knownSpace.cancel();this.knownSpace=new D(this.tiers,this.chr,n,b,c,d)}(d=this.knownSpace.bestCacheOverlapping(this.chr,f,a))&&d.min<=f&&d.max>=a?(this.drawnStart=Math.max(d.min,n),this.drawnEnd=Math.min(d.max,b)):(this.drawnStart=n,this.drawnEnd=b);this.knownSpace.viewFeatures(this.chr,this.drawnStart,this.drawnEnd,c);this.drawOverlays();this.positionRuler()};l.prototype.queryRegistry=function(a,b){var f,c;a?(f=this.chains[a].coords,this.mappableSources[a]||(this.mappableSources[a]=
new h),c=this.mappableSources[a]):(f=this.coordSystem,c=this.availableSources);var n=N(t(f));if(b){var d=localStorage["dalliance.registry."+n+".last_queried"];if(d)try{if(m(c,JSON.parse(localStorage["dalliance.registry."+n+".sources"]),a),432E5>(Date.now()|0)-(d|0))return}catch(k){console.log("Bad registry cache: "+k)}}(new M(this.registry)).sources(function(b){for(var d=[],k=0;k<b.length;++k){var h=b[k];if(h.coords&&0!=h.coords.length){var x=h.coords[0];x.taxon==f.taxon&&x.auth==f.auth&&x.version==
f.version&&d.push(h)}}localStorage["dalliance.registry."+n+".sources"]=JSON.stringify(d);localStorage["dalliance.registry."+n+".last_queried"]=""+Date.now();m(c,d,a)},function(a){},f)};l.prototype.move=function(a,b){var f=this.viewEnd-this.viewStart,c=this.viewStart-1*a/this.scale,n=c+f;b||(0<this.currentSeqMax&&n>this.currentSeqMax&&(n=this.currentSeqMax,c=this.viewEnd-f),1>c&&(c=1,n=c+f));this.setLocation(null,c,n,null,b)};l.prototype.zoomStep=function(a){var b=1*this.zoomSliderValue;a=b+a;a<this.zoomMin&&
(a=this.zoomMin);a>this.zoomMax&&(a=this.zoomMax);a!=b&&(this.zoomSliderValue=a,this.zoom(Math.exp(1*a/this.zoomExpt)))};l.prototype.zoom=function(a){this.zoomFactor=a;a=Math.round((this.viewStart+this.viewEnd)/2)|0;this.viewStart=a-this.zoomBase*this.zoomFactor/2;this.viewEnd=a+this.zoomBase*this.zoomFactor/2;0<this.currentSeqMax&&this.viewEnd>this.currentSeqMax+5&&(a=this.viewEnd-this.viewStart+1,this.viewEnd=this.currentSeqMax,this.viewStart=this.viewEnd-a+1);1>this.viewStart&&(a=this.viewEnd-
this.viewStart+1,this.viewStart=1,this.viewEnd=this.viewStart+a-1);this.scale=this.featurePanelWidth/(this.viewEnd-this.viewStart);this.notifyLocation();this.refresh()};l.prototype.spaceCheck=function(a){this.knownSpace&&this.knownSpace.chr===this.chr?(a=100/this.scale|0,((this.drawnStart|0)>Math.max(1,(this.viewStart|0)-a|0)||(this.drawnEnd|0)<Math.min((this.viewEnd|0)+a,0<(this.currentSeqMax|0)?this.currentSeqMax|0:1E9))&&this.refresh()):this.refresh()};l.prototype.resizeViewer=function(a){var b=
this.tierHolder.getBoundingClientRect().width|0;if(0!=b){var f=Math.max(this.featurePanelWidth,300);this.featurePanelWidth=b|0;f!=this.featurePanelWidth&&(this.zoomMax=this.zoomExpt*Math.log(this.maxViewWidth/this.zoomBase),this.zoomMin=this.zoomExpt*Math.log(this.featurePanelWidth/this.maxPixelsPerBase/this.zoomBase),this.zoomSliderValue=this.zoomExpt*Math.log((this.viewEnd-this.viewStart+1)/this.zoomBase),this.viewEnd=this.viewStart+(this.viewEnd-this.viewStart)*this.featurePanelWidth/f,b=this.viewEnd-
this.viewStart+1,0<this.currentSeqMax&&this.viewEnd>this.currentSeqMax&&(this.viewEnd=this.currentSeqMax,this.viewStart=this.viewEnd-b+1),1>this.viewStart&&(this.viewStart=1,this.viewEnd=this.viewStart+b-1),this.positionRuler(),a||this.spaceCheck(),this.notifyLocation());this.fullScreen&&this.setFullScreenHeight()}};l.prototype.setFullScreenHeight=function(){this.browserHolder.style.maxHeight=Math.max(300,window.innerHeight-(document.body.offsetHeight-this.browserHolder.offsetHeight)-20)+"px"};l.prototype.addTier=
function(a){a=B(a);a.disabled=!1;a=this.makeTier(a);this.markSelectedTiers();this.positionRuler();this.notifyTier();return a};l.prototype.removeTier=function(a,b){var f=-1;if("undefined"!==typeof a.index&&0<=a.index&&a.index<this.tiers.length)f=a.index;else for(var c=0;c<this.tiers.length;++c)if(z(a,this.tiers[c].dasSource)){f=c;break}if(0>f)throw"Couldn't find requested tier";this.tiers.splice(f,1);for(var c=[],n=0;n<this.selectedTiers.length;++n){var d=this.selectedTiers[n];d<f?c.push(d):d>f&&c.push(d-
1)}this.selectedTiers=c;this.markSelectedTiers();this.reorderTiers();this.notifyTier()};l.prototype.getSequenceSource=function(){void 0===this._sequenceSource&&(this._sequenceSource=this._getSequenceSource());return this._sequenceSource};l.prototype._getSequenceSource=function(){for(var a=0;a<this.tiers.length;++a)if(this.tiers[a].sequenceSource)return this.tiers[a].sequenceSource;for(a=0;a<this.defaultSources.length;++a){var b=this.defaultSources[a];if(b.provides_entrypoints||"sequence"==b.tier_type||
b.twoBitURI||b.twoBitBlob)return b.twoBitURI||b.twoBitBlob?new f(b):new x(b)}};l.prototype.setLocation=function(a,b,f,c,n){if("number"!==typeof b)throw Error("minimum must be a number (got "+JSON.stringify(b)+")");if("number"!==typeof f)throw Error("maximum must be a number (got "+JSON.stringify(f)+")");c||(c=function(a){if(a)throw a;});var d=this;if((!a||a==this.chr)&&0<this.currentSeqMax)return this._setLocation(null,b,f,null,c,n);var k=this.getSequenceSource();if(!k)return c("Need a sequence source");
k.getSeqInfo(a,function(h){if(h)return d._setLocation(a,b,f,h,c,n);var x;x=0==a.indexOf("chr")?a.substr(3):"chr"+a;k.getSeqInfo(x,function(k){return k?d._setLocation(x,b,f,k,c,n):c("Couldn't find sequence '"+a+"'")})})};l.prototype._setLocation=function(a,b,f,c,n,d){var k=!1;a&&(0==a.indexOf("chr")&&(a=a.substring(3)),this.chr!=a&&(k=!0),this.chr=a,this.currentSeqMax=c.length);b=parseFloat(b);f=parseFloat(f);a=Math.max(10,f-b+1);d||(1>b&&(b=1,f=b+a-1),f>this.currentSeqMax&&(f=this.currentSeqMax,b=
Math.max(1,f-a+1)));this.viewStart=b;this.viewEnd=f;b=Math.max(this.featurePanelWidth,50)/(this.viewEnd-this.viewStart);d=1E-4<Math.abs(b-this.scale);this.scale=b;f=this.zoomSliderValue;this.zoomSliderValue=b=this.zoomExpt*Math.log((this.viewEnd-this.viewStart+1)/this.zoomBase);if(d||k){for(k=0;k<this.tiers.length;++k)this.tiers[k].viewportHolder.style.left="5000px",this.tiers[k].overlay.style.left="5000px";this.refresh();this.savedZoom?(b-=this.zoomMin,f-=this.zoomMin,k=b-this.savedZoom,Math.abs(b-
f)>Math.abs(k)&&(this.isSnapZooming=!this.isSnapZooming,this.savedZoom=f)):(this.isSnapZooming=!1,this.savedZoom=null)}else for(k=0;k<this.tiers.length;++k)this.tiers[k].viewportHolder.style.left=""+((-((this.viewStart-this.tiers[k].norigin)*this.scale)|0)-1E3)+"px",this.tiers[k].drawOverlay();this.notifyLocation();this.spaceCheck();this.instrumentActivity&&(this.activityStartTime=Date.now()|0);return n()};l.prototype.setCenterLocation=function(a,b){var f=(this.viewEnd-this.viewStart)/2;this.setLocation(a,
b-f,b+f)};l.prototype.pingActivity=function(){if(this.instrumentActivity&&this.activityStartTime){for(var a=0,b=0;b<this.tiers.length;++b)"none"!==this.tiers[b].loaderButton.style.display&&++a;0==a&&(a=Date.now()|0,console.log("Loading took "+(a-this.activityStartTime)+"ms"),this.activityStartTime=null)}};l.prototype.addInitListener=function(a){this.initListeners.push(a)};l.prototype.addFeatureListener=function(a,b){this.featureListeners.push(a)};l.prototype.notifyFeature=function(a,b,f,c){for(var n=
0;n<this.featureListeners.length;++n)try{if(this.featureListeners[n](a,b,f,c))break}catch(d){console.log(d.stack)}};l.prototype.addFeatureHoverListener=function(a,b){this.featureHoverListeners.push(a)};l.prototype.notifyFeatureHover=function(a,b,f,c){for(var n=0;n<this.featureHoverListeners.length;++n)try{this.featureHoverListeners[n](a,b,f,c)}catch(d){console.log(d.stack)}};l.prototype.addViewListener=function(a,b){this.viewListeners.push(a)};l.prototype.notifyLocation=function(){var a=Math.max(1,
this.viewStart|0),b=this.viewEnd|0;0<this.currentSeqMax&&b>this.currentSeqMax&&(b=this.currentSeqMax);for(var f=0;f<this.viewListeners.length;++f)try{this.viewListeners[f](this.chr,a,b,this.zoomSliderValue,{current:this.zoomSliderValue,alternate:this.savedZoom+this.zoomMin||this.zoomMin,isSnapZooming:this.isSnapZooming,min:this.zoomMin,max:this.zoomMax},this.viewStart,this.viewEnd)}catch(c){console.log(c.stack)}};l.prototype.addTierListener=function(a){this.tierListeners.push(a)};l.prototype.notifyTier=
function(){for(var a=0;a<this.tierListeners.length;++a)try{this.tierListeners[a]()}catch(b){console.log(b.stack)}};l.prototype.addRegionSelectListener=function(a){this.regionSelectListeners.push(a)};l.prototype.notifyRegionSelect=function(a,b,f){for(var c=0;c<this.regionSelectListeners.length;++c)try{this.regionSelectListeners[c](a,b,f)}catch(n){console.log(n.stack)}};l.prototype.highlightRegion=function(a,b,f){var c=this;if(a==this.chr)return this._highlightRegion(a,b,f);var n=this.getSequenceSource();
if(!n)throw"Need a sequence source";n.getSeqInfo(a,function(d){if(d)return c._highlightRegion(a,b,f);var k;k=0==a.indexOf("chr")?a.substr(3):"chr"+a;n.getSeqInfo(k,function(a){if(a)return c._highlightRegion(k,b,f)})})};l.prototype._highlightRegion=function(a,b,f){for(var c=0;c<this.highlights.length;++c){var n=this.highlights[c];if(n.chr==a&&n.min==b&&n.max==f)return}this.highlights.push(new p(a,b,f));c=this.viewStart-1E3/this.scale;n=this.viewEnd+1E3/this.scale;(a==this.chr||a=="chr"+this.chr)&&
b<n&&f>c&&this.drawOverlays();this.notifyLocation()};l.prototype.clearHighlights=function(){this.highlights=[];this.drawOverlays();this.notifyLocation()};l.prototype.drawOverlays=function(){for(var a=0;a<this.tiers.length;++a)this.tiers[a].drawOverlay()};l.prototype.featuresInRegion=function(a,b,f){var c=[];if(a!==this.chr)return[];for(a=0;a<this.tiers.length;++a)for(var n=this.tiers[a].currentFeatures||[],d=0;d<n.length;++d){var k=n[d];k.min<=f&&k.max>=b&&c.push(k)}return c};l.prototype.getSelectedTier=
function(){return 0<this.selectedTiers.length?this.selectedTiers[0]:-1};l.prototype.setSelectedTier=function(a){this.selectedTiers=null==a?[]:[a];this.markSelectedTiers();this.notifyTierSelection()};l.prototype.markSelectedTiers=function(){for(var a=0;a<this.tiers.length;++a){var b=this.tiers[a].nameButton;0<=this.selectedTiers.indexOf(a)?b.classList.add("active"):b.classList.remove("active")}0<this.selectedTiers.length&&(a=this.browserHolder.offsetTop+this.browserHolder.offsetHeight/2,a>document.body.scrollTop&&
a+100<document.body.scrollTop+window.innerHeight&&this.browserHolder.focus())};l.prototype.addTierSelectionListener=function(a){this.tierSelectionListeners.push(a)};l.prototype.notifyTierSelection=function(){for(var a=0;a<this.tierSelectionListeners.length;++a)try{this.tierSelectionListeners[a](this.selectedTiers)}catch(b){console.log(b.stack)}};l.prototype.addTierSelectionWrapListener=function(a){this.tierSelectionWrapListeners.push(a)};l.prototype.notifyTierSelectionWrap=function(a){for(var b=0;b<
this.tierSelectionWrapListeners.length;++b)try{this.tierSelectionWrapListeners[b](a)}catch(f){console.log(f.stack)}};l.prototype.positionRuler=function(){var a="none",b="",f="";"center"==this.rulerLocation?(a="block",b=""+(this.featurePanelWidth/2|0)+"px"):"left"==this.rulerLocation?(a="block",b="0px"):"right"==this.rulerLocation?(a="block",f="0px"):a="none";this.ruler.style.display=a;this.ruler.style.left=b;this.ruler.style.right=f;this.singleBaseHighlight?(this.ruler2.style.display="block",this.ruler2.style.borderWidth=
"1px",1>this.scale?(this.ruler2.style.width="0px",this.ruler2.style.borderRightWidth="0px"):(this.ruler2.style.width=this.scale+"px",this.ruler2.style.borderRightWidth="1px"),this.locSingleBase.style.visibility="visible",this.locSingleBase.style.left=""+(this.featurePanelWidth/2-this.locSingleBase.offsetWidth/2+this.ruler2.offsetWidth/2|0)+"px"):(this.locSingleBase.style.visibility="hidden",this.ruler2.style.width="1px",this.ruler2.style.borderWidth="0px",this.ruler2.style.display="center"==this.rulerLocation?
"none":"block");this.ruler2.style.left=""+(this.featurePanelWidth/2|0)+"px";for(var c=0;c<this.tiers.length;++c){var n=this.tiers[c],d=n.quantOverlay,k;n.subtiers&&0<n.subtiers.length&&(k=n.subtiers[0].quant);d&&(d.style.display=k?a:"none",d.style.left=b,d.style.right=f)}};l.prototype.featureDoubleClick=function(a,b,f){if(a&&0!=a.length&&(f=a[a.length-1],f.min&&f.max)){var c=((f.min|0)-(this.viewStart|0))*this.scale,n=(f.max-f.min+1)*this.scale;a=((f.min|0)+(f.max|0))/2;10<n&&(b=1*(b-c)/n,0.3>b?a=
f.min|0:0.7<b&&(a=(f.max|0)+1));b=this.viewEnd-this.viewStart;this.setLocation(null,a-b/2,a+b/2)}};l.prototype.zoomForScale=function(a){return 0.2<a?"high":0.01<a?"medium":"low"};l.prototype.zoomForCurrentScale=function(){return this.zoomForScale(this.scale)};l.prototype.updateHeight=function(){for(var a=0,b=0;b<this.tiers.length;++b)a+=this.tiers[b].currentHeight||30;this.ruler.style.height=""+a+"px";this.ruler2.style.height=""+a+"px";this.browserHolder.style.display="block";this.browserHolder.style.display=
"flex"};l.prototype.scrollArrowKey=function(a,b){this.reverseKeyScrolling&&(b=-b);if(a.ctrlKey||a.metaKey){var f=!1;a.shiftKey&&(f=!0);this.leap(b,f)}else if(1<this.scale){var f=(this.viewStart+this.viewEnd)/2,f=f-Math.round(f),c=1;a.shiftKey&&(c*=10);0<b?(c=-c-f,0<f&&(c+=1)):(c-=f,0>f&&(c-=1));this.setLocation(null,this.viewStart+c,this.viewEnd+c)}else this.move(a.shiftKey?100*b:25*b)};l.prototype.leap=function(a,b){var f=this,c=(f.viewStart+f.viewEnd+1)/2|0;0<a&&1>=f.viewStart?c-=1E8:0>a&&f.viewEnd>=
f.currentSeqMax&&(c+=1E8);var n=f.getSelectedTier();0>n||((n=f.tiers[n])&&(n.featureSource&&this.sourceAdapterIsCapable(n.featureSource,"quantLeap")&&"number"==typeof n.quantLeapThreshold||n.featureSource&&this.sourceAdapterIsCapable(n.featureSource,"leap"))?n.findNextFeature(f.chr,c,-a,b,function(n){if(n){var d=n.min,k=n.max;b&&(0<a?d>c+1?k=d:(k++,d=k):k<c-1?(k++,d=k):k=d);var h=f.viewEnd-f.viewStart+1;parseFloat(h/2)==parseInt(h/2)&&h--;d=(d+k-h)/2+1;f.setLocation(n.segment,d,d+h-1)}else alert("no next feature")}):
this.move(100*a))};l.prototype.nameForCoordSystem=function(a){var b=null,f=null;this.assemblyNamePrimary&&(b=""+a.auth,"undefined"!==typeof a.version&&(b+=a.version));this.assemblyNameUcsc&&(f=a.ucscName);return null!=b&&null!=f?b+"/"+f:b||f||"unknown"};l.prototype.makeLoader=function(a){var b=1<window.devicePixelRatio;return 20>(a||16)?k("img",null,{src:this.resolveURL("$$img/spinner_"+(b?16:32)+".gif"),width:"16",height:"16"}):k("img",null,{src:this.resolveURL("$$img/spinner_"+(b?24:48)+".gif"),
width:"24",height:"24"})};l.prototype.getWorker=function(){if(!this.useFetchWorkers||!this.fetchWorkers||0==this.fetchWorkers.length)return null;this.nextWorker>=this.fetchWorkers.length&&(this.nextWorker=0);return this.fetchWorkers[this.nextWorker++]};a.prototype.postCommand=function(a,b,f){var c="x"+ ++this.tagSeed;a.tag=c;this.callbacks[c]=b;this.worker.postMessage(a,f)};if("undefined"!==typeof u){u.exports={Browser:l,sourcesAreEqual:z,sourceDataURI:g};e("./browser-ui");e("./track-adder");e("./feature-popup");
e("./tier-actions");e("./domui");e("./search");u=e("./sourceadapters");var f=u.TwoBitSequenceSource,x=u.DASSequenceSource,D=e("./kspace").KnownSpace,M=e("./das").DASRegistry}d.prototype.get=function(a){var b=this.sourcesByURI[g(a)];if(b)for(var f=0;f<b.configs.length;++f)if(v(b.configs[f],a))return b.sources[f]};d.prototype.put=function(a,b){var f=g(a),c=this.sourcesByURI[f];c||(c={configs:[],sources:[]},this.sourcesByURI[f]=c);c.configs.push(a);c.sources.push(b)}},{"./browser-ui":5,"./chainset":7,
"./das":10,"./domui":11,"./feature-popup":18,"./kspace":22,"./numformats":25,"./search":29,"./sha1":32,"./sourceadapters":33,"./thub":40,"./tier":43,"./tier-actions":41,"./track-adder":44,"./utils":47,"./version":49,"es6-promise":51}],7:[function(e,u,r){function p(a,b,c,k){"string"==typeof a?(this.uri=a,this.srcTag=b,this.destTag=c,this.coords=k):(this.uri=a.uri,this.srcTag=a.srcTag,this.destTag=a.destTag,this.coords=d(a.coords),this.type=a.type,this.credentials=a.credentials);this.chainsBySrc={};
this.chainsByDest={};this.postFetchQueues={};this.fetchedTiles={};this.granularity=1E6;this.chainFetcher="bigbed"==this.type?new m(this.uri,this.credentials):"alias"==this.type?new z(a):new l(this.uri,this.srcTag,this.destTag)}function l(a,c,d){this.source=new b(a);this.srcTag=c;this.destTag=d}function m(a,b){var d=this;this.uri=a;this.credentials=b;this.bwg=new t(function(a,b){c(new k(d.uri,{credentials:d.credentials}),function(c,d){c?a(c):b(d)})});this.bwg.then(function(a,b){b&&console.log(b)})}
function g(a){return parseInt(a)}function y(a){return 0==a.indexOf("chr")?a.substr(3):a}function v(a){var b={srcChr:y(a.srcChrom),srcMin:parseInt(a.srcStart),srcMax:parseInt(a.srcEnd),srcOri:a.srcOri,destChr:y(a.segment),destMin:a.min-1,destMax:a.max,destOri:a.ori,blocks:[]},c=a.srcStarts.split(",").map(g),d=a.destStarts.split(",").map(g);a=a.blockLens.split(",").map(g);for(var k=0;k<c.length;++k)b.blocks.push([c[k],d[k],a[k]]);return b}function z(a){this.conf=a;this.forwardAliases={};a=a.sequenceAliases||
[];for(var b=0;b<a.length;++b){var c=a[b];if(!(2>c.length)){for(var d=[],k=0;k<c.length-1;++k)d.push(c[k]);this.forwardAliases[c[c.length-1]]=d}}}if("undefined"!==typeof e){r=e("./das");var b=r.DASSource,a=r.DASSegment;r=e("./utils");var q=r.pusho,d=r.shallowCopy,h=e("./cigar").parseCigar,k=e("./bin").URLFetchable,c=e("./bigwig").makeBwg,t=e("es6-promise").Promise}p.prototype.exportConfig=function(){return{uri:this.uri,srcTag:this.srcTag,destTag:this.destTag,coords:this.coords,type:this.type,credentials:this.credentials}};
p.prototype.mapPoint=function(a,b){for(var c=this.chainsBySrc[a]||[],d=0;d<c.length;++d){var k=c[d];if(b>=k.srcMin&&b<=k.srcMax){var h;h="-"==k.srcOri?k.srcMax-b:b-k.srcMin;for(var q=k.blocks,g=0;g<q.length;++g){var e=q[g],f=e[0],x=e[1],e=e[2];if(h>=f&&h<=f+e)return c=h-f,{seq:k.destChr,pos:"-"==k.destOri?k.destMax-x-c:c+x+k.destMin,flipped:k.srcOri!=k.destOri}}}}return null};p.prototype.mapSegment=function(a,b,c){a=this.chainsBySrc[a]||[];for(var d=[],k=0;k<a.length;++k){var h=a[k];if(c>=h.srcMin&&
b<=h.srcMax){var q,g;"-"==h.srcOri?(q=h.srcMax-c,g=h.srcMax-b):(q=b-h.srcMin,g=c-h.srcMin);for(var e=h.blocks,f=0;f<e.length;++f){var x=e[f],t=x[0],m=x[1],x=x[2];if(g>=t&&q<=t+x){var s={segment:h.destChr,flipped:"-"==h.srcOri^"-"==h.destOri};"-"==h.destOri?(q>=t?s.max=h.destMax-m-q+t:(s.max=h.destMax-m,s.partialMax=t-q),g<=t+x?s.min=h.destMax-m-g+t:(s.min=h.destMax-m-x,s.partialMin=g-t-x)):(q>=t?s.min=h.destMin+m+q-t:(s.min=h.destMin+m,s.partialMin=t-q),g<=t+x?s.max=h.destMin+m+g-t:(s.max=h.destMin+
m+x,s.partialMax=g-t-x));d.push(s)}}}}return d};p.prototype.unmapPoint=function(a,b){for(var c=this.chainsByDest[a]||[],d=0;d<c.length;++d){var k=c[d];if(b>=k.destMin&&b<=k.destMax){var h;h="-"==k.srcOri?k.destMax-b:b-k.destMin;for(var q=k.blocks,g=0;g<q.length;++g){var t=q[g],f=t[0],x=t[1],t=t[2];if(h>=x&&h<=x+t)return c=h-x,d=c+f+k.srcMin,d="-"==k.destOri?k.srcMax-f-c:c+f+k.srcMin,{seq:k.srcChr,pos:d,flipped:k.srcOri!=k.destOri}}}}return null};p.prototype.sourceBlocksForRange=function(b,c,d,k){for(var h=
this,g=c/this.granularity|0,t=d/this.granularity|0,e=!1,m=g;m<=t;++m){var f=b+"_"+m;2!=this.fetchedTiles[f]&&(e=!0,1!=this.fetchedTiles[f]&&(this.fetchedTiles[f]=1))}if(e)this.postFetchQueues[b]||this.chainFetcher.fetchChains(b,g*this.granularity,(t+1)*this.granularity-1).then(function(a){h.chainsByDest||(h.chainsByDest[b]=[]);for(var f=0;f<a.length;++f){var c=a[f],n=h.chainsBySrc[c.srcChr];if(n){for(var d=!1,k=0;k<n.length;++k){var x=n[k];if(x.srcMin==c.srcMin&&x.srcMax==c.srcMax){d=!0;break}}d||
n.push(c)}else h.chainsBySrc[c.srcChr]=[c];if(n=h.chainsByDest[c.destChr]){d=!1;for(k=0;k<n.length;++k)if(x=n[k],x.destMin==c.destMin&&x.destMax==c.destMax){d=!0;break}d||n.push(c)}else h.chainsByDest[c.destChr]=[c]}for(a=g;a<=t;++a)h.fetchedTiles[b+"_"+a]=2;if(h.postFetchQueues[b]){a=h.postFetchQueues[b];for(f=0;f<a.length;++f)a[f]();h.postFetchQueues[b]=null}}).catch(function(a){console.log(a)}),q(this.postFetchQueues,b,function(){h.sourceBlocksForRange(b,c,d,k)});else{e=[];m=this.chainsByDest[b]||
[];for(f=0;f<m.length;++f){var x=m[f];if(c<=x.destMax&&d>=x.destMin){var D,l;"-"==x.srcOri?(D=x.destMax-d,l=x.destMax-c):(D=c-x.destMin,l=d-x.destMin);for(var s=x.blocks,v=0;v<s.length;++v){var p=s[v],A=p[0],n=p[1],J=p[2];l>=n&&D<=n+J&&(p=Math.max(D,n)-n,n=Math.min(l,n+J)-n,"-"==x.destOri?e.push(new a(x.srcChr,x.srcMax-A-n,x.srcMax-A-p)):e.push(new a(x.srcChr,x.srcMin+p+A,x.srcMin+n+A)))}}}k(e)}};l.prototype.fetchChains=function(a,b,c){var d=this;return new t(function(b,c){d.source.alignments(a,{},
function(a){for(var c=[],k=0;k<a.length;++k)for(var f=a[k],x=0;x<f.blocks.length;++x){for(var g=f.blocks[x],q,s,t=0;t<g.segments.length;++t){var e=g.segments[t],m=f.objects[e.object];m.dbSource===d.srcTag?q=e:m.dbSource===d.destTag&&(s=e)}if(q&&s){for(var g={srcChr:f.objects[q.object].accession,srcMin:q.min|0,srcMax:q.max|0,srcOri:q.strand,destChr:f.objects[s.object].accession,destMin:s.min|0,destMax:s.max|0,destOri:s.strand,blocks:[]},t=h(q.cigar),e=h(s.cigar),n=m=0,J=0,B=0;J<t.length&&B<e.length;)if("M"==
t[J].op&&"M"==e[B].op){var l=Math.min(t[J].cnt,e[B].cnt);g.blocks.push([m,n,l]);t[J].cnt==l?++J:t[J].cnt-=l;e[B].cnt==l?++B:e[B]-=l;m+=l;n+=l}else"I"==t[J].op?n+=t[J++].cnt:"I"==e[B].op&&(m+=e[B++].cnt);c.push(g)}}b(c)})})};m.prototype.fetchChains=function(a,b,c){return this.bwg.then(function(d,k){if(!d)throw Error("No BWG");return new t(function(k,h){d.getUnzoomedView().readWigData(a,b,c,function(a){k(a.map(v))})})})};z.prototype.fetchChains=function(a,b,c){b=[];c=this.forwardAliases[a]||[];for(var d=
0;d<c.length;++d)b.push({srcChr:c[d],srcMin:1,srcMax:1E9,srcOri:"+",destChr:a,destMin:1,destMax:1E9,destOri:"+",blocks:[[1,1,1E9]]});return t.resolve(b)};"undefined"!==typeof u&&(u.exports={Chainset:p})},{"./bigwig":3,"./bin":4,"./cigar":8,"./das":10,"./utils":47,"es6-promise":51}],8:[function(e,u,r){function p(e){for(var g=[],p;null!=(p=l.exec(e));){var v=p[1];0==v.length&&(v=1);g.push({cnt:v|0,op:p[2]})}return g}var l=/([0-9]*)([MIDS])/g;"undefined"!==typeof u&&(u.exports={parseCigar:p})},{}],9:[function(e,
u,r){function p(a,b,d,h){this.red=a|0;this.green=b|0;this.blue=d|0;h&&(this.name=h)}function l(a){a="00"+a.toString(16);return a.substring(a.length-2)}function m(a){var g=v[a];g||((g=z.exec(a))?g=new p("0x"+g[1]|0,"0x"+g[2]|0,"0x"+g[3]|0,a):(g=b.exec(a))?g=new p(g[1]|0,g[2]|0,g[3]|0,a):(console.log("couldn't handle color: "+a),g=v.black),v[a]=g);return g}function g(a,b,d){for(var h=[],k=0;k<d.length;++k)h.push(m(d[k]));d=[];k=0;a:for(;k<a;++k){for(var c=b[0]+1*k/(a-1)*(b[b.length-1]-b[0]),g=0;g<b.length-
1;++g)if(c>=b[g]&&c<=b[g+1]){var c=(c-b[g])/(b[g+1]-b[g]),e=h[g],g=h[g+1],g=(new p(e.red*(1-c)+g.red*c|0,e.green*(1-c)+g.green*c|0,e.blue*(1-c)+g.blue*c|0)).toSvgString();d.push(g);continue a}throw"Bad step";}return d}function y(a,b,d,h){return h?g(a,[0,0.5,1],[b,d,h]):g(a,[0,1],[b,d])}p.prototype.toSvgString=function(){this.name||(this.name="rgb("+this.red+","+this.green+","+this.blue+")");return this.name};p.prototype.toHexString=function(){return"#"+l(this.red)+l(this.green)+l(this.blue)};var v=
{red:new p(255,0,0,"red"),green:new p(0,255,0,"green"),blue:new p(0,0,255,"blue"),yellow:new p(255,255,0,"yellow"),white:new p(255,255,255,"white"),black:new p(0,0,0,"black"),gray:new p(180,180,180,"gray"),grey:new p(180,180,180,"grey"),lightskyblue:new p(135,206,250,"lightskyblue"),lightsalmon:new p(255,160,122,"lightsalmon"),hotpink:new p(255,105,180,"hotpink")},z=/^#([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})$/,b=/rgb\(([0-9]+),([0-9]+),([0-9]+)\)/;"undefined"!==typeof u&&(u.exports={makeColourSteps:g,
makeGradient:y,dasColourForName:m})},{}],10:[function(e,u,r){function p(a,b,f,c){this.name=a;this.start=b;this.end=f;this.description=c}function l(a,b){var f;"string"==typeof a?(this.uri=a,f=b||{}):f=a||{};for(var c in f)"function"!=typeof f[c]&&(this[c]=f[c]);this.coords||(this.coords=[]);this.props||(this.props={});(this.dasBaseURI=this.uri)&&"/"!=this.dasBaseURI.substr(this.uri.length-1)&&(this.dasBaseURI+="/")}function m(){}function g(a,b){return a.taxon==b.taxon&&a.auth==b.auth&&a.version==b.version}
function y(a,b,f,c,d){this.name=a;this.start=b;this.end=f;this.alphabet=c;this.seq=d}function v(){}function z(a){a&&(this.id=a)}function b(a,b){this.desc=a;this.uri=b}function a(a){this.type=a;this.objects={};this.blocks=[]}function q(){this.styles=[]}function d(){}function h(a,b){b=b||{};this.uri=a;this.opts=b}function k(a,b){var f=a.getElementsByTagName(b);if(0<f.length&&f[0].firstChild){f=f[0];if(1==f.childNodes.length)return f.firstChild.nodeValue;for(var c="",d=0;d<f.childNodes.length;++d)c+=
f.childNodes[d].nodeValue;return c}return null}function c(a){for(var c=[],f=a.getElementsByTagName("LINK"),d=0;d<f.length;++d){var k=f[d];k.parentNode==a&&c.push(new b(k.firstChild?k.firstChild.nodeValue:"Unknown",k.getAttribute("href")))}return c}function t(a){var b=[];a=a.getElementsByTagName("NOTE");for(var f=0;f<a.length;++f)a[f].firstChild&&b.push(a[f].firstChild.nodeValue);return b}function B(a,b,f,c){if(window.XDomainRequest){var d=new XDomainRequest;d.onload=function(){var a=new ActiveXObject("Microsoft.XMLDOM");
a.async=!1;a.loadXML(d.responseText);b(a)};d.open("get",a)}else Date.now(),d=new XMLHttpRequest,d.onreadystatechange=function(){4==d.readyState&&(200<=d.status||0==d.status)&&b(d.responseXML,d)},d.open("get",a,!0),f&&(d.withCredentials=!0),c&&d.setRequestHeader("X-DAS-Authorisation",c),d.overrideMimeType("text/xml"),d.setRequestHeader("Accept","application/xml,*/*");d.send("")}function Q(a){a=(""+a).toLowerCase();return"yes"===a||"true"===a}function N(a){if(!a)return!1;a=(""+a).toLowerCase();return"no"!==
a||"false"!==a}function O(a){var b=C(a);b.styles=[];for(var f=0;f<a.styles.length;++f){var c=b.styles[f]=C(a.styles[f]);c._methodRE=c._labelRE=c._typeRE=void 0;c.style=C(c.style);c.style.id=void 0;c.style._gradient=void 0}return b}if("undefined"!==typeof e){r=e("./utils");var C=r.shallowCopy,w=r.pusho,G=e("./color").makeColourSteps}p.prototype.toString=function(){return this.name+":"+this.start+".."+this.end};p.prototype.isBounded=function(){return this.start&&this.end};p.prototype.toDASQuery=function(){var a=
"segment="+this.name;this.start&&this.end&&(a+=":"+this.start+","+this.end);return a};l.prototype.entryPoints=function(a){this.doCrossDomainRequest(this.dasBaseURI+"entry_points",function(b){if(!b)return a([]);var f=[];b=b.getElementsByTagName("SEGMENT");for(var c=0;c<b.length;++c){var d=b[c],k=d.getAttribute("id"),h=d.getAttribute("size"),g;h?(g=1,h|=0):((g=d.getAttribute("start"))&&(g|=0),(h=d.getAttribute("stop"))&&(h|=0));var q=null;d.firstChild&&(q=d.firstChild.nodeValue);f.push(new p(k,g,h,
q))}a(f)})};l.prototype.sequence=function(a,b){var f=this.dasBaseURI+"sequence?"+a.toDASQuery();this.doCrossDomainRequest(f,function(a){if(a){var f=[];a=a.getElementsByTagName("SEQUENCE");for(var c=0;c<a.length;++c){var d=a[c],k=d.getAttribute("id"),h=d.getAttribute("start"),g=d.getAttribute("stop"),n=null;if(d.firstChild)for(var d=d.firstChild.nodeValue,n="",q=0;;){var e=d.indexOf("\n",q);if(0<=e)n+=d.substring(q,e).toUpperCase(),q=e+1;else{n+=d.substring(q).toUpperCase();break}}f.push(new y(k,h,
g,"DNA",n))}b(f)}else b([])})};l.prototype.features=function(a,b,f){b=b||{};var d;if(this.features_uri)d=this.features_uri;else{var h=[];if(a)h.push(a.toDASQuery());else if(b.group)if(a=b.group,"string"==typeof a)h.push("group_id="+a);else for(var g=0;g<a.length;++g)h.push("group_id="+a[g]);if(b.adjacent)for(a=b.adjacent,"string"==typeof a&&(a=[a]),g=0;g<a.length;++g)h.push("adjacent="+a[g]);if(b.type)if("string"==typeof b.type)h.push("type="+b.type);else for(a=0;a<b.type.length;++a)h.push("type="+
b.type[a]);b.maxbins&&h.push("maxbins="+b.maxbins);0<h.length?d=this.dasBaseURI+"features?"+h.join(";"):f([],"No filters specified")}this.doCrossDomainRequest(d,function(a,b){if(a){for(var d=[],h={},n=a.getElementsByTagName("SEGMENT"),g=0;g<n.length;++g){var q=n[g],x=q.getAttribute("id");h[x]={min:q.getAttribute("start"),max:q.getAttribute("stop")};for(var q=q.getElementsByTagName("FEATURE"),e=0;e<q.length;++e){var m=q[e],D=new v;D.segment=x;D.id=m.getAttribute("id");D.label=m.getAttribute("label");
var l=k(m,"START"),B=k(m,"END");(l|0)>(B|0)?(D.min=B|0,D.max=l|0):(D.min=l|0,D.max=B|0);l=m.getElementsByTagName("TYPE");0<l.length&&(l=l[0],l.firstChild&&(D.type=l.firstChild.nodeValue),D.typeId=l.getAttribute("id"),D.typeCv=l.getAttribute("cvId"));D.type=k(m,"TYPE");!D.type&&D.typeId&&(D.type=D.typeId);D.method=k(m,"METHOD");(l=k(m,"ORIENTATION"))||(l="0");D.orientation=l;D.score=k(m,"SCORE");D.links=c(m);D.notes=t(m);l=m.getElementsByTagName("GROUP");for(B=0;B<l.length;++B){var C=l[B],p=new z;
p.type=C.getAttribute("type");p.id=C.getAttribute("id");p.links=c(C);p.notes=t(C);D.groups?D.groups.push(p):D.groups=Array(p)}if(D.notes)for(l=0;l<D.notes.length;++l)B=D.notes[l],0==B.indexOf("Genename=")&&(C=new z,C.type="gene",C.id=B.substring(9),D.groups?D.groups.push(C):D.groups=Array(C));l=m.getElementsByTagName("PART");if(0<l.length){C=[];for(B=0;B<l.length;++B)C.push(l[B].getAttribute("id"));D.parts=C}l=m.getElementsByTagName("PARENT");if(0<l.length){m=[];for(B=0;B<l.length;++B)m.push(l[B].getAttribute("id"));
D.parents=m}d.push(D)}}f(d,void 0,h)}else f([],"Failed request: "+(0==b.status?"server may not support CORS":"status="+b.status))},function(a){f([],a)})};l.prototype.alignments=function(b,c,f){var d=this.dasBaseURI+"alignment?query="+b;this.doCrossDomainRequest(d,function(b){if(b){var c=[];b=b.getElementsByTagName("alignment");for(var h=0;h<b.length;++h){for(var g=b[h],q=new a(g.getAttribute("alignType")),e=g.getElementsByTagName("alignObject"),n=0;n<e.length;++n){var t=e[n],t={id:t.getAttribute("intObjectId"),
accession:t.getAttribute("dbAccessionId"),version:t.getAttribute("objectVersion"),dbSource:t.getAttribute("dbSource"),dbVersion:t.getAttribute("dbVersion")};q.objects[t.id]=t}g=g.getElementsByTagName("block");for(e=0;e<g.length;++e){for(var t=g[e],n={order:t.getAttribute("blockOrder"),segments:[]},t=t.getElementsByTagName("segment"),m=0;m<t.length;++m){var l=t[m],l={object:l.getAttribute("intObjectId"),min:l.getAttribute("start"),max:l.getAttribute("end"),strand:l.getAttribute("strand"),cigar:k(l,
"cigar")};n.segments.push(l)}q.blocks.push(n)}c.push(q)}f(c)}else f([],"Failed request "+d)})};q.prototype.pushStyle=function(a,b,f){a||(a={type:"default"});a=C(a);b&&(a.zoom=b);a.style=f;this.styles.push(a)};l.prototype.stylesheet=function(a,b){var f,c=this.credentials;this.stylesheet_uri?(f=this.stylesheet_uri,c=!1):f=this.dasBaseURI+"stylesheet";B(f,function(f){if(f){var c=new q;f=f.getElementsByTagName("TYPE");for(var k=0;k<f.length;++k){var h=f[k],g={};g.type=h.getAttribute("id");g.label=h.getAttribute("label");
g.method=h.getAttribute("method");for(var h=h.getElementsByTagName("GLYPH"),x=0;x<h.length;++x){var n=h[x],e=n.getAttribute("zoom"),t;a:{if(n.hasChildNodes()){n=n.firstChild;do{if(n.nodeType==Node.ELEMENT_NODE){t=n;break a}n=n.nextSibling}while(null!=n)}t=null}n=new d;n.glyph=t.localName;for(t=t.firstChild;t;){if(t.nodeType==Node.ELEMENT_NODE)if("BGGRAD"==t.localName){var m=n,l=t.localName,B,C=t;B=(B=C.getAttribute("steps"))?B|0:50;for(var p=[],v=[],C=C.getElementsByTagName("STOP"),w=0;w<C.length;++w){var z=
C[w];p.push(1*z.getAttribute("score"));v.push(z.firstChild.nodeValue)}B=G(B,p,v);m[l]=B}else n[t.localName]=t.firstChild.nodeValue;t=t.nextSibling}c.pushStyle(g,e,n)}}a(c)}else b&&b()},c)};h.prototype.sources=function(a,b,f){f||(f={});var c=[];f.taxon&&c.push("organism="+f.taxon);f.auth&&c.push("authority="+f.auth);f.version&&c.push("version="+f.version);f=this.uri;0<c.length&&(f=f+"?"+c.join("&"));B(f,function(f){if(!f&&b)b();else{var c=[];f=f.getElementsByTagName("SOURCE");for(var d=0;d<f.length;++d){var k=
f[d],h=k.getElementsByTagName("VERSION");if(!(1>h.length)){for(var g=h[0],n=g.getElementsByTagName("COORDINATES"),h=[],q=0;q<n.length;++q){var e=n[q],t=new m;t.auth=e.getAttribute("authority");t.taxon=e.getAttribute("taxid");t.version=e.getAttribute("version");h.push(t)}for(var n=[],e=g.getElementsByTagName("CAPABILITY"),x,q=0;q<e.length;++q)t=e[q],n.push(t.getAttribute("type")),"das1:features"==t.getAttribute("type")&&(x=t.getAttribute("query_uri"),x=x.substring(0,x.length-8));q={};g=g.getElementsByTagName("PROP");
for(e=0;e<g.length;++e)w(q,g[e].getAttribute("name"),g[e].getAttribute("value"));x&&(k=new l(x,{source_uri:k.getAttribute("uri"),name:k.getAttribute("title"),desc:k.getAttribute("description"),coords:h,props:q,capabilities:n}),c.push(k))}}a(c)}})};l.prototype.doCrossDomainRequest=function(a,b,f){var c;this.xUser&&(c="Basic "+btoa(this.xUser+":"+this.xPass));try{return B(a,b,this.credentials,c)}catch(d){if(f)f(d);else throw d;}};"undefined"!==typeof u&&(u.exports={DASGroup:z,DASFeature:v,DASStylesheet:q,
DASStyle:d,DASSource:l,DASSegment:p,DASRegistry:h,DASSequence:y,DASLink:b,isDasBooleanTrue:Q,isDasBooleanNotFalse:N,copyStylesheet:O,coordsMatch:g})},{"./color":9,"./utils":47}],11:[function(e,u,r){function p(g,e,l){function b(){l?(a.className="fa fa-caret-down",e.style.display="table"):(a.className="fa fa-caret-right",e.style.display="none")}var a=m("i");b();a.addEventListener("click",function(a){a.preventDefault();a.stopPropagation();l=!l;b()},!1);g=m("h6",[a," ",g],{},{display:"block",background:"gray",
color:"white",width:"100%",padding:"5px 2px",margin:"0px"});return m("div",[g,e],{})}if("undefined"!==typeof e){var l=e("./cbrowser").Browser;e=e("./utils");var m=e.makeElement,g=e.removeChildren}l.prototype.removeAllPopups=function(){g(this.hPopupHolder);g(this.popupHolder)};l.prototype.makeTooltip=function(g,e){var l=!1,b=this,a=null,q;q=function(b){l=!1;a&&(clearTimeout(a),a=null);g.removeEventListener("mouseout",q,!1)};var d=function(h){var k=h.clientX+window.scrollX,c=h.clientY+window.scrollY;
a||(a=setTimeout(function(){var h;h="function"===typeof e?e():e;var q=m("div",[m("div",null,{className:"tooltip-arrow"}),m("div",h,{className:"tooltip-inner"})],{className:"tooltip bottom in"},{display:"block",top:""+(c+20)+"px",left:""+Math.max(k-30,20)+"px"});b.hPopupHolder.appendChild(q);var p;p=function(a){try{b.hPopupHolder.removeChild(q)}catch(c){}window.removeEventListener("mousemove",p,!1);l&&null!=g.offsetParent&&d(a)};window.addEventListener("mousemove",p,!1);a=null},1E3))};g.addEventListener("mouseover",
function(a){l=!0;g.addEventListener("mouseout",q,!1);d(a)},!1);g.addEventListener("DOMNodeRemovedFromDocument",function(b){l=!1;a&&(clearTimeout(a),a=null)},!1)};l.prototype.popit=function(g,e,l,b){var a=this;b||(b={});g||(g={});var q=b.width||200,d;g.clientX?(b=g.clientX,d=g.clientY):(b=500,d=50);b+=document.documentElement.scrollLeft||document.body.scrollLeft;d+=document.documentElement.scrollTop||document.body.scrollTop;var h=window.innerWidth,k=d,c=Math.min(b-q/2-4,h-q-30),t=m("div");t.className=
"popover fade "+(g.clientX?"bottom ":"")+"in";t.style.display="block";t.style.position="absolute";t.style.top=""+k+"px";t.style.left=""+c+"px";t.style.width=q+"px";276<q&&(t.style.maxWidth=q+"px");t.appendChild(m("div",null,{className:"arrow"}));if(e){var B=m("button","",{className:"close"});B.innerHTML="&times;";B.addEventListener("mouseover",function(a){B.style.color="red"},!1);B.addEventListener("mouseout",function(a){B.style.color="black"},!1);B.addEventListener("click",function(b){b.preventDefault();
b.stopPropagation();a.removeAllPopups()},!1);g=m("h4",[m("span",e,null,{maxWidth:"200px"}),B],{},{paddingLeft:"10px",paddingRight:"10px"});var p,N,O,C;O=function(a){a.stopPropagation();a.preventDefault();c+=a.clientX-p;8>c&&(c=8);c>h-q-32&&(c=h-q-26);k+=a.clientY-N;k=Math.max(10,k);t.style.top=""+k+"px";t.style.left=""+Math.min(c,h-q-10)+"px";p=a.clientX;N=a.clientY};C=function(a){a.stopPropagation();a.preventDefault();window.removeEventListener("mousemove",O,!1);window.removeEventListener("mouseup",
C,!1)};g.addEventListener("mousedown",function(a){a.preventDefault();a.stopPropagation();p=a.clientX;N=a.clientY;window.addEventListener("mousemove",O,!1);window.addEventListener("mouseup",C,!1)},!1);t.appendChild(g)}t.appendChild(m("div",l,{className:"popover-content"},{padding:"0px"}));this.hPopupHolder.appendChild(t);var w={node:t,displayed:!0};t.addEventListener("DOMNodeRemoved",function(a){a.target==t&&(w.displayed=!1)},!1);return w};"undefined"!==typeof u&&(u.exports={makeTreeTableSection:p})},
{"./cbrowser":6,"./utils":47}],12:[function(e,u,r){function p(g){this.source=g;this.base=g.uri||"http://rest.ensembl.org";this.species=g.species||"human";this.activityListeners=[];this.busy=0;this.type="string"===typeof g.type?[g.type]:g.type||["regulatory"]}if("undefined"!==typeof e){var l=e("./sourceadapters").registerSourceAdapterFactory;e=e("./das");var m=e.DASStylesheet,g=e.DASStyle,y=e.DASFeature,v=e.DASGroup}p.prototype.addActivityListener=function(g){this.activityListeners.push(g)};p.prototype.notifyActivity=
function(){for(var g=0;g<this.activityListeners.length;++g)try{this.activityListeners[g](this.busy)}catch(b){console.log(b)}};p.prototype.getStyleSheet=function(e){var b=new m,a=new g;a.glyph="__NONE";0<=this.type.indexOf("exon")&&b.pushStyle({type:"transcript"},null,a);(0<=this.type.indexOf("exon")||0<=this.type.indexOf("transcript"))&&b.pushStyle({type:"gene"},null,a);a=new g;a.glyph="BOX";a.FGCOLOR="black";a.BGCOLOR="red";a.HEIGHT=8;a.BUMP=!0;a.LABEL=!0;a.ZINDEX=10;b.pushStyle({type:"cds"},null,
a);a=new g;a.glyph="SQUARE";a.BUMP="yes";a.LABEL="no";a.FGCOLOR="blue";b.pushStyle({type:"variation",method:".+_UTR_variant"},null,a);a=new g;a.glyph="TRIANGLE";a.DIRECTION="S";a.BUMP="yes";a.LABEL="no";a.FGCOLOR="blue";b.pushStyle({type:"variation",method:"missense_variant"},null,a);a=new g;a.glyph="TRIANGLE";a.DIRECTION="N";a.BUMP="yes";a.LABEL="no";a.FGCOLOR="blue";b.pushStyle({type:"variation",method:"splice_.+_variant"},null,a);a=new g;a.glyph="STAR";a.POINTS=6;a.BUMP="yes";a.LABEL="no";a.FGCOLOR=
"blue";b.pushStyle({type:"variation",method:"regulatory_region_variant"},null,a);a=new g;a.glyph="PLIMSOLL";a.BUMP="yes";a.LABEL="no";a.FGCOLOR="rgb(50,80,255)";a.STROKECOLOR="black";b.pushStyle({type:"variation"},null,a);a=new g;a.glyph="SQUARE";a.BUMP="yes";a.LABEL="no";a.BGCOLOR="#888888";a.FGCOLOR="red";b.pushStyle({type:"indel",method:".+_UTR_variant"},null,a);a=new g;a.glyph="TRIANGLE";a.DIRECTION="S";a.BUMP="yes";a.LABEL="no";a.BGCOLOR="#888888";a.FGCOLOR="red";b.pushStyle({type:"indel",method:"missense_variant"},
null,a);a=new g;a.glyph="TRIANGLE";a.DIRECTION="N";a.BUMP="yes";a.LABEL="no";a.BGCOLOR="#888888";a.FGCOLOR="red";b.pushStyle({type:"indel",method:"splice_.+_variant"},null,a);a=new g;a.glyph="STAR";a.POINTS=6;a.BUMP="yes";a.LABEL="no";a.BGCOLOR="#888888";a.FGCOLOR="red";b.pushStyle({type:"indel",method:"regulatory_region_variant"},null,a);a=new g;a.glyph="PLIMSOLL";a.BUMP="yes";a.LABEL="no";a.BGCOLOR="#888888";a.FGCOLOR="red";a.STROKECOLOR="black";b.pushStyle({type:"indel"},null,a);a=new g;a.glyph=
"BOX";a.FGCOLOR="black";a.BGCOLOR="orange";a.HEIGHT=8;a.BUMP=!0;a.LABEL=!0;a.ZINDEX=20;b.pushStyle({type:"default"},null,a);return e(b)};p.prototype.getScales=function(){return[]};p.prototype.fetch=function(g,b,a,q,d,h,k){var c=this;b=this.base+"/overlap/region/"+this.species+"/"+g+":"+b+"-"+a;a=[];for(q=0;q<this.type.length;++q)a.push("feature="+this.type[q]);a.push("content-type=application/json");b=b+"?"+a.join(";");var e=new XMLHttpRequest;e.onreadystatechange=function(){if(4==e.readyState)if(c.busy--,
c.notifyActivity(),300<=e.status){var a="Error code "+e.status;try{var b=JSON.parse(e.response);b.error&&(a=b.error)}catch(d){}k(a,null)}else{for(var a=JSON.parse(e.response),b=[],h=0;h<a.length;++h){var q=a[h],m=[],l=new y;l.segment=g;l.min=q.start|0;l.max=q.end|0;l.type=q.feature_type||"unknown";l.id=q.ID;if(q.Parent){var p=new v;p.id=q.Parent;l.groups=[p]}q.strand&&(0>q.strand?l.orientation="-":0<q.strand&&(l.orientation="+"));q.consequence_type&&(l.method=q.consequence_type);q.alt_alleles&&(m.push("Alleles="+
q.alt_alleles.join("/")),1<q.alt_alleles.length&&(q.alt_alleles[1].length!=q.alt_alleles[0].length||"-"==q.alt_alleles[1])&&(l.type="indel"));0<m.length&&(l.notes=m);b.push(l)}k(null,b)}};c.busy++;c.notifyActivity();e.open("GET",b,!0);e.responseType="text";e.send("")};l("ensembl",function(g){return{features:new p(g)}})},{"./das":10,"./sourceadapters":33}],13:[function(e,u,r){if("undefined"!==typeof e)var p=e("./cbrowser").Browser,l=e("./utils").shallowCopy,m=e("./sha1").hex_sha1,g=e("./das").copyStylesheet;
p.prototype.exportFullConfig=function(g){g={chr:this.chr,viewStart:this.viewStart|0,viewEnd:this.viewEnd|0,cookieKey:"dalliance_"+m(Date.now()),coordSystem:this.coordSystem,sources:this.exportSourceConfig(),chains:this.exportChains()};this.prefix&&(g.prefix=this.prefix);return g};p.prototype.exportChains=function(){var g={},e=this.chains||{},m;for(m in e)g[m]=e[m].exportConfig();return g};p.prototype.exportSourceConfig=function(e){e=[];for(var m=0;m<this.tiers.length;++m){var p=this.tiers[m],b=l(p.dasSource);
b.noPersist||(b.coords=void 0,b.props=void 0,b.disabled||(b.disabled=void 0),p.config.stylesheet?(b.style=g(p.config.stylesheet).styles,b.stylesheet_uri=void 0):b.style&&(b.style=g({styles:b.style}).styles),"string"===typeof p.config.name&&(b.name=p.config.name),void 0!==p.config.height&&(b.forceHeight=p.config.height),void 0!==p.config.forceMin&&(b.forceMin=p.config.forceMin),p.config.forceMinDynamic&&(b.forceMinDynamic=p.config.forceMinDynamic),void 0!==p.config.forceMax&&(b.forceMax=p.config.forceMax),
void 0!==p.config.bumped&&(b.bumped=p.config.bumped),p.config.forceMaxDynamic&&(b.forceMaxDynamic=p.config.forceMaxDynamic),e.push(b))}return e};p.prototype.exportPageTemplate=function(g){g=g||{};return'<html>\n  <head>\n    <script language="javascript" src="'+this.resolveURL("$$dalliance-compiled.js")+'">\x3c/script>\n    <script language="javascript">\n      var dalliance_browser = new Browser('+JSON.stringify(this.exportFullConfig(g),null,2)+');\n    \x3c/script>\n  </head>\n  <body>\n    <div id="svgHolder">Dalliance goes here</div>\n  </body>\n<html>\n'}},
{"./cbrowser":6,"./das":10,"./sha1":32,"./utils":47}],14:[function(e,u,r){if("undefined"!==typeof e)var p=e("./cbrowser").Browser,l=e("./glyphs").OverlayLabelCanvas,m=e("./numformats").formatQuantLabel,g=e("./sequence-draw").drawSeqTierGC;p.prototype.exportImage=function(e){e=e||{};for(var p=this.featurePanelWidth,z=0,b=0;b<this.tiers.length;++b){0<b&&(z+=3);var a=this.tiers[b];void 0!==a.layoutHeight&&(z+=a.layoutHeight)}var q=e.resolutionMultiplier||1,b=(p+200)*q|0,a=z*q|0,z=makeElement("canvas",
null,{width:b,height:a}),d=z.getContext("2d");d.fillStyle="white";d.fillRect(0,0,b,a);d.scale(q,q);for(b=q=0;b<this.tiers.length;++b){var a=this.tiers[b],h=(a.glyphCacheOrigin-this.viewStart)*this.scale,k=new l;d.save();d.translate(0,q);d.save();d.beginPath();d.moveTo(200,0);d.lineTo(200+p,0);d.lineTo(200+p,a.layoutHeight);d.lineTo(200,a.layoutHeight);d.closePath();d.clip();d.translate(200,0);d.save();d.translate(h,0);a.subtiers?a.paintToContext(d,k,h+1E3):g(a,a.currentSequence,d);d.restore();d.save();
d.translate(h,0);k.draw(d,-h,p-h);d.restore();d.restore();for(var k=!1,c=0,t=a.subtiers||[],B=0;B<t.length;++B){var Q=t[B];if(Q.quant){var k=!0,N=Q.quant,O=Q.height,C=2;40<O&&(C=1+(O/20|0));var O=O/(C-1),w=(N.max-N.min)/(C-1);d.beginPath();d.moveTo(205,c);d.lineTo(200,c);d.lineTo(200,c+Q.height);d.lineTo(205,c+Q.height);for(var G=1;G<C-1;++G){var K=G*O;d.moveTo(200,c+K);d.lineTo(203,c+K)}d.strokeStyle="black";d.strokeWidth=2;d.stroke();d.fillStyle="black";var G=m(N.max),r=c+7;d.fillText(G,197-d.measureText(G).width,
r);G=m(N.min);r=c+Q.height;d.fillText(G,197-d.measureText(G).width,r);for(G=1;G<C-1;++G)K=G*O,r=m(1*N.max-G*w),K=c+K+3,d.fillText(r,197-d.measureText(r).width,K)}c+=Q.height+3}c="string"===typeof a.config.name?a.config.name:a.dasSource.name;t=d.measureText(c).width;d.fillStyle="black";d.fillText(c,200-(k?22:12)-t,(a.layoutHeight+6)/2);d.restore();q+=a.layoutHeight+3}if(e.highlights){d.save();d.beginPath();d.moveTo(200,0);d.lineTo(200+p,0);d.lineTo(200+p,q);d.lineTo(200,q);d.closePath();d.clip();d.translate(200+
h,0);h=p=this.viewStart;b=this.viewEnd;for(a=0;a<this.highlights.length;++a)O=this.highlights[a],(O.chr===this.chr||O.chr==="chr"+this.chr)&&O.min<b&&O.max>h&&(d.globalAlpha=this.defaultHighlightAlpha,d.fillStyle=this.defaultHighlightFill,d.fillRect((O.min-p)*this.scale,0,(O.max-O.min)*this.scale,q));d.restore()}p=-1;"center"==e.ruler?p=200+(this.viewEnd-this.viewStart+1)*this.scale/2:"left"==e.ruler?p=200:"right"==e.ruler&&(p=200+(this.viewEnd-this.viewStart+1)*this.scale);0<=p&&(d.strokeStyle="blue",
d.beginPath(),d.moveTo(p,0),d.lineTo(p,q),d.stroke());return z.toDataURL("image/png")}},{"./cbrowser":6,"./glyphs":20,"./numformats":25,"./sequence-draw":30}],15:[function(e,u,r){if("undefined"!==typeof e){var p=e("./cbrowser").Browser;e=e("./utils");var l=e.makeElement,m=e.removeChildren}p.prototype.openExportPanel=function(){var g=this;if("export"===this.uiMode)this.hideToolPanel(),this.setUiMode("none");else{var e=l("div",null,{className:"export-form"}),p=l("select");p.appendChild(l("option","SVG",
{value:"svg"}));p.appendChild(l("option","Image",{value:"png"}));p.appendChild(l("option","Dalliance config",{value:"config"}));p.appendChild(l("option","Dalliance sources",{value:"sources"}));p.appendChild(l("option","Dalliance page",{value:"page"}));p.value="svg";p.addEventListener("change",function(a){m(d);B()},!1);e.appendChild(l("p",["Export as: ",p]));var z=l("input",null,{type:"checkbox",checked:this.exportHighlights});z.addEventListener("change",function(a){g.exportHighlights=z.checked;g.storeStatus()},
!1);var b=l("input",null,{type:"checkbox",checked:this.exportRuler});b.addEventListener("change",function(a){g.exportRuler=b.checked;g.storeStatus()},!1);var a=l("input",null,{type:"text",value:"1.0"}),q=l("button","Export",{className:"btn btn-primary"});q.addEventListener("click",function(c){m(d);var k,h,e,q;if("svg"===p.value)k=URL.createObjectURL(g.makeSVG({highlights:z.checked,ruler:b.checked?g.rulerLocation:"none"})),h="SVG",e="image/svg",q="dalliance-view.svg";else if("png"===p.value){e=parseFloat(a.value);
if(0.1>e||10<e){alert("bad scale "+e);return}k=g.exportImage({highlights:z.checked,ruler:b.checked?g.rulerLocation:"none",resolutionMultiplier:e});h="Image";e="image/png";q="dalliance-view.png"}else"config"===p.value?(e=JSON.stringify(g.exportFullConfig(),null,2),h=new Blob([e],{type:"text/plain"}),k=URL.createObjectURL(h),h="Configuration",e="text/plain",q="dalliance-config.json"):"sources"===p.value?(e=JSON.stringify(g.exportSourceConfig(),null,2),h=new Blob([e],{type:"text/plain"}),k=URL.createObjectURL(h),
h="Source array",e="text/plain",q="dalliance-sources.json"):"page"===p.value&&(h=g.exportPageTemplate(),e="text/html",h=new Blob([h],{type:e}),k=URL.createObjectURL(h),h="Page template",q="dalliance-view.html");k&&(c=l("a","[Download]",{href:k,download:q,type:e}),e=l("a","[Preview in browser]",{href:k,type:e,target:"_new"}),d.appendChild(l("p",[""+h+" created: ",c,e])))},!1);g.addViewListener(function(){m(d)});g.addTierListener(function(){m(d)});var d=l("p",""),h=l("tr",[l("th","Include highlights",
{},{width:"200px",textAlign:"right"}),l("td",z)]),k=l("tr",[l("th","Include vertical guideline"),l("td",b)]),c=l("tr",[l("th","Scale multiplier"),l("td",a)]),t=l("table",[h,k,c]),B=function(){var a=p.value;h.style.display="svg"==a||"png"==a?"table-row":"none";k.style.display="svg"==a||"png"==a?"table-row":"none";c.style.display="png"==a?"table-row":"none"};B();e.appendChild(t);e.appendChild(q);e.appendChild(d);"none"!==this.uiMode&&this.hideToolPanel();this.browserHolder.insertBefore(e,this.svgHolder);
this.activeToolPanel=e;this.setUiMode("export")}}},{"./cbrowser":6,"./utils":47}],16:[function(e,u,r){u=e("./cbrowser");r=e("./chainset");var p=e("./sourceadapters"),l=e("./utils");e=e("./das");window.Browser=u.Browser;window.Chainset=r.Chainset;window.makeElement=l.makeElement;window.dalliance_registerSourceAdapterFactory=p.registerSourceAdapterFactory;window.dalliance_registerParserFactory=p.registerParserFactory;window.dalliance_makeParser=p.makeParser;window.DASSequence=e.DASSequence;window.DASFeature=
e.DASFeature;window.DASGroup=e.DASGroup;window.DASStylesheet=e.DASStylesheet;window.DASStyle=e.DASStyle;window.DASSource=e.DASSource},{"./cbrowser":6,"./chainset":7,"./das":10,"./sourceadapters":33,"./utils":47}],17:[function(e,u,r){function p(){this.glyphs=[];this.height=0;this.quant=null}function l(f){Date.now();Z=f.viewport.getContext("2d");a(f);f.padding="number"===typeof f.dasSource.padding?f.dasSource.padding:$;var c=[],d={},n={},k;for(k in f.ungroupedFeatures)for(var h=f.ungroupedFeatures[k],
e=0;e<h.length;++e){var q=h[e];if(!q.parts){var x=f.styleForFeature(q);if(x)if("LINEPLOT"==x.glyph)b(d,x.id,q),n[x.id]=x;else{var t=g(q,0,x,f);t&&c.push(t)}}}for(var s in d)k=d[s],x=n[s],"LINEPLOT"==x.glyph&&c.push(y(k,x,f));if(f.dasSource.collapseSuperGroups&&!f.bumped)for(var l in f.superGroups){d=f.superGroups[l];f.groups[l]=z(f.groups[l]);f.groups[l].isSuperGroup=!0;n={};s=1E10;h=-1E10;e=null;for(t=0;t<d.length;++t)if(k=f.groupedFeatures[d[t]]){for(x=0;x<k.length;++x)q=k[x],b(n,q.type,q),s=Math.min(q.min,
s),h=Math.max(q.max,h),q.segment&&!e&&(e=q.segment);if(f.groups[l]&&!f.groups[l].links||0==f.groups[l].links.length)f.groups[l].links=f.groups[d[0]].links;delete f.groupedFeatures[d[t]]}f.groups[l].max=h;f.groups[l].min=s;f.groups[l].segment=e;for(var D in n){k=n[D];s=k[0];h=null;for(x=0;x<k.length;++x)q=k[x],q=new R(q.min,q.max),h=h?I(h,q):q;h=h.ranges();for(e=0;e<h.length;++e){for(var J=h[e],B=((J.max()|0)-(J.min()|0)+1)*d.length,A=0,x=0;x<k.length;++x)if(q=k[x],(q.min|0)<=J.max()&&(q.max|0)>=J.min())var C=
Math.max(q.min|0,J.min()),q=Math.min(q.max|0,J.max()),A=A+(q-C+1);var q=new V,w;for(w in s)q[w]=s[w];q.min=J.min();q.max=J.max();q.label&&1<d.length&&(q.label+=" ("+d.length+" vars)");q.visualWeight=1*A/B;b(f.groupedFeatures,l,q)}}delete f.superGroups[l]}w=[];for(var v in f.groupedFeatures)w.push(v);w.sort(function(a,b){var c=f.groupedFeatures[a][0].score-f.groupedFeatures[b][0].score;return 0<c?-1:0==c?0:1});D={};for(q=0;q<w.length;++q)if(v=w[q],t=m(f.groupedFeatures[v],0,f.groups[v],f,f.dasSource.collapseSuperGroups&&
!f.bumped?"collapsed_gene":"tent"))t.group=f.groups[v],D[v]=t;for(l in f.superGroups){d=f.superGroups[l];v=[];s=1E10;h=-1E10;for(w=0;w<d.length;++w)q=D[d[w]],D[d[w]]=null,q&&(v.push(q),s=Math.min(s,q.min()),h=Math.max(h,q.max()));for(w=0;w<v.length;++w)q=v[w],c.push(new N(q,s,h))}for(t in D)(q=D[t])&&c.push(q);l=new p;v=[];D=f.subtierMax||f.dasSource.subtierMax||f.browser.defaultSubtierMax;w=!1;q=0;a:for(;q<c.length;++q)if(t=c[q],t.bump&&(f.bumped||f.dasSource.collapseSuperGroups)){for(d=0;d<v.length;++d)if(n=
v[d],n.hasSpaceFor(t)){n.add(t);continue a}v.length>=D?w=!0:(n=new p,n.add(t),v.push(n))}else l.add(t);0<l.glyphs.length&&(v=[l].concat(v));for(d=0;d<v.length;++d)n=v[d],n.quant&&n.glyphs.unshift(new E(n.height));for(d=0;d<v.length;++d)n=v[d],n.glyphs.sort(function(a,b){return(a.zindex||0)-(b.zindex||0)});f.subtiers=v;f.glyphCacheOrigin=f.browser.viewStart;w?f.updateStatus("Bumping limit exceeded, use the track editor to see more features"):f.updateStatus()}function m(a,b,f,c,n){n=c.styleForFeature(f);
var h,q=!1,e=[];b=null;for(var x=0;x<a.length;++x){var t=a[x];t.orientation&&null==b&&(b=t.orientation);!h&&t.label&&(h=t.label);var s=c.styleForFeature(t);s&&!t.parts&&(W(s.LABEL)&&(q=!0),(t=g(t,0,s,c,null,!0))&&e.push(t))}if(0==e.length)return null;a="flat";n&&"LINE"===n.glyph||(c.dasSource.collapseSuperGroups&&!c.bumped?"+"===b?a="collapsed+":"-"===b&&(a="collapsed-"):"+"===b?a="hat+":"-"===b&&(a="hat-"));c=null;if(h&&q||n&&(W(n.LABEL)||W(n.LABELS)))c=f.label||h;f=new d(e,a);c&&("+"===b?c=">"+
c:"-"===b&&(c="<"+c),f=new k(Z,f,c,!1));f.bump=!0;return f}function g(a,b,n,h,g,e){function l(a,b,f){var c=null;if(a.currentSequence){var n=a.currentSequence.start|0,d=a.currentSequence.end|0;if(n<=f&&d>=b){for(var h=Math.max(b,n),d=Math.min(f,d),c=a.currentSequence.seq.substr(h-n,d-h+1);b<h;)c="N"+c,h--;for(;f>d;)c+="N",d++}}return c}var m=h.browser.scale,p=h.browser.viewStart,v=n.glyph||"BOX",z=a.min,E=a.max,r=a.orientation,I=a.score,V=a.label||a.id,y=(z-p)*m,R=Math.max((E-p+1)*m,y+1),u=h.forceHeight||
n.HEIGHT||g||12,S=u*=1,p=n.BUMP&&W(n.BUMP),$;if("CROSS"===v||"EX"===v||"TRIANGLE"===v||"DOT"===v||"SQUARE"===v||"STAR"===v||"PLIMSOLL"===v){var U=n.FGCOLOR||"black",L=n.BGCOLOR||"none",z=n.STROKECOLOR;n.BGITEM&&a.itemRgb?U=a.itemRgb:W(n.COLOR_BY_SCORE2)&&(m=n.BGGRAD||n._gradient,m||(m=J(50,n.COLOR1,n.COLOR2,n.COLOR3),n._gradient=m),u=a.score2,void 0==u&&U||(E=n.MIN2?1*n.MIN2:0,E=(1*(u||0)-E)/((n.MAX2?1*n.MAX2:1)-E)*m.length|0,0>E&&(E=0),E>=m.length&&(E=m.length-1),U=m[E]));u=h.forceHeight||n.HEIGHT||
g||12;S=u*=1;E=n.SIZE||u;n.RSIZE&&(E=1*n.RSIZE*u);n.STROKETHRESHOLD&&E<1*n.STROKETHRESHOLD&&(z=null);E*=1;u=(y+R)/2;m=E/2;"EX"===v?z=new t(u,E,U):"TRIANGLE"===v?z=new B(u,E,n.DIRECTION||"N",n.LINEWIDTH||E,U,z):"DOT"===v?z=new Q(u,E,U,z):"PLIMSOLL"===v?z=new A(u,E,0.2*E,U,z):"SQUARE"===v?z=new q(u-m,0,E,E,U,z):"STAR"===v?(v=5,n.POINTS&&(v=n.POINTS|0),z=new F(u,m,v,U,z)):z=new c(u,E,U);L&&"none"!=L&&5<R-y&&(y=new q(y,0,R-y,E,L),z=new d([y,z]));if(W(n.SCATTER)){L=h.quantMin(n);(E=h.quantMax(n))||(E=
0>L?0:10);L||(L=0);h=(1*I-L)/(E-L);I=-1*L/(E-L);if(0>h||1<h)return null;h>=I?(u=Math.max(1,(h-I)*S),b=b+(1-I)*S-u):(u=Math.max(1,(h-I)*S),b+=(1-I)*S);$={min:L,max:E};y=0;R="undefined"!==typeof a.forceLabel?a.forceLabel:n.LABEL;aa(R)&&V&&!e&&(z=new k(Z,z,V,!0,null,"above"==R?"above":"below"),"above"==R&&(y=z.textHeight+2),e=!0);z=new M(z,0,b-m-y,S)}}else if("HISTOGRAM"===v||"GRADIENT"===v&&"undefined"!==I)L=h.quantMin(n),(E=h.quantMax(n))||(E=0>L?0:10),L||(L=0),1*I<1*L&&(I=L),1*I>1*E&&(I=E),h=(1*I-
L)/(E-L),I=-1*L/(E-L),"HISTOGRAM"===v&&(h>=I?(u=Math.max(1,(h-I)*S),b=b+(1-I)*S-u):(u=Math.max(1,(I-h)*S),b+=(1-I)*S),$={min:L,max:E}),U=n.FGCOLOR||null,L=n.BGCOLOR||n.COLOR1||"green",n.BGITEM&&a.itemRgb&&(L=a.itemRgb),I=n.ALPHA?1*n.ALPHA:null,n.BGGRAD&&(m=n.BGGRAD,E=h*m.length|0,0>E&&(E=0),E>=m.length&&(E=m.length-1),L=m[E]),n.COLOR2&&(m=n._gradient,m||(m=J(50,n.COLOR1,n.COLOR2,n.COLOR3),n._gradient=m),E=h*m.length|0,0>E&&(E=0),E>=m.length&&(E=m.length-1),L=m[E]),z=new q(y,b,R-y,u,L,U,I);else if("HIDDEN"===
v)z=new N(null,y,R),e=!0;else if("ARROW"===v)h=n.FGCOLOR||"purple",b=W(n.PARALLEL),I=W(n.SOUTHWEST),L=W(n.NORTHEAST),z=new K(y,R,u,h,b,I,L);else if("ANCHORED_ARROW"===v)U=n.FGCOLOR||"none",L=n.BGCOLOR||"green",z=new O(y,R,u,L,U,r),z.bump=!0;else if("SPAN"===v)U=n.FGCOLOR||"black",z=new C(y,R,u,U);else if("LINE"===v)U=n.FGCOLOR||"black",z=new w(y,R,u,n.STYLE||"solid",r,U);else if("PRIMERS"===v)U=n.FGCOLOR||"black",L=n.BGCOLOR||"red",z=new G(y,R,u,L,U);else if("TEXT"===v)h=n.STRING||"text",L=n.FGCOLOR||
"black",z=new f(Z,y,R,u,L,h);else if("TOOMANY"===v)U=n.FGCOLOR||"gray",L=n.BGCOLOR||"orange",z=new H(y,R,u,L,U);else if("POINT"===v)u=h.forceHeight||n.HEIGHT||30,L=h.quantMin(n),E=h.quantMax(n),h=(1*I-L)/(E-L),b=1*u/(E-L)*(I-1*L)|0,$={min:L,max:E},L=n.FGCOLOR||n.COLOR1||"black",n.COLOR2&&(m=n._gradient,m||(m=J(50,n.COLOR1,n.COLOR2,n.COLOR3),n._gradient=m),E=h*m.length|0,0>E&&(E=0),E>=m.length&&(E=m.length-1),L=m[E]),z=new s((y+R)/2,u-b,u,L);else if("__SEQUENCE"===v){L=S=a.seq;v=U=a.quals;b=W(n.__INSERTIONS);
I=[];if(a.cigar){g=X(a.cigar);for(var v=L="",ra=r=0;ra<g.length;++ra){var ea=g[ra];if("M"==ea.op)L+=S.substr(r,ea.cnt),v+=U.substr(r,ea.cnt),r+=ea.cnt;else if("D"==ea.op)for(var Y=0;Y<ea.cnt;++Y)L+="-",v+="Z";else if("I"==ea.op){var ba=S.substr(r,ea.cnt),Y=new B(y+L.length*m,5,"S",5,"red");b&&(Y=new k(Z,Y,ba,!1,"center","above","7px sans-serif"));Y.feature={label:"Insertion: "+ba,type:"insertion",method:"insertion"};I.push(Y);r+=ea.cnt}else"S"==ea.op?r+=ea.cnt:console.log("unknown cigop"+ea.op)}}m=
l(h,z,E);if(L&&m&&("mismatch"===n.__SEQCOLOR||"mismatch-all"===n.__SEQCOLOR)){z=[];E="-"===a.orientation?",":".";for(S=0;S<L.length;++S)z.push(L[S]==m[S]?E:L[S]);L=z.join("")}z=new x(h.browser.baseColors,"-"===a.orientation?n._minusColor||"lightskyblue":n._plusColor||"lightsalmon",y,R,u,L,m,n.__SEQCOLOR,v,!W(n.__CLEARBG));b&&(z=new M(z,0,7));0<I.length&&(I.splice(0,0,z),z=new d(I))}else if("__INSERTION"===v)Y=new B(y,5,"S",5,"red"),z=new k(Z,Y,a.insertion||a.altAlleles[0],!1,"center","above","7px sans-serif"),
1<R-y&&(L=n.BGCOLOR||n.COLOR1||"green",y=new q(y,5,R-y,u,L,U),z=new d([y,z]));else{if("__NONE"===v)return null;U=n.FGCOLOR||null;L=n.BGCOLOR||n.COLOR1||"green";n.BGITEM&&a.itemRgb&&(L=a.itemRgb);m=(R-y)/(E-z);"translation"==a.type&&("protein_coding"==a.method||a.readframeExplicit)&&(!a.tags||0>a.tags.indexOf("cds_start_NF")||a.readframeExplicit)&&(!h.dasSource.collapseSuperGroups||h.bumped)&&0.5<=m?(m=l(h,z,E),z=new D(y,R,u,L,m,a.orientation,a.readframe)):z=new q(y,0,R-y,u,L,U)}(W(n.LABEL)||a.forceLabel)&&
V&&!e&&(z=new k(Z,z,V,!1));p&&(z.bump=!0);z.feature=a;$&&(z.quant=$);n.ZINDEX&&(z.zindex=n.ZINDEX|0);return z}function y(a,b,f){var c=f.browser.viewStart,n=f.browser.scale,d=f.forceHeight||b.HEIGHT||30,k=f.quantMin(b);f=f.quantMax(b);for(var g=1*d/(f-k),q=b.FGCOLOR||b.COLOR1||"black",e=[],x=0;x<a.length;++x){var t=a[x],s=d-((t.score-1*k)*g|0);e.push((((t.min|0)+(t.max|0))/2-c)*n);e.push(s)}a=new h(e,q,d);a.quant={min:k,max:f};b.ZINDEX&&(a.zindex=b.ZINDEX|0);return a}if("undefined"!==typeof e){var v=
e("./utils"),z=v.shallowCopy,b=v.pusho,v=e("./tier").DasTier,a=e("./features").sortFeatures;r=e("./glyphs");var q=r.BoxGlyph,d=r.GroupGlyph,h=r.LineGraphGlyph,k=r.LabelledGlyph,c=r.CrossGlyph,t=r.ExGlyph,B=r.TriangleGlyph,Q=r.DotGlyph,N=r.PaddedGlyph,O=r.AArrowGlyph,C=r.SpanGlyph,w=r.LineGlyph,G=r.PrimersGlyph,K=r.ArrowGlyph,H=r.TooManyGlyph,f=r.TextGlyph,x=r.SequenceGlyph,D=r.AminoAcidGlyph,M=r.TranslatedGlyph,s=r.PointGlyph,E=r.GridGlyph,F=r.StarGlyph,A=r.PlimsollGlyph,n=r.OverlayLabelCanvas,J=
e("./color").makeGradient;r=e("./spans");var R=r.Range,I=r.union;r=e("./das");var V=r.DASFeature,W=r.isDasBooleanTrue,aa=r.isDasBooleanNotFalse,X=e("./cigar").parseCigar,S=e("./numformats").formatQuantLabel}var $=3;p.prototype.indexFor=function(a){a=a.min();for(var b=0,f=this.glyphs.length;f>b;){var c=(b+f)/2|0;if(c>=this.glyphs.length)return this.glyphs.length;a<this.glyphs[c].min()?f=c:b=c+1}return f};p.prototype.add=function(a){var b=this.indexFor(a);this.glyphs.splice(b,0,a);this.height=Math.max(this.height,
a.height());a.quant&&null==this.quant&&(this.quant=a.quant)};p.prototype.hasSpaceFor=function(a){var b=this.indexFor(a);return 0<b&&this.glyphs[b-1].max()>=a.min()||b<this.glyphs.length&&this.glyphs[b].min()<=a.max()?!1:!0};var Z;v.prototype.paint=function(){var a=this.browser.retina&&1<window.devicePixelRatio,b=this.subtiers;if(b){var f=this.browser.featurePanelWidth+2E3;a&&(f*=2);var c=this.viewport.width|0;c<f-50&&(this.viewport.width=c=f);for(var f=this.padding,d=0;d<b.length;++d)f=f+b[d].height+
this.padding;d=f=Math.max(f+6,this.browser.minTierHeight);a&&(d*=2);d!=this.viewport.height&&(this.viewport.height=d);Math.max(f,this.browser.minTierHeight);this.viewportHolder.style.left="-1000px";this.viewport.style.width=a?""+c/2+"px":""+c+"px";this.viewport.style.height=""+f+"px";this.layoutHeight=Math.max(f,this.browser.minTierHeight);this.updateHeight();this.norigin=this.browser.viewStart;b=this.viewport.getContext("2d");b.clearRect(0,0,c,d);b.save();a&&b.scale(2,2);c=this.browser.viewStart-
1E3/this.browser.scale;d=this.browser.viewEnd+1E3/this.browser.scale;a=[];if(this.knownCoverage)for(var h=this.knownCoverage.ranges(),k=0;k<h.length;++k){var g=h[k];0==k?g.min()>c&&a.push({min:c,max:g.min()-1}):a.push({min:h[k-1].max()+1,max:g.min()-1});k==h.length-1&&g.max()<d&&a.push({min:g.max()+1,max:d})}if(0<a.length)for(b.fillStyle="gray",c=0;c<a.length;++c)d=a[c],h=(d.min-this.browser.viewStart)*this.browser.scale+1E3,b.fillRect(h,0,(d.max-this.browser.viewStart)*this.browser.scale+1E3-h,f);
f=new n;a=(this.glyphCacheOrigin-this.browser.viewStart)*this.browser.scale+1E3;b.translate(a,this.padding);f.translate(0,this.padding);this.paintToContext(b,f,a);this.overlayLabelCanvas=0<f.glyphs.length?f:null;b.restore();this.drawOverlay();this.paintQuant()}};v.prototype.paintToContext=function(a,b,f){var c=this.subtiers,n=this.viewport.width|0;a.save();for(var d=0;d<c.length;++d){for(var h=null,k=c[d].glyphs,g=0;g<k.length;++g){var q=k[g];q.min()<n-f&&q.max()>-f&&(q=k[g],q.draw(a,b),q.quant&&
(h=q.quant))}a.translate(0,c[d].height+this.padding);b.translate(0,c[d].height+this.padding)}a.restore();h&&this.quantLeapThreshold&&this.featureSource&&this.browser.sourceAdapterIsCapable(this.featureSource,"quantLeap")&&(b=c[0].height*(1-(this.quantLeapThreshold-h.min)/(h.max-h.min)),a.save(),a.strokeStyle="red",a.lineWidth=0.3,a.beginPath(),a.moveTo(-1E3,b),a.lineTo(n+1E3,b),a.stroke(),a.restore())};v.prototype.paintQuant=function(){if(this.quantOverlay){var a=this.browser.retina&&1<window.devicePixelRatio,
b;this.subtiers&&0<this.subtiers.length&&(b=this.subtiers[0].quant);if(b){var f=this.subtiers[0].height;this.quantOverlay.height=this.viewport.height;this.quantOverlay.width=a?100:50;this.quantOverlay.style.height=""+(a?this.quantOverlay.height/2:this.quantOverlay.height)+"px";this.quantOverlay.style.width="50px";this.quantOverlay.style.display="block";var c=this.quantOverlay.getContext("2d");a&&c.scale(2,2);a=2;40<f&&(a=1+(f/20|0));var n=(f+2*this.padding)/(a-1),d=(b.max-b.min)/(a-1);c.fillStyle=
"white";c.globalAlpha=0.6;"right"==this.browser.rulerLocation?c.fillRect(20,0,30,f+2*this.padding):c.fillRect(0,0,30,f+2*this.padding);c.globalAlpha=1;c.strokeStyle="black";c.lineWidth=1;c.beginPath();if("right"==this.browser.rulerLocation){c.moveTo(42,this.padding);c.lineTo(50,this.padding);c.lineTo(50,f+this.padding);c.lineTo(42,f+this.padding);for(var h=1;h<a-1;++h){var k=h*n;c.moveTo(50,k);c.lineTo(45,k)}}else for(c.moveTo(8,this.padding),c.lineTo(0,this.padding),c.lineTo(0,f+this.padding),c.lineTo(8,
f+this.padding),h=1;h<a-1;++h)k=h*n,c.moveTo(0,k),c.lineTo(5,k);c.stroke();c.fillStyle="black";if("right"==this.browser.rulerLocation)for(c.textAlign="right",c.fillText(S(b.max),41,8),c.fillText(S(b.min),41,f+this.padding),h=1;h<a-1;++h)k=h*n,c.fillText(S(1*b.max-h*d),41,k+3);else for(c.textAlign="left",c.fillText(S(b.max),9,8),c.fillText(S(b.min),9,f+this.padding),h=1;h<a-1;++h)k=h*n,c.fillText(S(1*b.max-h*d),9,k+3)}else this.quantOverlay.style.display="none"}};v.prototype.styleForFeature=function(a){var b=
this.browser.zoomForCurrentScale();if(!this.stylesheet)return null;for(var f=null,c=this.stylesheet.styles,n=0;n<c.length;++n){var d=c[n];if(!(d.zoom&&d.zoom!=b||d.orientation&&d.orientation!=a.orientation)){var h=d._labelRE;h&&h.test||(h=new RegExp("^"+d.label+"$"),d._labelRE=h);if(!d.label||h.test(a.label))if(h=d._methodRE,h&&h.test||(h=new RegExp("^"+d.method+"$"),d._methodRE=h),!d.method||h.test(a.method)){if(d.type)if("default"==d.type){f||(f=d.style);continue}else if(h=d._typeRE,h&&h.test||
(h=new RegExp("^"+d.type+"$"),d._typeRE=h),!h.test(a.type))continue;return d.style}}}return f};v.prototype.quantMin=function(a){return this.forceMinDynamic?this.currentFeaturesMinScore||0:"number"===typeof this.forceMin?this.forceMin:a.MIN||this.currentFeaturesMinScore||0};v.prototype.quantMax=function(a){return this.forceMaxDynamic?this.currentFeaturesMaxScore||0:"number"===typeof this.forceMax?this.forceMax:a.MAX||this.currentFeaturesMaxScore||0};"undefined"!==typeof u&&(u.exports={drawFeatureTier:l})},
{"./cigar":8,"./color":9,"./das":10,"./features":19,"./glyphs":20,"./numformats":25,"./spans":34,"./tier":43,"./utils":47}],18:[function(e,u,r){function p(b,a,q){var d=g(q.type,a.type),h=g(q.label,a.label,q.id,a.id);h&&0!=h.indexOf("__dazzle")&&(d=d+": "+h);this.hit=b;this.feature=a;this.group=q;this.title=d;this.sections=[]}function l(b,a){var g=[];if(b)for(var d=0;d<b.length;++d)y(g,b[d]);if(a)for(d=0;d<a.length;++d)y(g,a[d]);return g}if("undefined"!==typeof e){var m=e("./cbrowser").Browser;e=e("./utils");
var g=e.pick,y=e.pushnew,v=e.makeElement}var z=/^([A-Za-z_-]+)=(.+)/;m.prototype.addFeatureInfoPlugin=function(b){this.featureInfoPlugins||(this.featureInfoPlugins=[]);this.featureInfoPlugins.push(b)};p.prototype.setTitle=function(b){this.title=b};p.prototype.add=function(b,a){"string"===typeof a&&(a=v("span",a));this.sections.push({label:b,info:a})};m.prototype.featurePopup=function(b,a,g,d){var h=g.length;a=0<=--h?g[h]:{};var k=0<=--h?g[h]:{};g=new p(g,a,k);g.tier=d;for(var h=this.featureInfoPlugins||
[],c=0;c<h.length;++c)try{h[c](a,g)}catch(e){console.log(e.stack||e)}h=d.featureInfoPlugins||[];for(c=0;c<h.length;++c)try{h[c](a,g)}catch(m){console.log(m.stack||m)}this.removeAllPopups();d=v("table",null,{className:"table table-striped table-condensed"});d.style.width="100%";d.style.margin="0px";h=0;a.method&&(c=v("tr",[v("th","Method"),v("td",a.method)]),d.appendChild(c),++h);c=k.segment?k:a;c=v("tr",[v("th","Location"),v("td",c.segment+":"+c.min+"-"+c.max,{},{minWidth:"200px"})]);d.appendChild(c);
++h;void 0===a.score||null===a.score||"-"==a.score||a.suppressScore||(c=v("tr",[v("th","Score"),v("td",""+a.score)]),d.appendChild(c),++h);(c=l(k.links,a.links))&&0<c.length&&(c=v("tr",[v("th","Links"),v("td",c.map(function(a){return v("div",v("a",a.desc,{href:a.uri,target:"_new"}))}))]),d.appendChild(c),++h);a=l(k.notes,a.notes);for(k=0;k<a.length;++k){var c="Note",y=a[k],N=y.match(z);N&&(c=N[1],y=N[2]);c=v("tr",[v("th",c),v("td",y)]);d.appendChild(c);++h}for(a=0;a<g.sections.length;++a)h=g.sections[a],
d.appendChild(v("tr",[v("th",h.label),v("td",h.info)]));this.popit(b,g.title||"Feature",d,{width:450})}},{"./cbrowser":6,"./utils":47}],19:[function(e,u,r){function p(g){for(var e=g.browser.drawnStart,p=g.browser.drawnEnd,z={},b={},a={},q={},d={},h={},k={},c={},t=[],B,r,N,O=function(){N={};for(var a=0;a<g.currentFeatures.length;++a){var b=g.currentFeatures[a];b.id&&(N[b.id]=b)}},C=function(a){var b=[];if(a.parents)for(var f=0;f<a.parents.length;++f){var c=a.parents[f],d=N[c];d&&"SO:0000704"==d.typeCv&&
pushnew(b,c)}return b},w=0;w<g.currentFeatures.length;++w){var G=g.currentFeatures[w];if(!G.parts){var K=G.min<=p&&G.max>=e;if(G.min&&G.max){if(G.score&&"."!=G.score&&"-"!=G.score){var u=1*G.score;if(!B||u<B)B=u;if(!r||u>r)r=u}var u=[],f=null;if(G.groups)for(var x=0;x<G.groups.length;++x){var D=G.groups[x],M=D.id;if("gene"==D.type)f=M,h[M]=D;else if("translation"!=D.type){l(b,M,G);h[M]=D;u.push(M);D=q[M];if(!D||G.min<D)q[M]=G.min;D=d[M];if(!D||G.max>D)d[M]=G.max}}if(G.parents)for(N||O(),x=0;x<G.parents.length;++x){var s=
G.parents[x],E=N[s];if(E){E.parts||(E.parts=[G]);m(b,s,E);l(b,s,G);h[s]||(h[s]={type:E.type,id:E.id,label:E.label||E.id});u.push(s);D=q[s];if(!D||G.min<D)q[s]=G.min;D=d[s];if(!D||G.max>D)d[s]=G.max;D=C(E);0<D.length&&(f=D[0],s=N[D[0]],h[D[0]]={type:s.type,id:s.id,label:s.label||s.id},g.dasSource.collapseSuperGroups||(g.dasSource.collapseSuperGroups=!0))}}if(0==u.length)K&&l(z,G.type,G);else if(f)for(D=0;D<u.length;++D)M=u[D],m(k,f,M),c[M]=f}else t.push(G)}}for(M in b)t=h[M],"number"!==typeof t.min&&
(t.min=q[M]),"number"!==typeof t.max&&(t.max=d[M]),d[M]>=e&&q[M]<=p&&(a[M]=b[M]);g.ungroupedFeatures=z;g.groupedFeatures=a;g.groups=h;g.superGroups=k;g.groupsToSupers=c;B&&(0<B?B=0:0>r&&(r=0),g.currentFeaturesMinScore=B,g.currentFeaturesMaxScore=r)}if("undefined"!==typeof e){e=e("./utils");var l=e.pusho,m=e.pushnewo}"undefined"!==typeof u&&(u.exports={sortFeatures:p})},{"./utils":47}],20:[function(e,u,r){function p(a,b){this._stroke=a;this._fill=b}function l(a,b,f,c,d,h,k,g){this.x=a;this.y=b;this._width=
f;this._height=c;this.fill=d;this.stroke=h;this._alpha=k;this._radius=g||0}function m(a,b){this.glyphs=a;this.connector=b;this.h=a[0].height();for(var f=[],c=0;c<a.length;++c){var d=a[c];f.push(new M(d.min(),d.max()));this.h=Math.max(this.h,d.height())}this.coverage=D(f)}function g(a,b,f){this.points=a;this.color=b;this._height=f||50}function y(a,b,f,c,d,h,k){this.glyph=b;this.text=f;this.anchor=d||"left";this.align=h||"below";k&&(this.font=k);this.font&&(a.save(),a.font=this.font);f=a.measureText(f);
this.font&&a.restore();this.textLen=f.width;this.textHeight=5;this.bump=b.bump;this.measured=!c}function v(a,b,f){this._x=a;this._height=b;this._stroke=f}function z(a,b,f){this._x=a;this._height=b;this._stroke=f}function b(a,b,f,c,d,h){p.call(this,h,d);this._x=a;this._height=b;this._dir=f;this._width=c}function a(a,b,f,c){this._x=a;this._height=b;this._fill=f;this._stroke=c}function q(a,b,f){this.glyph=a;this._min=b;this._max=f;a&&(this.bump=a.bump)}function d(a,b,f,c,d,h){p.call(this,d,c);this._min=
a;this._max=b;this._height=f;this._ori=h}function h(a,b,f,c){p.call(this,c,null);this._min=a;this._max=b;this._height=f}function k(a,b,f,c,d,h){this._min=a;this._max=b;this._height=f;this._style=c;this._strand=d;this._stroke=h}function c(a,b,f,c,d){this._min=a;this._max=b;this._height=f;this._fill=c;this._stroke=d}function t(a,b,f,c,d,h,k){p.call(this,null,c);this._min=a;this._max=b;this._height=f;this._color=c;this._parallel=d;this._sw=h;this._ne=k}function B(a,b,f,c,d){this._min=a;this._max=b;this._height=
f;this._fill=c;this._stroke=d}function Q(a,b,f,c,d,h){this._min=b;this._max=f;this._height=c;this._fill=d;this._string=h;this._textLen=a.measureText(h).width}function N(a,b,f){var c={red:"darkred",purple:"mediumpurple",blue:"darkblue",green:"darkgreen"}[f.toLowerCase()];f=c?[f,c]:["rgb(73, 68, 149)","rgb(9, 0, 103)"];return"?"==a?"black":"M"==a?"greenyellow":"*"==a?"crimson":f[b%2]}function O(a){var b={A:"T",T:"A",G:"C",C:"G"};a=a.split("").reverse().join("");for(var f=[],c=0;c<a.length;++c){var d=
a.substr(c,1).toUpperCase();f.push(d in b?b[d]:"N")}return f.join("")}function C(a,b,f,c,d,h,k){this._min=a;this._max=b;this._height=f;this._fill=c;this._seq=d;this._orientation=h;this._readframe=k}function w(a,b,f,c){this.glyph=a;this._height=c;this._x=b;this._y=f}function G(a,b,f,c){this._x=a;this._y=b;this._height=f;this._fill=c}function K(a){this._height=a||50}function H(a,b,f,c,d){p.call(this,d,c);this._x=a;this._r=b;this._points=f}function f(a,b,f,c,d){this._x=a;this._height=b;this._overhang=
f;this._fill=c;this._stroke=d;this._hh=b/2}function x(){this.oy=this.ox=0;this.glyphs=[]}if("undefined"!==typeof e){r=e("./spans");var D=r.union,M=r.Range;r=e("./utils");var s=r.makeElementNS,E=r.AMINO_ACID_TRANSLATION;e=e("./svg-utils");var F=e.NS_SVG,A=e.SVGPath}p.prototype.draw=function(a){a.beginPath();this.drawPath(a);this._fill&&(a.fillStyle=this._fill,a.fill());this._stroke&&(a.strokeStyle=this._stroke,a.stroke())};p.prototype.toSVG=function(){var a=new A;this.drawPath(a);return s(F,"path",
null,{d:a.toPathData(),fill:this._fill||"none",stroke:this._stroke||"none"})};p.prototype.drawPath=function(a){throw"drawPath method on PathGlyphBase must be overridden";};l.prototype.draw=function(a){var b=this._radius;0<b?(a.beginPath(),a.moveTo(this.x+b,this.y),a.lineTo(this.x+this._width-b,this.y),a.arcTo(this.x+this._width,this.y,this.x+this._width,this.y+b,b),a.lineTo(this.x+this._width,this.y+this._height-b),a.arcTo(this.x+this._width,this.y+this._height,this.x+this._width-b,this.y+this._height,
b),a.lineTo(this.x+b,this.y+this._height),a.arcTo(this.x,this.y+this._height,this.x,this.y+this._height-b,b),a.lineTo(this.x,this.y+b),a.arcTo(this.x,this.y,this.x+b,this.y,b),a.closePath(),null!=this._alpha&&(a.save(),a.globalAlpha=this._alpha),this.fill&&(a.fillStyle=this.fill,a.fill()),this.stroke&&(a.strokeStyle=this.stroke,a.lineWidth=0.5,a.stroke())):(null!=this._alpha&&(a.save(),a.globalAlpha=this._alpha),this.fill&&(a.fillStyle=this.fill,a.fillRect(this.x,this.y,this._width,this._height)),
this.stroke&&(a.strokeStyle=this.stroke,a.lineWidth=0.5,a.strokeRect(this.x,this.y,this._width,this._height)));null!=this._alpha&&a.restore()};l.prototype.toSVG=function(){var a=s(F,"rect",null,{x:this.x,y:this.y,width:this._width,height:this._height,stroke:this.stroke||"none",strokeWidth:0.5,fill:this.fill||"none"});null!=this._alpha&&a.setAttribute("opacity",this._alpha);return a};l.prototype.min=function(){return this.x};l.prototype.max=function(){return this.x+this._width};l.prototype.height=
function(){return this.y+this._height};m.prototype.drawConnectors=function(a){for(var b=this.coverage.ranges(),f=1;f<b.length;++f){var c=b[f],d=b[f-1];if(d&&c.min()>d.max()){var d=d.max(),c=c.min(),h=(d+c)/2;"hat+"===this.connector?(a.moveTo(d,this.h/2),a.lineTo(h,0),a.lineTo(c,this.h/2)):"hat-"===this.connector?(a.moveTo(d,this.h/2),a.lineTo(h,this.h),a.lineTo(c,this.h/2)):"collapsed+"===this.connector?(a.moveTo(d,this.h/2),a.lineTo(c,this.h/2),4<c-d&&(a.moveTo(h-2,this.h/2-3),a.lineTo(h+2,this.h/
2),a.lineTo(h-2,this.h/2+3))):"collapsed-"===this.connector?(a.moveTo(d,this.h/2),a.lineTo(c,this.h/2),4<c-d&&(a.moveTo(h+2,this.h/2-3),a.lineTo(h-2,this.h/2),a.lineTo(h+2,this.h/2+3))):(a.moveTo(d,this.h/2),a.lineTo(c,this.h/2))}}};m.prototype.draw=function(a,b){for(var f=0;f<this.glyphs.length;++f)this.glyphs[f].draw(a,b);a.strokeStyle="black";a.beginPath();this.drawConnectors(a);a.stroke()};m.prototype.toSVG=function(){for(var a=s(F,"g"),b=0;b<this.glyphs.length;++b)a.appendChild(this.glyphs[b].toSVG());
b=new A;this.drawConnectors(b);0<b.toPathData().length&&(b=s(F,"path",null,{d:b.toPathData(),fill:"none",stroke:"black",strokeWidth:0.5}),a.appendChild(b));return a};m.prototype.min=function(){return this.coverage.min()};m.prototype.max=function(){return this.coverage.max()};m.prototype.height=function(){return this.h};g.prototype.min=function(){return this.points[0]};g.prototype.max=function(){return this.points[this.points.length-2]};g.prototype.height=function(){return this._height};g.prototype.draw=
function(a){a.save();a.strokeStyle=this.color;a.lineWidth=2;a.beginPath();for(var b=0;b<this.points.length;b+=2){var f=this.points[b],c=this.points[b+1];0==b?a.moveTo(f,c):a.lineTo(f,c)}a.stroke();a.restore()};g.prototype.toSVG=function(){for(var a=new A,b=0;b<this.points.length;b+=2){var f=this.points[b],c=this.points[b+1];0==b?a.moveTo(f,c):a.lineTo(f,c)}return s(F,"path",null,{d:a.toPathData(),fill:"none",stroke:this.color,strokeWidth:"2px"})};y.prototype.toSVG=function(){var a=this.glyph.toSVG(),
b={};"above"==this.align?(a=s(F,"g",a,{transform:"translate(0, "+(this.textHeight|2)+")"}),b.y=this.textHeight):b.y=this.glyph.height()+15;this.font&&(b.fontSize=7);b.x="center"==this.anchor?(this.glyph.min()+this.glyph.max()-this.textLen)/2:this.glyph.min();return s(F,"g",[a,s(F,"text",this.text,b)])};y.prototype.min=function(){return this.glyph.min()};y.prototype.max=function(){return this.measured?Math.max(this.glyph.max(),1*this.glyph.min()+this.textLen+10):this.glyph.max()};y.prototype.height=
function(){var a=this.glyph.height();this.measured&&(a="above"==this.align?a+(this.textHeight+2):a+20);return a};y.prototype.draw=function(a,b){"above"==this.align&&(a.save(),a.translate(0,this.textHeight+2));this.glyph.draw(a);"above"==this.align&&a.restore();b.registerGlyph(this)};y.prototype.drawOverlay=function(a,b,f){a.fillStyle="black";this.font&&(a.save(),a.font=this.font);"center"==this.anchor?f=(this.glyph.min()+this.glyph.max()-this.textLen)/2:(f=this.glyph.min(),f<b&&(f=Math.min(b,this.glyph.max()-
this.textLen)));a.fillText(this.text,f,"above"==this.align?this.textHeight:this.glyph.height()+15);this.font&&a.restore()};v.prototype.draw=function(a){var b=this._height/2;a.beginPath();a.moveTo(this._x,0);a.lineTo(this._x,this._height);a.moveTo(this._x-b,b);a.lineTo(this._x+b,b);a.strokeStyle=this._stroke;a.lineWidth=1;a.stroke()};v.prototype.toSVG=function(){var a=this._height/2,b=new A;b.moveTo(this._x,0);b.lineTo(this._x,this._height);b.moveTo(this._x-a,a);b.lineTo(this._x+a,a);return s(F,"path",
null,{d:b.toPathData(),fill:"none",stroke:this._stroke,strokeWidth:"1px"})};v.prototype.min=function(){return this._x-this._height/2};v.prototype.max=function(){return this._x+this._height/2};v.prototype.height=function(){return this._height};z.prototype.draw=function(a){var b=this._height/2;a.beginPath();a.moveTo(this._x-b,0);a.lineTo(this._x+b,this._height);a.moveTo(this._x-b,this._height);a.lineTo(this._x+b,0);a.strokeStyle=this._stroke;a.lineWidth=1;a.stroke()};z.prototype.toSVG=function(){var a=
this._height/2,b=new A;b.moveTo(this._x-a,0);b.lineTo(this._x+a,this._height);b.moveTo(this._x-a,this._height);b.lineTo(this._x+a,0);return s(F,"path",null,{d:b.toPathData(),fill:"none",stroke:this._stroke,strokeWidth:"1px"})};z.prototype.min=function(){return this._x-this._height/2};z.prototype.max=function(){return this._x+this._height/2};z.prototype.height=function(){return this._height};b.prototype=Object.create(p.prototype);b.prototype.drawPath=function(a){var b=this._height/2,f=this._width/
2;"S"===this._dir?(a.moveTo(this._x,this._height),a.lineTo(this._x-f,0),a.lineTo(this._x+f,0)):"W"===this._dir?(a.moveTo(this._x+f,b),a.lineTo(this._x-f,0),a.lineTo(this._x-f,this._height)):"E"===this._dir?(a.moveTo(this._x-f,b),a.lineTo(this._x+f,0),a.lineTo(this._x+f,this._height)):(a.moveTo(this._x,0),a.lineTo(this._x+f,this._height),a.lineTo(this._x-f,this._height));a.closePath()};b.prototype.min=function(){return this._x-this._height/2};b.prototype.max=function(){return this._x+this._height/
2};b.prototype.height=function(){return this._height};a.prototype.draw=function(a){var b=this._height/2;a.fillStyle=this._stroke;a.beginPath();a.arc(this._x,b,b,0,6.29);this._fill&&(a.fillStyle=this._fill,a.fill());this._stroke&&(a.strokeStyle=this._stroke,a.stroke())};a.prototype.toSVG=function(){var a=this._height/2;return s(F,"circle",null,{cx:this._x,cy:a,r:a,fill:this._fill||"none",stroke:this._stroke||"none",strokeWidth:"1px"})};a.prototype.min=function(){return this._x-this._height/2};a.prototype.max=
function(){return this._x+this._height/2};a.prototype.height=function(){return this._height};q.prototype.draw=function(a,b){this.glyph&&this.glyph.draw(a,b)};q.prototype.toSVG=function(){return this.glyph?this.glyph.toSVG():s(F,"g")};q.prototype.min=function(){return this._min};q.prototype.max=function(){return this._max};q.prototype.height=function(){return this.glyph?this.glyph.height():1};d.prototype=Object.create(p.prototype);d.prototype.min=function(){return this._min};d.prototype.max=function(){return this._max};
d.prototype.height=function(){return this._height};d.prototype.drawPath=function(a){var b=this._max,f=this._min,c=this._height,d=0,h=0,k=this._height+2,g=0.333333*this._height;this._ori&&("+"===this._ori?h=0.5*this._height:"-"===this._ori&&(d=0.5*this._height));b-f<k&&(f=(b+f-k)/2,b=f+k);a.moveTo(f+d,0+g);a.lineTo(b-h,0+g);a.lineTo(b-h,0);a.lineTo(b,0+this._height/2);a.lineTo(b-h,0+c);a.lineTo(b-h,0+g+g);a.lineTo(f+d,0+g+g);a.lineTo(f+d,0+c);a.lineTo(f,0+c/2);a.lineTo(f+d,0);a.lineTo(f+d,0+g)};h.prototype=
Object.create(p.prototype);h.prototype.min=function(){return this._min};h.prototype.max=function(){return this._max};h.prototype.height=function(){return this._height};h.prototype.drawPath=function(a){var b=this._min,f=this._max,c=this._height,d=c/2;a.moveTo(b,d);a.lineTo(f,d);a.moveTo(b,0);a.lineTo(b,c);a.moveTo(f,0);a.lineTo(f,c)};k.prototype.min=function(){return this._min};k.prototype.max=function(){return this._max};k.prototype.height=function(){return this._height};k.prototype.drawPath=function(a){var b=
this._min,f=this._max,c=this._height,d=c/2;"hat"===this._style?(a.moveTo(b,d),a.lineTo((b+f)/2,"-"===this._strand?c:0)):a.moveTo(b,d);a.lineTo(f,d)};k.prototype.draw=function(a){a.beginPath();this.drawPath(a);a.strokeStyle=this._stroke;"dashed"===this._style&&a.setLineDash?(a.save(),a.setLineDash([3]),a.stroke(),a.restore()):a.stroke()};k.prototype.toSVG=function(){var a=new A;this.drawPath(a);a={d:a.toPathData(),stroke:this._stroke||"none"};"dashed"===this._style&&(a.strokeDasharray="3");return s(F,
"path",null,a)};c.prototype.min=function(){return this._min};c.prototype.max=function(){return this._max};c.prototype.height=function(){return this._height};c.prototype.drawStemPath=function(a){var b=this._max,f=this._height/2;a.moveTo(this._min,f);a.lineTo(b,f)};c.prototype.drawTrigsPath=function(a){var b=this._min,f=this._max,c=this._height,d=c/2;a.moveTo(b,0);a.lineTo(b+c,d);a.lineTo(b,c);a.lineTo(b,0);a.moveTo(f,0);a.lineTo(f-c,d);a.lineTo(f,c);a.lineTo(f,0)};c.prototype.draw=function(a){a.beginPath();
this.drawStemPath(a);a.strokeStyle=this._stroke;a.stroke();a.beginPath();this.drawTrigsPath(a);a.fillStyle=this._fill;a.fill()};c.prototype.toSVG=function(){var a=new A;this.drawStemPath(a);var b=new A;this.drawTrigsPath(b);return s(F,"g",[s(F,"path",null,{d:a.toPathData(),stroke:this._stroke||"none"}),s(F,"path",null,{d:b.toPathData(),fill:this._fill||"none"})])};t.prototype=Object.create(p.prototype);t.prototype.min=function(){return this._min};t.prototype.max=function(){return this._max};t.prototype.height=
function(){return this._height};t.prototype.drawPath=function(a){var b=this._min,f=this._max,c=this._height;if(this._parallel){var d=c/2,h=0.4*c;this._sw?(a.moveTo(b+d,c-h),a.lineTo(b+d,c),a.lineTo(b,d),a.lineTo(b+d,0),a.lineTo(b+d,h)):(a.moveTo(b,c-h),a.lineTo(b,h));this._ne?(a.lineTo(f-d,h),a.lineTo(f-d,0),a.lineTo(f,d),a.lineTo(f-d,c),a.lineTo(f-d,c-h)):(a.lineTo(f,h),a.lineTo(f,c-h))}else{var d=(b+f)/2,h=0.4*(f-b),k=c/3;this._ne?(a.moveTo(b+h,k),a.lineTo(b,k),a.lineTo(d,0),a.lineTo(f,k),a.lineTo(f-
h,k)):(a.moveTo(b+h,0),a.lineTo(f-h,0));this._sw?(a.lineTo(f-h,c-k),a.lineTo(f,c-k),a.lineTo(d,c),a.lineTo(b,c-k),a.lineTo(b+h,c-k)):(a.lineTo(f-h,c),a.lineTo(b+h,c))}a.closePath()};B.prototype.min=function(){return this._min};B.prototype.max=function(){return this._max};B.prototype.height=function(){return this._height};B.prototype.toSVG=function(){return s(F,"rect",null,{x:this._min,y:0,width:this._max-this._min,height:this._height,stroke:this._stroke||"none",fill:this._fill||"none"})};B.prototype.draw=
function(a){this._fill&&(a.fillStyle=this._fill,a.fillRect(this._min,0,this._max-this._min,this._height));if(this._stroke){a.strokeStyle=this._stroke;a.strokeRect(this._min,0,this._max-this._min,this._height);a.beginPath();for(var b=2;b<this._height;b+=3)a.moveTo(this._min,b),a.lineTo(this._max,b);a.stroke()}};Q.prototype.min=function(){return this._min};Q.prototype.max=function(){return Math.max(this._max,this._min+this._textLen)};Q.prototype.height=function(){return this._height};Q.prototype.draw=
function(a){a.fillStyle=this._fill;a.fillText(this._string,this._min,this._height-4)};Q.prototype.toSVG=function(){return s(F,"text",this._string,{x:this._min,y:this._height-4})};C.prototype.min=function(){return this._min};C.prototype.max=function(){return this._max};C.prototype.height=function(){return this._height};C.prototype.draw=function(a){var b=this._seq,f=this._fill;if(b){var c=(this._max-this._min+1)/b.length,d=(3-this._readframe)%3,h=(b.length-d)%3,d="+"==this._orientation?d:h;0<d&&(a.fillStyle=
f,a.fillRect(this._min,0,c*d,this._height));for(;d<b.length;d+=3){h=b.substr(d,3).toUpperCase();"-"==this._orientation&&(h=O(h));var k=h in E?E[h]:"?",f=3==h.length?N(k,d,this._fill):this._fill;a.fillStyle=f;a.fillRect(this._min+d*c,0,c*h.length,this._height);8<=c&&3==h.length&&(a.fillStyle="white",a.fillText(k,this._min+(d+1)*c,this._height))}}};C.prototype.toSVG=function(){var a=s(F,"g"),b=this._seq,f=this._fill;if(!b)return a;var c=(this._max-this._min+1)/b.length,d=(3-this._readframe)%3,h=(b.length-
d)%3,d="+"==this._orientation?d:h;for(0<d&&a.appendChild(s(F,"rect",null,{x:this._min,y:0,width:c*d,height:this._height,fill:f}));d<b.length;d+=3){h=b.substr(d,3).toUpperCase();"-"==this._orientation&&(h=O(h));var k=h in E?E[h]:"?",f=3==h.length?N(k,d,this._fill):this._fill;a.appendChild(s(F,"rect",null,{x:this._min+d*c,y:0,width:c*h.length,height:this._height,fill:f}));8<=c&&3==h.length&&a.appendChild(s(F,"text",k,{x:this._min+(d+1)*c,y:this._height,fill:"white"}))}return a};(function(a){function b(a,
f,c,d,h,k,n,g,e,q){this.baseColors=a;this._strandColor=f;this._min=c;this._max=d;this._height=h;this._seq=k;this._ref=n;this._scheme=g;this._quals=e;this._fillbg=q}var f=1<window.devicePixelRatio,c={},d=/^[ACGT-]$/;b.prototype.min=function(){return this._min};b.prototype.max=function(){return this._max};b.prototype.height=function(){return this._height};b.prototype.alphaForQual=function(a){return 0.1+0.9*Math.max(0,Math.min(1*a/30,1))};b.prototype.draw=function(a){var b=this._seq,h=this._ref,k="mismatch-all"===
this._scheme,n=b?b.length:this._max-this._min+1,g=(this._max-this._min+1)/n;"mismatch"!==this._scheme&&"mismatch-all"!==this._scheme||8<=g||(a.fillStyle=this._strandColor,a.fillRect(this._min,this._height/4,this._max-this._min,this._height/2));for(var e=0;e<n;++e){var q=b?b.substr(e,1).toUpperCase():"N";if(d.test(q)||8<=g){var x=this.baseColors[q];if(this._quals){var t=this._quals.charCodeAt(e)-33,s=a.globalAlpha;a.globalAlpha=this.alphaForQual(t)}x||(t=h?h.substr(e,1).toUpperCase():"N",x="N"==q||
"N"==t?"gray":this._strandColor,k&&(q=t));a.fillStyle=x;t=d.test(q);!this._fillbg&&8<=g&&t||a.fillRect(this._min+e*g,0,g,this._height);if(8<=g&&t){var t=x+"_"+q,m=c[t];if(!m){m=document.createElement("canvas");f?(m.width=16,m.height=20):(m.width=8,m.height=10);var l=m.getContext("2d");f&&l.scale(2,2);l.fillStyle=this._fillbg?"black":x;x=l.measureText(q).width;l.fillText(q,0.5*(8-x),8);c[t]=m}f?a.drawImage(m,this._min+e*g+0.5*(g-8),0,8,10):a.drawImage(m,this._min+e*g+0.5*(g-8),0)}this._quals&&(a.globalAlpha=
s)}}};b.prototype.toSVG=function(){for(var a=this._seq,b=this._ref,f="mismatch-all"===this._scheme,c=(this._max-this._min+1)/this._seq.length,h=s(F,"g"),k=0;k<a.length;++k){var n=a?a.substr(k,1).toUpperCase():"N",g=this.baseColors[n];if(!g){var e=b?b.substr(k,1).toUpperCase():"N",g="N"==n||"N"==e?"gray":this._strandColor;f&&(n=e)}e=1;this._quals&&(e=this._quals.charCodeAt(k)-33,e=this.alphaForQual(e));var q=d.test(n);!this._fillbg&&8<=c&&q||h.appendChild(s(F,"rect",null,{x:this._min+k*c,y:0,width:c,
height:this._height,fill:g,fillOpacity:e}));8<=c&&q&&h.appendChild(s(F,"text",n,{x:this._min+(0.5+k)*c,y:8,textAnchor:"middle",fill:this._fillbg?"black":g,fillOpacity:e}))}return h};a.SequenceGlyph=b})(this);w.prototype.height=function(){return this._height?this._height:this.glyph.height()+this._y};w.prototype.min=function(){return this.glyph.min()+this._x};w.prototype.max=function(){return this.glyph.max()+this._x};w.prototype.minY=function(){return this._y};w.prototype.maxY=function(){return this._y+
this.glyph.height()};w.prototype.draw=function(a,b){a.save();a.translate(this._x,this._y);this.glyph.draw(a,b);a.restore()};w.prototype.toSVG=function(){var a=this.glyph.toSVG();a.setAttribute("transform","translate("+this._x+","+this._y+")");return a};G.prototype.min=function(){return this._x-2};G.prototype.max=function(){return this._x+2};G.prototype.height=function(){return this._height};G.prototype.draw=function(a){a.save();a.globalAlpha=0.3;a.fillStyle=this._fill;a.beginPath();a.arc(this._x,
this._y,1.5,0,6.29);a.fill();a.restore()};G.prototype.toSVG=function(){return s(F,"circle",null,{cx:this._x,cy:this._y,r:2,fill:this._fill,stroke:"none"})};K.prototype.notSelectable=!0;K.prototype.min=function(){return-1E5};K.prototype.max=function(){return 1E5};K.prototype.height=function(){return this._height};K.prototype.draw=function(a){a.save();a.strokeStyle="black";a.lineWidth=0.1;a.beginPath();for(var b=0;b<=this._height;b+=10)a.moveTo(-5E3,b),a.lineTo(5E3,b);a.stroke();a.restore()};K.prototype.toSVG=
function(){for(var a=new A,b=0;b<=this._height;b+=10)a.moveTo(-5E3,b),a.lineTo(5E3,b);return s(F,"path",null,{d:a.toPathData(),fill:"none",stroke:"black",strokeWidth:"0.1px"})};H.prototype=Object.create(p.prototype);H.prototype.min=function(){return this._x-this._r};H.prototype.max=function(){return this._x+this._r};H.prototype.height=function(){return 2*this._r};H.prototype.drawPath=function(a){for(var b=this._x,f=this._r,c=this._r,d=0;d<this._points;++d){var h=6.28*d/this._points,k=b+c*Math.sin(h),
h=f-c*Math.cos(h);0==d?a.moveTo(k,h):a.lineTo(k,h);h=6.28*(d+0.5)/this._points;k=b+0.4*c*Math.sin(h);h=f-0.4*c*Math.cos(h);a.lineTo(k,h)}a.closePath()};f.prototype.draw=function(a){var b=this._height/2;a.fillStyle=this._stroke;a.beginPath();a.arc(this._x,b,b-this._overhang,0,6.29);a.moveTo(this._x,0);a.lineTo(this._x,this._height);this._fill&&(a.fillStyle=this._fill,a.fill());this._stroke&&(a.strokeStyle=this._stroke,a.stroke())};f.prototype.toSVG=function(){var a=this._hh;return s(F,"g",[s(F,"circle",
null,{cx:this._x,cy:a,r:a-this._overhang}),s(F,"line",null,{x1:this._x,y1:0,x2:this._x,y2:this._height})],{fill:this._fill||"none",stroke:this._stroke||"none",strokeWidth:"1px"})};f.prototype.min=function(){return this._x-this._hh};f.prototype.max=function(){return this._x+this._hh};f.prototype.height=function(){return this._height};x.prototype.translate=function(a,b){this.ox+=a;this.oy+=b};x.prototype.registerGlyph=function(a){this.glyphs.push({x:this.ox,y:this.oy,glyph:a})};x.prototype.draw=function(a,
b,f){for(var c=0;c<this.glyphs.length;++c){var d=this.glyphs[c];a.save();a.translate(d.x,d.y);d.glyph.drawOverlay(a,b,f);a.restore()}};"undefined"!==typeof u&&(u.exports={BoxGlyph:l,GroupGlyph:m,LineGraphGlyph:g,LabelledGlyph:y,CrossGlyph:v,ExGlyph:z,TriangleGlyph:b,DotGlyph:a,PaddedGlyph:q,AArrowGlyph:d,SpanGlyph:h,LineGlyph:k,PrimersGlyph:c,ArrowGlyph:t,TooManyGlyph:B,TextGlyph:Q,SequenceGlyph:this.SequenceGlyph,AminoAcidGlyph:C,TranslatedGlyph:w,GridGlyph:K,StarGlyph:H,PointGlyph:G,PlimsollGlyph:f,
OverlayLabelCanvas:x})},{"./spans":34,"./svg-utils":37,"./utils":47}],21:[function(e,u,r){function p(e,g){this.base=e;this.query=g}if("undefined"!==typeof e)var l=e("./das").DASFeature;p.prototype.features=function(e,g,p){url=this.base+"/features/"+e.name;g=[];this.query&&g.push(this.query);e.isBounded&&(g.push("start="+e.start),g.push("end="+e.end));0<g.length&&(url=url+"?"+g.join("&"));var v=new XMLHttpRequest;v.onreadystatechange=function(){if(4==v.readyState)if(300<=v.status)p(null,"Error code "+
v.status);else{var g=JSON.parse(v.response).features,b=[];for(fi=0;fi<g.length;++fi){var a=g[fi],q=new l;q.segment=e;q.min=(a.start|0)+1;q.max=a.end|0;a.name&&(q.label=a.name);q.type=a.type||"unknown";b.push(q)}p(b)}};v.open("GET",url,!0);v.responseType="text";v.send("")};"undefined"!==typeof u&&(u.exports={JBrowseStore:p})},{"./das":10}],22:[function(e,u,r){function p(){var a=this;this.reqs=[];this.awaitedFeatures={};this.requestsIssued=new w(function(b,c){a.notifyRequestsIssued=b})}function l(a,
b,c,f,d,h,k){this.chr=a;this.min=b;this.max=c;this.coverage=k;this.scale=f;this.features=d||[];this.status=h}function m(a,b,c,f,d,h){this.tierMap=a;this.chr=b;this.min=c;this.max=f;this.scale=d;this.seqSource=h||new k;this.viewCount=0;this.featureCache={};this.latestViews={}}function g(a,b,c){for(var f=[],d={},h=0;h<a.length;++h){var k=a[h];k.min&&k.max?k.groups&&0<k.groups.length?v(d,k.groups[0].id,k):k.min<=c&&k.max>=b&&f.push(k):f.push(k)}for(var g in d){a=d[g];for(var e=1E11,q=-1E11,h=0;h<a.length;++h)k=
a[h],e=Math.min(e,k.min),q=Math.max(q,k.max);if(e<=c||q>=b)for(h=0;h<a.length;++h)f.push(a[h])}return f}if("undefined"!==typeof e){r=e("./utils");var y=r.Awaited,v=r.pusho;r=e("./sourceadapters");var z=r.MappedFeatureSource,b=r.CachingFeatureSource,a=r.BWGFeatureSource,q=r.RemoteBWGFeatureSource,d=r.BAMFeatureSource,h=r.RemoteBAMFeatureSource,k=r.DummySequenceSource,c=r.DummyFeatureSource,t=e("./overlay").OverlayFeatureSource;r=e("./spans");var B=r.Range,Q=r.intersection;r=e("./sample");var N=r.downsample,
O=r.getBaseCoverage,C=e("./das").DASSequence,w=e("es6-promise").Promise}p.prototype.addRequest=function(a){this.reqs.push(a)};p.prototype.abortAll=function(){for(var a=0;a<this.reqs.length;++a)this.reqs[a].abort()};l.prototype.toString=function(){return this.chr+":"+this.min+".."+this.max+";scale="+this.scale};m.prototype.cancel=function(){this.cancelled=!0};m.prototype.bestCacheOverlapping=function(a,b,c){return(a=this.featureCache[this.tierMap[0]])?a:null};m.prototype.viewFeatures=function(a,b,
c,f){if(f!=f)throw"viewFeatures called with silly scale";if(a!=this.chr)throw"Can't extend Known Space to a new chromosome";1>b&&(b=1);this.min=b;this.max=c;this.scale=f;this.pool&&this.pool.abortAll();this.pool=new p;this.awaitedSeq=new y;this.seqWasFetched=!1;this.viewCount++;this.startFetchesForTiers(this.tierMap);this.pool.notifyRequestsIssued()};m.prototype.invalidate=function(a){this.pool&&(this.featureCache[a]=null,this.startFetchesForTiers([a]))};m.prototype.startFetchesForTiers=function(a){for(var b=
this,c=this.awaitedSeq,f=!1,d,h=0;h<a.length;++h)try{this.startFetchesFor(a[h],c)&&(f=!0)}catch(k){d=a[h],d.currentFeatures=[],d.currentSequence=null,d.draw(),d.updateHeight(),d.updateStatus(k),console.log("Error fetching tier source"),console.log(k),d=k}if(f&&!this.seqWasFetched){this.seqWasFetched=!0;var g=this.min,e=this.max;if(this.cs&&this.cs.start<=g&&this.cs.end>=e)return a=this.cs.start==g&&this.cs.end==e?this.cs:new C(this.cs.name,g,e,this.cs.alphabet,this.cs.seq.substring(g-this.cs.start,
e+1-this.cs.start)),c.provide(a);this.seqSource.fetch(this.chr,g,e,this.pool,function(a,f){if(f){if(!b.cs||g<=b.cs.start&&e>=b.cs.end||g>=b.cs.end||e<=b.cs.start||e-g>b.cs.end-b.cs.start)b.cs=f;c.provide(f)}else console.log("Sequence loading failed",a),c.provide(null)})}if(d)throw d;};m.prototype.startFetchesFor=function(a,b){var d=this,f=this.viewCount,h=a.getSource()||new c,k=a.needsSequence(this.scale),e=d.featureCache[a],q=a.getActiveStyleFilters(this.scale),t;q&&(t=q.typeList());var m=this.chr,
p=this.min,n=this.max;if(void 0===t)return!1;if(e&&e.chr===this.chr&&e.min<=p&&e.max>=n){var v=e.features;if(e.min<p||e.max>n)v=g(v,p,n);d.provision(a,e.chr,Q(e.coverage,new B(p,n)),e.scale,t,v,e.status,k?b:null);v=h.getScales();if(e.scale<=this.scale||!v)return k}h.instrument&&console.log("Starting  fetch "+f+" ("+p+", "+n+")");h.fetch(m,p,n,this.scale,t,this.pool,function(c,g,q,s){h.instrument&&console.log("Finishing fetch "+f);var v=d.latestViews[a]||-1;if(!(d.cancelled||v>f)){s||(s=new B(p,n));
if(!e||p<e.min||n>e.max)d.featureCache[a]=new l(m,p,n,q,g,c,s);d.latestViews[a]=f;d.provision(a,m,s,q,t,g,c,k?b:null)}},q);return k};m.prototype.provision=function(c,k,g,f,e,m,l,s){l&&(c.currentFeatures=[],c.currentSequence=null,c.draw(),c.updateHeight());c.updateStatus(l);if(!l){for(var p=l=!1,B=c.getSource();z.prototype.isPrototypeOf(B)||b.prototype.isPrototypeOf(B)||t.prototype.isPrototypeOf(B);)B=t.prototype.isPrototypeOf(B)?B.sources[0]:B.source;if(a.prototype.isPrototypeOf(B)||q.prototype.isPrototypeOf(B)||
d.prototype.isPrototypeOf(B)||h.prototype.isPrototypeOf(B))l=!0;B.opts&&(B.opts.forceReduction||B.opts.noDownsample)||l&&e&&1==e.length&&0<=e.indexOf("density")&&(m=N(m,this.scale));e&&1==e.length&&0<=e.indexOf("base-coverage")&&(p=!0);s?s.await(function(a){p&&(m=O(m,a,c.browser.baseColors));c.viewFeatures(k,g,f,m,a)}):c.viewFeatures(k,g,f,m)}};"undefined"!==typeof u&&(u.exports={KnownSpace:m})},{"./das":10,"./overlay":26,"./sample":28,"./sourceadapters":33,"./spans":34,"./utils":47,"es6-promise":51}],
23:[function(e,u,r){function p(a,b){this.block=a;this.offset=b}function l(a,b){var d=4294967296*(a[b+6]&255)+16777216*(a[b+5]&255)+65536*(a[b+4]&255)+256*(a[b+3]&255)+(a[b+2]&255),h=a[b+1]<<8|a[b];return 0==d&&0==h?null:new p(d,h)}function m(a,g){g=Math.min(g||1,a.byteLength-50);for(var d=[],h=[0],k=0;h[0]<g;){var c=new Uint8Array(a,h[0],12),c=c[11]<<8|c[10],c=z(a,12+c+h[0],Math.min(65536,a.byteLength-12-c-h[0]),h);h[0]+=8;k+=c.byteLength;d.push(c)}if(1==d.length)return d[0];h=new Uint8Array(k);for(c=
k=0;c<d.length;++c){var e=new Uint8Array(d[c]);b(e,0,h,k,e.length);k+=e.length}return h.buffer}function g(a,b){this.minv=a;this.maxv=b}function y(a,b){--b;return a>>14==b>>14?4681+(a>>14):a>>17==b>>17?585+(a>>17):a>>20==b>>20?73+(a>>20):a>>23==b>>23?9+(a>>23):a>>26==b>>26?1+(a>>26):0}function v(a,b){var d,h=[];--b;h.push(0);for(d=1+(a>>26);d<=1+(b>>26);++d)h.push(d);for(d=9+(a>>23);d<=9+(b>>23);++d)h.push(d);for(d=73+(a>>20);d<=73+(b>>20);++d)h.push(d);for(d=585+(a>>17);d<=585+(b>>17);++d)h.push(d);
for(d=4681+(a>>14);d<=4681+(b>>14);++d)h.push(d);return h}if("undefined"!==typeof e){e=e("jszlib");var z=e.inflateBuffer,b=e.arrayCopy}p.prototype.toString=function(){return""+this.block+":"+this.offset};"undefined"!==typeof u&&(u.exports={unbgzf:m,readVob:l,reg2bin:y,reg2bins:v,Chunk:g})},{jszlib:63}],24:[function(e,u,r){function p(){this.featuresByChr={};this.maxLength=1;this.chrRing=null}function l(b){this.source=b;y.call(this);this.storeHolder=new v;this.parser=g(b.payload);if(!this.parser)throw"Unsupported memstore payload: "+
b.payload;var a=this;this._load(function(b,d){if(b){for(var h=new p,k=[],c=b.split("\n"),g=a.parser.createSession(function(a){k.push(a)}),e=0;e<c.length;++e){var m=c[e];0<m.length&&g.parse(m)}g.flush();h.addFeatures(k);a.storeHolder.provide(h)}else a.error=d||"No data",a.storeHolder.provide(null)})}if("undefined"!==typeof e){u=e("./sourceadapters");var m=u.registerSourceAdapterFactory,g=u.makeParser,y=u.FeatureSourceBase;e("./das");e=e("./utils");var v=e.Awaited,z=e.textXHR}p.prototype.addFeatures=
function(b){for(var a={},g=0;g<b.length;++g){var d=b[g],h=d.segment||d.chr,k=this.featuresByChr[h];k||(k=[],this.featuresByChr[h]=k);k.push(d);a[h]=!0;d=d.max-d.min+1;d>this.maxLength&&(this.maxLength=d)}for(h in a)k=this.featuresByChr[h],k.sort(function(a,b){var d=a.min-b.min;return 0!=d?d:a.max-b.max});this.chrRing=null};p.prototype._indexFor=function(b,a){for(var g=0,d=b.length;d>g;){var h=(g+d)/2|0;if(h>=b.length)return b.length;a<b[h].min?d=h:g=h+1}return d};p.prototype.fetch=function(b,a,g){var d=
this.featuresByChr[b];d||(d=0==b.indexOf("chr")?this.featuresByChr[b.substring(3)]:this.featuresByChr["chr"+b]);if(!d)return[];var h=Math.max(0,this._indexFor(d,a-this.maxLength-1));b=Math.min(d.length-1,this._indexFor(d,g));for(var k=[];h<=b;++h){var c=d[h];c.min<=g&&c.max>=a&&k.push(c)}return k};p.prototype.findNextFeature=function(b,a,g){if(null==this.chrRing){this.chrRing=[];for(b in this.featuresByChr)this.chrRing.push(b);this.chrRing.sort()}var d=this.featuresByChr[b];d||(b=0==b.indexOf("chr")?
b.substring(3):"chr"+b,d=this.featuresByChr[b]);if(!d)return null;var h=Math.max(0,Math.min(this._indexFor(d,a),d.length-1));if(0<g){for(;h<d.length;){var k=d[h++];if(k.min>a)return k}b=this.chrRing.indexOf(b)+1;b>=this.chrRing.length&&(b=0);return this.findNextFeature(this.chrRing[b],0,g)}for(;0<=h;)if(k=d[h--],k.max<a)return k;b=this.chrRing.indexOf(b)-1;0>b&&(b=this.chrRing.length-1);return this.findNextFeature(this.chrRing[b],1E10,g)};l.prototype=Object.create(y.prototype);l.prototype._load=function(b){if(this.source.blob){var a=
new FileReader;a.onloadend=function(){return b(a.result,a.error)};a.readAsText(this.source.blob)}else z(this.source.uri,b,{})};l.prototype.fetch=function(b,a,g,d,h,k,c){var e=this;this.storeHolder.await(function(d){return d?(d=d.fetch(b,a,g),c(null,d,1E8)):c(e.error)})};l.prototype.getStyleSheet=function(b){this.parser&&this.parser.getStyleSheet&&this.parser.getStyleSheet(b)};l.prototype.getDefaultFIPs=function(b){this.parser&&this.parser.getDefaultFIPs&&this.parser.getDefaultFIPs(b)};l.prototype.getScales=
function(){return 1E8};l.prototype.findNextFeature=function(b,a,g,d){var h=this;this.storeHolder.await(function(k){return k?d(k.findNextFeature(b,a,g)):d(null,h.error)})};l.prototype.capabilities=function(){return{leap:!0}};m("memstore",function(b){return{features:new l(b)}})},{"./das":10,"./sourceadapters":33,"./utils":47}],25:[function(e,u,r){function p(e){return(e|0).toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")}function l(e){e=""+e;var g=e.indexOf(".");if(0>g)return e;var l=2;"-"==e.substring(0,
1)&&++l;return g>=l?e.substring(0,g):e.substring(0,g+2)}"undefined"!==typeof u&&(u.exports={formatLongInt:p,formatQuantLabel:l})},{}],26:[function(e,u,r){function p(e,l){this.sources=e;this.opts=l||{};this.activityListeners=[];this.readinessListeners=[];this.changeListeners=[];this.business=[];this.readiness=[];for(var b=0;b<this.sources.length;++b)this.initN(b);"function"===typeof l.merge?this.merge=l.merge:"concat"==l.merge?this.merge=g:"alternates"==l.merge?(this.merge=g,this.filterDispatchOnMethod=
!0):this.merge=m}function l(g,e,b){this.source=g;this.callback=e;this.sources=b;this.count=b.length;this.statusCount=this.returnCount=0;this.returns=[];this.features=[];this.statuses=[];this.scale=null}function m(g){for(var e=[],b=1;b<g.length;++b){for(var a={},q=g[b],d=0;d<q.length;++d)a[this.keyForFeature(q[d])]=q[d];e.push(a)}b=[];g=g[0];for(d=0;d<g.length;++d){for(var h=g[d],k=0;k<e.length;++k)if(a=e[k],q=a[this.keyForFeature(h)])for(var c in q)"score"===c?h.score2=q.score:"min"!==c&&"max"!==
c&&"segment"!==c&&"_cachedStyle"!==c&&(h[c]=q[c]);b.push(h)}return b}function g(g,e){for(var b=[],a=0;a<g.length;++a)for(var q=g[a],d=e[a].name,h=0;h<q.length;++h){var k=q[h];k.method=d;b.push(k)}return b}if("undefined"!==typeof e)var y=e("./utils").shallowCopy;p.prototype.initN=function(g){var e=this.sources[g],b=this;this.business[g]=0;e.addActivityListener&&e.addActivityListener(function(a){b.business[g]=a;b.notifyActivity()});e.addChangeListener&&e.addChangeListener(function(){b.notifyChange()});
e.addReadinessListener&&e.addReadinessListener(function(a){b.readiness[g]=a;b.notifyReadiness()})};p.prototype.addReadinessListener=function(g){this.readinessListeners.push(g);this.notifyReadinessListener(g)};p.prototype.notifyReadiness=function(){for(var g=0;g<this.readinessListeners.length;++g)this.notifyReadinessListener(this.readinessListeners[g])};p.prototype.notifyReadinessListener=function(g){for(var e=null,b=0;b<this.readiness.length;++b)if(null!=this.readiness[b]){e=this.readiness[b];break}try{g(e)}catch(a){console.log(a)}};
p.prototype.addActivityListener=function(g){this.activityListeners.push(g)};p.prototype.notifyActivity=function(){for(var g=0,e=0;e<this.business.length;++e)g+=this.business[e];for(e=0;e<this.activityListeners.length;++e)try{this.activityListeners[e](g)}catch(b){console.log(b)}};p.prototype.addChangeListener=function(g){this.changeListeners.push(g)};p.prototype.notifyChange=function(){for(var g=0;g<this.changeListeners.length;++g)try{this.changeListeners[g](this.busy)}catch(e){console.log(e)}};p.prototype.getScales=
function(){return this.sources[0].getScales()};p.prototype.getStyleSheet=function(g){return this.sources[0].getStyleSheet(g)};p.prototype.capabilities=function(){var g={},e=this.sources[0];e.capabilities&&(g=y(e.capabilities()));for(e=1;e<this.sources.length;++e){var b=this.sources[e];b.capabilities&&(b=b.capabilities(),b.search&&(g.search=b.search))}return g};p.prototype.search=function(g,e){for(var b=0;b<this.sources.length;++b){var a;a=this.sources[b];a=a.capabilities?a.capabilities().search:!1;
if(a)return this.sources[b].search(g,e)}};p.prototype.fetch=function(g,e,b,a,q,d,h,k){var c;if(this.filterDispatchOnMethod){c=[];for(var t=k.list(),m=0;m<this.sources.length;++m)for(var p=this.sources[m],N=0;N<t.length;++N){var O=t[N];if(!O.method||O.method==p.name){c.push(p);break}}}else c=this.sources;h=new l(this,h,c);for(m=0;m<c.length;++m)this.fetchN(h,m,c[m],g,e,b,a,q,d,k)};p.prototype.fetchN=function(g,e,b,a,q,d,h,k,c,t){b.fetch(a,q,d,h,k,c,function(a,b,c){return g.completed(e,a,b,c)},t)};
p.prototype.quantFindNextFeature=function(g,e,b,a,q){return this.sources[0].quantFindNextFeature(g,e,b,a,q)};p.prototype.findNextFeature=function(g,e,b,a){return this.sources[0].findNextFeature(g,e,b,a)};l.prototype.completed=function(g,e,b,a){if(null==this.scale||0==g)this.scale=a;if(this.returns[g])throw"Multiple returns for source "+g;this.returns[g]=!0;this.returnCount++;this.features[g]=b;e&&(this.statuses[g]=e,this.statusCount++);if(this.returnCount==this.count){if(0<this.statusCount){g="";
for(e=0;e<this.count;++e)if(b=this.statuses[e])0<g.length&&(g+=", "),g+=b;return this.callback(g,null,this.scale)}this.callback(null,this.source.merge(this.features,this.sources),this.scale)}};p.prototype.getDefaultFIPs=function(g){for(var e=0;e<this.sources.length;++e){var b=this.sources[e];b.getDefaultFIPs&&b.getDefaultFIPs(g)}};p.prototype.keyForFeature=function(g){return""+g.min+".."+g.max};"undefined"!==typeof u&&(u.exports={OverlayFeatureSource:p})},{"./utils":47}],27:[function(e,u,r){function p(h,
k,c){var e=/^\w+\s[0-9]+\s[0-9]+.*$/,B=/([^=]+)=\"?([^\"]+)\"?/,r=/^##\s*fileformat=VCFv4\..+/;(h.blob?new g(h.blob):new m(h.uri,{credentials:h.credentials})).slice(0,65536).salted().fetch(function(g,m){if(!g)return c||(h.credentials=!0,p(h,k,!0)),k(h,"Couldn't fetch data");var C=new Uint8Array(g),w=(new Uint32Array(g,0,1))[0];if(w==v||w==z){h.tier_type="bwg";C=/\/?([^/]+?)(.bw|.bb|.bigWig|.bigBed)?$/;if(C=C.exec(h.uri||h.blob.name))h.name=C[1];return k(h,null)}if(w==q)return h.tier_type="bai",k(h,
null);if(31==C[0]||139==C[1]){C=b(g);C=new Uint8Array(C);w=y(C,0);if(w==a){h.tier_type="bam";C=/\/?([^/]+?)(.bam)?$/;if(C=C.exec(h.uri||h.blob.name))h.name=C[1];return k(h,null)}if(w==d)return h.tier_type="tabix-index",k(h,null);if(1768301347==w){h.tier_type="tabix";h.payload="vcf";C=/\/?([^/]+?)(.vcf)?(.gz)?$/;if(C=C.exec(h.uri||h.blob.name))h.name=C[1];return k(h,null)}console.log("magic = "+w.toString(16));return k(h,"Unsupported format")}C=String.fromCharCode.apply(null,C).split("\n");if(0<C.length&&
r.test(C[0]))return h.tier_type="memstore",h.payload="vcf",C=/\/?([^/]+?)(.vcf)?$/,(C=C.exec(h.uri||h.blob.name))&&!h.name&&(h.name=C[1]),k(h,null);for(var u=0;u<C.length;++u)if(w=C[u].replace("\r",""),0!=w.length&&0!=w.indexOf("browser")){if(0==w.indexOf("track")){C="bed";w=w.split(/\s/);for(u=1;u<w.length;++u){var K=B.exec(w[u]);K&&("type"==K[1]&&"wiggle_0"==K[2]?C="wig":"name"==K[0]&&(h.name=K[2]))}l(h,C);return k(h,null)}if(0==w.indexOf("fixedStep")||0==w.indexOf("variableStep"))return l(h,"wig"),
k(h,null);if(e.test(w))return l(h,null),k(h,null);break}return k(h,"Unsupported format")})}function l(a,b){a.tier_type="memstore";var c=/\/?([^/]+?)(.(bed|wig))?$/.exec(a.uri||a.blob.name);c&&(a.name||(a.name=c[1]),!b&&c[3]&&(b=c[3]));a.payload=b||"bed"}if("undefined"!==typeof e){r=e("./bin");var m=r.URLFetchable,g=r.BlobFetchable,y=r.readInt;r=e("./bigwig");var v=r.BIG_WIG_MAGIC,z=r.BIG_BED_MAGIC,b=e("./lh3utils").unbgzf;r=e("./bam");var a=r.BAM_MAGIC,q=r.BAI_MAGIC,d=e("./tabix").TABIX_MAGIC}"undefined"!==
typeof u&&(u.exports={probeResource:p})},{"./bam":1,"./bigwig":3,"./bin":4,"./lh3utils":23,"./tabix":39}],28:[function(e,u,r){function p(a){return q[a%q.length]*Math.pow(10,a/q.length|0)}function l(a,b,k){this.scale=a;this.cnt=this.tot=0;this.hasScore=!1;this.min=b;this.max=k;this.features=[]}function m(a,b){return a.min<b.min?-1:a.min>b.min?1:a.max<b.max?-1:b.max>a.max?1:0}function g(a,b){for(var k=0;p(k+1)<b;)++k;for(var k=p(k),c=[],g=-1E10,e=1E10,q=0;q<a.length;++q){var m=a[q];if(m.groups&&0<m.groups.length)return a;
for(var v=m.min/k|0,C=m.max/k|0,g=Math.max(g,C),e=Math.min(e,v);v<=C;++v){var w=c[v];w||(w=new l(k,v*k,(v+1)*k-1),c[v]=w);w.feature(m)}}q=[];for(v=e;v<=g;++v)if(w=c[v])m=new z,m.segment=a[0].segment,m.min=v*k+1,m.max=(v+1)*k,m.score=w.score(),m.type="density",q.push(m);Date.now();return q}function y(a){this._pos=a;this._bases={};this._totalCount=0}function v(d,h,k){for(var c,g,e=null,q=null,m=[],l=0;l<d.length;++l){var p=d[l];if(p.groups&&0<p.groups.length)return d;c=p.seq;var w=p.quals,v=b(p.cigar),
r=[];g=[];for(var u=0,f=0;f<v.length;++f){var x=v[f];if("M"==x.op)r.push(c.substr(u,x.cnt)),g.push(w.substr(u,x.cnt)),u+=x.cnt;else if("D"==x.op)for(var D=0;D<x.cnt;++D)r.push("-"),g.push("Z");else"I"==x.op?u+=x.cnt:"S"==x.op?u+=x.cnt:console.log("unknown cigop"+x.op)}c=r.join("");g=g.join("");r=c;u=g;f=p.orientation;x=p.min||0;p=p.max||0;g=0;for(c=x;c<=p;++c)v=m[c],v||(v=new y(c),m[c]=v),w=r.charAt(g),D=u.charCodeAt(g)-33,v.recordBase(w,D,f),g++;e=e?Math.min(e,x):x;q=q?Math.max(q,p):p}p=e;l=q;g=
[];if(h&&(c=h.start|0,v=h.end|0,c<=l&&v>=p)){w=Math.max(p,c);v=Math.min(l,v);for(r=0;r<w-p;r++)g.push("N");g.push(h.seq.substr(w-c,v-w+1));for(r=0;r<l-v;r++)g.push("N")}h=g.join("");l=[];g=0;for(c=e;c<=q;++c){if(v=m[c])if(p=new z,p.segment=d[0].segment,p.min=v.pos(),p.max=p.min,p.notes=[],p.notes=p.notes.concat(v.infoList()),p.type="base-coverage",p.suppressScore=!0,h)for(e=h.charAt(g),p.notes.unshift("Ref="+e),v=v.baseScoreList(e,0.2),r=0;r<v.length;r++){w=v[r].base;u=v[r].score;f=a(p);f.score=u;
if(1<v.length||w!=e)f.itemRgb=k[w];l.push(f)}else l.push(p);g++}return l}if("undefined"!==typeof e)var z=e("./das").DASFeature,b=e("./cigar").parseCigar,a=e("./utils").shallowCopy;var q=[1,2,5];l.prototype.score=function(){if(0==this.cnt)return 0;if(this.hasScore)return this.tot/this.cnt;var a=this.features;a.sort(m);for(var b=-1E10,k=0,c=0,g=1;g<a.length;++g){var e=a[g],q=Math.max(e.min,this.min),e=Math.min(e.max,this.max),c=c+(e-q+1);q>b?(k+=e-q+1,b=e):e>b&&(k+=e-b,b=e)}return 0<k?1*c/k:0};l.prototype.feature=
function(a){void 0!==a.score&&(this.tot+=a.score,this.hasScore=!0);++this.cnt;this.features.push(a)};y.prototype.recordBase=function(a,b,k){if(this._bases[a])a=this._bases[a],a.cnt++,a.totalQual+=b,a.strandCnt[k]++;else{var c={"+":0,"-":0};c[k]++;this._bases[a]={cnt:1,totalQual:b,strandCnt:c}}this._totalCount++};y.prototype.totalCount=function(){return this._totalCount};y.prototype.pos=function(){return this._pos};y.prototype.infoList=function(){var a=[],b=this._totalCount;a.push("Depth="+b.toString());
for(var k in this._bases){var c=this._bases[k],g=c.cnt,e=c.strandCnt["+"],q=c.strandCnt["-"],c=c.totalQual/g,g=[k,"=",g," (",(100*g/b).toFixed(0),"%, ",e," +, ",q," -, Qual: ",c.toFixed(0),")"];a.push(g.join(""))}return a};y.prototype.baseScoreList=function(a,b){var k=[],c=this._totalCount,g=b*c,e;for(e in this._bases){var q=this._bases[e].cnt;q<g||e==a||(k.push({base:e,score:c}),c-=q)}k.push({base:a,score:c});return k};"undefined"!==typeof u&&(u.exports={downsample:g,getBaseCoverage:v})},{"./cigar":8,
"./das":10,"./utils":47}],29:[function(e,u,r){function p(g,e){var b=parseFloat(g.replace(/,/g,""));return"k"===e||"K"===e?1E3*b|0:"m"==e||"M"===e?1E6*b|0:b|0}if("undefined"!==typeof e)var l=e("./cbrowser").Browser,m=e("./bin").URLFetchable,g=e("./trix").connectTrix;var y=/^([\d+,\w,\.,\_,\-]+):([0-9,\.]+?)([KkMmGg])?((-|\.\.)+([0-9,\.]+)([KkMmGg])?)?$/;l.prototype.search=function(e,l){var b=this,a=y.exec(e);if(a){var q=a[1],d;if(a[6])d=p(a[2],a[3]),a=p(a[6],a[7]);else{var h=this.viewEnd-this.viewStart+
1;d=p(a[2],a[3])-h/2|0;a=d+h-1}this.setLocation(q,d,a,l)}else{if(!e||0==e.length)return!1;var k=0,c=!1,t=function(a,d){--k;if(d)return l(d);a||(a=[]);for(var h=5E8,g=-1E8,q=null,m=0;m<a.length;++m){var t=a[m];null==q&&(q=t.segment);h=Math.min(h,t.min);g=Math.max(g,t.max)}if(q)c=!0,b.highlightRegion(q,h,g),m=Math.max(2500,0.3*(g-h+1)|0),b.setLocation(q,h-m,g+m,l);else if(0==k&&!c)return l("no match for '"+e+"'")},B=function(a,b){b.lookup(e,function(b,c){if(null==b||2>b.length)return a.featureSource.search(e,
t);var d=b[1].split(",")[0];return a.featureSource.search(d,t)})};if(this.searchEndpoint)return k=1,this.doDasSearch(b.searchEndpoint,e,t);for(q=0;q<this.tiers.length;++q)(function(a){b.sourceAdapterIsCapable(a.featureSource,"search")?a.dasSource.trixURI?(++k,a.trix?B(a,a.trix):g(new m(a.dasSource.trixURI),new m(a.dasSource.trixURI+"x"),function(b){a.trix=b;B(a,b)})):(++k,a.featureSource.search(e,t)):a.dasSource.provides_search&&(++k,b.doDasSearch(a.dasSource,e,t))})(this.tiers[q])}};l.prototype.doDasSearch=
function(g,e,b){g.features(null,{group:e,type:"transcript"},function(a){a||(a=[]);for(var g=[],d=0;d<a.length;++d){var h=a[d];h.label.toLowerCase()==e.toLowerCase()&&g.push(h)}return b(g)},!1)}},{"./bin":4,"./cbrowser":6,"./trix":45}],30:[function(e,u,r){function p(g,d){d||(d=b);for(var h=a.length;g*a[h%a.length]*Math.pow(10,h/a.length|0)<d;)++h;return a[h%a.length]*Math.pow(10,h/a.length|0)}function l(a,b){var h=a.viewport.getContext("2d"),k=a.browser.retina&&1<window.devicePixelRatio,c=a.browser.featurePanelWidth+
2E3;k&&(c*=2);var g=a.viewport.width|0;g<c-50&&(a.viewport.width=g=c);c=50;b&&b.seq&&(c+=25);var e=c;k&&(e*=2);a.viewport.height=e;a.viewport.style.height=""+c+"px";a.viewport.style.width=k?""+g/2+"px":""+g+"px";a.layoutHeight=c;a.updateHeight();a.background&&(h.fillStyle=a.background,h.fillRect(0,0,g,a.viewport.height));k&&h.scale(2,2);m(a,b,h)}function m(a,b,h){var k=a.browser.scale,c=a.browser.viewStart-1E3/k|0,g=a.browser.viewEnd+2E3/k,e=a.browser.currentSeqMax;h.translate(1E3,0);var m=g;0<e&&
e<g&&(m=e);for(var l=p(k),v=Math.max(0,(c/l|0)*l),e=a.browser.viewStart;v<=m;)h.fillStyle=0==v/l%2?"white":"black",h.strokeStyle="black",h.fillRect((v-e)*k,8,l*k,3),h.strokeRect((v-e)*k,8,l*k,3),h.fillStyle="black",h.fillText(y(v),(v-e)*k,22),v+=l;if(b&&b.seq)for(;c<=g;++c)c>=b.start&&c<=b.end&&(m=b.seq.substr(c-b.start,1).toUpperCase(),(l=a.browser.baseColors[m])||(l="gray"),h.fillStyle=l,8<=k?(l=h.measureText(m).width,h.fillText(m,(c-e)*k+0.5*(k-l),52)):h.fillRect((c-e)*k,42,k,12));a.norigin=a.browser.viewStart;
a.viewportHolder.style.left="-1000px"}function g(a,b){var h=a.browser.scale,k=a.browser.viewStart-1E3/h|0,c=a.browser.viewEnd+2E3/h,g=a.browser.currentSeqMax,e=c;0<g&&g<c&&(e=g);for(var m=p(h),l=Math.max(0,(k/m|0)*m),g=a.browser.viewStart,r=v(z,"g",[],{fontSize:"8pt"});l<=e;)r.appendChild(v(z,"rect",null,{x:(l-g)*h,y:8,width:m*h,height:3,fill:0==l/m%2?"white":"black",stroke:"black"})),r.appendChild(v(z,"text",y(l),{x:(l-g)*h,y:28,fill:"black",stroke:"none"})),l+=m;if(b&&b.seq)for(;k<=c;++k)k>=b.start&&
k<=b.end&&(e=b.seq.substr(k-b.start,1).toUpperCase(),(m=a.browser.baseColors[e])||(m="gray"),8<=h?r.appendChild(v(z,"text",e,{x:(0.5+k-g)*h,y:52,textAnchor:"middle",fill:m})):r.appendChild(v(z,"rect",null,{x:(k-g)*h,y:42,width:h,height:12,fill:m})));return r}if("undefined"!==typeof e){r=e("./utils");var y=r.formatLongInt,v=r.makeElementNS,z=e("./svg-utils").NS_SVG,y=e("./numformats").formatLongInt}var b=100,a=[1,2,5],z="http://www.w3.org/2000/svg";"undefined"!==typeof u&&(u.exports={drawSeqTier:l,
drawSeqTierGC:m,svgSeqTier:g})},{"./numformats":25,"./svg-utils":37,"./utils":47}],31:[function(e,u,r){if("undefined"!=typeof e){u=e("./cbrowser");var p=u.Browser,l=u.sourceDataURI,m=u.sourcesAreEqual,g=e("./version"),y=e("./utils").miniJSONify,v=e("./sha1").hex_sha1}p.prototype.nukeStatus=function(){delete localStorage["dalliance."+this.cookieKey+".view-chr"];delete localStorage["dalliance."+this.cookieKey+".view-start"];delete localStorage["dalliance."+this.cookieKey+".view-end"];delete localStorage["dalliance."+
this.cookieKey+".current-seq-length"];delete localStorage["dalliance."+this.cookieKey+".showing-alt-zoom"];delete localStorage["dalliance."+this.cookieKey+".saved-zoom"];delete localStorage["dalliance."+this.cookieKey+".sources"];delete localStorage["dalliance."+this.cookieKey+".hubs"];delete localStorage["dalliance."+this.cookieKey+".version"];delete localStorage["dalliance."+this.cookieKey+".reverse-scrolling"];delete localStorage["dalliance."+this.cookieKey+".reverse-key-scrolling"];delete localStorage["dalliance."+
this.cookieKey+".ruler-location"]};p.prototype.storeStatus=function(){this.storeViewStatus();this.storeTierStatus()};p.prototype.storeViewStatus=function(){!this.cookieKey||this.noPersist||this.noPersistView||(localStorage["dalliance."+this.cookieKey+".view-chr"]=this.chr,localStorage["dalliance."+this.cookieKey+".view-start"]=this.viewStart|0,localStorage["dalliance."+this.cookieKey+".view-end"]=this.viewEnd|0,localStorage["dalliance."+this.cookieKey+".showing-alt-zoom"]=""+this.isSnapZooming,localStorage["dalliance."+
this.cookieKey+".saved-zoom"]=this.savedZoom,this.currentSeqMax&&(localStorage["dalliance."+this.cookieKey+".current-seq-length"]=this.currentSeqMax))};p.prototype.storeTierStatus=function(){if(this.cookieKey&&!this.noPersist){for(var e=[],b=0;b<this.tiers.length;++b){var a=this.tiers[b];a.dasSource.noPersist||e.push({source:a.dasSource,config:a.config||{}})}localStorage["dalliance."+this.cookieKey+".sources"]=JSON.stringify(e);e={};b=[];for(a=0;a<this.hubObjects.length;++a){var q=this.hubObjects[a],
d={url:q.hub.url,genome:q.genome};q.credentials&&(d.credentials=q.credentials);q.mapping&&(d.mapping=q.mapping);e[d.url]=!0;b.push(d)}for(a=0;a<this.hubs.length;++a)d=this.hubs[a],"string"===typeof d&&(d={url:d}),e[d.url]||b.push(d);localStorage["dalliance."+this.cookieKey+".hubs"]=JSON.stringify(b);localStorage["dalliance."+this.cookieKey+".reverse-scrolling"]=this.reverseScrolling;localStorage["dalliance."+this.cookieKey+".reverse-key-scrolling"]=this.reverseKeyScrolling;localStorage["dalliance."+
this.cookieKey+".single-base-highlight"]=this.singleBaseHighlight;localStorage["dalliance."+this.cookieKey+".ruler-location"]=this.rulerLocation;localStorage["dalliance."+this.cookieKey+".export-ruler"]=this.exportRuler;localStorage["dalliance."+this.cookieKey+".export-highlights"]=this.exportHighlights;localStorage["dalliance."+this.cookieKey+".version"]=g.CONFIG}};p.prototype.restoreStatus=function(){if(!this.noPersist){var e=localStorage["dalliance."+this.cookieKey+".version"];if(g.CONFIG==(e?
e|0:-100)){var e=localStorage["dalliance."+this.cookieKey+".configHash"]||"",b=v(y({sources:this.sources,hubs:this.hubs}));if(b!=e)localStorage["dalliance."+this.cookieKey+".configHash"]=b;else{e={};for(b=0;b<this.sources.length;++b){var a=this.sources[b];if(a){var q=l(a),d=e[q];d||(e[q]=d=[]);d.push(a)}}if(!this.noPersistView&&(b=localStorage["dalliance."+this.cookieKey+".view-chr"],a=localStorage["dalliance."+this.cookieKey+".view-start"]|0,d=localStorage["dalliance."+this.cookieKey+".view-end"]|
0,b&&a&&d)){this.chr=b;this.viewStart=a;this.viewEnd=d;if(b=localStorage["dalliance."+this.cookieKey+".current-seq-length"])this.currentSeqMax=b|0;this.isSnapZooming="true"==localStorage["dalliance."+this.cookieKey+".showing-alt-zoom"];b=parseFloat(localStorage["dalliance."+this.cookieKey+".saved-zoom"]);"number"!==typeof b||isNaN(b)||(this.savedZoom=b)}this.reverseScrolling=(b=localStorage["dalliance."+this.cookieKey+".reverse-scrolling"])&&"true"==b;this.reverseKeyScrolling=(b=localStorage["dalliance."+
this.cookieKey+".reverse-key-scrolling"])&&"true"==b;this.singleBaseHighlight=(b=localStorage["dalliance."+this.cookieKey+".single-base-highlight"])&&"true"==b;if(b=localStorage["dalliance."+this.cookieKey+".ruler-location"])this.rulerLocation=b;if(b=localStorage["dalliance."+this.cookieKey+".export-ruler"])this.exportRuler="true"===b;if(b=localStorage["dalliance."+this.cookieKey+".export-highlights"])this.exportHighlights="true"===b;if(b=localStorage["dalliance."+this.cookieKey+".sources"]){var h=
JSON.parse(b);this.sources=[];this.restoredConfigs=[];for(b=0;b<h.length;++b)for(a=this.sources[b]=h[b].source,this.restoredConfigs[b]=h[b].config,q=l(a),d=e[q]||[],q=0;q<d.length;++q){var k=d[q];if(m(a,k))for(var c in k)k.hasOwnProperty(c)&&("function"===typeof k[c]||k[c]instanceof Blob)&&(a[c]=k[c])}}if(c=localStorage["dalliance."+this.cookieKey+".hubs"])this.hubs=JSON.parse(c);return!0}}}};p.prototype.reset=function(){for(var g=this.tiers.length-1;0<=g;--g)this.removeTier({index:g},!0);for(g=0;g<
this.defaultSources.length;++g)this.defaultSources[g].disabled||this.addTier(this.defaultSources[g]);this.highlights.splice(0,this.highlights.length);this.setLocation(this.defaultChr,this.defaultStart,this.defaultEnd)}},{"./cbrowser":6,"./sha1":32,"./utils":47,"./version":49}],32:[function(e,u,r){function p(b){b=m(g(b));for(var a=v?"0123456789ABCDEF":"0123456789abcdef",e="",d,h=0;h<b.length;h++)d=b.charCodeAt(h),e+=a.charAt(d>>>4&15)+a.charAt(d&15);return e}function l(b){b=m(g(b));for(var a="",e=
b.length,d=0;d<e;d+=3)for(var h=b.charCodeAt(d)<<16|(d+1<e?b.charCodeAt(d+1)<<8:0)|(d+2<e?b.charCodeAt(d+2):0),k=0;4>k;k++)a=8*d+6*k>8*b.length?a+z:a+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(h>>>6*(3-k)&63);return a}function m(b){for(var a=Array(b.length>>2),g=0;g<a.length;g++)a[g]=0;for(g=0;g<8*b.length;g+=8)a[g>>5]|=(b.charCodeAt(g/8)&255)<<24-g%32;b=8*b.length;a[b>>5]|=128<<24-b%32;a[(b+64>>9<<4)+15]=b;b=Array(80);for(var g=1732584193,d=-271733879,h=-1732584194,
k=271733878,c=-1009589776,e=0;e<a.length;e+=16){for(var m=g,l=d,p=h,v=k,C=c,w=0;80>w;w++){if(16>w)b[w]=a[e+w];else{var r=b[w-3]^b[w-8]^b[w-14]^b[w-16];b[w]=r<<1|r>>>31}var r=g<<5|g>>>27,u;u=20>w?d&h|~d&k:40>w?d^h^k:60>w?d&h|d&k|h&k:d^h^k;r=y(y(r,u),y(y(c,b[w]),20>w?1518500249:40>w?1859775393:60>w?-1894007588:-899497514));c=k;k=h;h=d<<30|d>>>2;d=g;g=r}g=y(g,m);d=y(d,l);h=y(h,p);k=y(k,v);c=y(c,C)}a=[g,d,h,k,c];b="";for(g=0;g<32*a.length;g+=8)b+=String.fromCharCode(a[g>>5]>>>24-g%32&255);return b}function g(b){for(var a=
"",g=-1,d,h;++g<b.length;)d=b.charCodeAt(g),h=g+1<b.length?b.charCodeAt(g+1):0,55296<=d&&56319>=d&&56320<=h&&57343>=h&&(d=65536+((d&1023)<<10)+(h&1023),g++),127>=d?a+=String.fromCharCode(d):2047>=d?a+=String.fromCharCode(192|d>>>6&31,128|d&63):65535>=d?a+=String.fromCharCode(224|d>>>12&15,128|d>>>6&63,128|d&63):2097151>=d&&(a+=String.fromCharCode(240|d>>>18&7,128|d>>>12&63,128|d>>>6&63,128|d&63));return a}function y(b,a){var g=(b&65535)+(a&65535);return(b>>16)+(a>>16)+(g>>16)<<16|g&65535}var v=0,
z="";"undefined"!==typeof u&&(u.exports={b64_sha1:l,hex_sha1:p})},{}],33:[function(e,u,r){function p(a,b){Z[a]=b}function l(a,b){ja[a]=b}function m(a){if(ja[a])return ja[a](a)}function g(a){var b=this;this.source=a;this.cfsid="cfs"+ ++ka;a.name&&(this.name=a.name);a.addChangeListener&&a.addChangeListener(function(){b.cfsid="cfs"+ ++ka})}function y(){this.busy=0;this.activityListeners=[];this.readinessListeners=[];this.readiness=null}function v(a){this.dasSource=new x(a);this.busy=0;this.activityListeners=
[]}function z(a){this.dasSource=new x(a);this.awaitedEntryPoints=new C;var b=this;this.dasSource.entryPoints(function(a){b.awaitedEntryPoints.provide(a)})}function b(a){var b=this;this.source=a;this.twoBit=new C;if(a.twoBitURI)a=new F(a.twoBitURI);else if(a.twoBitBlob)a=new A(a.twoBitBlob);else throw Error("No twoBitURI or twoBitBlob parameter");n(a,function(a,f){f?console.log(f):b.twoBit.provide(a)})}function a(a){y.call(this);var b=this;this.readiness="Connecting";this.bwgSource=this.opts=a;b.bwgHolder=
new C;if(this.opts.preflight){var f=ga[this.opts.preflight];if(!f){f=new C;ga[this.opts.preflight]=f;var c=new XMLHttpRequest;c.onreadystatechange=function(){4==c.readyState&&(200==c.status?f.provide("success"):f.provide("failure"))};c.open("get",this.opts.preflight+"?"+hex_sha1("salt"+Date.now()),!0);this.opts.credentials&&(c.withCredentials=!0);c.send("")}f.await(function(a){"success"===a&&b.init()})}else b.init()}function q(a,b){y.call(this);this.worker=b;this.readiness="Connecting";this.bwgSource=
this.opts=a;this.keyHolder=new C;this.init()}function d(a,b){if(!(a.flag&I.SEGMENT_UNMAPPED)){var f;f=a.seq?a.seq.length:a.seqLength;if(a.cigar){f=0;for(var c=aa(a.cigar),d=0;d<c.length;++d){var h=c[d];if("M"==h.op||"D"==h.op)f+=h.cnt}}c=new M;c.min=a.pos+1;c.max=a.pos+f;c.segment=a.segment;c.type="bam";c.id=a.readName;c.notes=["MQ="+a.mq];c.cigar=a.cigar;c.seq=a.seq;c.quals=a.quals;c.orientation=a.flag&I.REVERSE_COMPLEMENT?"-":"+";c.bamRecord=a;b&&a.flag&I.MULTIPLE_SEGMENTS&&(c.groups=[{id:a.readName,
type:"readpair"}]);return c}}function h(a){y.call(this);var b=this;this.bamSource=a;this.opts={credentials:a.credentials,preflight:a.preflight,bamGroup:a.bamGroup};this.bamHolder=new C;if(this.opts.preflight){var f=ga[this.opts.preflight];if(!f){f=new C;ga[this.opts.preflight]=f;var c=new XMLHttpRequest;c.onreadystatechange=function(){4==c.readyState&&(200==c.status?f.provide("success"):f.provide("failure"))};c.open("get",this.opts.preflight+"?"+hex_sha1("salt"+Date.now()),!0);this.opts.credentials&&
(c.withCredentials="true");c.send("")}f.await(function(a){"success"===a&&b.init()})}else b.init()}function k(a,b){y.call(this);this.bamSource=a;this.worker=b;this.opts={credentials:a.credentials,preflight:a.preflight,bamGroup:a.bamGroup};this.keyHolder=new C;this.init()}function c(a,b){this.source=a;this.mapping=b;this.activityListeners=[];this.busy=0}function t(){}function B(){}function Q(a){this.store=new S(a.jbURI,a.jbQuery)}if("undefined"!==typeof e){var N=e("./cbrowser").Browser,O=e("./tier").DasTier;
r=e("./utils");var C=r.Awaited,w=r.arrayIndexOf,G=r.shallowCopy,K=r.resolveUrlToPage;r=e("./das");var H=r.DASStylesheet,f=r.DASStyle,x=r.DASSource,D=r.DASSegment,M=r.DASFeature,s=r.DASSequence,E=r.DASLink;r=e("./bin");var F=r.URLFetchable,A=r.BlobFetchable,n=e("./twoBit").makeTwoBit,J=e("./bigwig").makeBwg;r=e("./bam");var R=r.makeBam,I=r.BamFlags;r=e("./spans");var V=r.Range,W=r.union,aa=e("./cigar").parseCigar,X=e("./overlay").OverlayFeatureSource,S=e("./jbjson").JBrowseStore,$=e("./chainset").Chainset;
e("./style")}var Z={},ja={};O.prototype.initSources=function(){var a=this,b=this.browser.createSources(this.dasSource);this.featureSource=b.features||new t;this.sequenceSource=b.sequence;this.featureSource&&this.featureSource.addChangeListener&&this.featureSource.addChangeListener(function(){a.browser.refreshTier(a)})};N.prototype.createSources=function(f){var d=this.sourceCache.get(f);if(d)return d;var e,n;if("sequence"==f.tier_type||f.twoBitURI||f.twoBitBlob)n=f.twoBitURI||f.twoBitBlob?new b(f):
new z(f);else if(f.tier_type&&Z[f.tier_type])n=(0,Z[f.tier_type])(f),e=n.features,n=n.sequence;else if(f.bwgURI||f.bwgBlob)e=(e=this.getWorker())?new q(f,e):new a(f);else if(f.bamURI||f.bamBlob)e=(e=this.getWorker())?new k(f,e):new h(f);else if(f.jbURI)e=new Q(f);else if(f.uri||f.features_uri)e=new v(f);if(f.overlay){d=[];e&&d.push(new g(e));for(e=0;e<f.overlay.length;++e){var m=this.createSources(f.overlay[e]);m&&m.features&&d.push(m.features)}e=new X(d,f)}f.sequenceAliases&&(e=new c(e,new $({type:"alias",
sequenceAliases:f.sequenceAliases})));f.mapping&&(e=new c(e,this.chains[f.mapping]));f.name&&e&&!e.name&&(e.name=f.name);null!=e&&(e=new g(e));if(null!=e||null!=n)d={features:e,sequence:n},this.sourceCache.put(f,d);return d};O.prototype.fetchStylesheet=function(a){(this.dasSource.stylesheet_uri||!(this.dasSource.tier_type||this.dasSource.bwgURI||this.dasSource.bwgBlob||this.dasSource.bamURI||this.dasSource.bamBlob||this.dasSource.twoBitURI||this.dasSource.twoBitBlob||this.dasSource.jbURI||this.dasSource.overlay)?
new v(this.dasSource):this.getSource()).getStyleSheet(a)};var ka=0;g.prototype.addReadinessListener=function(a){if(this.source.addReadinessListener)return this.source.addReadinessListener(a);a(null)};g.prototype.search=function(a,b){if(this.source.search)return this.source.search(a,b)};g.prototype.getDefaultFIPs=function(a){if(this.source.getDefaultFIPs)return this.source.getDefaultFIPs(a)};g.prototype.getStyleSheet=function(a){this.source.getStyleSheet(a)};g.prototype.getScales=function(){return this.source.getScales()};
g.prototype.addActivityListener=function(a){this.source.addActivityListener&&this.source.addActivityListener(a)};g.prototype.addChangeListener=function(a){this.source.addChangeListener&&this.source.addChangeListener(a)};g.prototype.findNextFeature=function(a,b,f,c){this.source.findNextFeature(a,b,f,c)};g.prototype.quantFindNextFeature=function(a,b,f,c,d){this.source.quantFindNextFeature(a,b,f,c,d)};g.prototype.capabilities=function(){return this.source.capabilities?this.source.capabilities():{}};
g.prototype.fetch=function(a,b,f,c,d,h,g,k){if(!h)throw Error("Fetch pool is null");var e=this,n=this.cfsid,m=h.awaitedFeatures[n];if(m&&m.started){if(m.styleFilters.doesNotContain(k)){e.source.fetch(a,b,f,c,d,h,g,k);return}}else m?m.styleFilters.addAll(k):(m=new C,m.styleFilters=k,h.awaitedFeatures[n]=m,h.requestsIssued.then(function(){m.started=!0;e.source.fetch(a,b,f,c,m.styleFilters.typeList(),h,function(a,b,f,c){m.res||m.provide({status:a,features:b,scale:f,coverage:c})},m.styleFilters)}).catch(function(a){console.log(a)}));
m.await(function(a){g(a.status,a.features,a.scale,a.coverage)})};y.prototype.addReadinessListener=function(a){this.readinessListeners.push(a);a(this.readiness)};y.prototype.notifyReadiness=function(){for(var a=0;a<this.readinessListeners.length;++a)try{this.readinessListeners[a](this.readiness)}catch(b){console.log(b)}};y.prototype.addActivityListener=function(a){this.activityListeners.push(a)};y.prototype.notifyActivity=function(){for(var a=0;a<this.activityListeners.length;++a)try{this.activityListeners[a](this.busy)}catch(b){console.log(b)}};
y.prototype.getScales=function(){return null};y.prototype.fetch=function(a,b,f,c,d,h,g){return g(null,[],1E9)};y.prototype.getStyleSheet=function(a){var b=new H,c=new f;c.glyph="BOX";c.BGCOLOR="blue";c.FGCOLOR="black";b.pushStyle({type:"default"},null,c);return a(b)};v.prototype.addActivityListener=function(a){this.activityListeners.push(a)};v.prototype.notifyActivity=function(){for(var a=0;a<this.activityListeners.length;++a)try{this.activityListeners[a](this.busy)}catch(b){console.log(b)}};v.prototype.getStyleSheet=
function(a){this.dasSource.stylesheet(function(b){a(b)},function(){a(null,"Couldn't fetch DAS stylesheet")})};v.prototype.fetch=function(a,b,f,c,d,h,g){if(d&&0==d.length)g(null,[],c);else if(this.dasSource.uri||this.dasSource.features_uri){if(this.dasSource.dasStaticFeatures&&this.cachedStaticFeatures)return g(null,this.cachedStaticFeatures,this.cachedStaticScale);var k=!1!==this.dasSource.maxbins;d={type:d};k&&(d.maxbins=1+((f-b)/c|0));var e=this;e.busy++;e.notifyActivity();this.dasSource.features(new D(a,
b,f),d,function(a,b){e.busy--;e.notifyActivity();var f=c;k||(f=0.1);!b&&e.dasSource.dasStaticFeatures&&(e.cachedStaticFeatures=a,e.cachedStaticScale=f);g(b,a,f)})}};v.prototype.findNextFeature=this.sourceFindNextFeature=function(a,b,f,c){if(this.dasSource.capabilities&&0<=w(this.dasSource.capabilities,"das1:adjacent-feature")){var d=this;if(this.dasAdjLock)return console.log("Already looking for a next feature, be patient!");this.dasAdjLock=!0;a={adjacent:a+":"+(b|0)+":"+(0<f?"F":"B")};if(b=thisTier.getDesiredTypes(thisTier.browser.scale))a.types=
b;thisTier.dasSource.features(null,a,function(a){d.dasAdjLock=!1;0<a.length&&null!=a[0]&&c(a[0])})}};z.prototype.fetch=function(a,b,f,c,d){this.dasSource.sequence(new D(a,b,f),function(a){return 1==a.length?d(null,a[0]):d("Didn't get sequence")})};z.prototype.getSeqInfo=function(a,b){this.awaitedEntryPoints.await(function(f){for(var c=0;c<f.length;++c)if(f[c].name==a)return b({length:f[c].end});return b()})};b.prototype.fetch=function(a,b,f,c,d){this.twoBit.await(function(c){c.fetch(a,b,f,function(c,
h){if(h)return d(h,null);var g=new s(a,b,f,"DNA",c);return d(null,g)})})};b.prototype.getSeqInfo=function(a,b){this.twoBit.await(function(f){f.getSeq(a)?f.getSeq(a).length(function(a){b({length:a})}):b()})};v.prototype.getScales=function(){return[]};var ga={};a.prototype=Object.create(y.prototype);a.prototype.init=function(){var a=this,b;b=this.bwgSource.bwgURI?new F(this.bwgSource.bwgURI,{credentials:this.opts.credentials}):new A(this.bwgSource.bwgBlob);J(b,function(b,f){f?(a.error=f,a.readiness=
null,a.notifyReadiness(),a.bwgHolder.provide(null)):(a.bwgHolder.provide(b),a.readiness=null,a.notifyReadiness(),"bigbed"==b.type&&b.getExtraIndices(function(b){a.extraIndices=b}))})};a.prototype.capabilities=function(){var a={leap:!0};this.bwgHolder.res&&"bigwig"==this.bwgHolder.res.type&&(a.quantLeap=!0);if(this.extraIndices&&0<this.extraIndices.length){a.search=[];for(var b=0;b<this.extraIndices.length;++b)a.search.push(this.extraIndices[b].field)}return a};a.prototype.fetch=function(a,b,f,c,d,
h,g){var k=this;this.bwgHolder.await(function(h){if(null==h)return g(k.error||"Can't access binary file",null,null);var e;e=!d||0==d.length||0<=w(d,"density");k.opts.clientBin&&(e=!1);if("bigwig"==h.type||e||"undefined"!==typeof k.opts.forceReduction){e=-1;for(var n=0;n<h.zoomLevels.length;++n)if(h.zoomLevels[n].reduction<=c)e=n;else break;"undefined"!==typeof k.opts.forceReduction&&(e=k.opts.forceReduction);e=0>e?h.getUnzoomedView():h.getZoomedView(e)}else e=h.getUnzoomedView();k.busy++;k.notifyActivity();
e.readWigData(a,b,f,function(a){k.busy--;k.notifyActivity();var c=1E9;if("bigwig"===h.type){var d=(f-b)/a.length/2;d<c&&(c=d)}if(k.opts.link)for(d=0;d<a.length;++d){var e=a[d];e.label&&(e.links=[new E("Link",k.opts.link.replace(/\$\$/,e.label))])}g(null,a,c)})})};a.prototype.quantFindNextFeature=function(a,b,f,c,d){var h=this;h.busy++;h.notifyActivity();this.bwgHolder.res.thresholdSearch(a,b,f,c,function(a,b){h.busy--;h.notifyActivity();return d(a,b)})};a.prototype.findNextFeature=function(a,b,f,
c){var d=this;d.busy++;d.notifyActivity();this.bwgHolder.res.getUnzoomedView().getFirstAdjacent(a,b,f,function(a){d.busy--;d.notifyActivity();0<a.length&&null!=a[0]&&c(a[0])})};a.prototype.getScales=function(){var a=this.bwgHolder.res;if(a){for(var b=[1],f=0;f<a.zoomLevels.length;++f)b.push(a.zoomLevels[f].reduction);return b}return null};a.prototype.search=function(a,b){return this.extraIndices&&0!=this.extraIndices.length?this.extraIndices[0].lookup(a,b):b(null,"No indices available")};a.prototype.getDefaultFIPs=
function(a){if(this.opts.noExtraFeatureInfo)return!0;this.bwgHolder.await(function(b){b&&b.schema&&b.definedFieldCount<b.schema.fields.length&&a(function(a,f){for(var c=0;c<f.hit.length;++c)if(f.hit[c].isSuperGroup)return;for(c=b.definedFieldCount;c<b.schema.fields.length;++c){var d=b.schema.fields[c];f.add(d.comment,a[d.name])}})})};a.prototype.getStyleSheet=function(a){this.bwgHolder.await(function(b){if(!b)return a(null,"bbi error");var c=new H;if("bigbed"==b.type){var d=new f;d.glyph="BOX";d.FGCOLOR=
"black";d.BGCOLOR="blue";d.HEIGHT=8;d.BUMP=!0;d.LABEL=!0;d.ZINDEX=20;c.pushStyle({type:"bigwig"},null,d);d.glyph="BOX";d.FGCOLOR="black";d.BGCOLOR="red";d.HEIGHT=10;d.BUMP=!0;d.ZINDEX=20;c.pushStyle({type:"translation"},null,d);d=new f;d.glyph="BOX";d.FGCOLOR="black";d.BGCOLOR="white";d.HEIGHT=10;d.ZINDEX=10;d.BUMP=!0;d.LABEL=!0;c.pushStyle({type:"transcript"},null,d);d=new f;d.glyph="HISTOGRAM";d.COLOR1="white";d.COLOR2="black";d.HEIGHT=30;c.pushStyle({type:"density"},null,d)}else d=new f,d.glyph=
"HISTOGRAM",d.COLOR1="white",d.COLOR2="black",d.HEIGHT=30,c.pushStyle({type:"default"},null,d);12==b.definedFieldCount&&14<=b.fieldCount&&(c.geneHint=!0);return a(c)})};q.prototype=Object.create(y.prototype);q.prototype.init=function(){var a=this,b=this.bwgSource.uri||this.bwgSource.bwgURI,f=this.bwgSource.blob||this.bwgSource.bwgBlob,c=function(b,f){a.readiness=null;a.notifyReadiness();b?a.worker.postCommand({command:"meta",connection:b},function(f,c){c?(a.error=c,a.keyHolder.provide(null)):(a.meta=
f,a.keyHolder.provide(b))}):(a.error=f,a.keyHolder.provide(null))};f?this.worker.postCommand({command:"connectBBI",blob:f},c):this.worker.postCommand({command:"connectBBI",uri:K(b),credentials:this.bwgSource.credentials},c)};q.prototype.capabilities=function(){var a={leap:!0};this.meta&&"bigwig"==this.meta.type&&(a.quantLeap=!0);if(this.meta&&this.meta.extraIndices&&0<this.meta.extraIndices.length){a.search=[];for(var b=0;b<this.meta.extraIndices.length;++b)a.search.push(this.meta.extraIndices[b].field)}return a};
q.prototype.fetch=function(a,b,f,c,d,h,g){var k=this;k.busy++;k.notifyActivity();this.keyHolder.await(function(h){if(!h)return k.busy--,k.notifyActivity(),g(k.error||"Can't access binary file",null,null);var e=-1,n=!d||0==d.length||0<=w(d,"density");k.opts.clientBin&&(n=!1);if("bigwig"==k.meta.type||n||"undefined"!==typeof k.opts.forceReduction){for(n=1;n<k.meta.zoomLevels.length;++n)if(k.meta.zoomLevels[n]<=c)e=n-1;else break;"undefined"!==typeof k.opts.forceReduction&&(e=k.opts.forceReduction)}k.worker.postCommand({command:"fetch",
connection:h,chr:a,min:b,max:f,zoom:e},function(a,c){k.busy--;k.notifyActivity();var d=1E9;if("bigwig"===k.meta.type){var h=(f-b)/a.length/2;h<d&&(d=h)}if(k.opts.link)for(h=0;h<a.length;++h){var e=a[h];e.label&&(e.links=[new E("Link",k.opts.link.replace(/\$\$/,e.label))])}g(c,a,d)})})};q.prototype.quantFindNextFeature=function(a,b,f,c,d){var h=this;this.busy++;this.notifyActivity();this.worker.postCommand({command:"quantLeap",connection:this.keyHolder.res,chr:a,pos:b,dir:f,threshold:c,under:!1},function(a,
b){console.log(a,b);h.busy--;h.notifyActivity();return d(a,b)})};q.prototype.findNextFeature=function(a,b,f,c){var d=this;this.busy++;this.notifyActivity();this.worker.postCommand({command:"leap",connection:this.keyHolder.res,chr:a,pos:b,dir:f},function(a,b){d.busy--;d.notifyActivity();0<a.length&&null!=a[0]&&c(a[0])})};q.prototype.getScales=function(){var a=this.meta;return a?a.zoomLevels:null};q.prototype.search=function(a,b){if(!this.meta.extraIndices||0==this.meta.extraIndices.length)return b(null,
"No indices available");var f=this;this.busy++;this.notifyActivity();this.worker.postCommand({command:"search",connection:this.keyHolder.res,query:a,index:this.meta.extraIndices[0]},function(a,c){f.busy--;f.notifyActivity();b(a,c)})};q.prototype.getDefaultFIPs=function(a){if(this.opts.noExtraFeatureInfo)return!0;var b=this;this.keyHolder.await(function(f){var c=b.meta;c&&c.schema&&c.definedFieldCount<c.schema.fields.length&&a(function(a,b){for(var f=0;f<b.hit.length;++f)if(b.hit[f].isSuperGroup)return;
for(f=c.definedFieldCount;f<c.schema.fields.length;++f){var d=c.schema.fields[f];b.add(d.comment,a[d.name])}})})};q.prototype.getStyleSheet=function(a){var b=this;this.keyHolder.await(function(c){c=b.meta;if(!c)return a(null,"bbi error");var d=new H;if("bigbed"==c.type){var h=new f;h.glyph="BOX";h.FGCOLOR="black";h.BGCOLOR="blue";h.HEIGHT=8;h.BUMP=!0;h.LABEL=!0;h.ZINDEX=20;d.pushStyle({type:"bigwig"},null,h);h.glyph="BOX";h.FGCOLOR="black";h.BGCOLOR="red";h.HEIGHT=10;h.BUMP=!0;h.ZINDEX=20;d.pushStyle({type:"translation"},
null,h);h=new f;h.glyph="BOX";h.FGCOLOR="black";h.BGCOLOR="white";h.HEIGHT=10;h.ZINDEX=10;h.BUMP=!0;h.LABEL=!0;d.pushStyle({type:"transcript"},null,h);h=new f;h.glyph="HISTOGRAM";h.COLOR1="white";h.COLOR2="black";h.HEIGHT=30;d.pushStyle({type:"density"},null,h)}else h=new f,h.glyph="HISTOGRAM",h.COLOR1="white",h.COLOR2="black",h.HEIGHT=30,d.pushStyle({type:"default"},null,h);12==c.definedFieldCount&&14<=c.fieldCount&&(d.geneHint=!0);return a(d)})};h.prototype=Object.create(y.prototype);h.prototype.init=
function(){var a=this,b,f;this.bamSource.bamBlob?(b=new A(this.bamSource.bamBlob),f=new A(this.bamSource.baiBlob)):(b=new F(this.bamSource.bamURI,{credentials:this.opts.credentials}),f=new F(this.bamSource.baiURI||this.bamSource.bamURI+".bai",{credentials:this.opts.credentials}));R(b,f,null,function(b,f){a.readiness=null;a.notifyReadiness();b?a.bamHolder.provide(b):(a.error=f,a.bamHolder.provide(null))})};h.prototype.fetch=function(a,b,f,c,h,g,k){var e=h&&1==h.length&&"density"==h[0],n=this;n.busy++;
n.notifyActivity();this.bamHolder.await(function(c){if(!c)return n.busy--,n.notifyActivity(),k(n.error||"Couldn't fetch BAM");c.fetch(a,b,f,function(a,b){n.busy--;n.notifyActivity();if(b)k(b,null,null);else{for(var f=[],c=0;c<a.length;++c){var h=d(a[c],n.opts.bamGroup);h&&f.push(h)}k(null,f,1E9)}},{light:e})})};h.prototype.getScales=function(){return 1E9};h.prototype.getStyleSheet=function(a){this.bamHolder.await(function(b){b=new H;var c=new f;c.glyph="HISTOGRAM";c.COLOR1="black";c.COLOR2="red";
c.HEIGHT=30;b.pushStyle({type:"density"},"low",c);b.pushStyle({type:"density"},"medium",c);c=new f;c.glyph="__SEQUENCE";c.FGCOLOR="black";c.BGCOLOR="blue";c.HEIGHT=8;c.BUMP=!0;c.LABEL=!1;c.ZINDEX=20;b.pushStyle({type:"bam"},"high",c);return a(b)})};k.prototype=Object.create(y.prototype);k.prototype.init=function(){var a=this,b=this.bamSource.uri||this.bamSource.bamURI,f=this.bamSource.indexUri||this.bamSource.baiURI||b+".bai",c=this.bamSource.bamBlob||this.bamSource.blob,d=this.bamSource.baiBlob||
this.bamSource.indexBlob,h=function(b,f){a.readiness=null;a.notifyReadiness();b?a.keyHolder.provide(b):(a.error=f,a.keyHolder.provide(null))};c?this.worker.postCommand({command:"connectBAM",blob:c,indexBlob:d},h):this.worker.postCommand({command:"connectBAM",uri:K(b),indexUri:K(f),credentials:this.bamSource.credentials,indexChunks:this.bamSource.indexChunks},h)};k.prototype.fetch=function(a,b,f,c,h,g,k){var e=h&&1==h.length&&"density"==h[0],n=this;n.busy++;n.notifyActivity();this.keyHolder.await(function(c){if(!c)return n.busy--,
n.notifyActivity(),k(n.error||"Couldn't fetch BAM");n.worker.postCommand({command:"fetch",connection:c,chr:a,min:b,max:f,opts:{light:e}},function(a,b){n.busy--;n.notifyActivity();if(b)k(b,null,null);else{for(var f=[],c=0;c<a.length;++c){var h=d(a[c],n.opts.bamGroup);h&&f.push(h)}k(null,f,1E9)}})})};k.prototype.getScales=function(){return 1E9};k.prototype.getStyleSheet=function(a){this.keyHolder.await(function(b){b=new H;var c=new f;c.glyph="HISTOGRAM";c.COLOR1="black";c.COLOR2="red";c.HEIGHT=30;b.pushStyle({type:"density"},
"low",c);b.pushStyle({type:"density"},"medium",c);c=new f;c.glyph="__SEQUENCE";c.FGCOLOR="black";c.BGCOLOR="blue";c.HEIGHT=8;c.BUMP=!0;c.LABEL=!1;c.ZINDEX=20;b.pushStyle({type:"bam"},"high",c);return a(b)})};c.prototype.addActivityListener=function(a){this.activityListeners.push(a)};c.prototype.notifyActivity=function(){for(var a=0;a<this.activityListeners.length;++a)try{this.activityListeners[a](this.busy)}catch(b){console.log(b)}};c.prototype.getStyleSheet=function(a){return this.source.getStyleSheet(a)};
c.prototype.getScales=function(){return this.source.getScales()};c.prototype.getDefaultFIPs=function(a){if(this.source.getDefaultFIPs)return this.source.getDefaultFIPs(a)};c.prototype.simplifySegments=function(a,b){if(0==a.length)return a;a.sort(function(a,b){var f=a.name-b.name;return f?f:(f=a.start-b.start)?f:a.end-b.end});for(var f=[],c=a[0],d=0;d<a.length;++d){var h=a[d];h.name!=c.name||h.start>c.end+b?(f.push(c),c=h):c=new D(c.name,Math.min(c.start,h.start),Math.max(c.end,h.end))}f.push(c);return f};
c.prototype.fetch=function(a,b,f,c,d,h,k,g){var e=this,n=f-b+1;e.busy++;e.notifyActivity();this.mapping.sourceBlocksForRange(a,b,f,function(a){if(0==a.length)e.busy--,e.notifyActivity(),k("No mapping available for this regions",[],c);else{a=e.simplifySegments(a,Math.max(100,0.05*n));var b=[],f=null,m=a.length,q;a.map(function(a){e.source.fetch(a.name,a.start,a.end,c,d,h,function(c,d,h){c&&!q&&(q=c);if(d)for(c=0;c<d.length;++c){var g=d[c],n=g.segment;0==n.indexOf("chr")&&(n=n.substr(3));n=e.mapping.mapSegment(n,
g.min,g.max);if(0==n.length)g.parts&&0<g.parts.length&&b.push(g);else for(var x=0;x<n.length;++x){var l=n[x],s=G(g);s.segment=l.segment;s.min=l.min;s.max=l.max;l.partialMin&&(s.partialMin=l.partialMin);l.partialMax&&(s.partialMax=l.partialMax);l.flipped&&("-"==g.orientation?s.orientation="+":"+"==g.orientation&&(s.orientation="-"));b.push(s)}}d=e.mapping.mapPoint(a.name,a.start);c=e.mapping.mapPoint(a.name,a.end);d&&c&&(d=new V(d.pos,c.pos),f=f?W(f,d):d);--m;0==m&&(e.busy--,e.notifyActivity(),k(q,
b,h,f))},g)})}})};t.prototype.getScales=function(){return null};t.prototype.fetch=function(a,b,f,c,d,h,g){return g(null,[],1E9)};t.prototype.getStyleSheet=function(a){var b=new H,c=new f;c.glyph="BOX";c.BGCOLOR="blue";c.FGCOLOR="black";b.pushStyle({type:"default"},null,c);return a(b)};B.prototype.fetch=function(a,b,f,c,d){return d(null,null)};Q.prototype.getScales=function(){return null};Q.prototype.getStyleSheet=function(a){var b=new H,c=new f;c.glyph="BOX";c.FGCOLOR="black";c.BGCOLOR="green";c.HEIGHT=
8;c.BUMP=!0;c.LABEL=!0;c.ZINDEX=20;b.pushStyle({type:"default"},null,c);return a(b)};Q.prototype.fetch=function(a,b,f,c,d,h,g){d&&0==d.length?g(null,[],c):this.store.features(new D(a,b,f),{},function(a,b){g(b,a,1E5)})};N.prototype.sourceAdapterIsCapable=function(a,b){return a.capabilities?a.capabilities()[b]:!1};"undefined"!==typeof u&&(u.exports={FeatureSourceBase:y,TwoBitSequenceSource:b,DASSequenceSource:z,MappedFeatureSource:c,CachingFeatureSource:g,BWGFeatureSource:a,RemoteBWGFeatureSource:q,
BAMFeatureSource:h,RemoteBAMFeatureSource:k,DummyFeatureSource:t,DummySequenceSource:B,registerSourceAdapterFactory:p,registerParserFactory:l,makeParser:m},e("./ensembljson"),e("./tabix-source"),e("./memstore"),e("./bedwig"),e("./vcf"))},{"./bam":1,"./bedwig":2,"./bigwig":3,"./bin":4,"./cbrowser":6,"./chainset":7,"./cigar":8,"./das":10,"./ensembljson":12,"./jbjson":21,"./memstore":24,"./overlay":26,"./spans":34,"./style":35,"./tabix-source":38,"./tier":43,"./twoBit":46,"./utils":47,"./vcf":48}],34:[function(e,
u,r){function p(b,a){if("number"!=typeof b||"number"!=typeof a)throw"Bad range "+b+","+a;this._min=b;this._max=a}function l(b){this._ranges=b}function m(b,a){b instanceof Array||(b=[b],a&&b.push(a));if(0==b.length)return null;if(1==b.length)return b[0];for(var g=[],d=0;d<b.length;++d)b[d]._pushRanges(g);for(var g=g.sort(z),d=[],h=g[0],h=new p(h._min,h._max),k=1;k<g.length;++k){var c=g[k];c._min>h._max+1?(d.push(h),h=new p(c._min,c._max)):c._max>h._max&&(h._max=c._max)}d.push(h);return 1==d.length?
d[0]:new l(d)}function g(b,a){for(var g=b.ranges(),d=a.ranges(),h=g.length,k=d.length,c=0,e=0,m=[];c<h&&e<k;){b=g[c];a=d[e];var v=Math.max(b.min(),a.min()),r=Math.min(b.max(),a.max());r>=v&&m.push(new p(v,r));b.max()>a.max()?++e:++c}return 0==m.length?null:1==m.length?m[0]:new l(m)}function y(b){var a=0;b=b.ranges();for(var g=0;g<b.length;++g)var d=b[g],a=a+(d.max()-d.min()+1);return a}function v(b,a){return b.min()<a.min()?-1:b.min()>a.min()?1:b.max()<a.max()?-1:a.max()>b.max()?1:0}function z(b,
a){return b._min<a._min?-1:b._min>a._min?1:b._max<a._max?-1:a._max>b._max?1:0}p.prototype.min=function(){return this._min};p.prototype.max=function(){return this._max};p.prototype.contains=function(b){return b>=this._min&&b<=this._max};p.prototype.isContiguous=function(){return!0};p.prototype.ranges=function(){return[this]};p.prototype._pushRanges=function(b){b.push(this)};p.prototype.toString=function(){return"["+this._min+"-"+this._max+"]"};l.prototype.min=function(){return this._ranges[0].min()};
l.prototype.max=function(){return this._ranges[this._ranges.length-1].max()};l.prototype.contains=function(b){for(var a=0;a<this._ranges.length;++a)if(this._ranges[a].contains(b))return!0;return!1};l.prototype.isContiguous=function(){return 1<this._ranges.length};l.prototype.ranges=function(){return this._ranges};l.prototype._pushRanges=function(b){for(var a=0;a<this._ranges.length;++a)b.push(this._ranges[a])};l.prototype.toString=function(){for(var b="",a=0;a<this._ranges.length;++a)0<a&&(b+=","),
b+=this._ranges[a].toString();return b};"undefined"!==typeof u&&(u.exports={Range:p,union:m,intersection:g,coverage:y,rangeOver:v,_rangeOrder:z})},{}],35:[function(e,u,r){function p(e,g,l){this.type=e;this.method=g;this.label=l}function l(e){this._filters={};if(e)for(var g=0;g<e.length;++g)this.add(e[g])}p.prototype.equals=function(e){return this.type==e.type&&this.method==e.method&&this.label==e.label};p.prototype.toString=function(){var e=[];this.type&&e.push("type="+this.type);this.method&&e.push("method="+
this.method);this.label&&e.push("label="+this.label);return"StyleFilter<"+e.join(";")+">"};l.prototype.add=function(e){var g=e.toString();this._filters[g]||(this._filters[g]=e,this._list=null)};l.prototype.addAll=function(e){e=e.list();for(var g=0;g<e.length;++g)this.add(e[g])};l.prototype.doesNotContain=function(e){e=e.list();for(var g=0;g<e.length;++g)if(!this._filters[g.toString()])return!0;return!1};l.prototype.list=function(){if(!this._list){this._list=[];for(var e in this._filters)this._filters.hasOwnProperty(e)&&
this._list.push(this._filters[e])}return this._list};l.prototype.typeList=function(){for(var e=[],g=this.list(),l=0;l<g.length;++l){var p=g[l].type;if(!p||"default"==p)return null;0>e.indexOf(p)&&e.push(p)}return e};"undefined"!==typeof u&&(u.exports={StyleFilter:p,StyleFilterSet:l})},{}],36:[function(e,u,r){if("undefined"!==typeof e){var p=e("./cbrowser").Browser,l=e("./utils").makeElementNS,m=e("./version"),g=e("./sequence-draw").svgSeqTier;u=e("./svg-utils");var y=u.NS_SVG,v=u.NS_XLINK,z=u.SVGPath,
b=e("./numformats").formatQuantLabel}p.prototype.makeSVG=function(a){a=a||{};var e=a.minTierHeight||20,d=document.implementation.createDocument(y,"svg",null),h=l(y,"g",null,{fontFamily:"helvetica",fontSize:"8pt"});d.documentElement.appendChild(h);var k=l(y,"a",l(y,"text","Graphics from Dalliance "+m,{x:(this.featurePanelWidth+200+20)/2,y:30,strokeWidth:0,fontSize:"12pt",textAnchor:"middle",fill:"blue"}));k.setAttribute("xmlns:xlink",v);k.setAttribute("xlink:href","http://www.biodalliance.org/");h.appendChild(k);
k=l(y,"rect",null,{x:200,y:50,width:this.featurePanelWidth,height:1E5});k=l(y,"clipPath",k,{id:"featureClip"});h.appendChild(k);for(var k=70,c=l(y,"g",null,{}),p=0;p<this.tiers.length;++p){var B=this.tiers[p],r=l(y,"g",null,{clipPath:"url(#featureClip)",clipRule:"nonzero"}),u=l(y,"g"),O=k,C=l(y,"rect",null,{x:0,y:O,width:"10000",height:50,fill:B.background});r.appendChild(C);if(B.sequenceSource){var w=g(B,B.currentSequence);r.appendChild(l(y,"g",w,{transform:"translate(200, "+k+")"}));k+=80}else{if(!B.subtiers)continue;
for(var w=(B.glyphCacheOrigin-this.viewStart)*this.scale,G=!1,K=0;K<B.subtiers.length;++K){for(var k=k+3,H=B.subtiers[K],f=[],x=0;x<H.glyphs.length;++x)f.push(H.glyphs[x].toSVG());r.appendChild(l(y,"g",f,{transform:"translate("+(200+w)+", "+k+")"}));if(H.quant){var G=!0,f=H.quant,D=H.height,x=2;40<D&&(x=1+(D/20|0));var D=D/(x-1),M=(f.max-f.min)/(x-1),s=new z;s.moveTo(205,k);s.lineTo(200,k);s.lineTo(200,k+H.height);s.lineTo(205,k+H.height);for(var E=1;E<x-1;++E){var F=E*D;s.moveTo(200,k+F);s.lineTo(203,
k+F)}u.appendChild(l(y,"path",null,{d:s.toPathData(),fill:"none",stroke:"black",strokeWidth:"2px"}));u.appendChild(l(y,"text",b(f.max),{x:197,y:k+7,textAnchor:"end"}));u.appendChild(l(y,"text",b(f.min),{x:197,y:k+H.height,textAnchor:"end"}));for(E=1;E<x-1;++E)F=E*D,u.appendChild(l(y,"text",b(1*f.max-E*M),{x:197,y:k+F+3,textAnchor:"end"}))}k+=H.height+3}k-O<e&&(k=O+e)}u.appendChild(l(y,"text","string"===typeof B.config.name?B.config.name:B.dasSource.name,{x:200-(G?20:12),y:(k+O+8)/2,fontSize:"10pt",
textAnchor:"end"}));C.setAttribute("height",k-O);c.appendChild(l(y,"g",[r,u]))}if(a.highlights)for(e=this.highlights||[],G=0;G<e.length;++G)D=e[G],(D.chr==this.chr||D.chr=="chr"+this.chr)&&D.min<this.viewEnd&&D.max>this.viewStart&&(p=(Math.max(D.min,this.viewStart)-this.viewStart)*this.scale,B=(Math.min(D.max,this.viewEnd)-this.viewStart)*this.scale,c.appendChild(l(y,"rect",null,{x:200+p,y:70,width:B-p,height:k-70,stroke:"none",fill:this.defaultHighlightFill,fillOpacity:this.defaultHighlightAlpha})));
e=-1;"center"==a.ruler?e=200+(this.viewEnd-this.viewStart)*this.scale/2:"left"==a.ruler?e=200:"right"==a.ruler&&(e=200+(this.viewEnd-this.viewStart)*this.scale);0<=e&&c.appendChild(l(y,"line",null,{x1:e,y1:70,x2:e,y2:k,stroke:"blue"}));h.appendChild(c);d.documentElement.setAttribute("width",this.featurePanelWidth+20+200);d.documentElement.setAttribute("height",k+50);return new Blob([(new XMLSerializer).serializeToString(d)],{type:"image/svg+xml"})}},{"./cbrowser":6,"./numformats":25,"./sequence-draw":30,
"./svg-utils":37,"./utils":47,"./version":49}],37:[function(e,u,r){function p(){this.ops=[]}p.prototype.moveTo=function(e,m){this.ops.push("M "+e+" "+m)};p.prototype.lineTo=function(e,m){this.ops.push("L "+e+" "+m)};p.prototype.closePath=function(){this.ops.push("Z")};p.prototype.toPathData=function(){return this.ops.join(" ")};"undefined"!==typeof u&&(u.exports={NS_SVG:"http://www.w3.org/2000/svg",NS_XLINK:"http://www.w3.org/1999/xlink",SVGPath:p})},{}],38:[function(e,u,r){function p(a){g.call(this);
this.readiness="Connecting";this.source=a;this.tabixHolder=new z;var e=this,d=m(a.payload);if(d)this.parser=d;else throw"Unsuported tabix payload "+a.payload;var h;this.source.blob?(a=new v(this.source.blob),h=new v(this.source.indexBlob)):(a=new y(this.source.uri,{credentials:this.source.credentials}),h=new y(this.source.indexURI||this.source.uri+".tbi",{credentials:this.source.credentials}));b(a,h,function(a,b){e.tabixHolder.provide(a);a.fetchHeader(function(a,b){if(a){for(var c=d.createSession(function(){}),
h=0;h<a.length;++h)c.parse(a[h]);c.flush()}});e.readiness=null;e.notifyReadiness()})}if("undefined"!==typeof e){u=e("./sourceadapters");var l=u.registerSourceAdapterFactory,m=u.makeParser,g=u.FeatureSourceBase;u=e("./bin");var y=u.URLFetchable,v=u.BlobFetchable,z=e("./utils").Awaited,b=e("./tabix").connectTabix}p.prototype=Object.create(g.prototype);p.prototype.fetch=function(a,b,d,h,g,c,e){var m=this;m.busy++;m.notifyActivity();this.tabixHolder.await(function(c){c.fetch(a,b,d,function(a,b){m.busy--;
m.notifyActivity();for(var c=[],d=m.parser.createSession(function(a){c.push(a)}),h=0;h<a.length;++h)d.parse(a[h]);d.flush();e(null,c,1E9)})})};p.prototype.getStyleSheet=function(a){this.parser&&this.parser.getStyleSheet&&this.parser.getStyleSheet(a)};p.prototype.getDefaultFIPs=function(a){this.parser&&this.parser.getDefaultFIPs&&this.parser.getDefaultFIPs(a)};l("tabix",function(a){return{features:new p(a)}})},{"./bin":4,"./sourceadapters":33,"./tabix":39,"./utils":47}],39:[function(e,u,r){function p(){}
function l(a,b,d){var h=new p;h.data=a;h.tbi=b;h.tbi.fetch(function(a){if(!a)return d(null,"Couldn't access Tabix");a=v(a,a.byteLength);var b=new Uint8Array(a);if(g(b,0)!=m)return d(null,"Not a tabix index");var e=g(b,4);h.format=g(b,8);h.colSeq=g(b,12);h.colStart=g(b,16);h.colEnd=g(b,20);h.meta=g(b,24);h.skip=g(b,28);g(b,32);h.indices=[];var l=36;h.chrToIndex={};h.indexToChr=[];for(var q=0;q<e;++q){for(var p="";;){var r=b[l++];if(0==r)break;p+=String.fromCharCode(r)}h.chrToIndex[p]=q;0==p.indexOf("chr")?
h.chrToIndex[p.substring(3)]=q:h.chrToIndex["chr"+p]=q;h.indexToChr.push(p)}p=1E9;for(r=0;r<e;++r){for(var C=l,w=g(b,l),l=l+4,q=0;q<w;++q){g(b,l);var u=g(b,l+4),l=l+(8+16*u)}for(var u=g(b,l),z=l+=4,q=0;q<u;++q){var H=y(b,z),z=z+8;if(H){q=H.block;0<H.offset&&(q+=65536);q<p&&(p=q);break}}l+=8*u;0<w&&(h.indices[r]=new Uint8Array(a,C,l-C))}h.headerMax=p;d(h)})}var m=21578324;if("undefined"!==typeof e){e("./spans");var g=e("./bin").readInt;e=e("./lh3utils");var y=e.readVob,v=e.unbgzf,z=e.reg2bins,b=e.Chunk}p.prototype.blocksForRange=
function(a,e,d){var h=this.indices[a];if(!h)return[];a=z(e,d);for(var k=[],c=0;c<a.length;++c)k[a[c]]=!0;a=[];for(var m=[],c=g(h,0),l=4,p=0;p<c;++p){var v=g(h,l),r=g(h,l+4),l=l+8;if(k[v])for(var C=0;C<r;++C){var w=y(h,l),u=y(h,l+8);(4681>v?m:a).push(new b(w,u));l+=16}else l+=16*r}c=g(h,l);k=null;e=Math.min(e>>14,c-1);d=Math.min(d>>14,c-1);for(c=e;c<=d;++c)(e=y(h,l+4+8*c))&&(!k||e.block<k.block||e.offset<k.offset)&&(k=e);h=[];if(null!=k)for(c=0;c<m.length;++c)d=m[c],d.maxv.block>=k.block&&d.maxv.offset>=
k.offset&&h.push(d);m=h;h=[];for(c=0;c<m.length;++c)h.push(m[c]);for(c=0;c<a.length;++c)h.push(a[c]);h.sort(function(a,b){var f=a.minv.block-b.minv.block;return 0!=f?f:a.minv.offset-b.minv.offset});a=[];if(0<h.length){m=h[0];for(c=1;c<h.length;++c)d=h[c],d.minv.block==m.maxv.block?m=new b(m.minv,d.maxv):(a.push(m),m=d);a.push(m)}return a};p.prototype.fetch=function(a,b,d,h){function g(){if(p>=m.length)return h(l);if(r){var a=new Uint8Array(r);c.readRecords(a,m[p].minv.offset,l,b,d,e);r=null;++p;return g()}var w=
m[p],a=w.minv.block;c.data.slice(a,w.maxv.block+65536-a).fetch(function(a){r=v(a,w.maxv.block-w.minv.block+1);return g()})}var c=this;a=this.chrToIndex[a];if(void 0==a)return h([]);var e=this.indexToChr[a],m;void 0===a?m=[]:(m=this.blocksForRange(a,b,d))||h(null,"Error in index fetch");var l=[],p=0,r;g()};p.prototype.readRecords=function(a,b,d,h,g,c){a:for(;;){for(var e="";b<a.length;){var m=a[b++];if(10==m){m=e.split("\t");if(m[this.colSeq-1]==c){var l=parseInt(m[this.colStart-1]),p=l;0<this.colEnd&&
(p=parseInt(m[this.colEnd-1]));this.format&65536&&++l;l<=g&&p>=h&&d.push(e)}continue a}else e+=String.fromCharCode(m)}break}};p.prototype.fetchHeader=function(a){var b=this;b.data.slice(0,b.headerMax).fetch(function(d){if(!d)return a(null,"Fetch failed");d=new Uint8Array(v(d,d.byteLength));for(var h=0,g="",c=[];h<d.length;){var e=d[h++];if(10==e)if(g.charCodeAt(0)==b.meta)c.push(g),g="";else return a(c);else g+=String.fromCharCode(e)}a(c)})};"undefined"!==typeof u&&(u.exports={connectTabix:l,TABIX_MAGIC:m})},
{"./bin":4,"./lh3utils":23,"./spans":34}],40:[function(e,u,r){function p(a){this.genomes={};this.url=a}function l(){}function m(a){this.hub=a}function g(a,b,g){g=g||{};g.salt=!0;v(a,function(e,k){if(k)return b(null,k);var l=e.split(h),q=new p(a);g.credentials&&(q.credentials=g.credentials);for(var w=0;w<l.length-2;w+=3)q[l[w+1]]=l[w+2];if(q.genomesFile){var r=z(a,q.genomesFile);v(r,function(a,c){if(c)return b(null,c);for(var f=a.split(d),e=0;e<f.length;++e){var k=f[e].split(h),l=new m(q);g.credentials&&
(l.credentials=g.credentials);for(var p=0;p<k.length-2;p+=3)l[k[p+1]]=k[p+2];l.twoBitPath&&(l.twoBitPath=z(r,l.twoBitPath));l.genome&&l.trackDb&&(l.absURL=z(r,l.trackDb),q.genomes[l.genome]=l)}b(q)},g)}else b(null,"No genomesFile")},g)}function y(a,b){return a.priority&&b.priority?1*a.priority-1*b.priority:a.priority?1:b.priority?-1:a.shortLabel.localeCompare(b.shortLabel)}if("undefined"!==typeof e){r=e("./utils");var v=r.textXHR,z=r.relativeURL,b=r.shallowCopy;e=e("./das");var a=e.DASStylesheet,
q=e.DASStyle}var d=/\n\s*\n/,h=/(\w+) +(.+)\n?/,k=/subGroup[1-9]/;l.prototype.get=function(a){if(this[a])return this[a];if(this._parent)return this._parent.get(a)};m.prototype.getTracks=function(a){var b=this;if(this._tracks)return a(this._tracks);v(this.absURL,function(g,e){if(e)return a(null,e);g=g.replace("\\\n"," ");for(var m=[],p={},q=g.split(d),w=0;w<q.length;++w){var v=q[w].replace(/\#.*/g,"").split(h),r=new l;r._db=b;for(var u=0;u<v.length-2;u+=3){var f=v[u+1],x=v[u+2];if(f.match(k)){r.subgroups||
(r.subgroups={});for(var f=x.split(/\s/),x=f[0],D={name:f[1],tags:[],titles:[]},M=2;M<f.length;++M){var s=f[M].split(/=/);D.tags.push(s[0]);D.titles.push(s[1])}r.subgroups[x]=D}else if("subGroups"===f)for(f=x.split(/(\w+)=(\w+)/),r.sgm={},M=0;M<f.length-2;M+=3)r.sgm[f[M+1]]=f[M+2];else r[v[u+1]]=v[u+2]}r.track&&(r.type||r.container||r.view||r.bigDataUrl)&&(m.push(r),p[r.track]=r)}q=[];w=[];for(f=0;f<m.length;++f)r=m[f],v=!0,r.parent&&(u=r.parent.split(/\s+/),(x=p[u[0]])?(r._parent=x,x.children||(x.children=
[]),x.children.push(r),x&&(v=!1)):console.log("Couldn't find parent "+u[0]+"("+r.parent+")")),r.compositeTrack?w.push(r):v&&q.push(r);for(m=0;m<w.length;++m)if(p=w[m],p.children){r=!1;for(v=0;v<p.children.length;++v)f=p.children[v],f.view&&(f.shortLabel=p.shortLabel+": "+f.shortLabel,q.push(f),r=!0);r||q.push(p)}b._tracks=q;return a(b._tracks,null)},{credentials:this.credentials,salt:!0})};l.prototype.toDallianceSource=function(){var a={name:this.shortLabel,desc:this.longLabel};this._db.mapping&&
(a.mapping=this._db.mapping);var b=this.get("pennantIcon");b&&(b=b.split(/\s+/),a.pennant="http://genome.ucsc.edu/images/"+b[0]);if(b=this.get("searchTrix"))a.trixURI=z(this._db.absURL,b);if("multiWig"==this.container){a.merge="concat";a.overlay=[];b=this.children||[];a.style=[];a.noDownsample=!0;for(var d=0;d<b.length;++d){var h=b[d],g=h.toDallianceSource();a.overlay.push(g);if(g.style)for(var e=0;e<g.style.length;++e){var k=g.style[e];k.method=h.shortLabel;"transparentOverlay"==this.aggregate&&
(k.style.ALPHA=0.5);a.style.push(k)}}return a}b=this.type;if(!b){for(b=this;b._parent&&!b.type;)b=b._parent;b=b.type}if(b){d=b.split(/\s+/);if("bigBed"==d[0]&&this.bigDataUrl)return b=d[1]|0,d="+"==d[2],a.bwgURI=z(this._db.absURL,this.bigDataUrl),a.style=this.bigbedStyles(),this._db.credentials&&(a.credentials=!0),12<=b&&d&&(a.collapseSuperGroups=!0),a;if("bigWig"==d[0]&&this.bigDataUrl)return a.bwgURI=z(this._db.absURL,this.bigDataUrl),a.style=this.bigwigStyles(),a.noDownsample=!0,this.yLineOnOff&&
"on"==this.yLineOnOff&&(a.quantLeapThreshold=void 0!==this.yLineMark?1*this.yLineMark:0),this._db.credentials&&(a.credentials=!0),a;if("bam"==d[0]&&this.bigDataUrl)return a.bamURI=z(this._db.absURL,this.bigDataUrl),this._db.credentials&&(a.credentials=!0),a;if("vcfTabix"==d[0]&&this.bigDataUrl)return a.uri=z(this._db.absURL,this.bigDataUrl),a.tier_type="tabix",a.payload="vcf",this._db.credentials&&(a.credentials=!0),a;console.log("Unsupported "+this.type)}};l.prototype.bigwigStyles=function(){var b=
this.type;if(!b){for(b=this;b._parent&&!b.type;)b=b._parent;b=b.type}if(b){var b=b.split(/\s+/),d,h;3<=b.length&&(d=1*b[1],h=1*b[2]);var g;this.maxHeightPixels&&(b=this.maxHeightPixels.split(/:/),3==b.length?g=b[1]|0:console.log("maxHeightPixels should be of the form max:default:min"));b="bars";this.graphTypeDefault&&(b=this.graphTypeDefault);var e="black",k=null;this.color&&(e="rgb("+this.color+")");this.altColor&&(k="rgb("+this.altColor+")");var m=new a,l=new q;l.glyph="points"==b?"POINT":"HISTOGRAM";
k?(l.COLOR1=e,l.COLOR2=k):l.BGCOLOR=e;l.HEIGHT=g||30;if(d||h)l.MIN=d,l.MAX=h;m.pushStyle({type:"default"},null,l);return m.styles}};l.prototype.bigbedStyles=function(){var c="on"==(""+this.get("itemRgb")).toLowerCase(),d=this.get("visibility")||"full",h=this.get("color"),h=h?"rgb("+h+")":"blue",g=new a,e=new q;e.glyph="BOX";e.FGCOLOR="black";e.BGCOLOR=h;e.HEIGHT="full"==d||"pack"==d?12:8;e.BUMP="full"==d||"pack"==d;e.LABEL="full"==d||"pack"==d;e.ZINDEX=20;c&&(e.BGITEM=!0);(d=this.get("colorByStrand"))?
(d=d.split(/\s+/),h=b(e),h.BGCOLOR="rgb("+d[0]+")",g.pushStyle({type:"bigwig",orientation:"+"},null,h),e=b(e),e.BGCOLOR="rgb("+d[1]+")",g.pushStyle({type:"bigwig",orientation:"-"},null,e)):g.pushStyle({type:"bigwig"},null,e);e=new q;e.glyph="BOX";e.FGCOLOR="black";c&&(e.BGITEM=!0);e.BGCOLOR="red";e.HEIGHT=10;e.BUMP=!0;e.ZINDEX=20;g.pushStyle({type:"translation"},null,e);c=new q;c.glyph="BOX";c.FGCOLOR="black";c.BGCOLOR="white";c.HEIGHT=10;c.ZINDEX=10;c.BUMP=!0;c.LABEL=!0;g.pushStyle({type:"transcript"},
null,c);return g.styles};"undefined"!==typeof u&&(u.exports={connectTrackHub:g,THUB_COMPARE:y})},{"./das":10,"./utils":47}],41:[function(e,u,r){if("undefined"!==typeof e)var p=e("./cbrowser").Browser,l=e("./utils").shallowCopy;p.prototype.mergeSelectedTiers=function(){for(var e=[],g=[],p=0;p<this.selectedTiers.length;++p){var v=this.tiers[this.selectedTiers[p]];e.push(l(v.dasSource));for(var r=v.stylesheet.styles,b=0;b<r.length;++b){var a=r[b],q=l(a);q.method=v.dasSource.name.replace(/[()+*?]/g,"\\$&");
q._methodRE=null;q.style=l(a.style);void 0===q.style.ZINDEX&&(q.style.ZINDEX=p);v.forceMin&&(q.style.MIN=v.forceMin);v.forceMax&&(q.style.MAX=v.forceMax);g.push(q)}}this.addTier({name:"Merged",merge:"concat",overlay:e,noDownsample:!0,style:g});this.setSelectedTier(this.tiers.length-1)}},{"./cbrowser":6,"./utils":47}],42:[function(e,u,r){function p(b){for(var a=0;a<b.styles.length;++a){var e=b.styles[a].style;if("__SEQUENCE"===e.glyph)return e}}if("undefined"!==typeof e){var l=e("./cbrowser").Browser,
m=e("./utils").makeElement;u=e("./das");var g=u.isDasBooleanTrue,y=u.copyStylesheet,v=e("./color").dasColourForName}var z={DOT:!0,EX:!0,STAR:!0,SQUARE:!0,CROSS:!0,TRIANGLE:!0,PLIMSOLL:!0};l.prototype.openTierPanel=function(b){if("tier"===this.uiMode&&this.manipulatingTier===b)this.hideToolPanel(),this.setUiMode("none");else{var a=function(a){a.BGGRAD||(1==x?("LINEPLOT"==a.glyph||z[a.glyph]?a.FGCOLOR=N.value:a.BGCOLOR=N.value,a.COLOR1=a.COLOR2=a.COLOR3=null):(a.COLOR1=N.value,a.COLOR2=O.value,a.COLOR3=
2<x?C.value:null),a._gradient=null,a._plusColor=w.value,a._minusColor=G.value)},e=function(a){for(var f=y(b.stylesheet),c=b.browser.zoomForCurrentScale(),d=0;d<f.styles.length;++d){var h=f.styles[d];h.zoom&&h.zoom!=c||a(h.style)}return f},d=function(f){b.mergeStylesheet(e(a))};this.manipulatingTier=b;var h=m("div",null,{className:"tier-edit"});if(b.dasSource.mapping){var k=this.chains[b.dasSource.mapping].coords;h.appendChild(m("div","Mapped from "+k.auth+k.version,null,{background:"gray",paddingBottom:"5px",
marginBottom:"5px",textAlign:"center"}))}var c=m("div","Editing styles for current zoom level",null,{background:"gray",paddingBottom:"5px",marginBottom:"5px",textAlign:"center",display:"none"});h.appendChild(c);var l=m("input",null,{type:"text"}),r=m("input",null,{type:"checkbox",disabled:this.disablePinning}),u=m("select");u.appendChild(m("option","Histogram",{value:"HISTOGRAM"}));u.appendChild(m("option","Line Plot",{value:"LINEPLOT"}));u.appendChild(m("option","Ribbon",{value:"GRADIENT"}));u.appendChild(m("option",
"Scatter",{value:"SCATTER"}));var N=m("input",null,{type:"text",value:"#dd00dd"}),O=m("input",null,{type:"text",value:"#dd00dd"}),C=m("input",null,{type:"text",value:"#dd00dd"}),w=m("input",null,{type:"text",value:"#ffa07a"}),G=m("input",null,{type:"text",value:"#87cefa"});try{N.type=O.type=C.type="color",w.type=G.type="color"}catch(K){}var H=[N,O,C],k=m("i",null,{className:"fa fa-plus-circle"}),f=m("i",null,{className:"fa fa-minus-circle"}),x=1,D=m("td",H),M=function(a){x=a;for(var b=0;b<a;++b)H[b].style.display=
"block";for(b=a;b<H.length;++b)H[b].style.display="none"};k.addEventListener("click",function(a){3>x&&(M(x+1),d(null))},!1);f.addEventListener("click",function(a){1<x&&(M(x-1),d(null))},!1);var s=m("input",null,{type:"text",value:"0.0"}),E=m("input",null,{type:"text",value:"10.0"}),F=m("input",null,{type:"checkbox"}),A=m("input",null,{type:"checkbox"}),n=m("input",null,{type:"checkbox",checked:void 0!==b.quantLeapThreshold}),J=m("input",null,{type:"text",value:b.quantLeapThreshold,disabled:!n.checked}),
R=m("input",null,{type:"text",value:"50"}),I=m("input",null,{type:"checkbox"}),V=m("input",null,{type:"text"}),W=m("input",null,{type:"checkbox"}),aa=null;0<b.stylesheet.styles.length&&(aa=b.stylesheet.styles[0].style);var X=function(){l.value="string"===typeof b.config.name?b.config.name:b.dasSource.name;r.checked=b.pinned;b.forceHeight?R.value=""+b.forceHeight:aa&&aa.HEIGHT&&(R.value=""+aa.HEIGHT);"number"==typeof b.quantLeapThreshold?(n.checked=!0,J.disabled=!1,parseFloat(J.value)!=b.quantLeapThreshold&&
(J.value=b.quantLeapThreshold)):(n.checked=!1,J.disabled=!0);V.value="number"==typeof b.subtierMax?""+b.subtierMax:""+(b.dasSource.subtierMax||b.browser.defaultSubtierMax);if(0<b.stylesheet.styles.length){for(var a=null,f=!1,d=!1,d=b.browser.zoomForCurrentScale(),h=0,e=0;e<b.stylesheet.styles.length;++e){var k=b.stylesheet.styles[e];if(!k.zoom||k.zoom==d)if(++h,k=b.stylesheet.styles[e].style,a||(a=aa=k),"LINEPLOT"==k.glyph||"HISTOGRAM"==k.glyph||"GRADIENT"==k.glyph||g(k.SCATTER))f||(a=aa=k),f=!0}if(!a)return;
c.style.display=h==b.stylesheet.styles.length?"none":"block";d=f&&1==h;f?(na.style.display="table-row",la.style.display="table-row",ha.style.display="none",pa.style.display="none"):(na.style.display="none",la.style.display="none",ha.style.display="table-row",I.checked=g(aa.BUMP),V.disabled=!g(aa.BUMP),pa.style.display="table-row",W.checked=g(aa.LABEL));d?(ka.style.display="table-row",ga.style.display="table-row"):(ka.style.display="none",ga.style.display="none");h=1;a.COLOR1?(N.value=v(a.COLOR1).toHexString(),
a.COLOR2&&(O.value=v(a.COLOR2).toHexString(),a.COLOR3?(C.value=v(a.COLOR3).toHexString(),h=3):h=2)):"LINEPLOT"==a.glyph||"DOT"==a.glyph&&a.FGCOLOR?N.value=v(a.FGCOLOR).toHexString():a.BGCOLOR&&(N.value=v(a.BGCOLOR).toHexString());M(h);a._plusColor&&(w.value=v(a._plusColor).toHexString()||a._plusColor);a._minusColor&&(G.value=v(a._minusColor).toHexString()||a._minusColor);g(a.SCATTER)?u.value="SCATTER":u.value=a.glyph;var m,x;void 0!==a.MIN&&(h=parseFloat(a.MIN),isNaN(h)||(m=h));b.forceMinDynamic||
void 0===a.MIN&&void 0===b.forceMin?(F.checked=!1,s.disabled=!0):(F.checked=!0,s.disabled=!1);void 0!==a.MAX&&(h=parseFloat(a.MAX),isNaN(h)||(x=h));b.forceMaxDynamic||void 0===a.MAX&&void 0===b.forceMax?(A.checked=!1,E.disabled=!0):(A.checked=!0,E.disabled=!1);void 0!=b.forceMin&&(m=b.forceMin);void 0!=b.forceMax&&(x=b.forceMax);"number"==typeof m&&m!=parseFloat(s.value)&&(s.value=m);"number"==typeof x&&x!=parseFloat(E.value)&&(E.value=x);(a=p(b.stylesheet))?($.style.display="table-row",S.checked=
"mismatch"===a.__SEQCOLOR,ja.style.display="table-row",Z.checked=g(a.__INSERTIONS)):($.style.display="none",ja.style.display="none");a&&S.checked&&!d?(fa.style.display="table-row",ca.style.display="table-row"):(fa.style.display="none",ca.style.display="none")}f&&b.browser.sourceAdapterIsCapable(b.featureSource,"quantLeap")?ma.style.display="table-row":ma.style.display="none"},S=m("input",null,{type:"checkbox"}),$=m("tr",[m("th","Highlight mismatches & strands"),m("td",S)]);S.addEventListener("change",
function(a){a=y(b.stylesheet);p(a).__SEQCOLOR=S.checked?"mismatch":"base";b.mergeStylesheet(a)});var Z=m("input",null,{type:"checkbox"}),ja=m("tr",[m("th","Show insertions"),m("td",Z)]);Z.addEventListener("change",function(a){a=y(b.stylesheet);p(a).__INSERTIONS=Z.checked?"yes":"no";b.mergeStylesheet(a)});var ka=m("tr",[m("th","Style"),m("td",u)]),ga=m("tr",[m("th",["Colour(s)",k,f]),D]),fa=m("tr",[m("th","Plus Strand Color"),m("td",w)]),ca=m("tr",[m("th","Minus Strand Color"),m("td",G)]),na=m("tr",
[m("th","Min value"),m("td",[F," ",s])]),la=m("tr",[m("th","Max value"),m("td",[A," ",E])]),ma=m("tr",[m("th","Threshold leap:"),m("td",[n," ",J])]),ha=m("tr",[m("th","Bump overlaps"),m("td",[I," limit: ",V])]),pa=m("tr",[m("th","Label features"),m("td",W)]),k=m("table",[m("tr",[m("th","Name",{},{width:"150px",textAlign:"right"}),l]),m("tr",[m("th","Pin to top"),r]),m("tr",[m("th","Height"),m("td",R)]),ka,ga,fa,ca,na,la,ma,ha,pa,$,ja]);X();h.appendChild(k);k=m("button","Reset track",{className:"btn"},
{marginLeft:"auto",marginRight:"auto",display:"block"});k.addEventListener("click",function(a){b.setConfig({})},!1);h.appendChild(k);l.addEventListener("input",function(a){b.mergeConfig({name:l.value})},!1);r.addEventListener("change",function(a){b.mergeConfig({pinned:r.checked})},!1);for(k=0;k<H.length;++k)H[k].addEventListener("change",d,!1);w.addEventListener("change",d,!1);G.addEventListener("change",d,!1);u.addEventListener("change",function(f){f=e(function(b){"SCATTER"===u.value?(b.SCATTER=
!0,b.glyph="DOT",b.SIZE="3"):(b.glyph=u.value,b.SCATTER=void 0);a(b)});b.mergeStylesheet(f)},!1);F.addEventListener("change",function(a){a={forceMinDynamic:!F.checked};s.disabled=!F.checked;var f=parseFloat(s.value);F.checked&&"number"==typeof f&&!isNaN(f)&&(a.forceMin=parseFloat(f));b.mergeConfig(a)});s.addEventListener("input",function(a){a=parseFloat(s.value);"number"!=typeof a||isNaN(a)||b.mergeConfig({forceMin:a})},!1);A.addEventListener("change",function(a){a={forceMaxDynamic:!A.checked};E.disabled=
!A.checked;var f=parseFloat(E.value);A.checked&&"number"==typeof f&&!isNaN(f)&&(a.forceMax=parseFloat(f));b.mergeConfig(a)});E.addEventListener("input",function(a){a=parseFloat(E.value);"number"!=typeof a||isNaN(a)||b.mergeConfig({forceMax:a})},!1);R.addEventListener("input",function(a){a=parseFloat(R.value);"number"!=typeof a||isNaN(a)||b.mergeConfig({height:Math.min(500,a|0)})},!1);var qa=function(){J.disabled=!n.checked;if(n.checked){var a=parseFloat(J.value);"number"!=typeof a||isNaN(a)||b.mergeConfig({quantLeapThreshold:parseFloat(J.value)})}else b.mergeConfig({quantLeapThreshold:null})};
n.addEventListener("change",function(a){qa()},!1);J.addEventListener("input",function(a){qa()},!1);W.addEventListener("change",function(a){a=e(function(a){a.LABEL=W.checked?"yes":"no"});b.mergeStylesheet(a)},!1);I.addEventListener("change",function(a){a=e(function(a){a.BUMP=I.checked?"yes":"no"});b.mergeStylesheet(a)},!1);V.addEventListener("input",function(a){a=parseInt(V.value);"number"==typeof a&&0<a&&b.mergeConfig({subtierMax:a})},!1);this.showToolPanel(h);this.setUiMode("tier");b.addTierListener(X);
var T=b.browser.scale;b.browser.addViewListener(function(){b.browser.scale!=T&&(T=b.browser.scale,X())})}}},{"./cbrowser":6,"./color":9,"./das":10,"./utils":47}],43:[function(e,u,r){function p(a,b,d,h){this.config=d||{};this.id="tier"+ ++q;this.browser=a;this.dasSource=m(b);this.background=h;this.viewport=l("canvas",null,{width:""+((this.browser.featurePanelWidth|0)+2E3),height:"30",className:"viewport_12_5"},{position:"inline-block",margin:"0px",border:"0px"});this.viewportHolder=l("div",this.viewport,
{className:"viewport-holder_12_5"},{background:h,position:"absolute",padding:"0px",margin:"0px",border:"0px",left:"-1000px",minHeight:"200px"});this.overlay=l("canvas",null,{width:+(this.browser.featurePanelWidth|0),height:"30",className:"viewport-overlay"});this.notifier=l("div","",{className:"notifier"});this.notifierHolder=l("div",this.notifier,{className:"notifier-holder"});this.quantOverlay=l("canvas",null,{width:"50",height:"56",className:"quant-overlay"});this.removeButton=l("i",null,{className:"fa fa-times"});
this.bumpButton=l("i",null,{className:"fa fa-plus-circle"});this.loaderButton=a.makeLoader(16);this.loaderButton.style.display="none";this.infoElement=l("div",this.dasSource.desc,{className:"track-label-info"});this.nameButton=l("div",[],{className:"tier-tab"});this.nameButton.appendChild(this.removeButton);b.pennant?this.nameButton.appendChild(l("img",null,{src:b.pennant,width:"16",height:"16"})):b.mapping&&(d=null,this.browser.chains[b.mapping]&&(d=this.browser.chains[b.mapping].coords.version),
d&&this.nameButton.appendChild(l("span",""+d,null,{fontSize:"8pt",background:"black",color:"white",paddingLeft:"3px",paddingRight:"3px",paddingTop:"1px",paddingBottom:"1px",marginLeft:"2px",borderRadius:"10px"})));this.nameElement=l("span",b.name);this.nameButton.appendChild(l("span",[this.nameElement,this.infoElement],{className:"track-name-holder"}));this.nameButton.appendChild(this.bumpButton);this.nameButton.appendChild(this.loaderButton);this.label=l("span",[this.nameButton],{className:"btn-group track-label"});
this.row=l("div",[this.viewportHolder,this.overlay,this.quantOverlay],{className:"tier"+(b.className?" "+b.className:"")});h||(this.row.style.background="none");a.noDefaultLabels||this.row.appendChild(this.label);this.row.appendChild(this.notifierHolder);this.layoutHeight=25;this.bumped=!0;this.styleIdSeed=0;b.quantLeapThreshold&&(this.quantLeapThreshold=b.quantLeapThreshold);this.dasSource.collapseSuperGroups&&(this.bumped=!1);this.layoutWasDone=!1;b.featureInfoPlugin&&this.addFeatureInfoPlugin(b.featureInfoPlugin);
this.initSources();var e=this;this.featureSource&&this.featureSource.getDefaultFIPs&&!b.noSourceFeatureInfo&&this.featureSource.getDefaultFIPs(function(a){a&&e.addFeatureInfoPlugin(a)});this.featureSource&&this.featureSource.addReadinessListener&&this.featureSource.addReadinessListener(function(a){e.notify(a,-1)});this.listeners=[];this.featuresLoadedListeners=[]}if("undefined"!==typeof e){r=e("./utils");var l=r.makeElement,m=r.shallowCopy,g=r.miniJSONify;r=e("./das");var y=r.DASStylesheet,v=r.DASStyle,
z=e("./sha1").b64_sha1;r=e("./style");var b=r.StyleFilter,a=r.StyleFilterSet}var q=0;p.prototype.setBackground=function(a){this.background=a;this.viewportHolder.style.background=a};p.prototype.toString=function(){return this.id};p.prototype.addFeatureInfoPlugin=function(a){this.featureInfoPlugins||(this.featureInfoPlugins=[]);this.featureInfoPlugins.push(a)};p.prototype.init=function(){var a=this;a.dasSource.style?(this.setStylesheet({styles:a.dasSource.style}),this.browser.refreshTier(this)):(a.status=
"Fetching stylesheet",a.fetchStylesheet(function(b,d){if(d||!b){a.error="No stylesheet";b=new y;var h=new v;h.glyph="BOX";h.BGCOLOR="blue";h.FGCOLOR="black";b.pushStyle({type:"default"},null,h);a.setStylesheet(b)}else a.setStylesheet(b),b.geneHint&&(a.dasSource.collapseSuperGroups=!0,a.bumped=!1,a.updateLabel()),a._updateFromConfig();a.browser.refreshTier(a)}))};p.prototype.setStylesheet=function(a){this.baseStylesheet=m(a);for(a=0;a<this.baseStylesheet.styles.length;++a){var b=this.baseStylesheet.styles[a]=
m(this.baseStylesheet.styles[a]);b._methodRE=b._labelRE=b._typeRE=null;b.style=m(b.style);b.style.id="style"+ ++this.styleIdSeed}this.baseStylesheetValidity=z(g(this.baseStylesheet));this._updateFromConfig()};p.prototype.getSource=function(){return this.featureSource};p.prototype.getDesiredTypes=function(a){if(a=this.getActiveStyleFilters(a))return a.typeList()};p.prototype.getActiveStyleFilters=function(d){d=this.browser.zoomForCurrentScale();if(this.stylesheet){for(var c=new a,h=this.stylesheet.styles,
e=0;e<h.length;++e){var g=h[e];g.zoom&&g.zoom!=d||c.add(new b(g.type,g.method,g.label))}return c}};p.prototype.needsSequence=function(a){return this.sequenceSource&&5>a||(this.dasSource.bamURI||this.dasSource.bamBlob||this.dasSource.bwgURI||this.dasSource.bwgBlob)&&20>a?!0:!1};p.prototype.viewFeatures=function(a,b,d,h,e){this.currentFeatures=h;this.currentSequence=e;this.notifyFeaturesLoaded();this.knownChr=a;this.knownCoverage=b;this.status&&(this.status=null,this._notifierToStatus());this.draw()};
p.prototype.draw=function(){var a=this.currentSequence;this.sequenceSource?h(this,a):d(this);this.paint();this.originHaxx=0;this.browser.arrangeTiers()};p.prototype.findNextFeature=function(a,b,d,h,e){if(this.quantLeapThreshold)b=b+(this.browser.viewEnd-this.browser.viewStart+1)*d/2|0,this.featureSource.quantFindNextFeature(a,b,d,this.quantLeapThreshold,e);else{if(this.knownCoverage&&b>=this.knownCoverage.min()&&b<=this.knownCoverage.max()&&this.currentFeatures){for(var g=null,m=0;m<this.currentFeatures.length;++m){var l=
this.currentFeatures[m];if(l.min&&l.max&&!(l.parents&&0<l.parents.length))if(0>d)if(1==h&&l.max>=b&&l.min<b){if(!g||l.min>g.min||l.min==g.min&&l.max<g.max)g=l}else l.max<b&&(!g||l.max>g.max||l.max==g.max&&l.min<g.min||l.min==g.mmin&&g.max>=b)&&(g=l);else if(1==h&&l.min<=b&&l.max>b){if(!g||l.max<g.max||l.max==g.max&&l.min>g.min)g=l}else l.min>b&&(!g||l.min<g.min||l.min==g.min&&l.max>g.max||l.max==g.max&&g.min<=b)&&(g=l)}if(g)return e(g);b=0>d?this.browser.knownSpace.min:this.browser.knownSpace.max}this.trySourceFNF(a,
b,d,e)}};p.prototype.trySourceFNF=function(a,b,d,h){var g=this;this.featureSource.findNextFeature(a,b,d,function(a){a||h(a);var b=g.browser.getSequenceSource();b||h(a);b.getSeqInfo(a.segment,function(b){b?h(a):g.trySourceFNF(a.segment,0<d?1E10:0,d,h)})})};p.prototype.updateLabel=function(){this.bumpButton.className=this.bumped?"fa fa-minus-circle":"fa fa-plus-circle";this.bumpButton.style.display=this.dasSource.collapseSuperGroups?"inline-block":"none"};p.prototype.updateHeight=function(){this.currentHeight=
Math.max(Math.max(this.layoutHeight,this.label.clientHeight+2),this.browser.minTierHeight);this.row.style.height=""+this.currentHeight+"px";this.browser.updateHeight()};p.prototype.drawOverlay=function(){var a=this.browser,b=a.retina&&1<window.devicePixelRatio;this.overlay.height=this.viewport.height;this.overlay.width=b?2*a.featurePanelWidth:a.featurePanelWidth;var d=this.overlay.getContext("2d");b&&d.scale(2,2);var h=b=a.viewStart,g=a.viewEnd;if(this.overlayLabelCanvas){var e=(this.glyphCacheOrigin-
this.browser.viewStart)*this.browser.scale;d.save();d.translate(e,0);var l=-e+2;this.dasSource.tierGroup&&(l+=15);this.overlayLabelCanvas.draw(d,l,a.featurePanelWidth-e);d.restore()}for(e=0;e<a.highlights.length;++e)l=a.highlights[e],(l.chr===a.chr||l.chr==="chr"+a.chr)&&l.min<g&&l.max>h&&(d.globalAlpha=a.defaultHighlightAlpha,d.fillStyle=a.defaultHighlightFill,d.fillRect((l.min-b)*a.scale,0,(l.max-l.min)*a.scale,this.overlay.height));this.overlay.style.width=a.featurePanelWidth;this.overlay.style.height=
this.viewport.style.height;this.overlay.style.left="0px"};p.prototype.updateStatus=function(a){a?(this.status=a,this._notifierToStatus()):this.status&&(this.status=null,this._notifierToStatus())};p.prototype.notify=function(a,b){"number"!==typeof b&&(b=2E3);this.notifierFadeTimeout&&(clearTimeout(this.notifierFadeTimeout),this.notifierFadeTimeout=null);if(a){if(this._notifierOn(a),0<b){var d=this;this.notifierFadeTimeout=setTimeout(function(){d._notifierToStatus()},b)}}else this._notifierToStatus()};
p.prototype._notifierOn=function(a){this.notifier.textContent=a;this.notifier.style.opacity=0.8};p.prototype._notifierOff=function(){this.notifier.style.opacity=0};p.prototype._notifierToStatus=function(){this.status?this._notifierOn(this.status):this._notifierOff()};p.prototype.setConfig=function(a){this.config=a||{};this._updateFromConfig();this.notifyTierListeners()};p.prototype.mergeStylesheet=function(a){this.mergeConfig({stylesheet:a,stylesheetValidity:this.baseStylesheetValidity})};p.prototype.mergeConfig=
function(a){for(var b in a)this.config[b]=a[b];this._updateFromConfig();this.notifyTierListeners()};p.prototype._updateFromConfig=function(){var a=!1,b=!1;this.nameElement.textContent="string"===typeof this.config.name?this.config.name:this.dasSource.name;var d=this.config.height||this.dasSource.forceHeight;d!=this.forceHeight&&(this.forceHeight=d,a=!0);this.forceMinDynamic!=this.config.forceMinDynamic&&(this.forceMinDynamic=this.config.forceMinDynamic,a=!0);d=void 0!=this.config.forceMin?this.config.forceMin:
this.dasSource.forceMin;this.forceMin!=d&&(this.forceMin=d,a=!0);this.forceMaxDynamic!=this.config.forceMaxDynamic&&(this.forceMaxDynamic=this.config.forceMaxDynamic,a=!0);d=void 0!=this.config.forceMax?this.config.forceMax:this.dasSource.forceMax;this.forceMax!=d&&(this.forceMax=d,a=!0);d=null;void 0!==this.config.quantLeapThreshold?d=this.config.quantLeapThreshold:void 0!==this.dasSource.quantLeapThreshold&&(d=this.dasSource.quantLeapThreshold);d!=this.quantLeapThreshold&&(this.quantLeapThreshold=
d,a=!0);d=null;this.config.stylesheetValidity==this.baseStylesheetValidity&&(d=this.config.stylesheet);d=d||this.baseStylesheet;this.stylesheet!==d&&(this.stylesheet=d,a=!0);d=void 0!==this.config.pinned?this.config.pinned:this.dasSource.pinned;d!==this.pinned&&(this.pinned=d,b=!0);d=typeof("number"===this.config.subtierMax)?this.config.subtierMax:this.dasSource.subtierMax||this.browser.defaultSubtierMax;d!=this.subtierMax&&(this.subtierMax=d,a=!0);d=void 0!==this.config.bumped?this.config.bumped:
void 0!==this.dasSource.bumped?this.dasSource.bumped:this.dasSource.collapseSuperGroups?!1:!0;d!==this.bumped&&(this.bumped=d,a=!0,this.updateLabel());a&&this.scheduleRedraw();b&&this.browser.reorderTiers()};p.prototype.scheduleRedraw=function(){if(this.currentFeatures){var a=this;this.redrawTimeout||(this.redrawTimeout=setTimeout(function(){a.draw();a.redrawTimeout=null},10))}};p.prototype.addTierListener=function(a){this.listeners.push(a)};p.prototype.notifyTierListeners=function(a){for(var b=0;b<
this.listeners.length;++b)try{this.listeners[b](a)}catch(d){console.log(d)}this.browser.notifyTier()};p.prototype.addFeaturesLoadedListener=function(a){this.featuresLoadedListeners.push(a)};p.prototype.notifyFeaturesLoaded=function(){for(var a=0;a<this.featuresLoadedListeners.length;++a)try{this.featuresLoadedListeners[a].call(this)}catch(b){console.log(b)}};if("undefined"!==typeof u){u.exports={DasTier:p};var d=e("./feature-draw").drawFeatureTier,h=e("./sequence-draw").drawSeqTier}},{"./das":10,
"./feature-draw":17,"./sequence-draw":30,"./sha1":32,"./style":35,"./utils":47}],44:[function(e,u,r){function p(a,b){for(var c=0;c<a.length;++c){var d=a[c];d===b?d.classList.add("active"):d.classList.remove("active")}}if("undefined"!==typeof e){u=e("./cbrowser");var l=u.Browser,m=u.sourcesAreEqual;u=e("./utils");var g=u.makeElement,y=u.removeChildren,v=u.Observed;u=e("./thub");var z=u.THUB_COMPARE,b=u.connectTrackHub,a=e("./domui").makeTreeTableSection,q=e("./probe").probeResource;u=e("./bin");var d=
u.URLFetchable,h=u.BlobFetchable,k=u.readInt,c=e("./lh3utils").unbgzf,t=e("./bam").BAI_MAGIC,B=e("./tabix").TABIX_MAGIC;e=e("./das");var Q=e.DASSource,N=e.DASSegment,O=e.DASRegistry,C=e.coordsMatch}l.prototype.currentlyActive=function(a){for(var b=0;b<this.tiers.length;++b)if(m(this.tiers[b].dasSource,a))return this.tiers[b];return!1};l.prototype.makeButton=function(a,b){var c=g("a",a,{href:"#"});b&&this.makeTooltip(c,b);return g("li",c)};l.prototype.showTrackAdder=function(e){function l(b){ba.style.display=
"none";ia.style.display="none";Y.style.display="none";T=!1;y(P);for(var f=g("div",null,{},{width:"100%"}),c=[],d=0;d<b.length;++d)c.push(b[d]);c.sort(function(a,b){return a.shortLabel.toLowerCase().trim().localeCompare(b.shortLabel.toLowerCase().trim())});b=[];for(var h=[],d=0;d<c.length;++d){var e=c[d];e.children&&0<e.children.length&&"multiWig"!=e.container?b.push(e):h.push(e)}0<h.length&&b.push({shortLabel:"Others",priority:-1E8,children:h});b.sort(z);for(var k=[],c=0;c<b.length;++c){e=h=b[c];
!e.dimensions&&e._parent&&e._parent.dimensions&&(e=e._parent);d={};if(e.dimensions)for(var n=e.dimensions.split(/(\w+)=(\w+)/),m=0;m<n.length-2;m+=3)d[n[m+1]]=n[m+2];if(d.dimX&&d.dimY){for(var p=d.dimX,x=d.dimY,d=e.subgroups[p],n=e.subgroups[x],m={},q=0;q<h.children.length;++q){var s=h.children[q],e=s.sgm[p],D=s.sgm[x];m[e]||(m[e]={});m[e][D]=s}x=g("table",null,{className:"table table-striped table-condensed"},{tableLayout:"fixed"});e=g("tr");e.appendChild(g("th",null,{},{width:"150px",height:"100px"}));
for(D=0;D<d.titles.length;++D)p=g("th",g("div",d.titles[D],{},{transform:"rotate(-60deg)",transformOrigin:"0% 100%",webkitTransform:"rotate(-60deg) translate(20px,10px)",webkitTransformOrigin:"0% 100%",textAlign:"left"}),{},{width:"35px",height:"100px",verticalAlign:"bottom"}),e.appendChild(p);x.appendChild(e);for(var v=g("tbody",null,{className:"table table-striped table-condensed"}),r=0;r<n.titles.length;++r){var D=n.tags[r],w=g("tr");w.appendChild(g("th",n.titles[r]),{});for(var t=0;t<d.titles.length;++t){var e=
d.tags[t],u=g("td");if(m[e]&&m[e][D]){e=m[e][D];q=e.toDallianceSource();if(!q)continue;p=g("tr");s=g("td");s.style.textAlign="center";var E=g("input");E.type="checkbox";E.dalliance_source=q;oa&&(E.dalliance_mapping=oa);k.push(E);u.appendChild(E);E.addEventListener("change",function(a){a.target.checked?A.addTier(a.target.dalliance_source):A.removeTier(a.target.dalliance_source)})}w.appendChild(u)}v.appendChild(w)}x.appendChild(v);f.appendChild(a(h.shortLabel,x,0==c))}else{n=g("tbody",null,{className:"table table-striped table-condensed"});
m=g("table",n,{className:"table table-striped table-condensed"},{width:"100%",tableLayout:"fixed"});D=0;h.children.sort(z);for(d=0;d<h.children.length;++d)if(e=h.children[d],q=e.toDallianceSource())p=g("tr"),s=g("td",null,{},{width:"30px"}),s.style.textAlign="center",E=g("input"),E.type="checkbox",E.dalliance_source=q,oa&&(E.dalliance_mapping=oa),k.push(E),s.appendChild(E),E.addEventListener("change",function(a){a.target.checked?A.addTier(a.target.dalliance_source):A.removeTier(a.target.dalliance_source)}),
p.appendChild(s),x=g("td"),x.appendChild(document.createTextNode(e.shortLabel)),e.longLabel&&0<e.longLabel.length&&A.makeTooltip(x,e.longLabel),p.appendChild(x),n.appendChild(p),++D;1<b.length||"Others"!==h.shortLabel?f.appendChild(a(h.shortLabel,m,0==c)):f.appendChild(m)}}var F=function(){for(var a=0;a<k.length;++a){var b=k[a],f=A.currentlyActive(b.dalliance_source);f?(b.checked=!0,b.disabled=null!=f.sequenceSource):b.checked=!1}};F();A.addTierListener(function(a){F()});P.appendChild(f)}function m(){p(n,
ka);T="bin";ba.style.display="none";ia.style.display="inline";Y.style.display="none";y(P);var a=g("div",null,{},{paddingLeft:"10px",paddingRight:"10px"});a.appendChild(g("h3","Add custom URL-based data"));a.appendChild(g("p",["You can add indexed binary data hosted on an web server that supports CORS (",g("a","full details",{href:"http://www.biodalliance.org/bin.html"}),").  Currently supported formats are bigwig, bigbed, and indexed BAM."]));a.appendChild(g("br"));a.appendChild(document.createTextNode("URL: "));
ca=g("input","",{size:80,value:"http://www.biodalliance.org/datasets/ensGene.bb"},{width:"100%"});a.appendChild(ca);a.appendChild(g("br"));a.appendChild(g("b","- or -"));a.appendChild(g("br"));a.appendChild(document.createTextNode("File: "));ha=g("input",null,{type:"file",multiple:"multiple"});a.appendChild(ha);a.appendChild(g("p",'Clicking the "Add" button below will initiate a series of test queries.'));P.appendChild(a);ca.focus()}function r(){p(n,ga);ba.style.display="none";ia.style.display="inline";
Y.style.display="none";T="hub-connect";ba.style.visibility="hidden";y(P);var a=g("div",null,{},{paddingLeft:"10px",paddingRight:"10px"});a.appendChild(g("h3","Connect to a track hub."));a.appendChild(g("p",['Enter the top-level URL (usually points to a file called "hub.txt") of a UCSC-style track hub']));ca=g("input","",{size:120,value:"http://www.biodalliance.org/datasets/testhub/hub.txt"},{width:"100%"});a.appendChild(ca);P.appendChild(a);ca.focus()}function f(){p(n,ja);ba.style.display="none";
ia.style.display="inline";Y.style.display="none";T="das";y(P);var a=g("div",null,{},{paddingLeft:"10px",paddingRight:"10px"});a.appendChild(g("h3","Add custom DAS data"));a.appendChild(g("p","This interface is intended for adding custom or lab-specific data.  Public data can be added more easily via the registry interface."));a.appendChild(document.createTextNode("URL: "));a.appendChild(g("br"));ca=g("input","",{size:80,value:"http://www.derkholm.net:8080/das/medipseq_reads/"},{width:"100%"});a.appendChild(ca);
a.appendChild(g("p",'Clicking the "Add" button below will initiate a series of test queries.  If the source is password-protected, you may be prompted to enter credentials.'));P.appendChild(a);ca.focus()}function x(){if(T)if("das"===T){var a=ca.value.trim();/^.+:\/\//.exec(a)||(a="http://"+a);var b=new Q({name:"temporary",uri:a});ta(b)}else if("bin"===T)if((a=ha.files)&&0<a.length){b=L=[];T="multiple";for(var c=0;c<a.length;++c){var d=a[c];d&&b.push({blob:d})}for(c=0;c<b.length;++c)ra(b[c]);ea()}else a=
ca.value.trim(),/^.+:\/\//.exec(a)||(a="http://"+a),va({uri:a});else if("reset"===T)f();else if("reset-bin"===T)m();else if("reset-hub"===T)r();else if("prompt-bai"===T)(a=ha.files)&&0<a.length&&a[0]?(da.baiBlob=a[0],s(da)):(a=da,ba.style.display="none",ia.style.display="inline",Y.style.display="inline",y(P),T="prompt-bai",P.appendChild(g("h2","Select an index file")),P.appendChild(g("p","Dalliance requires a BAM index (.bai) file when displaying BAM data.  These normally accompany BAM files.  For security reasons, web applications like Dalliance can only access local files which you have explicity selected.  Please use the file chooser below to select the appropriate BAI file")),
P.appendChild(document.createTextNode("Index file: ")),ha=g("input",null,{type:"file"}),P.appendChild(ha),da=a);else if("prompt-tbi"===T)(a=ha.files)&&0<a.length&&a[0]?(da.indexBlob=a[0],E(da)):(a=da,ba.style.display="none",ia.style.display="inline",Y.style.display="inline",y(P),T="prompt-tbi",P.appendChild(g("h2","Select an index file")),P.appendChild(g("p","Dalliance requires a Tabix index (.tbi) file when displaying VCF data.  For security reasons, web applications like Dalliance can only access local files which you have explicity selected.  Please use the file chooser below to select the appropriate BAI file")),
P.appendChild(document.createTextNode("Index file: ")),ha=g("input",null,{type:"file"}),P.appendChild(ha),da=a);else if("finalize"===T||"finalize-bin"===T)da.name=na.value,a=la.value,da.mapping="__default__"!=a?a:void 0,ma&&(da.maxbins=ma.checked),1<pa.value.length&&1<qa.value.length&&(da.xUser=pa.value,da.xPass=qa.value),A.addTier(da),"finalize-bin"==T?m():f();else if("hub-connect"===T)a=ca.value.trim(),/^.+:\/\//.exec(a)||(a="http://"+a),D(a);else{if("multiple"===T){for(a=0;a<L.length;++a)if(b=
L[a],!b.hidden&&("bam"!=b.tier_type||b.indexBlob||b.indexUri)&&("tabix"!=b.tier_type||b.indexBlob||b.indexUri)&&(b=ua(b)))b.noPersist=!0,A.addTier(b);m()}}else A.removeAllPopups()}function D(a,f,c){f=f||{};for(var d=0;d<A.hubObjects.length;++d){var h=A.hubObjects[d];if(h.hub.url==a){for(d=0;d<n.length;++d)n[d].hub==h&&p(n,n[d]);h.getTracks(function(a,b){b&&console.log(b);l(a)});return}}b(a,function(b,d){if(d){if(!c)return D(a,{credentials:!0},!0);y(P);P.appendChild(g("h2","Error connecting to track hub"));
P.appendChild(g("p",d));T="reset-hub"}else{var h=null,e=null,k;for(k in b.genomes){var m=null,x=!1;if(k==A.coordSystem.ucscName)x=!0;else for(var q in A.chains)k==A.chains[q].coords.ucscName&&(m=q,x=!0);x&&(x={url:a,genome:k},f.credentials&&(x.credentials=!0),m&&(x.mapping=m,b.genomes[k].mapping=m),A.hubs.push(x),A.hubObjects.push(b.genomes[k]),x=S(b.genomes[k]),fa.appendChild(x),m&&h||(h=b.genomes[k],e=x))}h?(A.notifyTier(),p(n,e),h.getTracks(function(a,b){l(a)})):(y(P),P.appendChild(g("h2","No data for this genome")),
P.appendChild(g("p","This URL appears to be a valid track-hub, but it doesn't contain any data for the coordinate system of this browser")),P.appendChild(g("p","coordSystem.ucscName = "+A.coordSystem.ucscName)),T="reset-hub")}},f)}function u(a,b){var f=a.uri;if(b){var c=/(.+)\/[^\/]+\/?/.exec(f);c&&(f=c[1]+"/sources")}(new O(f,{credentials:a.credentials})).sources(function(f){if(!f||0==f.length)return b?U(a):u(a,!0);var c=null;if(1==f.length)c=f[0];else for(var d=0;d<f.length;++d)if(f[d].uri===a.uri){c=
f[d];break}d=f=!1;if(c&&(a.name=c.name,a.desc=c.desc,a.maxbins=c.maxbins?!0:!1,c.capabilities&&(a.capabilities=c.capabilities),d=!0,c.coords&&1==c.coords.length))if(c=c.coords[0],C(c,A.coordSystem))f=!0;else if(A.chains)for(var h in A.chains)C(c,A.chains[h].coords)&&(a.mapping=h,f=!0);return U(a,f,d)},function(){return b?U(a):u(a,!0)})}function s(a){(a.baiBlob?new h(a.baiBlob):new d(a.bamURI+".bai")).slice(0,256).fetch(function(b){var f=!1;b&&(b=new Uint8Array(b),f=k(b,0)==t);return f?U(a,!1,!1,!0):
F("You have selected a valid BAM file, but a corresponding index (.bai) file was not found.  Please index your BAM (samtools index) and place the BAI file in the same directory")})}function E(a){(a.indexBlob?new h(a.indexBlob):new d(a.uri+".tbi")).slice(0,65536).fetch(function(b){var f=!1;if(b){var d=new Uint8Array(b);if(31==d[0]||139==d[1])b=c(b),d=new Uint8Array(b),f=k(d,0)==B}return f?U(a,!1,!1,!0):F('You have selected a valid VCF file, but a corresponding index (.tbi) file was not found.  Please index your VCF ("tabix -p vcf -f myfile.vcf.gz") and place the .tbi file in the same directory')})}
function F(a){ba.style.display="none";ia.style.display="inline";Y.style.display="inline";y(P);a=a||"Custom data format not recognized";P.appendChild(g("h2","Error adding custom data"));P.appendChild(g("p",a));P.appendChild(g("p","Currently supported formats are bigBed, bigWig, and BAM."));T="reset-bin"}if("add"===this.uiMode)this.hideToolPanel(),this.setUiMode("none");else{var A=this;e=g("div",null,{className:"dalliance"},{width:"100%",display:"inline-block",boxSizing:"border-box",MozBoxSizing:"border-box",
verticalAlign:"top",paddingRight:"15px"});var n=[],J,R;if(!this.noRegistryTabs){var I=this.makeButton("Registry","Browse compatible datasources from the DAS registry");n.push(I);for(var V in this.mappableSources)(function(a){var b=A.makeButton(A.chains[a].srcTag,"Browse datasources mapped from "+A.chains[a].srcTag);n.push(b);b.addEventListener("click",function(f){f.preventDefault();f.stopPropagation();p(n,b);J(A.mappableSources[a],a)},!1)})(V)}V={};for(var W=0;W<this.defaultSources.length;++W){var aa=
this.defaultSources[W],X=aa.group||"Defaults";V[X]?V[X].push(aa):V[X]=[aa]}var S=function(a){var b=a.hub,f=g("i",null,{className:"fa fa-list-alt"},{cursor:"context-menu"}),c=b.shortLabel||"Unknown";a.mapping&&(c=c+" ("+a.genome+")");var c=g("span",[c," ",f]),d=A.makeButton(c,b.longLabel);d.hub=a;n.push(d);d.addEventListener("click",function(b){b.preventDefault();b.stopPropagation();p(n,d);y(P);b=A.makeLoader(24);b.style.marginLeft="auto";b.style.marginRight="auto";b.style.marginTop="100px";P.appendChild(g("div",
b,null,{textAlign:"center"}));ba.style.display="none";ia.style.display="none";Y.style.display="none";a.getTracks(function(a,b){b&&console.log(b);l(a)})},!1);f.addEventListener("click",function(b){b.preventDefault();b.stopPropagation();var f=g("li",g("a","Remove hub")),c=g("li",g("a","Enable all")),h=g("li",g("a","Disable all")),e=g("ul",[f,c,h],{className:"dropdown-menu"},{display:"block"}),k=b.clientX;b=b.clientY;k+=document.documentElement.scrollLeft||document.body.scrollLeft;b+=document.documentElement.scrollTop||
document.body.scrollTop;e.style.position="absolute";e.style.top=""+(b+10)+"px";e.style.left=""+(k-30)+"px";A.hPopupHolder.appendChild(e);var l=function(a){console.log("cc");document.body.removeEventListener("click",l,!0);A.hPopupHolder.removeChild(e)};document.body.addEventListener("click",l,!0);f.addEventListener("click",function(b){for(b=0;b<A.hubObjects.length;++b)if(A.hubObjects[b].absURL==a.absURL){A.hubObjects.splice(b,1);break}for(b=0;b<A.hubs.length;++b){var f=A.hubs[b];"string"===typeof f&&
(f={url:f});if(f.url==a.hub.url&&!f.genome||f.genome==a.genome){A.hubs.splice(b,1);break}}A.notifyTier();fa.removeChild(d);p(n,ga);r()},!1);c.addEventListener("click",function(b){a.getTracks(function(a,b){b&&console.log(b);for(var f=0;f<a.length;++f){var c=a[f].toDallianceSource();A.currentlyActive(c)||A.addTier(c)}})},!1);h.addEventListener("click",function(b){a.getTracks(function(a,b){b&&console.log(b);for(var f=0;f<a.length;++f){var c=a[f].toDallianceSource();A.currentlyActive(c)&&A.removeTier(c)}})},
!1)},!1);return d},$=null,Z=null;for(X in V)(function(a,b){var f=A.makeButton(a,"Browse the default set of data for this browser");f.addEventListener("click",function(a){a.preventDefault();a.stopPropagation();p(n,f);J(new v(b))},!1);n.push(f);$||($=f,Z=b)})(X,V[X]);var ja=this.makeButton("DAS","Add arbitrary DAS data");n.push(ja);var ka=this.makeButton("Binary","Add data in bigwig or bigbed format");n.push(ka);for(X=0;X<this.hubObjects.length;++X)S(this.hubObjects[X]);var ga=this.makeButton("+","Connect to a new track-hub");
n.push(ga);var fa=g("ul",n,{className:"nav nav-tabs"},{marginBottom:"0px"});e.appendChild(fa);var ca,na,la,ma,ha,pa,qa,T=!1,da=null,X=g("form",null,{},{display:"inline-block",width:"100%"});X.addEventListener("submit",function(a){a.stopPropagation();a.preventDefault();x();return!1},!0);var P=g("div");P.style.position="relative";P.style.overflow="scroll";X.appendChild(P);var oa,sa;J=function(a,b){ba.style.display="none";ia.style.display="none";Y.style.display="none";sa&&sa.removeListener(R);oa=b;sa=
a;sa.addListenerAndFire(R)};R=function(a){T=!1;var b=[];y(P);if(a){for(var f=g("tbody",null,{className:"table table-striped table-condensed"},{width:"100%"}),c=g("table",f,{className:"table table-striped table-condensed"},{width:"100%",tableLayout:"fixed"}),d=0,h=[],e=0;e<a.length;++e)h.push(a[e]);h.sort(function(a,b){return a.name.toLowerCase().trim().localeCompare(b.name.toLowerCase().trim())});for(e=0;e<h.length;++e){a=h[e];var k=g("tr"),n=g("td",null,{},{width:"30px"});n.style.textAlign="center";
if(!a.props||a.props.cors){var l=g("input");l.type="checkbox";l.dalliance_source=a;oa&&(l.dalliance_mapping=oa);n.appendChild(l);b.push(l);l.addEventListener("change",function(a){a.target.checked?A.addTier(a.target.dalliance_source):A.removeTier(a.target.dalliance_source)})}else n.appendChild(document.createTextNode("!")),A.makeTooltip(n,g("span",["This data source isn't accessible because it doesn't support ",g("a","CORS",{href:"http://www.w3.org/TR/cors/"}),"."]));k.appendChild(n);n=g("td");n.appendChild(document.createTextNode(a.name));
a.desc&&0<a.desc.length&&A.makeTooltip(n,a.desc);k.appendChild(n);f.appendChild(k);++d}var m=function(){for(var a=0;a<b.length;++a){var f=b[a];A.currentlyActive(f.dalliance_source)?f.checked=!0:f.checked=!1}};m();A.addTierListener(function(a){m()});P.appendChild(c)}else P.appendChild(g("p","Dalliance was unable to retrieve data source information from the DAS registry, please try again later"))};I&&I.addEventListener("click",function(a){a.preventDefault();a.stopPropagation();p(n,I);J(A.availableSources)},
!1);ka.addEventListener("click",function(a){a.preventDefault();a.stopPropagation();m()},!1);ga.addEventListener("click",function(a){a.preventDefault();a.stopPropagation();r()},!1);ja.addEventListener("click",function(a){a.preventDefault();a.stopPropagation();f()},!1);var ia=g("button","Add",{className:"btn btn-primary"});ia.addEventListener("click",function(a){a.stopPropagation();a.preventDefault();x()},!1);var ta=function(a,b){var f=A.knownSpace;if(f){var c=Math.max(f.min,(f.min+f.max-100)/2)|0,
f=new N(f.chr,c,Math.min(c+99,f.max));a.features(f,{},function(f,c){if(c)b?(y(P),P.appendChild(g("h2","Custom data not found")),P.appendChild(g("p","DAS uri: "+a.uri+" is not answering features requests")),T="reset"):(a.credentials=!0,ta(a,!0));else{var d=/\/([^/]+)\/?$/.exec(a.uri);d&&(a.name=d[1]);u(a)}})}else alert("Can't confirm track-addition to an uninit browser.")},ua=function(a){var b={name:a.name};a.credentials&&(b.credentials=a.credentials);a.mapping&&"__default__"!=a.mapping&&(b.mapping=
a.mapping);if("bwg"==a.tier_type)return a.blob?b.bwgBlob=a.blob:a.uri&&(b.bwgURI=a.uri),b;if("bam"==a.tier_type)return a.blob?(b.bamBlob=a.blob,b.baiBlob=a.indexBlob):(b.bamURI=a.uri,b.baiURI=a.indexUri),b;if("tabix"==a.tier_type)return b.tier_type="tabix",b.payload=a.payload,a.blob?(b.blob=a.blob,b.indexBlob=a.indexBlob):(b.uri=a.uri,b.indexUri=a.indexUri),b;if("memstore"==a.tier_type)return b.tier_type="memstore",b.payload=a.payload,a.blob?b.blob=a.blob:b.uri=a.uri,b},va=function(a){q(a,function(a,
b){if(b)y(P),P.appendChild(g("h2","Couldn't access custom data")),P.appendChild(g("p",""+b)),T="reset-bin";else{var f=ua(a);return"bam"==a.tier_type?s(f):"tabix"==a.tier_type?E(f):U(f,!1,!1,!0)}})},U=function(a,b,f,c){ba.style.display="none";ia.style.display="inline";Y.style.display="inline";y(P);P.appendChild(g("h2","Add custom data: step 2"));P.appendChild(document.createTextNode("Label: "));na=g("input","",{value:a.name});P.appendChild(na);pa=g("input","");qa=g("input","");P.appendChild(g("br"));
P.appendChild(g("br"));P.appendChild(g("h4","Coordinate system: "));la=g("select",null);la.appendChild(g("option",A.nameForCoordSystem(A.coordSystem),{value:"__default__"}));if(A.chains)for(var d in A.chains)la.appendChild(g("option",A.nameForCoordSystem(A.chains[d].coords),{value:d}));la.value=a.mapping||"__default__";P.appendChild(la);b?P.appendChild(g("p","(Based on server response, probably doesn't need changing.)")):(P.appendChild(g("p",[g("b","Warning: "),"unable to determine the correct value from server responses.  Please check carefully."])),
P.appendChild(g("p","If you don't see the mapping you're looking for, please contact thomas@biodalliance.org")));c||(P.appendChild(document.createTextNode("Quantitative: ")),ma=g("input",null,{type:"checkbox",checked:!0}),"undefined"!==typeof a.maxbins&&(ma.checked=a.maxbins),P.appendChild(ma),f?P.appendChild(g("p","(Based on server response, probably doesn't need changing.)")):P.appendChild(g("p",[g("b","Warning: "),"unable to determine correct value.  If in doubt, leave checked."])));a.bwgBlob&&
P.appendChild(g("p",[g("b","Warning: "),"data added from local file.  Due to the browser security model, the track will disappear if you reload Dalliance."]));na.focus();T="bin"===T||"prompt-bai"===T||"prompt-tbi"===T?"finalize-bin":"finalize";da=a},L=null,ra=function(a){q(a,function(a,b){b&&(a.error=b);for(var f=[],c={},d={},h=0;h<L.length;++h){var e=L[h];"bam"!=e.tier_type||e.indexBlob||(c[e.blob.name]=e);"tabix"!=e.tier_type||e.indexBlob||(d[e.blob.name]=e)}for(h=0;h<L.length;++h)if(e=L[h],"bai"===
e.tier_type){var g=/(.+)\.bai$/.exec(e.blob.name);g&&c[g[1]]&&(c[g[1]].indexBlob=e.blob,f.push(h))}else"tabix-index"===e.tier_type&&(g=/(.+)\.tbi$/.exec(e.blob.name))&&d[g[1]]&&(d[g[1]].indexBlob=e.blob,f.push(h));for(c=f.length-1;0<=c;--c)L.splice(f[c],1);ea()})},ea=function(){y(P);var a=!1,b=g("table",L.filter(function(a){return!a.hidden}).map(function(b){g("tr").appendChild(g("td",b.name||b.blob.name));var f;f=b.error?g("span","Error",null,{color:"red"}):b.tier_type?b.payload||b.tier_type:A.makeLoader(16);
var c,d="unknown";"bwg"==b.tier_type||"memstore"==b.tier_type?d="okay":"bam"==b.tier_type?d=b.indexBlob?"okay":"needs-index":"tabix"==b.tier_type&&(d=b.indexBlob?"okay":"needs-index");if("okay"==d){c=g("select",null,null,{width:"150px"});c.appendChild(g("option",A.nameForCoordSystem(A.coordSystem),{value:"__default__"}));if(A.chains)for(var h in A.chains)c.appendChild(g("option",A.nameForCoordSystem(A.chains[h].coords),{value:h}));c.value=b.mapping||"__default__";c.addEventListener("change",function(a){b.mapping=
c.value;console.log(b)},!1)}else"needs-index"==d&&(c=g("span","Needs index",{},{color:"red"}),a=!0);return g("tr",[g("td",b.name||b.blob.name),g("td",f),g("td",c)])}),{className:"table table-striped table-condensed"});P.appendChild(b);if(a){P.appendChild(g("p","Some of these files are missing required index (.bai or .tbi) files.  For security reasons, web applications like Dalliance can only access local files which you have explicity selected.  Please use the file chooser below to select the appropriate index file"));
P.appendChild(document.createTextNode("Index file(s): "));var f=g("input",null,{type:"file",multiple:"multiple"});P.appendChild(f);f.addEventListener("change",function(a){console.log("fileset changed");a=f.files||[];for(var b=0;b<a.length;++b){var c=a[b];c&&(c={blob:c,hidden:!0},L.push(c),ra(c))}},!1)}},Y=g("button","Cancel",{className:"btn"});Y.addEventListener("click",function(a){a.stopPropagation();a.preventDefault();"finalize-bin"===T?m():f()},!1);var ba=g("button","Refresh",{className:"btn"});
ba.addEventListener("click",function(a){a.stopPropagation();a.preventDefault();A.queryRegistry(oa)},!1);this.makeTooltip(ba,"Click to re-fetch data from the DAS registry");V=g("div",[ia," ",Y," ",ba]);V.style.margin="10px";X.appendChild(V);e.appendChild(X);J(A.availableSources);this.showToolPanel(e);this.setUiMode("add");$&&(p(n,$),J(new v(Z)))}}},{"./bam":1,"./bin":4,"./cbrowser":6,"./das":10,"./domui":11,"./lh3utils":23,"./probe":27,"./tabix":39,"./thub":40,"./utils":47}],45:[function(e,u,r){function p(e,
g,p){g.fetchAsText(function(g){if(!g)return p(null,"Couldn't fetch index-index");g=g.split(/(.+)([0-9A-F]{10})\n/);for(var r=[],b=[],a=1;a<g.length;a+=3)r.push(g[a]),b.push(parseInt(g[a+1],16));return p(new l(r,b,e))})}function l(e,g,l){this.keys=e;this.offsets=g;this.ix=l}l.prototype.lookup=function(e,g){for(var l,p=(e+"     ").substring(0,5).toLowerCase(),r=0;r<this.keys.length;++r)if(0>p.localeCompare(this.keys[r])){l=this.ix.slice(this.offsets[r-1],this.offsets[r]-this.offsets[r-1]);break}l||
(l=this.ix.slice(this.offsets[this.offsets.length-1]));l.fetchAsText(function(b){b=b.split("\n");for(var a=0;a<b.length;++a)if(0==b[a].indexOf(e.toLowerCase()+" "))return g(b[a].split(" "));return g(null)})};"undefined"!==typeof u&&(u.exports={connectTrix:p})},{}],46:[function(e,u,r){function p(){}function l(b,d){var c=new p;c.data=b;c.data.slice(0,12500).fetch(function(b){if(!b)return d(null,"Couldn't access data");var h=new Uint8Array(b);b=g(h,0);if(b==a)c.readInt=g;else if(b==q)c.readInt=y;else return d(null,
"Not a .2bit file, magic=0x"+b.toString(16));b=c.readInt(h,4);if(0!=b)return d(null,"Unsupported version "+b);c.seqCount=c.readInt(h,8);c.seqDict={};var e=16,l=0,p=0,r=function(){for(;l<c.seqCount;){var a=h[e];if(e+a+6>=h.length)return c.data.slice(p+e,12500).fetch(function(a){p+=e;e=0;h=new Uint8Array(a);r()});++e;for(var b="",g=1;g<=a;++g)b+=String.fromCharCode(h[e++]);a=c.readInt(h,e);e+=4;c.seqDict[b]=new m(c,a);++l}return d(c)};r()})}function m(a,b){this.tbf=a;this.offset=b}if("undefined"!==
typeof e){r=e("./bin");var g=r.readInt,y=r.readIntBE;e=e("./spans");var v=e.Range,z=e.union,b=e.intersection}var a=440477507,q=1126646042;p.prototype.getSeq=function(a){var b=this.seqDict[a];b||(b=this.seqDict["chr"+a]);return b};p.prototype.fetch=function(a,b,c,d){var e=this.getSeq(a);if(e){if(c<=b)return d("");e.fetch(b,c,d)}else return d(null,"Couldn't find "+a)};m.prototype.init=function(a){if(this.seqOffset)return a();var b=this;b.tbf.data.slice(b.offset,8).fetch(function(c){if(!c)return a("Fetch failed");
c=new Uint8Array(c);b._length=b.tbf.readInt(c,0);b.nBlockCnt=b.tbf.readInt(c,4);b.tbf.data.slice(b.offset+8,8*b.nBlockCnt+4).fetch(function(c){if(!c)return a("Fetch failed");c=new Uint8Array(c);for(var d=null,e=0;e<b.nBlockCnt;++e)var g=b.tbf.readInt(c,4*e),l=b.tbf.readInt(c,4*(e+b.nBlockCnt)),g=new v(g,g+l-1),d=d?z(d,g):g;b.nBlocks=d;b.mBlockCnt=b.tbf.readInt(c,8*b.nBlockCnt);b.seqLength=(b._length+3)/4|0;b.seqOffset=b.offset+16+8*(b.nBlockCnt+b.mBlockCnt);return a()})})};var d=["T","C","A","G"];
m.prototype.fetch=function(a,e,c){--a;--e;var g=this;this.init(function(l){if(l)return c(null,l);var m=a>>2;l=e+3>>2;if(0>m||l>g.seqLength)return c("Coordinates out of bounds: "+a+":"+e);g.tbf.data.slice(g.seqOffset+m,l-m).salted().fetch(function(l){function p(a){for(;y<=a;){var b=y&3,c=q[(y>>2)-m];u+=d[0==b?c>>6&3:1==b?c>>4&3:2==b?c>>2&3:c&3];++y}}if(null==l)return c("SeqFetch failed");var q=new Uint8Array(l);l=[];if(g.nBlocks){var r=b(new v(a,e),g.nBlocks);r&&(l=r.ranges())}for(var u="",y=a,r=0;r<
l.length;++r){var z=l[r];if(y>z.min())throw"N mismatch...";for(y<z.min()&&p(z.min()-1);y<=z.max();)u+="N",++y}y<=e&&p(e);return c(u)})})};m.prototype.length=function(a){var b=this;this.init(function(c){return c?a(null,c):a(b._length)})};"undefined"!==typeof u&&(u.exports={makeTwoBit:l})},{"./bin":4,"./spans":34}],47:[function(e,u,r){function p(a,b){for(var c=0;c<a.length;++c)if(a[c]==b)return;a.push(b)}function l(a,b,c){a[b]?a[b].push(c):a[b]=[c]}function m(a,b,c){var d=a[b];if(d){for(a=0;a<d.length;++a)if(d[a]==
c)return;d.push(c)}else a[b]=[c]}function g(a,b,c,d){if(a)return a;if(b)return b;if(c)return c;if(d)return d}function p(a,b){for(var c=0;c<a.length;++c)if(a[c]==b)return;a.push(b)}function y(a,b){if(!a)return-1;for(var c=0;c<a.length;++c)if(a[c]===b)return c;return-1}function v(a,b,c,d){a=document.createElement(a);if(b){b instanceof Array||(b=[b]);for(var h=0;h<b.length;++h){var e=b[h];e&&("string"==typeof e?e=document.createTextNode(e):"number"==typeof e&&(e=document.createTextNode(""+e)),a.appendChild(e))}}if(c)for(var f in c)try{a[f]=
c[f]}catch(g){throw console.log("error setting "+f),g;}if(d)for(f in d)a.style[f]=d[f];return a}function z(a,b,c,d){a=document.createElementNS(a,b);if(c)for(c instanceof Array||(c=[c]),b=0;b<c.length;++b){var e=c[b];"string"==typeof e&&(e=document.createTextNode(e));a.appendChild(e)}if(d)for(var h in d){c=a;b=h;var e=d[h],f=Q[b];if(!f){for(var f="",g=0;g<b.length;++g)var k=b.substring(g,g+1),l=k.toLowerCase(),f=l!=k?f+"-"+l:f+k;Q[b]=f}c.setAttribute(f,e)}return a}function b(a){if(a&&a.childNodes)for(;0<
a.childNodes.length;)a.removeChild(a.firstChild)}function a(b,c){if("undefined"===typeof b)return"undefined";if(null==b)return"null";if("string"==typeof b)return"'"+b+"'";if("number"==typeof b||"boolean"==typeof b)return""+b;if("object"==typeof b){if(b instanceof Array){for(var d=null,e=0;e<b.length;++e)d=(null==d?"":d+", ")+a(b[e],c);return"["+(d?d:"")+"]"}c=c||{};d=null;for(e in b)c[e]||void 0!=e&&"function"!=typeof b[e]&&(d=(null==d?"":d+", ")+e+": "+a(b[e],c));return"{"+(d?d:"")+"}"}return typeof b}
function q(a){var b={},c;for(c in a)b[c]=a[c];return b}function d(a){this.value=a;this.listeners=[]}function h(){this.queue=[]}function k(a,b,c){c.salt&&(a=a+"?salt="+B(""+Date.now()+","+ ++N));var d=new XMLHttpRequest;d.onreadystatechange=function(){4==d.readyState&&(300<=d.status?b(null,"Error code "+d.status):b(d.responseText))};d.open("GET",a,!0);d.responseType="text";c&&c.credentials&&(d.withCredentials=!0);d.send("")}function c(a,b){if(0==b.indexOf("http:")||0==b.indexOf("https:"))return b;
var c=a.lastIndexOf("/");return 0<=c?a.substr(0,c+1)+b:b}function t(a){return v("a",null,{href:a}).href}if("undefined"!==typeof e)var B=e("./sha1").b64_sha1;var Q={};d.prototype.addListener=function(a){this.listeners.push(a)};d.prototype.addListenerAndFire=function(a){this.listeners.push(a);a(this.value)};d.prototype.removeListener=function(a){var b=this.listeners;a=y(b,a);0<=a&&b.splice(a,1)};d.prototype.get=function(){return this.value};d.prototype.set=function(a){this.value=a;for(var b=0;b<this.listeners.length;++b)this.listeners[b](a)};
h.prototype.provide=function(a){if(void 0!==this.res)throw"Resource has already been provided.";this.res=a;for(var b=0;b<this.queue.length;++b)this.queue[b](a);this.queue=null};h.prototype.await=function(a){if(void 0!==this.res)return a(this.res),this.res;this.queue.push(a)};var N=0;e={TTT:"F",TTC:"F",TTA:"L",TTG:"L",CTT:"L",CTC:"L",CTA:"L",CTG:"L",ATT:"I",ATC:"I",ATA:"I",ATG:"M",GTT:"V",GTC:"V",GTA:"V",GTG:"V",TCT:"S",TCC:"S",TCA:"S",TCG:"S",CCT:"P",CCC:"P",CCA:"P",CCG:"P",ACT:"T",ACC:"T",ACA:"T",
ACG:"T",GCT:"A",GCC:"A",GCA:"A",GCG:"A",TAT:"Y",TAC:"Y",TAA:"*",TAG:"*",CAT:"H",CAC:"H",CAA:"Q",CAG:"Q",AAT:"N",AAC:"N",AAA:"K",AAG:"K",GAT:"D",GAC:"D",GAA:"E",GAG:"E",TGT:"C",TGC:"C",TGA:"*",TGG:"W",CGT:"R",CGC:"R",CGA:"R",CGG:"R",AGT:"S",AGC:"S",AGA:"R",AGG:"R",GGT:"G",GGC:"G",GGA:"G",GGG:"G"};"trim"in String.prototype||(String.prototype.trim=function(){return this.replace(/^\s+/,"").replace(/\s+$/,"")});"undefined"!==typeof u&&(u.exports={textXHR:k,relativeURL:c,resolveUrlToPage:t,shallowCopy:q,
pusho:l,pushnew:p,pushnewo:m,arrayIndexOf:y,pick:g,makeElement:v,makeElementNS:z,removeChildren:b,miniJSONify:a,Observed:d,Awaited:h,AMINO_ACID_TRANSLATION:e})},{"./sha1":32}],48:[function(e,u,r){function p(){this.info=[]}function l(a,b){this.parser=a;this.sink=b}if("undefined"!==typeof e){var m=e("./sourceadapters").registerParserFactory;e=e("./das");var g=e.DASStylesheet,y=e.DASStyle,v=e.DASFeature}var z=/([^;=]+)(=([^;]+))?;?/,b=/##INFO=<([^>]+)>/,a=/([^,=]+)=([^,]+|"[^"]+"),?/;p.prototype.createSession=
function(a){return new l(this,a)};l.prototype.parse=function(e){if(0!=e.length)if("#"==e[0]){if(1<e.length&&"#"==e[1]&&(e=b.exec(e))){var d=e[1].split(a),h=null,g=null;for(e=0;e<d.length-1;e+=3){var c=d[e+1],l=d[e+2].replace(/"/g,"");"ID"==c?h=l:"Description"==c&&(g=l)}h&&g&&this.parser.info.push({id:h,desc:g})}}else{d=e.split("\t");h=new v;h.segment=d[0];h.id=d[2];h.refAllele=d[3];h.altAlleles=d[4].split(",");h.min=parseInt(d[1]);h.max=h.min+h.refAllele.length-1;d=d[7].split(z);h.info={};for(e=0;e<
d.length;e+=4)h.info[d[e+1]]=d[e+3];e=h.altAlleles[0];d=h.refAllele;e.length>d.length?(h.type="insertion",0==e.indexOf(d)?(h.insertion=e.substr(d.length),h.min+=d.length,h.max=h.min-1):h.insertion=e):h.type=e.length<d.length?"deletion":"substitution";this.sink(h)}};l.prototype.flush=function(){};p.prototype.getStyleSheet=function(a){var b=new g,e=new y;e.glyph="__INSERTION";e.BUMP="yes";e.LABEL="no";e.FGCOLOR="rgb(50,80,255)";e.BGCOLOR="#888888";e.STROKECOLOR="black";b.pushStyle({type:"insertion"},
null,e);e=new y;e.glyph="PLIMSOLL";e.BUMP="yes";e.LABEL="no";e.FGCOLOR="rgb(255, 60, 60)";e.BGCOLOR="#888888";e.STROKECOLOR="black";b.pushStyle({type:"deletion"},null,e);e=new y;e.glyph="PLIMSOLL";e.BUMP="yes";e.LABEL="no";e.FGCOLOR="rgb(50,80,255)";e.BGCOLOR="#888888";e.STROKECOLOR="black";b.pushStyle({type:"default"},null,e);return a(b)};p.prototype.getDefaultFIPs=function(a){var b=this;a(function(a,e){e.add("Ref. allele",a.refAllele);e.add("Alt. alleles",a.altAlleles.join(","));if(a.info)for(var c=
0;c<b.info.length;++c){var g=b.info[c],l=a.info[g.id];void 0!==l&&e.add(g.desc,l)}})};m("vcf",function(){return new p})},{"./das":10,"./sourceadapters":33}],49:[function(e,u,r){e={CONFIG:5,MAJOR:0,MINOR:12,MICRO:9,PATCH:"",BRANCH:"dev",toString:function(){var e=""+this.MAJOR+"."+this.MINOR+"."+this.MICRO;this.PATCH&&(e+=this.PATCH);this.BRANCH&&""!=this.BRANCH&&(e=e+"-"+this.BRANCH);return e}};"undefined"!==typeof u&&(u.exports=e)},{}],50:[function(e,u,r){function p(){function e(b){b=Math.min(b,q);
k=b=Math.max(b,a);r.style.left=""+k+"px"}function g(b){b=Math.min(b,q);c=b=Math.max(b,a);u.style.left=""+c+"px"}var p=l("hr",null,{className:"slider-track"}),r=l("hr",null,{className:"slider-thumb active"}),u=l("hr",null,{className:"slider-thumb"}),b=l("div",[p,r,u],{className:"slider"}),a=0,q=200,d=0,h=200,k=50,c=100,t=[];b.removeLabels=function(){for(var a=0;a<t.length;++a)b.removeChild(t[a]);t=[]};b.addLabel=function(c,e){var g=l("div",e,{className:"slider-label"},{left:""+(a+(c-d)*(q-a)/(h-d)|
0)+"px"});b.appendChild(g);t.push(g)};var B=document.createEvent("HTMLEvents");B.initEvent("change",!0,!1);Object.defineProperty(b,"value",{get:function(){return d+(k-a)*(h-d)/(q-a)},set:function(b){e(a+(b-d)*(q-a)/(h-d))}});Object.defineProperty(b,"value2",{get:function(){return d+(c-a)*(h-d)/(q-a)},set:function(b){g(a+(b-d)*(q-a)/(h-d))}});Object.defineProperty(b,"active",{get:function(){return r.classList.contains("active")?1:2},set:function(a){1==a?(r.classList.add("active"),u.classList.remove("active")):
(u.classList.add("active"),r.classList.remove("active"))}});Object.defineProperty(b,"min",{get:function(){return d},set:function(a){d=a}});Object.defineProperty(b,"max",{get:function(){return h},set:function(a){h=a}});var Q,N,p=function(a){N=this==r?1:2;N!=b.active&&(b.active=N,b.dispatchEvent(B));a.stopPropagation();a.preventDefault();window.addEventListener("mousemove",O,!1);window.addEventListener("mouseup",C,!1);Q=a.clientX-(1==N?k:c)};r.addEventListener("mousedown",p,!1);u.addEventListener("mousedown",
p,!1);var O=function(a){1==N?e(a.clientX-Q):g(a.clientX-Q);b.dispatchEvent(B)},C=function(a){window.removeEventListener("mousemove",O,!1);window.removeEventListener("mouseup",C,!1)};return b}if("undefined"!==typeof e)var l=e("./utils").makeElement;"undefined"!==typeof u&&(u.exports=p)},{"./utils":47}],51:[function(e,u,r){u=e("./promise/promise").Promise;e=e("./promise/polyfill").polyfill;r.Promise=u;r.polyfill=e},{"./promise/polyfill":56,"./promise/promise":57}],52:[function(e,u,r){var p=e("./utils").isArray,
l=e("./utils").isFunction;r.all=function(e){if(!p(e))throw new TypeError("You must pass an array to all.");return new this(function(g,p){function r(a){return function(e){u[a]=e;0===--b&&g(u)}}var u=[],b=e.length,a;0===b&&g([]);for(var q=0;q<e.length;q++)(a=e[q])&&l(a.then)?a.then(r(q),p):(u[q]=a,0===--b&&g(u))})}},{"./utils":61}],53:[function(e,u,r){(function(e,l){function m(){return function(){e.nextTick(v)}}function g(){var a=0,d=new b(v),c=document.createTextNode("");d.observe(c,{characterData:!0});
return function(){c.data=a=++a%2}}function u(){return function(){a.setTimeout(v,1)}}function v(){for(var a=0;a<q.length;a++){var b=q[a];(0,b[0])(b[1])}q=[]}var z="undefined"!==typeof window?window:{},b=z.MutationObserver||z.WebKitMutationObserver,a="undefined"!==typeof l?l:void 0===this?window:this,q=[],d;d="undefined"!==typeof e&&"[object process]"==={}.toString.call(e)?m():b?g():u();r.asap=function(a,b){1===q.push([a,b])&&d()}}).call(this,e("1YiZ5S"),"undefined"!==typeof self?self:"undefined"!==
typeof window?window:{})},{"1YiZ5S":62}],54:[function(e,u,r){r.cast=function(e){return e&&"object"===typeof e&&e.constructor===this?e:new this(function(l){l(e)})}},{}],55:[function(e,u,r){var p={instrument:!1};r.config=p;r.configure=function(e,m){if(2===arguments.length)p[e]=m;else return p[e]}},{}],56:[function(e,u,r){(function(p){var l=e("./promise").Promise,m=e("./utils").isFunction;r.polyfill=function(){var e;e="undefined"!==typeof p?p:"undefined"!==typeof window&&window.document?window:self;
"Promise"in e&&"cast"in e.Promise&&"resolve"in e.Promise&&"reject"in e.Promise&&"all"in e.Promise&&"race"in e.Promise&&function(){var l;new e.Promise(function(e){l=e});return m(l)}()||(e.Promise=l)}}).call(this,"undefined"!==typeof self?self:"undefined"!==typeof window?window:{})},{"./promise":57,"./utils":61}],57:[function(e,u,r){function p(a){if(!c(a))throw new TypeError("You must pass a resolver function as the first argument to the promise constructor");if(!(this instanceof p))throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.");
this._subscribers=[];l(a,this)}function l(b,c){function f(a){z(c,a)}function d(b){a(c,b)}try{b(f,d)}catch(e){d(e)}}function m(b,d,f,e){var h=c(f),g,k,l,m;if(h)try{g=f(e),l=!0}catch(p){m=!0,k=p}else g=e,l=!0;v(d,g)||(h&&l?z(d,g):m?a(d,k):b===w?z(d,g):b===G&&a(d,g))}function g(a,b,f,c){a=a._subscribers;var d=a.length;a[d]=b;a[d+w]=f;a[d+G]=c}function y(a,b){for(var f,c,d=a._subscribers,e=a._detail,h=0;h<d.length;h+=3)f=d[h],c=d[h+b],m(b,f,c,e);a._subscribers=null}function v(d,e){var f=null,h;try{if(d===
e)throw new TypeError("A promises callback cannot return that same promise.");if(k(e)&&(f=e.then,c(f)))return f.call(e,function(a){if(h)return!0;h=!0;e!==a?z(d,a):b(d,a)},function(b){if(h)return!0;h=!0;a(d,b)}),!0}catch(g){if(h)return!0;a(d,g);return!0}return!1}function z(a,c){a===c?b(a,c):v(a,c)||b(a,c)}function b(a,b){a._state===O&&(a._state=C,a._detail=b,h.async(q,a))}function a(a,b){a._state===O&&(a._state=C,a._detail=b,h.async(d,a))}function q(a){y(a,a._state=w)}function d(a){y(a,a._state=G)}
var h=e("./config").config;e("./config");var k=e("./utils").objectOrFunction,c=e("./utils").isFunction;e("./utils");u=e("./cast").cast;var t=e("./all").all,B=e("./race").race,Q=e("./resolve").resolve,N=e("./reject").reject;e=e("./asap").asap;h.async=e;var O=void 0,C=0,w=1,G=2;p.prototype={constructor:p,_state:void 0,_detail:void 0,_subscribers:void 0,then:function(a,b){var f=this,c=new this.constructor(function(){});if(this._state){var d=arguments;h.async(function(){m(f._state,c,d[f._state-1],f._detail)})}else g(this,
c,a,b);return c},"catch":function(a){return this.then(null,a)}};p.all=t;p.cast=u;p.race=B;p.resolve=Q;p.reject=N;r.Promise=p},{"./all":52,"./asap":53,"./cast":54,"./config":55,"./race":58,"./reject":59,"./resolve":60,"./utils":61}],58:[function(e,u,r){var p=e("./utils").isArray;r.race=function(e){if(!p(e))throw new TypeError("You must pass an array to race.");return new this(function(m,g){for(var p,r=0;r<e.length;r++)(p=e[r])&&"function"===typeof p.then?p.then(m,g):m(p)})}},{"./utils":61}],59:[function(e,
u,r){r.reject=function(e){return new this(function(l,m){m(e)})}},{}],60:[function(e,u,r){r.resolve=function(e){return new this(function(l,m){l(e)})}},{}],61:[function(e,u,r){function p(e){return"function"===typeof e}e=Date.now||function(){return(new Date).getTime()};r.objectOrFunction=function(e){return p(e)||"object"===typeof e&&null!==e};r.isFunction=p;r.isArray=function(e){return"[object Array]"===Object.prototype.toString.call(e)};r.now=e},{}],62:[function(e,u,r){function p(){}e=u.exports={};
e.nextTick=function(){if("undefined"!==typeof window&&window.setImmediate)return function(e){return window.setImmediate(e)};if("undefined"!==typeof window&&window.postMessage&&window.addEventListener){var e=[];window.addEventListener("message",function(m){var g=m.source;g!==window&&null!==g||"process-tick"!==m.data||(m.stopPropagation(),0<e.length&&e.shift()())},!0);return function(m){e.push(m);window.postMessage("process-tick","*")}}return function(e){setTimeout(e,0)}}();e.title="browser";e.browser=
!0;e.env={};e.argv=[];e.on=p;e.addListener=p;e.once=p;e.off=p;e.removeListener=p;e.removeAllListeners=p;e.emit=p;e.binding=function(e){throw Error("process.binding is not supported");};e.cwd=function(){return"/"};e.chdir=function(e){throw Error("process.chdir is not supported");}},{}],63:[function(e,u,r){function p(){}function l(){this.was=[0]}function m(b,c,d){this.hufts=new Int32Array(3*a);this.window=new Uint8Array(d);this.end=d;this.checkfn=c;this.mode=t;this.reset(b,null);this.index=this.table=
this.left=0;this.blens=null;this.bb=new Int32Array(1);this.tb=new Int32Array(1);this.codes=new g;this.check=this.write=this.read=this.bitb=this.bitk=this.last=0;this.inftree=new y}function g(){}function y(){}function v(a,b,c,d,e){if(0!=e){if(!a)throw"Undef src";if(!c)throw"Undef dest";if(0==b&&e==a.length)c.set(a,d);else if(H)a=a.subarray(b,b+e),c.set(a,d);else if(1==a.BYTES_PER_ELEMENT&&100<e)a=new Uint8Array(a.buffer,a.byteOffset+b,e),c.set(a,d);else for(var h=0;h<e;++h)c[d+h]=a[b+h]}}function z(a,
c,e,g){a=c?e?new Uint8Array(a,c,e):new Uint8Array(a,c,a.byteLength-c):new Uint8Array(a);e=new p;e.inflateInit(b,!0);e.next_in=a;e.next_in_index=0;e.avail_in=a.length;a=[];for(var l=0;;){var m=new Uint8Array(32E3);e.next_out=m;e.next_out_index=0;e.avail_out=m.length;var r=e.inflate(q);if(r!=d&&r!=h&&r!=k)throw e.msg;if(0!=e.avail_out){var A=new Uint8Array(m.length-e.avail_out);v(m,0,A,0,m.length-e.avail_out);m=A}a.push(m);l+=m.length;if(r==h||r==k)break}g&&(g[0]=(c||0)+e.next_in_index);if(1==a.length)return a[0].buffer;
c=new Uint8Array(l);for(e=g=0;e<a.length;++e)l=a[e],v(l,0,c,g,l.length),g+=l.length;return c.buffer}var b=15,a=1440,q=0,d=0,h=1,k=-5,c=[0,1,3,7,15,31,63,127,255,511,1023,2047,4095,8191,16383,32767,65535],t=0,B=[96,7,256,0,8,80,0,8,16,84,8,115,82,7,31,0,8,112,0,8,48,0,9,192,80,7,10,0,8,96,0,8,32,0,9,160,0,8,0,0,8,128,0,8,64,0,9,224,80,7,6,0,8,88,0,8,24,0,9,144,83,7,59,0,8,120,0,8,56,0,9,208,81,7,17,0,8,104,0,8,40,0,9,176,0,8,8,0,8,136,0,8,72,0,9,240,80,7,4,0,8,84,0,8,20,85,8,227,83,7,43,0,8,116,0,
8,52,0,9,200,81,7,13,0,8,100,0,8,36,0,9,168,0,8,4,0,8,132,0,8,68,0,9,232,80,7,8,0,8,92,0,8,28,0,9,152,84,7,83,0,8,124,0,8,60,0,9,216,82,7,23,0,8,108,0,8,44,0,9,184,0,8,12,0,8,140,0,8,76,0,9,248,80,7,3,0,8,82,0,8,18,85,8,163,83,7,35,0,8,114,0,8,50,0,9,196,81,7,11,0,8,98,0,8,34,0,9,164,0,8,2,0,8,130,0,8,66,0,9,228,80,7,7,0,8,90,0,8,26,0,9,148,84,7,67,0,8,122,0,8,58,0,9,212,82,7,19,0,8,106,0,8,42,0,9,180,0,8,10,0,8,138,0,8,74,0,9,244,80,7,5,0,8,86,0,8,22,192,8,0,83,7,51,0,8,118,0,8,54,0,9,204,81,7,15,
0,8,102,0,8,38,0,9,172,0,8,6,0,8,134,0,8,70,0,9,236,80,7,9,0,8,94,0,8,30,0,9,156,84,7,99,0,8,126,0,8,62,0,9,220,82,7,27,0,8,110,0,8,46,0,9,188,0,8,14,0,8,142,0,8,78,0,9,252,96,7,256,0,8,81,0,8,17,85,8,131,82,7,31,0,8,113,0,8,49,0,9,194,80,7,10,0,8,97,0,8,33,0,9,162,0,8,1,0,8,129,0,8,65,0,9,226,80,7,6,0,8,89,0,8,25,0,9,146,83,7,59,0,8,121,0,8,57,0,9,210,81,7,17,0,8,105,0,8,41,0,9,178,0,8,9,0,8,137,0,8,73,0,9,242,80,7,4,0,8,85,0,8,21,80,8,258,83,7,43,0,8,117,0,8,53,0,9,202,81,7,13,0,8,101,0,8,37,0,
9,170,0,8,5,0,8,133,0,8,69,0,9,234,80,7,8,0,8,93,0,8,29,0,9,154,84,7,83,0,8,125,0,8,61,0,9,218,82,7,23,0,8,109,0,8,45,0,9,186,0,8,13,0,8,141,0,8,77,0,9,250,80,7,3,0,8,83,0,8,19,85,8,195,83,7,35,0,8,115,0,8,51,0,9,198,81,7,11,0,8,99,0,8,35,0,9,166,0,8,3,0,8,131,0,8,67,0,9,230,80,7,7,0,8,91,0,8,27,0,9,150,84,7,67,0,8,123,0,8,59,0,9,214,82,7,19,0,8,107,0,8,43,0,9,182,0,8,11,0,8,139,0,8,75,0,9,246,80,7,5,0,8,87,0,8,23,192,8,0,83,7,51,0,8,119,0,8,55,0,9,206,81,7,15,0,8,103,0,8,39,0,9,174,0,8,7,0,8,135,
0,8,71,0,9,238,80,7,9,0,8,95,0,8,31,0,9,158,84,7,99,0,8,127,0,8,63,0,9,222,82,7,27,0,8,111,0,8,47,0,9,190,0,8,15,0,8,143,0,8,79,0,9,254,96,7,256,0,8,80,0,8,16,84,8,115,82,7,31,0,8,112,0,8,48,0,9,193,80,7,10,0,8,96,0,8,32,0,9,161,0,8,0,0,8,128,0,8,64,0,9,225,80,7,6,0,8,88,0,8,24,0,9,145,83,7,59,0,8,120,0,8,56,0,9,209,81,7,17,0,8,104,0,8,40,0,9,177,0,8,8,0,8,136,0,8,72,0,9,241,80,7,4,0,8,84,0,8,20,85,8,227,83,7,43,0,8,116,0,8,52,0,9,201,81,7,13,0,8,100,0,8,36,0,9,169,0,8,4,0,8,132,0,8,68,0,9,233,80,
7,8,0,8,92,0,8,28,0,9,153,84,7,83,0,8,124,0,8,60,0,9,217,82,7,23,0,8,108,0,8,44,0,9,185,0,8,12,0,8,140,0,8,76,0,9,249,80,7,3,0,8,82,0,8,18,85,8,163,83,7,35,0,8,114,0,8,50,0,9,197,81,7,11,0,8,98,0,8,34,0,9,165,0,8,2,0,8,130,0,8,66,0,9,229,80,7,7,0,8,90,0,8,26,0,9,149,84,7,67,0,8,122,0,8,58,0,9,213,82,7,19,0,8,106,0,8,42,0,9,181,0,8,10,0,8,138,0,8,74,0,9,245,80,7,5,0,8,86,0,8,22,192,8,0,83,7,51,0,8,118,0,8,54,0,9,205,81,7,15,0,8,102,0,8,38,0,9,173,0,8,6,0,8,134,0,8,70,0,9,237,80,7,9,0,8,94,0,8,30,0,
9,157,84,7,99,0,8,126,0,8,62,0,9,221,82,7,27,0,8,110,0,8,46,0,9,189,0,8,14,0,8,142,0,8,78,0,9,253,96,7,256,0,8,81,0,8,17,85,8,131,82,7,31,0,8,113,0,8,49,0,9,195,80,7,10,0,8,97,0,8,33,0,9,163,0,8,1,0,8,129,0,8,65,0,9,227,80,7,6,0,8,89,0,8,25,0,9,147,83,7,59,0,8,121,0,8,57,0,9,211,81,7,17,0,8,105,0,8,41,0,9,179,0,8,9,0,8,137,0,8,73,0,9,243,80,7,4,0,8,85,0,8,21,80,8,258,83,7,43,0,8,117,0,8,53,0,9,203,81,7,13,0,8,101,0,8,37,0,9,171,0,8,5,0,8,133,0,8,69,0,9,235,80,7,8,0,8,93,0,8,29,0,9,155,84,7,83,0,8,
125,0,8,61,0,9,219,82,7,23,0,8,109,0,8,45,0,9,187,0,8,13,0,8,141,0,8,77,0,9,251,80,7,3,0,8,83,0,8,19,85,8,195,83,7,35,0,8,115,0,8,51,0,9,199,81,7,11,0,8,99,0,8,35,0,9,167,0,8,3,0,8,131,0,8,67,0,9,231,80,7,7,0,8,91,0,8,27,0,9,151,84,7,67,0,8,123,0,8,59,0,9,215,82,7,19,0,8,107,0,8,43,0,9,183,0,8,11,0,8,139,0,8,75,0,9,247,80,7,5,0,8,87,0,8,23,192,8,0,83,7,51,0,8,119,0,8,55,0,9,207,81,7,15,0,8,103,0,8,39,0,9,175,0,8,7,0,8,135,0,8,71,0,9,239,80,7,9,0,8,95,0,8,31,0,9,159,84,7,99,0,8,127,0,8,63,0,9,223,
82,7,27,0,8,111,0,8,47,0,9,191,0,8,15,0,8,143,0,8,79,0,9,255],Q=[80,5,1,87,5,257,83,5,17,91,5,4097,81,5,5,89,5,1025,85,5,65,93,5,16385,80,5,3,88,5,513,84,5,33,92,5,8193,82,5,9,90,5,2049,86,5,129,192,5,24577,80,5,2,87,5,385,83,5,25,91,5,6145,81,5,7,89,5,1537,85,5,97,93,5,24577,80,5,4,88,5,769,84,5,49,92,5,12289,82,5,13,90,5,3073,86,5,193,192,5,24577],N=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],O=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,
5,5,0,112,112],C=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577],w=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13];p.prototype.inflateInit=function(a,c){a||(a=b);c&&(c=!1);this.istate=new l;return this.istate.inflateInit(this,c?-a:a)};p.prototype.inflate=function(a){return null==this.istate?-2:this.istate.inflate(this,a)};p.prototype.inflateEnd=function(){if(null==this.istate)return-2;var a=istate.inflateEnd(this);
this.istate=null;return a};p.prototype.inflateSync=function(){return istate.inflateSync(this)};p.prototype.inflateSetDictionary=function(a,b){return istate.inflateSetDictionary(this,a,b)};l.prototype.inflateReset=function(a){if(null==a||null==a.istate)return-2;a.total_in=a.total_out=0;a.msg=null;a.istate.mode=0!=a.istate.nowrap?7:0;a.istate.blocks.reset(a,null);return d};l.prototype.inflateEnd=function(a){null!=this.blocks&&this.blocks.free(a);this.blocks=null;return d};l.prototype.inflateInit=function(a,
b){this.blocks=a.msg=null;nowrap=0;0>b&&(b=-b,nowrap=1);if(8>b||15<b)return this.inflateEnd(a),-2;this.wbits=b;a.istate.blocks=new m(a,0!=a.istate.nowrap?null:this,1<<b);this.inflateReset(a);return d};l.prototype.inflate=function(a,b){var c,e;if(null==a||null==a.istate||null==a.next_in)return-2;b=4==b?k:d;for(c=k;;)switch(a.istate.mode){case 0:if(0==a.avail_in)return c;c=b;a.avail_in--;a.total_in++;if(8!=((a.istate.method=a.next_in[a.next_in_index++])&15)){a.istate.mode=13;a.msg="unknown compression method";
a.istate.marker=5;break}if((a.istate.method>>4)+8>a.istate.wbits){a.istate.mode=13;a.msg="invalid window size";a.istate.marker=5;break}a.istate.mode=1;case 1:if(0==a.avail_in)return c;c=b;a.avail_in--;a.total_in++;e=a.next_in[a.next_in_index++]&255;if(0!=((a.istate.method<<8)+e)%31){a.istate.mode=13;a.msg="incorrect header check";a.istate.marker=5;break}if(0==(e&32)){a.istate.mode=7;break}a.istate.mode=2;case 2:if(0==a.avail_in)return c;c=b;a.avail_in--;a.total_in++;a.istate.need=(a.next_in[a.next_in_index++]&
255)<<24&4278190080;a.istate.mode=3;case 3:if(0==a.avail_in)return c;c=b;a.avail_in--;a.total_in++;a.istate.need+=(a.next_in[a.next_in_index++]&255)<<16&16711680;a.istate.mode=4;case 4:if(0==a.avail_in)return c;c=b;a.avail_in--;a.total_in++;a.istate.need+=(a.next_in[a.next_in_index++]&255)<<8&65280;a.istate.mode=5;case 5:if(0==a.avail_in)return c;a.avail_in--;a.total_in++;a.istate.need+=a.next_in[a.next_in_index++]&255;a.adler=a.istate.need;a.istate.mode=6;return 2;case 6:return a.istate.mode=13,
a.msg="need dictionary",a.istate.marker=0,-2;case 7:c=a.istate.blocks.proc(a,c);if(-3==c){a.istate.mode=13;a.istate.marker=0;break}c==d&&(c=b);if(c!=h)return c;c=b;a.istate.blocks.reset(a,a.istate.was);if(0!=a.istate.nowrap){a.istate.mode=12;break}a.istate.mode=8;case 8:if(0==a.avail_in)return c;c=b;a.avail_in--;a.total_in++;a.istate.need=(a.next_in[a.next_in_index++]&255)<<24&4278190080;a.istate.mode=9;case 9:if(0==a.avail_in)return c;c=b;a.avail_in--;a.total_in++;a.istate.need+=(a.next_in[a.next_in_index++]&
255)<<16&16711680;a.istate.mode=10;case 10:if(0==a.avail_in)return c;c=b;a.avail_in--;a.total_in++;a.istate.need+=(a.next_in[a.next_in_index++]&255)<<8&65280;a.istate.mode=11;case 11:if(0==a.avail_in)return c;c=b;a.avail_in--;a.total_in++;a.istate.need+=a.next_in[a.next_in_index++]&255;if(a.istate.was[0]!=a.istate.need){a.istate.mode=13;a.msg="incorrect data check";a.istate.marker=5;break}a.istate.mode=12;case 12:return h;case 13:return-3;default:return-2}};l.prototype.inflateSetDictionary=function(a,
b,c){var e=0,h=c;if(null==a||null==a.istate||6!=a.istate.mode)return-2;if(a._adler.adler32(1,b,0,c)!=a.adler)return-3;a.adler=a._adler.adler32(0,null,0,0);h>=1<<a.istate.wbits&&(h=(1<<a.istate.wbits)-1,e=c-h);a.istate.blocks.set_dictionary(b,e,h);a.istate.mode=7;return d};var G=[0,0,255,255];l.prototype.inflateSync=function(a){var b,c,e;if(null==a||null==a.istate)return-2;13!=a.istate.mode&&(a.istate.mode=13,a.istate.marker=0);if(0==(b=a.avail_in))return k;c=a.next_in_index;for(e=a.istate.marker;0!=
b&&4>e;)a.next_in[c]==G[e]?e++:e=0!=a.next_in[c]?0:4-e,c++,b--;a.total_in+=c-a.next_in_index;a.next_in_index=c;a.avail_in=b;a.istate.marker=e;if(4!=e)return-3;b=a.total_in;c=a.total_out;this.inflateReset(a);a.total_in=b;a.total_out=c;a.istate.mode=7;return d};l.prototype.inflateSyncPoint=function(a){return null==a||null==a.istate||null==a.istate.blocks?-2:a.istate.blocks.sync_point()};var K=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];m.prototype.reset=function(a,b){b&&(b[0]=this.check);6==this.mode&&
this.codes.free(a);this.mode=t;this.read=this.write=this.bitb=this.bitk=0;this.checkfn&&(a.adler=this.check=a._adler.adler32(0,null,0,0))};m.prototype.proc=function(a,b){var e,g,k,l,m,p,n;l=a.next_in_index;m=a.avail_in;g=this.bitb;k=this.bitk;p=this.write;for(n=p<this.read?this.read-p-1:this.end-p;;)switch(this.mode){case t:for(;3>k;){if(0!=m)b=d;else return this.bitb=g,this.bitk=k,a.avail_in=m,a.total_in+=l-a.next_in_index,a.next_in_index=l,this.write=p,this.inflate_flush(a,b);m--;g|=(a.next_in[l++]&
255)<<k;k+=8}e=g&7;this.last=e&1;switch(e>>>1){case 0:g>>>=3;k-=3;e=k&7;g>>>=e;k-=e;this.mode=1;break;case 1:var q=new Int32Array(1),r=new Int32Array(1),u=[],w=[];e=r;var y=u,z=w;q[0]=9;e[0]=5;y[0]=B;z[0]=Q;this.codes.init(q[0],r[0],u[0],0,w[0],0,a);g>>>=3;k-=3;this.mode=6;break;case 2:g>>>=3;k-=3;this.mode=3;break;case 3:return g>>>=3,k-=3,this.mode=13,a.msg="invalid block type",b=-3,this.bitb=g,this.bitk=k,a.avail_in=m,a.total_in+=l-a.next_in_index,a.next_in_index=l,this.write=p,this.inflate_flush(a,
b)}break;case 1:for(;32>k;){if(0!=m)b=d;else return this.bitb=g,this.bitk=k,a.avail_in=m,a.total_in+=l-a.next_in_index,a.next_in_index=l,this.write=p,this.inflate_flush(a,b);m--;g|=(a.next_in[l++]&255)<<k;k+=8}if((~g>>>16&65535)!=(g&65535))return this.mode=13,a.msg="invalid stored block lengths",b=-3,this.bitb=g,this.bitk=k,a.avail_in=m,a.total_in+=l-a.next_in_index,a.next_in_index=l,this.write=p,this.inflate_flush(a,b);this.left=g&65535;g=k=0;this.mode=0!=this.left?2:0!=this.last?7:t;break;case 2:if(0==
m)return this.bitb=g,this.bitk=k,a.avail_in=m,a.total_in+=l-a.next_in_index,a.next_in_index=l,write=p,this.inflate_flush(a,b);if(0==n&&(p==end&&0!=read&&(p=0,n=p<this.read?this.read-p-1:this.end-p),0==n&&(this.write=p,b=this.inflate_flush(a,b),p=this.write,n=p<this.read?this.read-p-1:this.end-p,p==this.end&&0!=this.read&&(p=0,n=p<this.read?this.read-p-1:this.end-p),0==n)))return this.bitb=g,this.bitk=k,a.avail_in=m,a.total_in+=l-a.next_in_index,a.next_in_index=l,this.write=p,this.inflate_flush(a,
b);b=d;e=this.left;e>m&&(e=m);e>n&&(e=n);v(a.next_in,l,window,p,e);l+=e;m-=e;p+=e;n-=e;if(0!=(this.left-=e))break;this.mode=0!=this.last?7:t;break;case 3:for(;14>k;){if(0!=m)b=d;else return this.bitb=g,this.bitk=k,a.avail_in=m,a.total_in+=l-a.next_in_index,a.next_in_index=l,this.write=p,this.inflate_flush(a,b);m--;g|=(a.next_in[l++]&255)<<k;k+=8}this.table=e=g&16383;if(29<(e&31)||29<(e>>5&31))return this.mode=9,a.msg="too many length or distance symbols",b=-3,this.bitb=g,this.bitk=k,a.avail_in=m,
a.total_in+=l-a.next_in_index,a.next_in_index=l,this.write=p,this.inflate_flush(a,b);e=258+(e&31)+(e>>5&31);if(null==this.blens||this.blens.length<e)this.blens=new Int32Array(e);else for(n=0;n<e;n++)this.blens[n]=0;g>>>=14;k-=14;this.index=0;mode=4;case 4:for(;this.index<4+(this.table>>>10);){for(;3>k;){if(0!=m)b=d;else return this.bitb=g,this.bitk=k,a.avail_in=m,a.total_in+=l-a.next_in_index,a.next_in_index=l,this.write=p,this.inflate_flush(a,b);m--;g|=(a.next_in[l++]&255)<<k;k+=8}this.blens[K[this.index++]]=
g&7;g>>>=3;k-=3}for(;19>this.index;)this.blens[K[this.index++]]=0;this.bb[0]=7;e=this.inftree.inflate_trees_bits(this.blens,this.bb,this.tb,this.hufts,a);if(e!=d)return b=e,-3==b&&(this.blens=null,this.mode=9),this.bitb=g,this.bitk=k,a.avail_in=m,a.total_in+=l-a.next_in_index,a.next_in_index=l,write=p,this.inflate_flush(a,b);this.index=0;this.mode=5;case 5:for(;;){e=this.table;if(!(this.index<258+(e&31)+(e>>5&31)))break;for(e=this.bb[0];k<e;){if(0!=m)b=d;else return this.bitb=g,this.bitk=k,a.avail_in=
m,a.total_in+=l-a.next_in_index,a.next_in_index=l,this.write=p,this.inflate_flush(a,b);m--;g|=(a.next_in[l++]&255)<<k;k+=8}e=this.hufts[3*(this.tb[0]+(g&c[e]))+1];r=this.hufts[3*(this.tb[0]+(g&c[e]))+2];if(16>r)g>>>=e,k-=e,this.blens[this.index++]=r;else{n=18==r?7:r-14;for(q=18==r?11:3;k<e+n;){if(0!=m)b=d;else return this.bitb=g,this.bitk=k,a.avail_in=m,a.total_in+=l-a.next_in_index,a.next_in_index=l,this.write=p,this.inflate_flush(a,b);m--;g|=(a.next_in[l++]&255)<<k;k+=8}g>>>=e;k-=e;q+=g&c[n];g>>>=
n;k-=n;n=this.index;e=this.table;if(n+q>258+(e&31)+(e>>5&31)||16==r&&1>n)return this.blens=null,this.mode=9,a.msg="invalid bit length repeat",b=-3,this.bitb=g,this.bitk=k,a.avail_in=m,a.total_in+=l-a.next_in_index,a.next_in_index=l,this.write=p,this.inflate_flush(a,b);r=16==r?this.blens[n-1]:0;do this.blens[n++]=r;while(0!=--q);this.index=n}}this.tb[0]=-1;q=new Int32Array(1);r=new Int32Array(1);u=new Int32Array(1);w=new Int32Array(1);q[0]=9;r[0]=6;e=this.table;e=this.inftree.inflate_trees_dynamic(257+
(e&31),1+(e>>5&31),this.blens,q,r,u,w,this.hufts,a);if(e!=d)return-3==e&&(this.blens=null,this.mode=13),b=e,this.bitb=g,this.bitk=k,a.avail_in=m,a.total_in+=l-a.next_in_index,a.next_in_index=l,this.write=p,this.inflate_flush(a,b);this.codes.init(q[0],r[0],this.hufts,u[0],this.hufts,w[0],a);this.mode=6;case 6:this.bitb=g;this.bitk=k;a.avail_in=m;a.total_in+=l-a.next_in_index;a.next_in_index=l;this.write=p;if((b=this.codes.proc(this,a,b))!=h)return this.inflate_flush(a,b);b=d;this.codes.free(a);l=a.next_in_index;
m=a.avail_in;g=this.bitb;k=this.bitk;p=this.write;n=p<this.read?this.read-p-1:this.end-p;if(0==this.last){this.mode=t;break}this.mode=7;case 7:this.write=p;b=this.inflate_flush(a,b);p=this.write;if(this.read!=this.write)return this.bitb=g,this.bitk=k,a.avail_in=m,a.total_in+=l-a.next_in_index,a.next_in_index=l,this.write=p,this.inflate_flush(a,b);mode=12;case 8:return b=h,this.bitb=g,this.bitk=k,a.avail_in=m,a.total_in+=l-a.next_in_index,a.next_in_index=l,this.write=p,this.inflate_flush(a,b);case 9:return b=
-3,this.bitb=g,this.bitk=k,a.avail_in=m,a.total_in+=l-a.next_in_index,a.next_in_index=l,this.write=p,this.inflate_flush(a,b);default:return b=-2,this.bitb=g,this.bitk=k,a.avail_in=m,a.total_in+=l-a.next_in_index,a.next_in_index=l,this.write=p,this.inflate_flush(a,b)}};m.prototype.free=function(a){this.reset(a,null);this.hufts=this.window=null};m.prototype.set_dictionary=function(a,b,c){v(a,b,window,0,c);this.read=this.write=c};m.prototype.sync_point=function(){return 1==this.mode};m.prototype.inflate_flush=
function(a,b){var c,e,g;e=a.next_out_index;g=this.read;c=(g<=this.write?this.write:this.end)-g;c>a.avail_out&&(c=a.avail_out);0!=c&&b==k&&(b=d);a.avail_out-=c;a.total_out+=c;null!=this.checkfn&&(a.adler=this.check=a._adler.adler32(this.check,this.window,g,c));v(this.window,g,a.next_out,e,c);e+=c;g+=c;g==this.end&&(g=0,this.write==this.end&&(this.write=0),c=this.write-g,c>a.avail_out&&(c=a.avail_out),0!=c&&b==k&&(b=d),a.avail_out-=c,a.total_out+=c,null!=this.checkfn&&(a.adler=this.check=a._adler.adler32(this.check,
this.window,g,c)),v(this.window,g,a.next_out,e,c),e+=c,g+=c);a.next_out_index=e;this.read=g;return b};g.prototype.init=function(a,b,c,d,e,g,h){this.mode=0;this.lbits=a;this.dbits=b;this.ltree=c;this.ltree_index=d;this.dtree=e;this.dtree_index=g;this.tree=null};g.prototype.proc=function(a,b,e){var g,k,l=0,m=0,p=0,n,q,r,p=b.next_in_index;n=b.avail_in;l=a.bitb;m=a.bitk;q=a.write;for(r=q<a.read?a.read-q-1:a.end-q;;)switch(this.mode){case 0:if(258<=r&&10<=n&&(a.bitb=l,a.bitk=m,b.avail_in=n,b.total_in+=
p-b.next_in_index,b.next_in_index=p,a.write=q,e=this.inflate_fast(this.lbits,this.dbits,this.ltree,this.ltree_index,this.dtree,this.dtree_index,a,b),p=b.next_in_index,n=b.avail_in,l=a.bitb,m=a.bitk,q=a.write,r=q<a.read?a.read-q-1:a.end-q,e!=d)){this.mode=e==h?7:9;break}this.need=this.lbits;this.tree=this.ltree;this.tree_index=this.ltree_index;this.mode=1;case 1:for(g=this.need;m<g;){if(0!=n)e=d;else return a.bitb=l,a.bitk=m,b.avail_in=n,b.total_in+=p-b.next_in_index,b.next_in_index=p,a.write=q,a.inflate_flush(b,
e);n--;l|=(b.next_in[p++]&255)<<m;m+=8}g=3*(this.tree_index+(l&c[g]));l>>>=this.tree[g+1];m-=this.tree[g+1];k=this.tree[g];if(0==k){this.lit=this.tree[g+2];this.mode=6;break}if(0!=(k&16)){this.get=k&15;this.len=this.tree[g+2];this.mode=2;break}if(0==(k&64)){this.need=k;this.tree_index=g/3+this.tree[g+2];break}if(0!=(k&32)){this.mode=7;break}this.mode=9;b.msg="invalid literal/length code";e=-3;a.bitb=l;a.bitk=m;b.avail_in=n;b.total_in+=p-b.next_in_index;b.next_in_index=p;a.write=q;return a.inflate_flush(b,
e);case 2:for(g=this.get;m<g;){if(0!=n)e=d;else return a.bitb=l,a.bitk=m,b.avail_in=n,b.total_in+=p-b.next_in_index,b.next_in_index=p,a.write=q,a.inflate_flush(b,e);n--;l|=(b.next_in[p++]&255)<<m;m+=8}this.len+=l&c[g];l>>=g;m-=g;this.need=this.dbits;this.tree=this.dtree;this.tree_index=this.dtree_index;this.mode=3;case 3:for(g=this.need;m<g;){if(0!=n)e=d;else return a.bitb=l,a.bitk=m,b.avail_in=n,b.total_in+=p-b.next_in_index,b.next_in_index=p,a.write=q,a.inflate_flush(b,e);n--;l|=(b.next_in[p++]&
255)<<m;m+=8}g=3*(this.tree_index+(l&c[g]));l>>=this.tree[g+1];m-=this.tree[g+1];k=this.tree[g];if(0!=(k&16)){this.get=k&15;this.dist=this.tree[g+2];this.mode=4;break}if(0==(k&64)){this.need=k;this.tree_index=g/3+this.tree[g+2];break}this.mode=9;b.msg="invalid distance code";e=-3;a.bitb=l;a.bitk=m;b.avail_in=n;b.total_in+=p-b.next_in_index;b.next_in_index=p;a.write=q;return a.inflate_flush(b,e);case 4:for(g=this.get;m<g;){if(0!=n)e=d;else return a.bitb=l,a.bitk=m,b.avail_in=n,b.total_in+=p-b.next_in_index,
b.next_in_index=p,a.write=q,a.inflate_flush(b,e);n--;l|=(b.next_in[p++]&255)<<m;m+=8}this.dist+=l&c[g];l>>=g;m-=g;this.mode=5;case 5:for(g=q-this.dist;0>g;)g+=a.end;for(;0!=this.len;){if(0==r&&(q==a.end&&0!=a.read&&(q=0,r=q<a.read?a.read-q-1:a.end-q),0==r&&(a.write=q,e=a.inflate_flush(b,e),q=a.write,r=q<a.read?a.read-q-1:a.end-q,q==a.end&&0!=a.read&&(q=0,r=q<a.read?a.read-q-1:a.end-q),0==r)))return a.bitb=l,a.bitk=m,b.avail_in=n,b.total_in+=p-b.next_in_index,b.next_in_index=p,a.write=q,a.inflate_flush(b,
e);a.window[q++]=a.window[g++];r--;g==a.end&&(g=0);this.len--}this.mode=0;break;case 6:if(0==r&&(q==a.end&&0!=a.read&&(q=0,r=q<a.read?a.read-q-1:a.end-q),0==r&&(a.write=q,e=a.inflate_flush(b,e),q=a.write,r=q<a.read?a.read-q-1:a.end-q,q==a.end&&0!=a.read&&(q=0,r=q<a.read?a.read-q-1:a.end-q),0==r)))return a.bitb=l,a.bitk=m,b.avail_in=n,b.total_in+=p-b.next_in_index,b.next_in_index=p,a.write=q,a.inflate_flush(b,e);e=d;a.window[q++]=this.lit;r--;this.mode=0;break;case 7:7<m&&(m-=8,n++,p--);a.write=q;
e=a.inflate_flush(b,e);q=a.write;if(a.read!=a.write)return a.bitb=l,a.bitk=m,b.avail_in=n,b.total_in+=p-b.next_in_index,b.next_in_index=p,a.write=q,a.inflate_flush(b,e);this.mode=8;case 8:return e=h,a.bitb=l,a.bitk=m,b.avail_in=n,b.total_in+=p-b.next_in_index,b.next_in_index=p,a.write=q,a.inflate_flush(b,e);case 9:return e=-3,a.bitb=l,a.bitk=m,b.avail_in=n,b.total_in+=p-b.next_in_index,b.next_in_index=p,a.write=q,a.inflate_flush(b,e);default:return e=-2,a.bitb=l,a.bitk=m,b.avail_in=n,b.total_in+=
p-b.next_in_index,b.next_in_index=p,a.write=q,a.inflate_flush(b,e)}};g.prototype.free=function(a){};g.prototype.inflate_fast=function(a,b,e,g,k,l,m,p){var n,q,r,u,t,w,y,z,B,C,G,H;w=p.next_in_index;y=p.avail_in;u=m.bitb;t=m.bitk;z=m.write;B=z<m.read?m.read-z-1:m.end-z;a=c[a];C=c[b];do{for(;20>t;)y--,u|=(p.next_in[w++]&255)<<t,t+=8;n=u&a;q=e;r=g;H=3*(r+n);if(0==(b=q[H]))u>>=q[H+1],t-=q[H+1],m.window[z++]=q[H+2],B--;else{do{u>>=q[H+1];t-=q[H+1];if(0!=(b&16)){b&=15;G=q[H+2]+(u&c[b]);u>>=b;for(t-=b;15>
t;)y--,u|=(p.next_in[w++]&255)<<t,t+=8;n=u&C;q=k;r=l;H=3*(r+n);b=q[H];do if(u>>=q[H+1],t-=q[H+1],0!=(b&16)){for(b&=15;t<b;)y--,u|=(p.next_in[w++]&255)<<t,t+=8;n=q[H+2]+(u&c[b]);u>>=b;t-=b;B-=G;if(z>=n)n=z-n,m.window[z++]=m.window[n++],m.window[z++]=m.window[n++],G-=2;else{n=z-n;do n+=m.end;while(0>n);b=m.end-n;if(G>b){G-=b;if(0<z-n&&b>z-n){do m.window[z++]=m.window[n++];while(0!=--b)}else v(m.window,n,m.window,z,b),z+=b;n=0}}do m.window[z++]=m.window[n++];while(0!=--G);break}else if(0==(b&64))n+=
q[H+2],n+=u&c[b],H=3*(r+n),b=q[H];else return p.msg="invalid distance code",G=p.avail_in-y,G=t>>3<G?t>>3:G,y+=G,w-=G,t-=G<<3,m.bitb=u,m.bitk=t,p.avail_in=y,p.total_in+=w-p.next_in_index,p.next_in_index=w,m.write=z,-3;while(1);break}if(0==(b&64)){if(n+=q[H+2],n+=u&c[b],H=3*(r+n),0==(b=q[H])){u>>=q[H+1];t-=q[H+1];m.window[z++]=q[H+2];B--;break}}else{if(0!=(b&32))return G=p.avail_in-y,G=t>>3<G?t>>3:G,y+=G,w-=G,t-=G<<3,m.bitb=u,m.bitk=t,p.avail_in=y,p.total_in+=w-p.next_in_index,p.next_in_index=w,m.write=
z,h;p.msg="invalid literal/length code";G=p.avail_in-y;G=t>>3<G?t>>3:G;y+=G;w-=G;t-=G<<3;m.bitb=u;m.bitk=t;p.avail_in=y;p.total_in+=w-p.next_in_index;p.next_in_index=w;m.write=z;return-3}}while(1)}}while(258<=B&&10<=y);G=p.avail_in-y;G=t>>3<G?t>>3:G;w-=G;m.bitb=u;m.bitk=t-(G<<3);p.avail_in=y+G;p.total_in+=w-p.next_in_index;p.next_in_index=w;m.write=z;return d};y.prototype.huft_build=function(b,c,e,g,h,l,m,p,n,q,r){var u,t,w,y,z,B,C,G,H;B=0;t=e;do this.c[b[c+B]]++,B++,t--;while(0!=t);if(this.c[0]==
e)return m[0]=-1,p[0]=0,d;z=p[0];for(w=1;15>=w&&0==this.c[w];w++);y=w;z<w&&(z=w);for(t=15;0!=t&&0==this.c[t];t--);q=t;z>t&&(z=t);p[0]=z;for(p=1<<w;w<t;w++,p<<=1)if(0>(p-=this.c[w]))return-3;if(0>(p-=this.c[t]))return-3;this.c[t]+=p;this.x[1]=w=0;B=1;for(C=2;0!=--t;)this.x[C]=w+=this.c[B],C++,B++;B=t=0;do 0!=(w=b[c+B])&&(this.v[this.x[w]++]=t),B++;while(++t<e);e=this.x[q];B=this.x[0]=t=0;c=-1;G=-z;for(H=C=this.u[0]=0;y<=q;y++)for(b=this.c[y];0!=b--;){for(;y>G+z;){c++;G+=z;H=q-G;H=H>z?z:H;if((u=1<<
(w=y-G))>b+1&&(u-=b+1,C=y,w<H))for(;++w<H&&!((u<<=1)<=this.c[++C]);)u-=this.c[C];H=1<<w;if(this.hn[0]+H>a)return-3;this.u[c]=C=this.hn[0];this.hn[0]+=H;0!=c?(this.x[c]=t,this.r[0]=w,this.r[1]=z,w=t>>>G-z,this.r[2]=C-this.u[c-1]-w,v(this.r,0,n,3*(this.u[c-1]+w),3)):m[0]=C}this.r[1]=y-G;B>=e?this.r[0]=192:r[B]<g?(this.r[0]=256>this.v[B]?0:96,this.r[2]=this.v[B++]):(this.r[0]=l[this.v[B]-g]+16+64,this.r[2]=h[this.v[B++]-g]);u=1<<y-G;for(w=t>>>G;w<H;w+=u)v(this.r,0,n,3*(C+w),3);for(w=1<<y-1;0!=(t&w);w>>>=
1)t^=w;t^=w;for(w=(1<<G)-1;(t&w)!=this.x[c];)c--,G-=z,w=(1<<G)-1}return 0!=p&&1!=q?k:d};y.prototype.inflate_trees_bits=function(a,b,c,d,e){this.initWorkArea(19);this.hn[0]=0;a=this.huft_build(a,0,19,19,null,null,c,b,d,this.hn,this.v);if(-3==a)e.msg="oversubscribed dynamic bit lengths tree";else if(a==k||0==b[0])e.msg="incomplete dynamic bit lengths tree",a=-3;return a};y.prototype.inflate_trees_dynamic=function(a,b,c,e,g,h,l,m,n){this.initWorkArea(288);this.hn[0]=0;h=this.huft_build(c,0,a,257,N,O,
h,e,m,this.hn,this.v);if(h!=d||0==e[0])return-3==h?n.msg="oversubscribed literal/length tree":-4!=h&&(n.msg="incomplete literal/length tree",h=-3),h;this.initWorkArea(288);h=this.huft_build(c,a,b,0,C,w,l,g,m,this.hn,this.v);return h!=d||0==g[0]&&257<a?(-3==h?n.msg="oversubscribed distance tree":h==k?(n.msg="incomplete distance tree",h=-3):-4!=h&&(n.msg="empty distance tree with lengths",h=-3),h):d};y.prototype.initWorkArea=function(a){null==this.hn&&(this.hn=new Int32Array(1),this.v=new Int32Array(a),
this.c=new Int32Array(16),this.r=new Int32Array(3),this.u=new Int32Array(15),this.x=new Int32Array(16));this.v.length<a&&(this.v=new Int32Array(a));for(var b=0;b<a;b++)this.v[b]=0;for(b=0;16>b;b++)this.c[b]=0;for(b=0;3>b;b++)this.r[b]=0;v(this.c,0,this.u,0,15);v(this.c,0,this.x,0,16)};var H="function"===typeof(new Uint8Array(1)).subarray;"undefined"!==typeof u&&(u.exports={inflateBuffer:z,arrayCopy:v})},{}]},{},[16]);
