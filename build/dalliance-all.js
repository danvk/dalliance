(function e$$0(t,s,r){function p(h,u){if(!s[h]){if(!t[h]){var z="function"==typeof require&&require;if(!u&&z)return z(h,!0);if(q)return q(h,!0);throw Error("Cannot find module '"+h+"'");}z=s[h]={exports:{}};t[h][0].call(z.exports,function(a){var b=t[h][1][a];return p(b?b:a)},z,z.exports,e$$0,t,s,r)}return s[h].exports}for(var q="function"==typeof require&&require,h=0;h<r.length;h++)p(r[h]);return p})({1:[function(e,t,s){function r(){}function p(c,g,v){var m=new r;m.data=c;m.bai=g;m.bai.fetch(function(c){if(!c)return v(null,
"Couldn't access BAI");var g=new Uint8Array(c),B=h(g,0);if(B!=f)return v(null,"Not a BAI file, magic=0x"+B.toString(16));B=h(g,4);m.indices=[];for(var N=8,H=1E9,d=0;d<B;++d){for(var x=N,C=h(g,N),N=N+4,I=0;I<C;++I){h(g,N);var l=h(g,N+4),N=N+(8+16*l)}for(var I=h(g,N),D=N+=4,E=0;E<I;++E)if(l=a(g,D),D+=8,l){D=l.block;0<l.offset&&(D+=65536);D<H&&(H=D);break}N+=8*I;0<C&&(m.indices[d]=new Uint8Array(c,x,N-x))}m.data.slice(0,H).fetch(function(l){if(!l)return v(null,"Couldn't access BAM");l=b(l,l.byteLength);
l=new Uint8Array(l);var n=h(l,0);if(n!=k)return v(null,"Not a BAM file, magic=0x"+n.toString(16));for(var d=h(l,4),a="",n=0;n<d;++n)a+=String.fromCharCode(l[n+8]);a=h(l,d+8);d+=12;m.chrToIndex={};m.indexToChr=[];for(n=0;n<a;++n){for(var E=h(l,d),c="",f=0;f<E-1;++f)c+=String.fromCharCode(l[d+4+f]);h(l,d+E+4);m.chrToIndex[c]=n;0==c.indexOf("chr")?m.chrToIndex[c.substring(3)]=n:m.chrToIndex["chr"+c]=n;m.indexToChr.push(c);d=d+8+E}if(m.indices)return v(m)})})}function q(){}if("undefined"!==typeof e){e("./spans");
s=e("./bin");var h=s.readInt,w=s.readShort,u=s.readByte,z=s.readFloat;e=e("./lh3utils");var a=e.readVob,b=e.unbgzf,m=e.reg2bins,g=e.Chunk}var k=21840194,f=21578050;e={MULTIPLE_SEGMENTS:1,ALL_SEGMENTS_ALIGN:2,SEGMENT_UNMAPPED:4,NEXT_SEGMENT_UNMAPPED:8,REVERSE_COMPLEMENT:16,NEXT_REVERSE_COMPLEMENT:32,FIRST_SEGMENT:64,LAST_SEGMENT:128,SECONDARY_ALIGNMENT:256,QC_FAIL:512,DUPLICATE:1024,SUPPLEMENTARY:2048};r.prototype.blocksForRange=function(c,f,b){var k=this.indices[c];if(!k)return[];c=m(f,b);for(var v=
[],e=0;e<c.length;++e)v[c[e]]=!0;c=[];for(var u=[],e=h(k,0),G=4,H=0;H<e;++H){var d=h(k,G),x=h(k,G+4),G=G+8;if(v[d])for(var C=0;C<x;++C){var I=a(k,G),l=a(k,G+8);(4681>d?u:c).push(new g(I,l));G+=16}else G+=16*x}e=h(k,G);v=null;f=Math.min(f>>14,e-1);b=Math.min(b>>14,e-1);for(e=f;e<=b;++e)(f=a(k,G+4+8*e))&&(!v||f.block<v.block||f.offset<v.offset)&&(v=f);k=[];if(null!=v)for(e=0;e<u.length;++e)b=u[e],b.maxv.block>=v.block&&b.maxv.offset>=v.offset&&k.push(b);u=k;k=[];for(e=0;e<u.length;++e)k.push(u[e]);
for(e=0;e<c.length;++e)k.push(c[e]);k.sort(function(l,d){var c=l.minv.block-d.minv.block;return 0!=c?c:l.minv.offset-d.minv.offset});c=[];if(0<k.length){u=k[0];for(e=1;e<k.length;++e)b=k[e],b.minv.block==u.maxv.block?u=new g(u.minv,b.maxv):(c.push(u),u=b);c.push(u)}return c};r.prototype.fetch=function(c,a,f,g,k){function v(){if(x>=H.length)return g(d);if(C){var c=new Uint8Array(C),c=m.readBamRecords(c,H[x].minv.offset,d,a,f,h,k);C=null;++x;return c?g(d):v()}var l=H[x],c=l.minv.block;m.data.slice(c,
l.maxv.block+65536-c).fetch(function(d){C=b(d,l.maxv.block-l.minv.block+1);return v()})}var m=this;k=k||{};var h=this.chrToIndex[c],H;void 0===h?H=[]:(H=this.blocksForRange(h,a,f))||g(null,"Error in index fetch");var d=[],x=0,C;v()};var c="=ACxGxxxTxxxxxxN".split(""),v="MIDNSHP=X???????".split("");r.prototype.readBamRecords=function(a,f,b,g,k,m,e){for(;;){var G=h(a,f),G=f+G+4;if(G>=a.length)return b;var H=new q,d=h(a,f+4),x=h(a,f+8),C=h(a,f+12),I=(C&65280)>>8,l=C&255,C=h(a,f+16),D=(C&4294901760)>>
16,E=C&65535,C=h(a,f+20),A=h(a,f+24),n=h(a,f+28);h(a,f+32);H.segment=this.indexToChr[d];H.flag=D;H.pos=x;H.mq=I;e.light&&(H.seqLength=C);if(!e.light){0<=A&&(H.nextSegment=this.indexToChr[A],H.nextPos=n);I="";for(x=0;x<l-1;++x)I+=String.fromCharCode(a[f+36+x]);H.readName=I;f=f+36+l;l="";for(x=0;x<E;++x)I=h(a,f),l=l+(I>>4)+v[I&15],f+=4;H.cigar=l;E="";l=C+1>>1;for(x=0;x<l;++x)I=a[f+x],E+=c[(I&240)>>4],E+=c[I&15];f+=l;H.seq=E;E="";for(x=0;x<C;++x)E+=String.fromCharCode(a[f+x]+33);f+=C;for(H.quals=E;f<
G;){E=String.fromCharCode(a[f],a[f+1]);l=String.fromCharCode(a[f+2]);if("A"==l)l=String.fromCharCode(a[f+3]),f+=4;else if("i"==l||"I"==l)l=h(a,f+3),f+=7;else if("c"==l||"C"==l)l=a[f+3],f+=4;else if("s"==l||"S"==l)l=w(a,f+3),f+=5;else if("f"==l)l=z(a,f+3),f+=7;else if("Z"==l||"H"==l)for(f+=3,l="";x=a[f++],0!=x;)l+=String.fromCharCode(x);else if("B"==l){l=String.fromCharCode(a[f+3]);x=h(a,f+4);if("i"==l||"I"==l||"f"==l)I=4,D="f"==l?z:h;else if("s"==l||"S"==l)I=2,D=w;else if("c"==l||"C"==l)I=1,D=u;else throw"Unknown array type "+
l;f+=8;l=[];for(A=0;A<x;++A)l.push(D(a,f)),f+=I}else throw"Unknown type "+l;H[E]=l}}if(!g||H.pos<=k&&H.pos+C>=g)void 0!==m&&d!=m||b.push(H);if(H.pos>k)return!0;f=G}};"undefined"!==typeof t&&(t.exports={makeBam:p,BAM_MAGIC:k,BAI_MAGIC:f,BamFlags:e})},{"./bin":4,"./lh3utils":23,"./spans":34}],2:[function(e,t,s){function r(a){this.type=a}function p(a,f){this.parser=a;this.sink=f}function q(a,f){this.parser=a;this.sink=f;this.wigState=null}if("undefined"!==typeof e){var h=e("./spans"),w=h.Range,u=h.union,
z=h.intersection,h=e("./sourceadapters").registerParserFactory;t=e("./das");var a=t.DASStylesheet,b=t.DASStyle,m=t.DASGroup,g=e("./utils").shallowCopy}r.prototype.createSession=function(a){return"wig"==this.type?new q(this,a):new p(this,a)};var k=/([^=]+)=(.+)/,f=/\s/,c=/^[0-9]+,[0-9]+,[0-9]+/;p.prototype.parse=function(a){var b=a.split(f);if(!(3>b.length)){var k=parseInt(b[1])+1;a=parseInt(b[2]);a={segment:b[0],min:k,max:a};3<b.length&&"."!==b[3]&&(a.label=b[3]);4<b.length&&(a.score=parseFloat(b[4]));
5<b.length&&(a.orientation=b[5]);if(8<b.length){var h=b[8];c.test(h)&&(a.itemRgb="rgb("+h+")")}if(12<=b.length){var h=parseInt(b[6]),e=parseInt(b[7]),y=parseInt(b[9]),q=b[10].split(",").map(function(d){return parseInt(d)}),p=b[11].split(",").map(function(d){return parseInt(d)});a.type="transcript";var G=new m;G.id=b[3];G.type="transcript";G.notes=[];a.groups=[G];if(12<b.length){var H=G=b[12];13<b.length&&(H=b[13]);b=new m;b.id=G;b.label=H;b.type="gene";a.groups.push(b)}b=null;for(G=0;G<y;++G)H=p[G]+
k,H=new w(H,H+q[G]),b=b?u(b,H):H;p=b.ranges();for(k=0;k<p.length;++k)q=p[k],y=g(a),y.min=q.min(),y.max=q.max(),this.sink(y);if(e>h&&(h="+"==a.orientation?new w(h,e+3):new w(h-3,e),h=z(b,h)))for(a.type="translation",h=h.ranges(),k=e=0;k<h.length;++k)y=k,"-"==a.orientation&&(y=h.length-k-1),q=h[y],y=g(a),y.min=q.min(),y.max=q.max(),a.readframe=e,q=q.max()-q.min(),e=(e+q)%3,this.sink(y)}else this.sink(a)}};p.prototype.flush=function(){};q.prototype.parse=function(a){a=a.split(f);if("fixedStep"==a[0]){this.wigState=
"fixedStep";this.chr=this.pos=this.step=null;for(var c=this.span=1;c<a.length;++c){var b=k.exec(a[c]);b&&("chrom"==b[1]?this.chr=b[2]:"start"==b[1]?this.pos=parseInt(b[2]):"step"==b[1]?this.step=parseInt(b[2]):"span"==b[1]&&(this.span=parseInt(b[2])))}}else if("variableStep"==a[0])for(this.wigState="variableStep",this.chr=null,c=this.span=1;c<a.length;++c)b=k.exec(a[c]),"chrom"==b[1]?this.chr=b[2]:"span"==b[1]&&(this.span=parseInt(b[2]));else this.wigState?"fixedStep"==this.wigState?1==a.length&&
(a=parseFloat(a[0]),a={segment:this.chr,min:this.pos,max:this.pos+this.span-1,score:a},this.pos+=this.step,this.sink(a)):"variableStep"==this.wigState&&2==a.length&&(c=parseInt(a[0]),a=parseFloat(a[1]),a={segment:this.chr,min:c,max:c+this.span-1,score:a},this.sink(a)):4>a.length||(a={segment:a[0],min:parseInt(a[1])+1,max:parseInt(a[2]),score:parseFloat(a[3])},this.sink(a))};q.prototype.flush=function(){};r.prototype.getStyleSheet=function(c){var f=new a;if("wig"==this.type){var g=new b;g.glyph="HISTOGRAM";
g.BGCOLOR="blue";g.HEIGHT=30;f.pushStyle({type:"default"},null,g)}else g=new b,g.glyph="BOX",g.FGCOLOR="black",g.BGCOLOR="blue",g.HEIGHT=8,g.BUMP=!0,g.LABEL=!0,g.ZINDEX=20,f.pushStyle({type:"default"},null,g),g=new b,g.glyph="BOX",g.FGCOLOR="black",g.BGCOLOR="red",g.HEIGHT=10,g.BUMP=!0,g.ZINDEX=20,f.pushStyle({type:"translation"},null,g),g=new b,g.glyph="BOX",g.FGCOLOR="black",g.BGCOLOR="white",g.HEIGHT=10,g.ZINDEX=10,g.BUMP=!0,g.LABEL=!0,f.pushStyle({type:"transcript"},null,g),g=new b,g.glyph="HISTOGRAM",
g.COLOR1="white",g.COLOR2="black",g.HEIGHT=30,f.pushStyle({type:"density"},null,g);return c(f)};h("bed",function(a){return new r(a)});h("wig",function(a){return new r(a)})},{"./das":10,"./sourceadapters":33,"./spans":34,"./utils":47}],3:[function(e,t,s){function r(a,d){return a[d]+a[d+1]*O+a[d+2]*y+a[d+3]*J+a[d+4]*F}function p(){}function q(a,d,f,c){this.bwg=a;this.cirTreeOffset=d;this.cirTreeLength=f;this.isSummary=c}function h(a,d,f){var c=new p;c.data=a;c.name=f;c.data.slice(0,512).salted().fetch(function(a){if(!a)return d(null,
"Couldn't fetch file");var l=new Uint8Array(a),f=new Int16Array(a);a=new Int32Array(a);var b=l[0]+O*l[1]+y*l[2]+J*l[3];b==v?c.type="bigwig":b==N?c.type="bigbed":b==B||b==L?d(null,"Currently don't support big-endian BBI files"):d(null,"Not a supported format, magic=0x"+b.toString(16));c.version=f[2];c.numZoomLevels=f[3];c.chromTreeOffset=r(l,8);c.unzoomedDataOffset=r(l,16);c.unzoomedIndexOffset=r(l,24);c.fieldCount=f[16];c.definedFieldCount=f[17];c.asOffset=r(l,36);c.totalSummaryOffset=r(l,44);c.uncompressBufSize=
a[13];c.extHeaderOffset=r(l,56);c.zoomLevels=[];for(f=0;f<c.numZoomLevels;++f){var b=a[6*f+16],A=r(l,24*f+72),n=r(l,24*f+80);c.zoomLevels.push({reduction:b,dataOffset:A,indexOffset:n})}c.readChromTree(function(){c.getAutoSQL(function(l){c.schema=l;return d(c)})})})}function w(a,d,c,f,b){this.bbi=a;this.type=d;this.fieldCount=c;this.offset=f;this.field=b}if("undefined"!==typeof e){s=e("./spans");var u=s.Range,z=s.union,a=s.intersection;s=e("./das");var b=s.DASFeature,m=s.DASGroup,g=e("./utils").shallowCopy,
k=e("./bin").readInt;e=e("jszlib");var f=e.inflateBuffer,c=e.arrayCopy}var v=2291137574,B=654086024,N=2273964779,L=3958540679,O=256,y=65536,J=16777216,F=4294967296,G=/^[0-9]+,[0-9]+,[0-9]+/;p.prototype.readChromTree=function(a){var d=this;this.chromsToIDs={};this.idsToChroms={};this.maxID=0;var c=this.unzoomedDataOffset,c=c+4-(c-this.chromTreeOffset&3);this.data.slice(this.chromTreeOffset,c-this.chromTreeOffset).fetch(function(c){var f=new Uint8Array(c),l=new Int16Array(c),b=(new Int32Array(c))[2];
r(f,16);var E=function(a){var n=f[a],c=l[a/2+1];a+=4;for(var g=0;g<c;++g)if(0==n){a+=b;var x=r(f,a);a+=8;x-=d.chromTreeOffset;E(x)}else{for(var x="",k=0;k<b;++k){var C=f[a++];0!=C&&(x+=String.fromCharCode(C))}k=f[a+3]<<24|f[a+2]<<16|f[a+1]<<8|f[a+0];a+=8;d.chromsToIDs[x]=k;0==x.indexOf("chr")&&(d.chromsToIDs[x.substr(3)]=k);d.idsToChroms[k]=x;d.maxID=Math.max(d.maxID,k)}};E(32);a(d)})};q.prototype.readWigData=function(a,d,c,f){a=this.bwg.chromsToIDs[a];if(void 0===a)return f([]);this.readWigDataById(a,
d,c,f)};q.prototype.readWigDataById=function(a,d,c,f){var b=this;if(this.cirHeader){var l=[],g=0;Date.now();var E=function(l,n,f,b){return(0>a||l==a)&&n<=c&&f>=d},A=function(d,a){b.bwg.instrument&&console.log("level="+a+"; offset="+d+"; time="+(Date.now()|0));g+=d.length;if(1==d.length&&48==d[0]-b.cirTreeOffset&&b.cachedCirRoot)M(b.cachedCirRoot,0,a),--g,0==g&&b.fetchFeatures(E,l,f);else{for(var c=4+32*b.cirBlockSize,A,x=0;x<d.length;++x){var k=new u(d[x],d[x]+c);A=A?z(A,k):k}c=A.ranges();for(A=0;A<
c.length;++A)n(d,c[A],a)}},n=function(d,n,a,c){n.max();n.min();b.bwg.data.slice(n.min(),n.max()-n.min()).fetch(function(c){for(var A=0;A<d.length;++A)n.contains(d[A])&&(M(c,d[A]-n.min(),a),48==d[A]-b.cirTreeOffset&&0==d[A]-n.min()&&(b.cachedCirRoot=c),--g,0==g&&b.fetchFeatures(E,l,f))})},M=function(n,f,b){var E=new Uint8Array(n),g=new Int16Array(n);n=new Int32Array(n);var M=E[f],g=g[f/2+1];f+=4;if(0!=M)for(M=0;M<g;++M){var k=f/4,D=n[k],C=n[k+1],m=n[k+2],k=n[k+3],v=r(E,f+16);b=r(E,f+24);(0>a||D<a||
D==a&&C<=c)&&(0>a||m>a||m==a&&k>=d)&&l.push({offset:v,size:b});f+=32}else{for(var I=[],M=0;M<g;++M)k=f/4,D=n[k],C=n[k+1],m=n[k+2],k=n[k+3],v=r(E,f+16),(0>a||D<a||D==a&&C<=c)&&(0>a||m>a||m==a&&k>=d)&&I.push(v),f+=24;0<I.length&&A(I,b+1)}};A([b.cirTreeOffset+48],1)}else this.bwg.data.slice(this.cirTreeOffset,48).fetch(function(l){b.cirHeader=l;l=new Int32Array(b.cirHeader);b.cirBlockSize=l[1];b.readWigDataById(a,d,c,f)})};q.prototype.fetchFeatures=function(a,d,g){var k=this;d.sort(function(l,d){return(l.offset|
0)-(d.offset|0)});if(0==d.length)g([]);else{var m=[],l=function(l,d,n,a){a||(a={});var c=new b;c._chromId=l;c.segment=k.bwg.idsToChroms[l];c.min=d;c.max=n;c.type="bigwig";for(var f in a)c[f]=a[f];m.push(c)},D=function(){if(0==d.length)Date.now(),g(m);else{var b=d[0];if(b.data)k.parseFeatures(b.data,l,a),d.splice(0,1),D();else{for(var A=b.offset,n=b.size,b=1;b<d.length&&d[b].offset==A+n;)n+=d[b].size,++b;k.bwg.data.slice(A,n).fetch(function(l){for(var a=0,b=0;a<n;){var A=d[b],g;0<k.bwg.uncompressBufSize?
g=f(l,a+2,A.size-2):(g=new Uint8Array(A.size),c(new Uint8Array(l,a,A.size),0,g,0,A.size),g=g.buffer);A.data=g;a+=A.size;++b}D()})}}};D()}};q.prototype.parseFeatures=function(c,d,f){var b=new Uint8Array(c);if(this.isSummary)for(var k=new Int16Array(c),l=new Int32Array(c),D=new Float32Array(c),b=c.byteLength/32,k=0;k<b;++k){c=l[8*k];var E=l[8*k+1],A=l[8*k+2],n=l[8*k+3],M=D[8*k+5],v=D[8*k+6];f(c,E+1,A)&&(n={type:"bigwig",score:v/n,maxScore:M},"bigbed"==this.bwg.type&&(n.type="density"),d(c,E+1,A,n))}else if("bigwig"==
this.bwg.type)if(k=new Int16Array(c),l=new Int32Array(c),D=new Float32Array(c),c=l[0],M=l[1],v=l[3],n=l[4],E=b[20],b=k[11],3==E)for(k=0;k<b;++k){var Q=D[k+6],l=M+k*v+1,E=M+k*v+n;f(c,l,E)&&d(c,l,E,{score:Q})}else if(2==E)for(k=0;k<b;++k)E=l[2*k+6]+1,A=E+n-1,Q=D[2*k+7],f(c,E,A)&&d(c,E,A,{score:Q});else if(1==E)for(k=0;k<b;++k)E=l[3*k+6]+1,A=l[3*k+7],Q=D[3*k+8],E>A&&(E=A),f(c,E,A)&&d(c,E,A,{score:Q});else console.log("Currently not handling bwgType="+E);else if("bigbed"==this.bwg.type)for(k=0,n=this.bwg.definedFieldCount,
M=this.bwg.schema;k<b.length;){c=b[k+3]<<24|b[k+2]<<16|b[k+1]<<8|b[k+0];E=b[k+7]<<24|b[k+6]<<16|b[k+5]<<8|b[k+4];A=b[k+11]<<24|b[k+10]<<16|b[k+9]<<8|b[k+8];k+=12;for(Q="";;)if(v=b[k++],0!=v)Q+=String.fromCharCode(v);else break;var v={},h;h=0<Q.length?Q.split("\t"):[];0<h.length&&3<n&&(v.label=h[0]);1<h.length&&4<n&&(Q=parseInt(h[1]),isNaN(Q)||(v.score=Q));2<h.length&&5<n&&(v.orientation=h[2]);5<h.length&&8<n&&(Q=h[5],G.test(Q)&&(v.itemRgb="rgb("+Q+")"));if(h.length>n-3&&M)for(Q=n-3;Q<h.length;++Q)v[M.fields[Q+
3].name]=h[Q];if(f(c,E+1,A,h))if(12>n)d(c,E+1,A,v);else{var Q=h[3]|0,e=h[4]|0,B=h[6]|0,y=h[7].split(","),q=h[8].split(",");v.exonFrames&&(D=v.exonFrames.split(","),v.exonFrames=void 0);v.type="transcript";var p=new m;for(l in v)p[l]=v[l];p.id=h[0];p.segment=this.bwg.idsToChroms[c];p.min=E+1;p.max=A;p.notes=[];v.groups=[p];if(9<h.length){var r=A=v.geneName||h[9];10<h.length&&(r=h[10]);v.geneName2&&(r=v.geneName2);h=g(p);h.id=A;h.label=r;h.type="gene";v.groups.push(h)}A=[];for(h=0;h<B;++h)p=(q[h]|0)+
E,p=new u(p,p+(y[h]|0)),A.push(p);y=z(A);B=y.ranges();for(E=0;E<B.length;++E)A=B[E],d(c,A.min()+1,A.max(),v);if(e>Q&&(E="+"==v.orientation?new u(Q,e+3):new u(Q-3,e),E=a(y,E))){v.type="translation";Q=E.ranges();for(y=e=0;Q[0].min()>B[y].max();)y++;for(E=0;E<Q.length;++E)B=E,"-"==v.orientation&&(B=Q.length-E-1),A=Q[B],v.readframe=e,D&&(B=parseInt(D[B+y]),"number"===typeof B&&0<=B&&2>=B&&(v.readframe=B,v.readframeExplicit=!0)),B=A.max()-A.min(),e=(e+B)%3,d(c,A.min()+1,A.max(),v)}}}else throw Error("Don't know what to do with "+
this.bwg.type);};q.prototype.getFirstAdjacent=function(a,d,c,b){a=this.bwg.chromsToIDs[a];if(void 0===a)return b([]);this.getFirstAdjacentById(a,d,c,b)};q.prototype.getFirstAdjacentById=function(a,d,c,b){var f=this;if(this.cirHeader){var l=null,g=-1,k=-1,A=0;Date.now();var n=function(l,d){A+=l.length;for(var n=4+32*f.cirBlockSize,a,c=0;c<l.length;++c){var b=new u(l[c],l[c]+n);a=a?z(a,b):b}n=a.ranges();for(a=0;a<n.length;++a)M(l,n[a],d)},M=function(n,g,k,E){g.max();g.min();f.bwg.data.slice(g.min(),
g.max()-g.min()).fetch(function(E){for(var M=0;M<n.length;++M)if(g.contains(n[M])&&(m(E,n[M]-g.min(),k),--A,0==A)){if(!l)return 0<c&&(0!=a||0<d)?f.getFirstAdjacentById(0,0,c,b):0>c&&(a!=f.bwg.maxID||1E9>d)?f.getFirstAdjacentById(f.bwg.maxID,1E9,c,b):b([]);f.fetchFeatures(function(l,n,f,b){return 0>c&&(l<a||f<d)||0<c&&(l>a||n>d)},[l],function(l){for(var n=null,d=-1,a=-1,f=0;f<l.length;++f){var g=l[f],A=g._chromId,k=g.min,E=g.max;if(null==n||0>c&&(A>d||E>a)||0<c&&(A<d||k<a))n=g,a=0>c?E:k,d=A}return null!=
n?b([n]):b([])})}})},m=function(b,A,M){var m=new Uint8Array(b),v=new Int16Array(b);b=new Int32Array(b);var C=m[A],v=v[A/2+1];A+=4;if(0!=C)for(C=0;C<v;++C){var h=A/4,e=b[h],B=b[h+1],y=b[h+2],u=b[h+3],h=r(m,A+16);M=r(m,A+24);(0>c&&(e<a||e==a&&B<=d)||0<c&&(y>a||y==a&&u>=d))&&!/_random/.exec(f.bwg.idsToChroms[e])&&(null==l||0>c&&(y>g||y==g&&u>k)||0<c&&(e<g||e==g&&B<k))&&(l={offset:h,size:M},k=0>c?u:B,g=0>c?y:e);A+=32}else{for(var fa=m=-1,C=0;C<v;++C){h=A/4;e=b[h];B=b[h+1];y=b[h+2];u=b[h+3];h=b[h+4]<<
32|b[h+5];if(0>c&&(e<a||e==a&&B<=d)&&y>=a||0<c&&(y>a||y==a&&u>=d)&&e<=a)if(0>m||u>fa)m=h,fa=0>c?u:B;A+=24}0<=m&&n([m],M+1)}};n([f.cirTreeOffset+48],1)}else this.bwg.data.slice(this.cirTreeOffset,48).fetch(function(l){f.cirHeader=l;l=new Int32Array(f.cirHeader);f.cirBlockSize=l[1];f.getFirstAdjacentById(a,d,c,b)})};p.prototype.readWigData=function(a,d,c,b){this.getUnzoomedView().readWigData(a,d,c,b)};p.prototype.getUnzoomedView=function(){if(!this.unzoomedView){var a=4E3;this.zoomLevels[0]&&(a=this.zoomLevels[0].dataOffset-
this.unzoomedIndexOffset);this.unzoomedView=new q(this,this.unzoomedIndexOffset,a,!1)}return this.unzoomedView};p.prototype.getZoomedView=function(a){a=this.zoomLevels[a];a.view||(a.view=new q(this,a.indexOffset,4E3,!0));return a.view};p.prototype._tsFetch=function(a,d,c,b,f){var l=this;if(a>=this.zoomLevels.length-1){if(this.topLevelReductionCache){for(var g=[],k=this.topLevelReductionCache,A=0;A<k.length;++A)k[A]._chromId==d&&g.push(k[A]);return f(g)}this.getZoomedView(this.zoomLevels.length-1).readWigDataById(-1,
0,3E8,function(n){l.topLevelReductionCache=n;return l._tsFetch(a,d,c,b,f)})}else return(0>a?this.getUnzoomedView():this.getZoomedView(a)).readWigDataById(d,c,b,f)};p.prototype.thresholdSearch=function(a,d,c,b,f){function l(){if(0==k.length)return f(null);k.sort(function(l,n){var d=l.zoom-n.zoom;if(0!=d)return d;d=l.chrOrd-n.chrOrd;return 0!=d?d:l.min-n.min*c});var n=k.splice(0,1)[0];g._tsFetch(n.zoom,n.chr,n.min,n.max,function(a){var g=0<c?0:3E8;n.fromRef&&(g=d);for(var A=0;A<a.length;++A){var m=
a[A],D;D=void 0!=m.maxScore?m.maxScore:m.score;if(0<c){if(D>b)if(0>n.zoom){if(m.min>g)return f(m)}else m.max>g&&k.push({chr:n.chr,chrOrd:n.chrOrd,zoom:n.zoom-2,min:m.min,max:m.max,fromRef:n.fromRef})}else if(D>b)if(0>n.zoom){if(m.max<g)return f(m)}else m.min<g&&k.push({chr:n.chr,chrOrd:n.chrOrd,zoom:n.zoom-2,min:m.min,max:m.max,fromRef:n.fromRef})}l()})}c=0>c?-1:1;var g=this;a=this.chromsToIDs[a];for(var k=[{chrOrd:0,chr:a,zoom:g.zoomLevels.length-4,min:0,max:3E8,fromRef:!0}],A=1;A<=this.maxID+1;++A){var n=
(a+c*A)%(this.maxID+1);0>n&&(n+=this.maxID+1);k.push({chrOrd:A,chr:n,zoom:g.zoomLevels.length-1,min:0,max:3E8})}l()};p.prototype.getAutoSQL=function(a){if(!this.asOffset)return a(null);this.data.slice(this.asOffset,2048).fetch(function(d){var c=new Uint8Array(d);d="";for(var b=0;b<c.length&&0!=c[b];++b)d+=String.fromCharCode(c[b]);var c=/([\w\[\]]+)\s+(\w+)\s*;\s*("([^"]+)")?\s*/g,f=/(\w+)\s+(\w+)\s+("([^"]+)")?\s+\(\s*/.exec(d);if(f){b={declType:f[1],name:f[2],comment:f[4],fields:[]};d=d.substring(f[0]);
for(f=c.exec(d);null!=f;f=c.exec(d))b.fields.push({type:f[1],name:f[2],comment:f[4]});return a(b)}})};p.prototype.getExtraIndices=function(a){var d=this;if(4>this.version||0==this.extHeaderOffset||"bigbed"!=this.type)return a(null);this.data.slice(this.extHeaderOffset,64).fetch(function(c){if(!c)return a(null,"Couldn't fetch extension header");var b=new Uint8Array(c),f=new Int16Array(c);new Int32Array(c);var l=f[1];c=r(b,4);if(0==l)return a(null);d.data.slice(c,20*l).fetch(function(c){if(!c)return a(null,
"Couldn't fetch index info");var b=new Uint8Array(c),f=new Int16Array(c);new Int32Array(c);c=[];for(var n=0;n<l;++n){var g=f[10*n],k=f[10*n+1],x=r(b,20*n+4),g=new w(d,g,k,x,f[10*n+8]);c.push(g)}a(c)})})};w.prototype.lookup=function(a,d){var c=this;this.bbi.data.slice(this.offset,32).fetch(function(b){function f(l){c.bbi.data.slice(l,4+g*(E+A)).fetch(function(l){var n=new Uint8Array(l),b=new Uint16Array(l);new Uint32Array(l);b=b[1];l=4;if(0==n[0]){for(var g=null,m=0;m<b;++m){for(var D="",v=0;v<E;++v){var h=
n[l++];0!=h&&(D+=String.fromCharCode(h))}v=r(n,l);l+=8;if(0>a.localeCompare(D)&&g){f(g);return}g=v}f(g)}else{for(m=0;m<b;++m){D="";for(v=0;v<E;++v)h=n[l++],0!=h&&(D+=String.fromCharCode(h));if(D==a)return b=r(n,l),n=k(n,l+8),c.bbi.getUnzoomedView().fetchFeatures(function(l,n,d,b){if(b&&b.length>c.field-3)return b[c.field-3]==a},[{offset:b,size:n}],d);l+=A}return d([])}})}var l=new Uint8Array(b);new Int16Array(b);b=new Int32Array(b);var g=b[1],E=b[2],A=b[3];r(l,16);f(c.offset+32)})};"undefined"!==
typeof t&&(t.exports={makeBwg:h,BIG_BED_MAGIC:N,BIG_WIG_MAGIC:v})},{"./bin":4,"./das":10,"./spans":34,"./utils":47,jszlib:63}],4:[function(e,t,s){function r(a){this.blob=a}function p(a,c,b,g){g||("object"===typeof c?(g=c,c=void 0):g={});this.url=a;this.start=c||0;b&&(this.end=b);this.opts=g}function q(a){if(!a)return null;for(var c=new Uint8Array(a.length),b=0;b<c.length;++b)c[b]=a.charCodeAt(b);return c.buffer}function h(a,c){return a[c+7]<<24|a[c+6]<<16|a[c+5]<<8|a[c+4]}function w(a,c){return a[c+
3]<<24|a[c+2]<<16|a[c+1]<<8|a[c]}function u(a,c){return a[c+1]<<8|a[c]}function z(a,c){return a[c]}function a(a,c){return a[c]<<24|a[c+1]<<16|a[c+2]<<8|a[c+3]}if("undefined"!==typeof e)var b=e("./utils").shallowCopy,m=e("./sha1").b64_sha1;r.prototype.slice=function(a,c){var b;b=this.blob.slice?c?this.blob.slice(a,a+c):this.blob.slice(a):c?this.blob.webkitSlice(a,a+c):this.blob.webkitSlice(a);return new r(b)};r.prototype.salted=function(){return this};r.prototype.fetch="undefined"!==typeof FileReader?
function(a){var c=new FileReader;c.onloadend=function(b){a(q(c.result))};c.readAsBinaryString(this.blob)}:function(a){var c=new FileReaderSync;try{var b=c.readAsArrayBuffer(this.blob);a(b)}catch(g){a(null,g)}};p.prototype.slice=function(a,c){if(0>a)throw"Bad slice "+a;var b=this.start,g=this.end,b=b&&a?b+a:a||b;return new p(this.url,b,c&&b?b+c-1:g||c-1,this.opts)};var g=0,k=0<=navigator.userAgent.indexOf("Safari")&&0>navigator.userAgent.indexOf("Chrome");p.prototype.fetchAsText=function(a){var c=
new XMLHttpRequest,b=this.url;if(k||this.opts.salt)b=b+"?salt="+m(""+Date.now()+","+ ++g);c.open("GET",b,!0);if(this.end){if(1E8<this.end-this.start)throw"Monster fetch!";c.setRequestHeader("Range","bytes="+this.start+"-"+this.end)}c.onreadystatechange=function(){if(4==c.readyState)return 200==c.status||206==c.status?a(c.responseText):a(null)};this.opts.credentials&&(c.withCredentials=!0);c.send("")};p.prototype.salted=function(){var a=b(this.opts);a.salt=!0;return new p(this.url,this.start,this.end,
a)};p.prototype.fetch=function(a,b,h){var e=this;b=b||1;if(3<b)return a(null);var u=new XMLHttpRequest,p,r=this.url;if(k||this.opts.salt)r=r+"?salt="+m(""+Date.now()+","+ ++g);u.open("GET",r,!0);u.overrideMimeType("text/plain; charset=x-user-defined");if(this.end){if(1E8<this.end-this.start)throw"Monster fetch!";u.setRequestHeader("Range","bytes="+this.start+"-"+this.end);p=this.end-this.start+1}u.responseType="arraybuffer";u.onreadystatechange=function(){if(4==u.readyState){if(200==u.status||206==
u.status){if(u.response){var g=u.response.byteLength;return!p||p==g||h&&g==h?a(u.response):e.fetch(a,b+1,g)}if(u.mozResponseArrayBuffer)return a(u.mozResponseArrayBuffer);g=u.responseText;return!p||p==g.length||h&&g.length==h?a(q(u.responseText)):e.fetch(a,b+1,g.length)}return e.fetch(a,b+1)}};this.opts.credentials&&(u.withCredentials=!0);u.send("")};(function(a){var b=new ArrayBuffer(8),g=new Uint8Array(b),k=new Float32Array(b);a.readFloat=function(a,b){g[0]=a[b];g[1]=a[b+1];g[2]=a[b+2];g[3]=a[b+
3];return k[0]}})(this);"undefined"!==typeof t&&(t.exports={BlobFetchable:r,URLFetchable:p,readInt:w,readIntBE:a,readInt64:h,readShort:u,readByte:z,readFloat:this.readFloat})},{"./sha1":32,"./utils":47}],5:[function(e,t,s){function r(h){var e="bp";1E9<h?(h/=1E9,e="Gb"):1E6<h?(h/=1E6,e="Mb"):1E3<h&&(h/=1E3,e="kb");return""+Math.round(h)+e}if("undefined"!==typeof e){var p=e("./cbrowser").Browser,q=e("./utils").makeElement,h=e("./numformats").formatLongInt,w=e("./zoomslider");e("./tier-edit");e("./export-config");
e("./export-ui");e("./export-image");e("./svg-export");e("./session")}p.prototype.initUI=function(e,p){this.noSourceCSS||["bootstrap-scoped.css","dalliance-scoped.css","font-awesome.min.css"].forEach(function(a){document.head.appendChild(q("link","",{rel:"stylesheet",href:this.resolveURL("$$css/"+a)}))}.bind(this));var a=this;a.disableDefaultFeaturePopup||this.addFeatureListener(function(l,n,d,b){a.featurePopup(l,n,d,b)});e.classList.add("dalliance");var b=a.toolbar=q("div",null,{className:"btn-toolbar toolbar"}),
m=a.coordSystem.speciesName+" "+a.nameForCoordSystem(a.coordSystem);this.setDocumentTitle&&(document.title=m+" :: dalliance");var g=q("input","",{className:"loc-field"});a.makeTooltip(g,"Enter a genomic location or gene name");var k=q("p","",{className:"loc-status"}),f=q("a",[q("i",null,{className:"fa fa-search-plus"})],{className:"btn"}),c=new w;a.makeTooltip(c,"Highlighted button shows current zoom level, gray button shows inactive zoom level (click or tap SPACE to toggle).");var v=q("a",[q("i",
null,{className:"fa fa-search-minus"})],{className:"btn"}),B=q("a",[q("i",null,{className:"fa fa-eraser"})],{className:"btn"}),N=q("a",[q("i",null,{className:"fa fa-plus"})],{className:"btn"}),L=q("a",[q("i",null,{className:"fa fa-bookmark"})],{className:"btn"}),O=q("a",[q("i",null,{className:"fa fa-print"})],{className:"btn"});q("a",[q("i",null,{className:"fa fa-refresh"})],{className:"btn"});var y=q("a",[q("i",null,{className:"fa fa-cogs"})],{className:"btn"}),J=q("a",[q("i",null,{className:"fa fa-question"})],
{className:"btn"}),F=q("a",[q("i",null,{className:"fa fa-road"})],{className:"btn"});a.makeTooltip(F,"Configure currently selected track(s) (E)");var G=q("a",[q("i",null,{className:"fa fa-angle-left"})],{className:"btn"},{width:"5px"}),H=q("a",[q("i",null,{className:"fa fa-angle-right"})],{className:"btn pull-right"},{width:"5px"}),d=q("div",null,{className:"btn-group pull-right"});this.noTrackAdder||d.appendChild(N);this.noTrackEditor||d.appendChild(F);this.noExport||d.appendChild(O);this.noOptions||
d.appendChild(y);this.noHelp||d.appendChild(J);this.setUiMode=function(a){this.uiMode=a;var l={help:J,add:N,opts:y,"export":O,tier:F},d;for(d in l)d==a?l[d].classList.add("active"):l[d].classList.remove("active")};this.noLeapButtons||b.appendChild(H);d.firstChild&&b.appendChild(d);this.noLeapButtons||b.appendChild(G);this.noTitle||b.appendChild(q("div",q("h4",m,{},{margin:"0px"}),{className:"btn-group title"}));this.noLocationField||b.appendChild(q("div",[g,k],{className:"btn-group loc-group"}));
this.noClearHighlightsButton||b.appendChild(B);this.noZoomSlider||b.appendChild(q("div",[f,q("span",c,{className:"btn"}),v],{className:"btn-group"}));this.toolbarBelow?(e.appendChild(p),e.appendChild(b)):(e.appendChild(b),e.appendChild(p));var x=Math.log10(2),C=Math.log10(5),I=function(l){var n=(l/a.zoomExpt+Math.log(a.zoomBase))/Math.log(10);l=n|0;n-=l;return((0.01>n?l:n<=x+0.01?l+x:n<=C+0.01?l+C:l+1)*Math.log(10)-Math.log(a.zoomBase))*a.zoomExpt},l=function(l){c.addLabel(l,r(Math.exp(l/a.zoomExpt)*
a.zoomBase))};this.addViewListener(function(d,n,b,f,k){g.value=d+":"+h(n)+".."+h(b);c.min=k.min|0;c.max=k.max|0;k.isSnapZooming?(c.value=k.alternate,c.value2=k.current,c.active=2):(c.value=k.current,c.value2=k.alternate,c.active=1);c.removeLabels();d=k.min;k=k.max;n=k-d;l(I(d));l(I(d+1*n/3));l(I(d+2*n/3));l(I(k));a.storeStatus&&a.storeViewStatus();B.style.display=0<a.highlights.length?"inline-block":"none"});this.addTierListener(function(){a.storeStatus&&a.storeTierStatus()});g.addEventListener("keydown",
function(l){40==l.keyCode&&(l.preventDefault(),l.stopPropagation(),a.setSelectedTier(0));if(10==l.keyCode||13==l.keyCode)l.preventDefault(),a.search(g.value,function(l){k.textContent=l?""+l:""})},!1);var D;N.addEventListener("click",function(l){D&&D.displayed?a.removeAllPopups():D=a.showTrackAdder(l)},!1);a.makeTooltip(N,"Add a new track from the registry or an indexed file. (A)");f.addEventListener("click",function(l){l.stopPropagation();l.preventDefault();a.zoomStep(-10)},!1);a.makeTooltip(f,"Zoom in (+)");
v.addEventListener("click",function(l){l.stopPropagation();l.preventDefault();a.zoomStep(10)},!1);a.makeTooltip(v,"Zoom out (-)");c.addEventListener("change",function(l){l=2==c.active;l!=a.isSnapZooming&&(a.savedZoom=a.zoomSliderValue-a.zoomMin,a.isSnapZooming=l);l=1==c.active?c.value:c.value2;a.zoomSliderValue=1*l;a.zoom(Math.exp(1*l/a.zoomExpt))},!1);L.addEventListener("click",function(l){l.stopPropagation();l.preventDefault()},!1);a.makeTooltip(L,"Favourite regions");O.addEventListener("click",
function(l){l.stopPropagation();l.preventDefault();a.openExportPanel()},!1);a.makeTooltip(O,"Export publication-quality SVG. (X)");y.addEventListener("click",function(l){l.stopPropagation();l.preventDefault();a.toggleOptsPopup(l)},!1);a.makeTooltip(y,"Configure options.");J.addEventListener("click",function(l){l.stopPropagation();l.preventDefault();a.toggleHelpPopup(l)});a.makeTooltip(J,"Help; Keyboard shortcuts. (H)");F.addEventListener("click",function(l){l.stopPropagation();l.preventDefault();
1==a.selectedTiers.length&&a.openTierPanel(a.tiers[a.selectedTiers[0]])},!1);G.addEventListener("click",function(l){a.leap(a.reverseKeyScrolling?-1:1,!1)},!1);a.makeTooltip(G,function(l){l=a.getSelectedTier();var n;0<=l&&(n=a.tiers[l]);return n&&n.featureSource&&a.sourceAdapterIsCapable(n.featureSource,"quantLeap")&&"number"==typeof n.quantLeapThreshold?'Jump to the next region with a score above the threshold in the selected track "'+(n.config.name||n.dasSource.name)+'"" (ctrl+LEFT)':n&&n.featureSource&&
a.sourceAdapterIsCapable(n.featureSource,"leap")?'Jump to the next feature in the selected track "'+(n.config.name||n.dasSource.name)+'" (ctrl+LEFT)':"Jump left (shift+LEFT)"});H.addEventListener("click",function(l){a.leap(a.reverseKeyScrolling?1:-1,!1)},!1);a.makeTooltip(H,function(l){l=a.getSelectedTier();var n;0<=l&&(n=a.tiers[l]);return n&&n.featureSource&&a.sourceAdapterIsCapable(n.featureSource,"quantLeap")&&"number"==typeof n.quantLeapThreshold?'Jump to the next region with a score above the threshold in the selected track "'+
(n.config.name||n.dasSource.name)+'"" (ctrl+RIGHT)':n&&n.featureSource&&a.sourceAdapterIsCapable(n.featureSource,"leap")?'Jump to the next feature in the selected track "'+(n.config.name||n.dasSource.name)+'" (ctrl+RIGHT)':"Jump right (shift+RIGHT)"});a.addTierSelectionListener(function(){var l=a.getSelectedTier(),n;0<=l&&(n=a.tiers[l]);l=!1;n&&n.featureSource&&(a.sourceAdapterIsCapable(n.featureSource,"quantLeap")&&"number"==typeof n.quantLeapThreshold?l=!0:a.sourceAdapterIsCapable(n.featureSource,
"leap")&&(l=!0));G.firstChild.className=l?"fa fa-angle-double-left":"fa fa-angle-left";H.firstChild.className=l?"fa fa-angle-double-right":"fa fa-angle-right"});B.addEventListener("click",function(l){a.clearHighlights()},!1);a.makeTooltip(B,"Clear highlights (C)");a.addTierSelectionWrapListener(function(l){0>l&&(a.setSelectedTier(null),g.focus())});a.addTierSelectionListener(function(l){"tier"===a.uiMode&&(0==l.length?(a.hideToolPanel(),a.manipulatingTier=null,a.uiMode="none"):(l=a.tiers[l[0]],l!=
a.manipulatingTier&&a.openTierPanel(l)))});var E=function(l){if(65==l.keyCode||97==l.keyCode)l.preventDefault(),l.stopPropagation(),a.showTrackAdder();else if(72==l.keyCode||104==l.keyCode)l.stopPropagation(),l.preventDefault(),a.toggleHelpPopup(l);else if(69==l.keyCode||101==l.keyCode)l.stopPropagation(),l.preventDefault(),1==a.selectedTiers.length&&a.openTierPanel(a.tiers[a.selectedTiers[0]]);else if(88==l.keyCode||120==l.keyCode)l.stopPropagation(),l.preventDefault(),a.openExportPanel();else if(67==
l.keyCode||99==l.keyCode)l.stopPropagation(),l.preventDefault(),a.clearHighlights()};e.addEventListener("focus",function(l){e.addEventListener("keydown",E,!1)},!1);e.addEventListener("blur",function(l){e.removeEventListener("keydown",E,!1)},!1);e.addEventListener("keydown",function(l){27===l.keyCode&&(l.preventDefault(),l.stopPropagation(),a.uiMode="none",a.hideToolPanel(),a.selectedTiers&&0<a.selectedTiers.length&&a.browserHolder.focus())},!1)};p.prototype.showToolPanel=function(h,e){var a=this;
this.activeToolPanel&&this.activeToolPanel.parentElement.removeChild(this.activeToolPanel);var b;b=e?h:q("div",h,{},{overflowY:"auto",width:"100%"});var m=q("div",q("i",null,{className:"fa fa-caret-right"}),{className:"tool-divider"});m.addEventListener("click",function(b){a.hideToolPanel();a.setUiMode("none")},!1);this.makeTooltip(m,"Close tool panel (ESC)");this.activeToolPanel=q("div",[m,b],{className:"tool-holder"});this.svgHolder.appendChild(this.activeToolPanel);this.resizeViewer();a=this};
p.prototype.hideToolPanel=function(){this.activeToolPanel&&this.activeToolPanel.parentElement.removeChild(this.activeToolPanel);this.svgHolder.style.width="100%";this.activeToolPanel=null;this.resizeViewer()};p.prototype.toggleHelpPopup=function(h){"help"===this.uiMode?(this.hideToolPanel(),this.setUiMode("none")):(h=q("iframe",null,{scrolling:"yes",seamless:"seamless",src:this.resolveURL("$$help/index.html"),className:"help-panel"}),this.showToolPanel(h,!1),this.setUiMode("help"))};p.prototype.toggleOptsPopup=
function(h){var e=this;if("opts"===this.uiMode)this.hideToolPanel(),this.setUiMode("none");else{h=q("div",null,{className:"form-horizontal"},{boxSizing:"border-box",MozBoxSizing:"border-box",display:"inline-block",verticalAlign:"top"});var a=q("table");a.cellPadding=5;var b=q("input","",{type:"checkbox",checked:e.reverseScrolling});b.addEventListener("change",function(a){e.reverseScrolling=b.checked;e.storeStatus()},!1);a.appendChild(q("tr",[q("td","Reverse trackpad scrolling",{align:"right"}),q("td",
b)]));var m=q("input","",{type:"checkbox",checked:e.reverseKeyScrolling});m.addEventListener("change",function(a){e.reverseKeyScrolling=m.checked;e.storeStatus()},!1);a.appendChild(q("tr",[q("td","Reverse scrolling buttons and keys",{align:"right"}),q("td",m)]));var g=q("select");g.appendChild(q("option","Left",{value:"left"}));g.appendChild(q("option","Center",{value:"center"}));g.appendChild(q("option","Right",{value:"right"}));g.appendChild(q("option","None",{value:"none"}));g.value=e.rulerLocation;
g.addEventListener("change",function(a){e.rulerLocation=g.value;e.positionRuler();for(a=0;a<e.tiers.length;++a)e.tiers[a].paintQuant();e.storeStatus()},!1);a.appendChild(q("tr",[q("td","Vertical guideline",{align:"right"}),q("td",g)]));var k=q("input","",{type:"checkbox",checked:e.singleBaseHighlight});k.addEventListener("change",function(a){e.singleBaseHighlight=k.checked;e.positionRuler();e.storeStatus()},!1);k.setAttribute("id","singleBaseHightlightButton");a.appendChild(q("tr",[q("td","Display and highlight current genome location",
{align:"right"}),q("td",k)]));h.appendChild(a);a=q("button","Reset browser",{className:"btn"},{marginLeft:"auto",marginRight:"auto",display:"block"});a.addEventListener("click",function(a){e.reset()},!1);h.appendChild(a);this.showToolPanel(h);this.setUiMode("opts")}}},{"./cbrowser":6,"./export-config":13,"./export-image":14,"./export-ui":15,"./numformats":25,"./session":31,"./svg-export":36,"./tier-edit":42,"./utils":47,"./zoomslider":50}],6:[function(e,t,s){function r(l,a,d){this.min=a;this.max=
d;this.chr=l}function p(l){l||(l={});this.prefix="//www.biodalliance.org/release-0.13/";this.sources=[];this.tiers=[];this.tierGroups={};this.featureListeners=[];this.featureHoverListeners=[];this.viewListeners=[];this.regionSelectListeners=[];this.tierListeners=[];this.tierSelectionListeners=[];this.tierSelectionWrapListeners=[];this.cookieKey="browser";this.registry="http://www.dasregistry.org/das/sources";this.chains={};this.pageName="svgHolder";this.maxExtra=2.5;this.minExtra=0.5;this.zoomFactor=
1;this.zoomMin=10;this.origin=0;this.targetQuantRes=1;this.featurePanelWidth=750;this.zoomBase=100;this.zoomExpt=30;this.zoomSliderValue=100;this.entryPoints=null;this.currentSeqMax=-1;this.highlights=[];this.selectedTiers=[1];this.maxViewWidth=5E5;this.defaultSubtierMax=100;this.reverseScrolling=!1;this.rulerLocation="center";this.defaultHighlightFill="red";this.defaultHighlightAlpha=0.3;this.singleBaseHighlight=this.exportRuler=this.exportHighlights=!0;this.tierBackgroundColors=["rgb(245,245,245)",
"white"];this.minTierHeight=20;this.noDefaultLabels=!1;this.baseColors={A:"green",C:"blue",G:"orange",T:"red","-":"hotpink"};this.availableSources=new k;this.defaultSources=[];this.mappableSources={};this.hubs=[];this.hubObjects=[];this.sourceCache=new g;this.useFetchWorkers=this.retina=!0;this.maxWorkers=2;this.workerPath="$$worker-all.js";this.assemblyNameUcsc=this.assemblyNamePrimary=!0;this.initListeners=[];if(void 0!==l.viewStart&&"number"!==typeof l.viewStart)throw Error("viewStart must be an integer");
if(void 0!==l.viewEnd&&"number"!==typeof l.viewEnd)throw Error("viewEnd must be an integer");for(var a in l)this[a]=l[a];"string"===typeof l.uiPrefix&&"string"!==typeof l.prefix&&(this.prefix=l.uiPrefix);0===this.prefix.indexOf("//")&&"http:"!==window.location.prototol&&"https:"!==window.location.protocol&&(console.log("WARNING: prefix is set to a protocol-relative URL ("+this.prefix+" when loading from a non-HTTP source"),this.prefix="http:"+this.prefix);if(!this.coordSystem)throw Error("Coordinate system must be configured");
if(void 0===this.chr||void 0===this.viewStart||void 0===this.viewEnd)throw Error("Viewed region (chr:start..end) must be defined");var d=this;"complete"===document.readyState?d.realInit():window.addEventListener("load",function(l){d.realInit()},!1)}function q(l,a,d){if(d)for(var b=0;b<a.length;++b)a[b].mapping=d;l.set(a)}function h(l){return l.uri?l.uri:l.blob?"file:"+l.blob.name:l.bwgBlob?"file:"+l.bwgBlob.name:l.bamBlob?"file:"+l.bamBlob.name:l.twoBitBlob?"file:"+l.twoBitBlob.name:l.bwgURI||l.bamURI||
l.jbURI||l.twoBitURI||"http://www.biodalliance.org/magic/no_uri"}function w(l){return l.stylesheet_uri?l.stylesheet_uri:"sequence"==l.tier_type||l.twoBitURI||l.twoBitBlob?"http://www.biodalliance.org/magic/sequence":h(l)}function u(l,a){if(h(l)!=h(a)||l.mapping!=a.mapping||l.tier_type!=a.tier_type)return!1;if(l.overlay){if(!a.overlay||a.overlay.length!=l.overlay.length)return!1;for(var d=0;d<l.overlay.length;++d)if(!u(l.overlay[d],a.overlay[d]))return!1}else if(a.overlay)return!1;return!0}function z(l,
a){if(h(l)!=h(a)||w(l)!=w(a)||l.mapping!=a.mapping||l.tier_type!=a.tier_type)return!1;if(l.overlay){if(!a.overlay||a.overlay.length!=l.overlay.length)return!1;for(var d=0;d<l.overlay.length;++d)if(!z(l.overlay[d],a.overlay[d]))return!1}else if(a.overlay)return!1;return!0}function a(l,d,b,c){c=c||[];for(var n=l.length-1;0<=n;--n){var f=l[n];if(!f.notSelectable&&f.min()<=d&&f.max()>=d&&(!f.minY||!(b<f.minY()||b>f.maxY()))){f.feature?c.push(f.feature):f.group&&c.push(f.group);if(f.glyphs)return a(f.glyphs,
d,b,c);if(f.glyph)return a([f.glyph],d,b,c);break}}return c}function b(l,a){var d=this;this.tagSeed=0;this.callbacks={};this.browser=l;this.worker=a;this.worker.onmessage=function(l){var a=d.callbacks[l.data.tag];a&&(a(l.data.result,l.data.error),delete d.callbacks[l.data.tag])}}function m(l){var a=l.resolveURL(l.workerPath);0==a.indexOf("//")&&(a="https:"===window.location.prototype?"https:"+a:"http:"+a);var d=new Blob(['importScripts("'+a+'");'],{type:"application/javascript"});return new H(function(a,
n){var c=new Worker(URL.createObjectURL(d));c.onmessage=function(d){"init"===d.data.tag&&(console.log("Worker initialized"),a(new b(l,c)))};c.onerror=function(l){n(l.message)}})}function g(){this.sourcesByURI={}}if("undefined"!==typeof e){s=e("./utils");var k=s.Observed,f=s.makeElement,c=s.removeChildren,v=s.miniJSONify,B=s.shallowCopy,N=e("./tier").DasTier,L=e("./sha1").hex_sha1,O=e("./thub").connectTrackHub,y=e("./version");s=e("./numformats");var J=s.formatQuantLabel,F=s.formatLongInt,G=e("./chainset").Chainset,
H=e("es6-promise").Promise}p.prototype.resolveURL=function(l){return l.replace("$$",this.prefix)};p.prototype.realInit=function(){var l=this;if(this.wasInitialized)console.log("Attemping to call realInit on an already-initialized Dalliance instance");else{this.wasInitialized=!0;var a=navigator.userAgent||"dummy";0<=a.indexOf("Trident")&&0<=a.indexOf("rv:11")&&(this.disablePinning=!0);this.defaultChr=this.chr;this.defaultStart=this.viewStart;this.defaultEnd=this.viewEnd;this.defaultSources=[];for(a=
0;a<this.sources.length;++a){var d=this.sources[a];d&&this.defaultSources.push(d)}this.restoreStatus&&(this.statusRestored=this.restoreStatus());var b=this;this.browserHolderHolder=document.getElementById(this.pageName);this.browserHolderHolder.classList.add("dalliance-injection-point");this.browserHolder=f("div",null,{className:"dalliance dalliance-root",tabIndex:-1});this.maxHeight?this.browserHolder.style.maxHeight=this.maxHeight+"px":void 0!=this.maxHeight&&(this.browserHolder.style.maxHeight=
null);c(this.browserHolderHolder);this.browserHolderHolder.appendChild(this.browserHolder);this.svgHolder=f("div",null,{className:"main-holder"});this.initUI(this.browserHolder,this.svgHolder);this.pinnedTierHolder=f("div",null,{className:"tier-holder tier-holder-pinned"});this.tierHolder=f("div",this.makeLoader(24),{className:"tier-holder tier-holder-rest"});this.locSingleBase=f("span","foo",{className:"loc-single-base"});a=f("div",this.locSingleBase,{className:"loc-single-base-holder"});this.addViewListener(function(a,
d,n,b,c,f,g){d=Math.round((g+f)/2);l.locSingleBase.appendChild(document.createTextNode(a+":"+F(d)));l.locSingleBase.removeChild(l.locSingleBase.firstChild)});this.disablePinning?this.tierHolderHolder=this.tierHolder:(this.tierHolderHolder=f("div",[a,this.pinnedTierHolder,this.tierHolder],{className:"tier-holder-holder"}),this.svgHolder.appendChild(this.tierHolderHolder));this.svgHolder.appendChild(this.tierHolderHolder);this.bhtmlRoot=f("div");this.disablePoweredBy||this.bhtmlRoot.appendChild(f("span",
["Powered by ",f("a","Biodalliance",{href:"http://www.biodalliance.org/"})," "+y],{className:"powered-by"}));this.browserHolder.appendChild(this.bhtmlRoot);window.addEventListener("resize",function(l){b.resizeViewer()},!1);this.ruler=f("div",null,{className:"guideline"});this.ruler2=f("div",null,{className:"single-base-guideline"});this.tierHolderHolder.appendChild(this.ruler);this.tierHolderHolder.appendChild(this.ruler2);this.chainConfigs=this.chains||{};this.chains={};for(var n in this.chainConfigs)a=
this.chainConfigs[n],a instanceof G&&console.log('WARNING: Should no longer use "new Chainset" in Biodalliance configurations.'),this.chains[n]=new G(a);if(0<this.maxWorkers){n=[];for(a=0;a<this.maxWorkers;++a)n.push(m(this));n=H.all(n)}else n=H.resolve([]);this.fetchWorkers=null;this.nextWorker=0;n.then(function(l){console.log("Booted "+l.length+" workers");b.fetchWorkers=l},function(l){console.log("Failed to boot workers",l)}).then(function(){if("none"!=window.getComputedStyle(b.browserHolderHolder).display)setTimeout(function(){b.realInit2()},
1);else var l=setInterval(function(){"none"!=window.getComputedStyle(b.browserHolderHolder).display&&(clearInterval(l),b.realInit2())},300)})}};p.prototype.realInit2=function(){var l=this;c(this.tierHolder);c(this.pinnedTierHolder);this.featurePanelWidth=this.tierHolder.getBoundingClientRect().width|0;this.scale=this.featurePanelWidth/(this.viewEnd-this.viewStart);this.zoomMax||(this.zoomMax=this.zoomExpt*Math.log(this.maxViewWidth/this.zoomBase),this.zoomMin=this.zoomExpt*Math.log(this.featurePanelWidth/
10/this.zoomBase));this.zoomSliderValue=this.zoomExpt*Math.log((this.viewEnd-this.viewStart+1)/this.zoomBase);this.tierHolderHolder.addEventListener("mousewheel",function(a){a.stopPropagation();a.preventDefault();if(a.wheelDeltaX){var d=a.wheelDeltaX/5;l.reverseScrolling||(d=-d);l.move(d)}a.wheelDeltaY&&(d=a.wheelDeltaY,l.reverseScrolling&&(d=-d),l.tierHolder.scrollTop+=d)},!1);this.tierHolderHolder.addEventListener("MozMousePixelScroll",function(a){a.stopPropagation();a.preventDefault();1==a.axis?
0!=a.detail&&(a=a.detail/4,l.reverseScrolling&&(a=-a),l.move(a)):(a=a.detail,l.reverseScrolling||(a=-a),l.tierHolder.scrollTop+=a)},!1);this.tierHolderHolder.addEventListener("touchstart",function(a){return l.touchStartHandler(a)},!1);this.tierHolderHolder.addEventListener("touchmove",function(a){return l.touchMoveHandler(a)},!1);this.tierHolderHolder.addEventListener("touchend",function(a){return l.touchEndHandler(a)},!1);this.tierHolderHolder.addEventListener("touchcancel",function(a){return l.touchCancelHandler(a)},
!1);var a=function(a){if(13==a.keyCode){var d=!1;for(a=0;a<l.tiers.length;++a){var n=l.tiers[a];n.wantedLayoutHeight&&n.wantedLayoutHeight!=n.layoutHeight&&(n.layoutHeight=n.wantedLayoutHeight,n.clipTier(),d=!0)}d&&l.arrangeTiers()}else if(32==a.keyCode||32==a.charCode)l.isSnapZooming?(l.isSnapZooming=!1,d=(l.savedZoom||20)+l.zoomMin):(l.isSnapZooming=!0,d=(l.savedZoom||0)+l.zoomMin),l.savedZoom=l.zoomSliderValue-l.zoomMin,l.zoomSliderValue=d,l.zoom(Math.exp(1*d/l.zoomExpt)),a.stopPropagation(),a.preventDefault();
else if(85==a.keyCode)"opts"===l.uiMode&&(d=document.getElementById("singleBaseHightlightButton").checked,document.getElementById("singleBaseHightlightButton").checked=!d),l.singleBaseHighlight=!l.singleBaseHighlight,l.positionRuler(),a.stopPropagation(),a.preventDefault();else if(39==a.keyCode)a.stopPropagation(),a.preventDefault(),l.scrollArrowKey(a,-1);else if(37==a.keyCode)a.stopPropagation(),a.preventDefault(),l.scrollArrowKey(a,1);else if(38==a.keyCode||87==a.keyCode)if(a.stopPropagation(),
a.preventDefault(),a.shiftKey)a=l.getSelectedTier(),0>a||(d=l.tiers[a],a=d.forceHeight||d.subtiers[0].height,40<=a&&d.mergeConfig({height:a-10}));else if(a.ctrlKey||a.metaKey){if(a=l.getSelectedTier(),!(0>a)&&(d=l.tiers[a],d.quantLeapThreshold)){var n=d.subtiers[0].height,b=d.subtiers[0].quant;b&&(a=1*b.min,b=1*b.max,n=(b-a)/n,d.mergeConfig({quantLeapThreshold:a+((Math.round((d.quantLeapThreshold-a)/n)|0)+1)*n}),d.notify("Threshold: "+J(d.quantLeapThreshold)))}}else if(a.altKey){if(b=l.selectedTiers.length,
0!=b){a=l.selectedTiers[0];for(var c=!0,d=[],n=0;n<l.selectedTiers.length;++n)d.push(l.tiers[l.selectedTiers[n]]),0<n&&1!=l.selectedTiers[n]-l.selectedTiers[n-1]&&(c=!1);if(!(c&&0>=a)){for(n=l.selectedTiers.length-1;0<=n;--n)l.tiers.splice(l.selectedTiers[n],1);l.selectedTiers.splice(0,b);a=c?a-1:a;for(n=0;n<d.length;++n)l.tiers.splice(a+n,0,d[n]),l.selectedTiers.push(a+n);l.withPreservedSelection(l._ensureTiersGrouped);l.markSelectedTiers();l.notifyTierSelection();l.reorderTiers();l.notifyTier()}}}else if(a=
l.getSelectedTier(),0<a){if(l.setSelectedTier(a-1),a=l.tiers[l.getSelectedTier()],d=a.row.offsetTop,a=d+a.row.offsetHeight,d<l.tierHolder.scrollTop||a>l.tierHolder.scrollTop+l.tierHolder.offsetHeight)l.tierHolder.scrollTop=d}else l.notifyTierSelectionWrap(-1);else if(40==a.keyCode||83==a.keyCode)if(a.stopPropagation(),a.preventDefault(),a.shiftKey)a=l.getSelectedTier(),0>a||(d=l.tiers[a],a=d.forceHeight||d.subtiers[0].height,d.mergeConfig({height:a+10}));else if(a.ctrlKey||a.metaKey){if(a=l.getSelectedTier(),
!(0>a)&&(d=l.tiers[a],d.quantLeapThreshold&&(n=d.subtiers[0].height,b=d.subtiers[0].quant)))a=1*b.min,b=1*b.max,n=(b-a)/n,b=Math.round((d.quantLeapThreshold-a)/n)|0,1<b&&(d.mergeConfig({quantLeapThreshold:a+(b-1)*n}),d.notify("Threshold: "+J(d.quantLeapThreshold)))}else if(a.altKey){if(b=l.selectedTiers.length,0!=b){a=l.selectedTiers[0];for(var f=0,d=[],n=0;n<l.selectedTiers.length;++n)d.push(l.tiers[l.selectedTiers[n]]),0<n&&(f+=l.selectedTiers[n]-l.selectedTiers[n-1]-1);c=0==f;if(!(c&&a+b>=l.tiers.length)){for(n=
l.selectedTiers.length-1;0<=n;--n)l.tiers.splice(l.selectedTiers[n],1);l.selectedTiers.splice(0,b);a=c?a+1:a+f;for(n=0;n<d.length;++n)l.tiers.splice(a+n,0,d[n]),l.selectedTiers.push(a+n);l.withPreservedSelection(function(){l._ensureTiersGrouped(!0)});l.markSelectedTiers();l.notifyTierSelection();l.reorderTiers();l.notifyTier()}}}else{if(a=l.getSelectedTier(),a<l.tiers.length-1&&(l.setSelectedTier(a+1),a=l.tiers[l.getSelectedTier()],d=a.row.offsetTop,a=d+a.row.offsetHeight,d<l.tierHolder.scrollTop||
a>l.tierHolder.scrollTop+l.tierHolder.offsetHeight))l.tierHolder.scrollTop=Math.min(d,a-l.tierHolder.offsetHeight)}else if(187==a.keyCode||61==a.keyCode)a.stopPropagation(),a.preventDefault(),l.zoomStep(-10);else if(189==a.keyCode||173==a.keyCode)a.stopPropagation(),a.preventDefault(),l.zoomStep(10);else if(73==a.keyCode||105==a.keyCode)a.stopPropagation(),a.preventDefault(),a=l.getSelectedTier(),0>a||(n=l.tiers[a],n.infoVisible?(n.infoElement.style.display="none",n.updateHeight(),n.infoVisible=!1):
(n.infoElement.style.display="block",n.updateHeight(),n.infoVisible=!0));else if(84==a.keyCode||116==a.keyCode)if(a.shiftKey)for(a.stopPropagation(),a.preventDefault(),a=0;a<l.tiers.length;++a)n=l.tiers[a],n.dasSource.collapseSuperGroups&&(void 0===d&&(d=!n.bumped),n.mergeConfig({bumped:d}));else a.ctrlKey||a.metaKey||(a.stopPropagation(),a.preventDefault(),a=l.getSelectedTier(),0>a||(n=l.tiers[a],n.dasSource.collapseSuperGroups&&(void 0===d&&(d=!n.bumped),n.mergeConfig({bumped:d}))));else if(77==
a.keyCode||109==a.keyCode)a.stopPropagation(),a.preventDefault(),(a.ctrlKey||a.metaKey)&&1<l.selectedTiers.length&&l.mergeSelectedTiers();else if(68==a.keyCode||100==a.keyCode){if(a.stopPropagation(),a.preventDefault(),a.ctrlKey||a.metaKey)a=l.getSelectedTier(),0>a||l.addTier(l.tiers[a].dasSource)}else if(80==a.keyCode||112==a.keyCode)if(a.ctrlKey||a.metaKey){d=[];for(a=0;a<l.selectedTiers.length;++a)d.push(l.tiers[l.selectedTiers[a]]);for(a=0;a<d.length;++a)d[a].mergeConfig({pinned:!d[a].pinned})}};
this.browserHolder.addEventListener("focus",function(d){l.browserHolder.addEventListener("keydown",a,!1)},!1);this.browserHolder.addEventListener("blur",function(d){l.browserHolder.removeEventListener("keydown",a,!1)},!1);this.hPopupHolder=f("div");this.hPopupHolder.style["font-family"]="helvetica";this.hPopupHolder.style["font-size"]="12pt";this.hPopupHolder.classList.add("dalliance");document.body.appendChild(this.hPopupHolder);for(var d=0;d<this.sources.length;++d){var b=this.sources[d];if(b){var n=
{};this.restoredConfigs&&(n=this.restoredConfigs[d]);b.disabled||this.makeTier(b,n)}}l._ensureTiersGrouped();l.arrangeTiers();l.reorderTiers();l.refresh();l.setSelectedTier(1);l.positionRuler();(d=this.getSequenceSource())&&d.getSeqInfo(this.chr,function(a){l.currentSeqMax=a.length});this.queryRegistry();for(var g in this.chains)this.queryRegistry(g,!0);if(this.hubs)for(g=0;g<this.hubs.length;++g)d=this.hubs[g],"string"==typeof d&&(d={url:d}),function(a){O(a.url,function(d,n){if(n)console.log(n);
else{var b;if(b=a.genome?d.genomes[a.genome]:d.genomes[l.coordSystem.ucscName])a.mapping&&(b.mapping=a.mapping),l.hubObjects.push(b)}},a)}(d);this.fullScreen&&this.setFullScreenHeight();!this.statusRestored&&this.storeStatus&&this.storeStatus();for(g=0;g<this.initListeners.length;++g)try{this.initListeners[g].call(this)}catch(k){console.log(k)}};p.prototype.touchStartHandler=function(a){this.touchOriginX=a.touches[0].pageX;this.touchOriginY=a.touches[0].pageY;2==a.touches.length&&(a=Math.abs(a.touches[0].pageX-
a.touches[1].pageX),this.zooming=!0,this.zoomLastSep=this.zoomInitialSep=a,this.zoomInitialScale=this.scale)};p.prototype.touchMoveHandler=function(a){a.stopPropagation();a.preventDefault();if(1==a.touches.length){var d=a.touches[0].pageX;a=a.touches[0].pageY;this.touchOriginX&&d!=this.touchOriginX&&this.move(d-this.touchOriginX);this.touchOriginY&&a!=this.touchOriginY&&(this.tierHolder.scrollTop-=a-this.touchOriginY);this.touchOriginX=d;this.touchOriginY=a}else if(this.zooming&&2==a.touches.length){d=
Math.abs(a.touches[0].pageX-a.touches[1].pageX);if(d!=this.zoomLastSep){a=(a.touches[0].pageX+a.touches[1].pageX)/2;var b=this.viewStart+a/this.scale|0;this.scale=d/this.zoomInitialSep*this.zoomInitialScale;this.viewStart=b-a/this.scale|0;for(a=0;a<this.tiers.length;++a)this.tiers[a].draw()}this.zoomLastSep=d}};p.prototype.touchEndHandler=function(a){};p.prototype.touchCancelHandler=function(a){};p.prototype.makeTier=function(a,d){try{return this.realMakeTier(a,d)}catch(b){console.log("Error initializing",
a),console.log(b.stack||b)}};p.prototype.realMakeTier=function(d,b){var c=this,f=null;this.tierBackgroundColors&&(f=this.tierBackgroundColors[this.tiers.length%this.tierBackgroundColors.length]);var n=new N(this,d,b,f);n.oorigin=this.viewStart;var g=!1,k,m,x,h=function(d,l){var b=n.subtiers;if(b){var f=0;for(l-=n.padding;f<b.length&&l>b[f].height&&f<b.length-1;)l=l-b[f].height-n.padding,++f;if(!(f>=b.length))return b=b[f].glyphs,d-=(n.glyphCacheOrigin-c.viewStart)*c.scale,a(b,d,l)}},e=function(a){a.preventDefault();
a.stopPropagation();a=a.clientX;a!=m&&(c.move(a-m,!0),m=a);c.isDragging=!0},v=function(a){window.removeEventListener("mousemove",e,!0);window.removeEventListener("mouseup",v,!0);c.move(a.clientX-m)};n.viewport.addEventListener("mousedown",function(a){c.browserHolder.focus();a.preventDefault();n.row.getBoundingClientRect();a=a.clientX;window.addEventListener("mousemove",e,!0);window.addEventListener("mouseup",v,!0);k=m=a;c.isDragging=!1},!1);n.viewport.addEventListener("mousemove",function(a){var d=
n.row.getBoundingClientRect(),l=a.clientX-d.left,b=a.clientY-d.top,d=h(l,b);n.row.style.cursor=d&&0<d.length?"pointer":"default";x&&clearTimeout(x);g||(x=setTimeout(function(){var d=h(l,b);d&&0<d.length&&c.notifyFeatureHover(a,d[d.length-1],d,n)},1E3))});var C=null;n.viewport.addEventListener("mouseup",function(a){var d=n.row.getBoundingClientRect(),l=a.clientX-d.left,d=a.clientY-d.top,b=h(l,d);b&&0<b.length&&!c.isDragging&&(C?(clearTimeout(C),C=null,c.featureDoubleClick(b,l,d)):C=setTimeout(function(){C=
null;c.notifyFeature(a,b[b.length-1],b,n)},500));if(c.isDragging&&l!=k&&n.sequenceSource){var d=c.viewStart+l/c.scale,f=c.viewStart+k/c.scale;d<f?(l=d|0,d=f|0):(l=f|0,d|=0);c.notifyRegionSelect(c.chr,l,d)}c.isDragging=!1},!1);n.viewport.addEventListener("mouseout",function(a){g=!1});n.removeButton.addEventListener("click",function(a){a.stopPropagation();a.preventDefault();for(a=0;a<c.tiers.length;++a)if(c.tiers[a]===n){c.removeTier({index:a});break}},!1);n.nameButton.addEventListener("click",function(a){a.stopPropagation();
a.preventDefault();if(a.shiftKey){a=-1;for(var d=0;d<c.tiers.length;++d)if(c.tiers[d]===n){a=d;break}0<=a&&(d=c.selectedTiers.indexOf(a),0<=d?c.selectedTiers.splice(d,1):(c.selectedTiers.push(a),c.selectedTiers.sort()),c.markSelectedTiers(),c.notifyTierSelection(),0<c.selectedTiers.length?c.browserHolder.focus():c.notifyTierSelectionWrap(-1))}else{for(d=0;d<c.tiers.length;++d)if(c.tiers[d]===n&&(c.browserHolder.focus(),1!=c.selectedTiers.length||c.selectedTiers[0]!=d)){c.setSelectedTier(d);return}n.infoVisible?
(n.infoElement.style.display="none",n.updateHeight(),n.infoVisible=!1):(n.infoElement.style.display="block",n.updateHeight(),n.infoVisible=!0)}},!1);n.bumpButton.addEventListener("click",function(a){a.stopPropagation();a.preventDefault();var d;n.dasSource.collapseSuperGroups&&(void 0===d&&(d=!n.bumped),n.mergeConfig({bumped:d}))},!1);var B,y,q,G,u,fa=!1,p=function(a){var d=n.label;a.stopPropagation();a.preventDefault();if(!B){y=n.pinned?c.pinnedTierHolder:c.tierHolder;q=y.scrollHeight-y.offsetHeight;
B=d.cloneNode(!0);B.style.cursor="pointer";y.appendChild(B);d.style.visibility="hidden";for(var l=0;l<c.tiers.length;++l)if(c.tiers[l]===n){G=l;break}u=a.clientY}var b=y.getBoundingClientRect();B.style.left=d.getBoundingClientRect().left-b.left+"px";B.style.top=a.clientY-b.top+y.scrollTop-10+"px";d=a.clientY-b.top+y.scrollTop;for(l=0;l<c.tiers.length;++l)if(b=c.tiers[l],!(b.pinned^n.pinned)&&(b=b.row.getBoundingClientRect(),d-=b.bottom-b.top,0>d)){if(l<G&&a.clientY<u||l>G&&a.clientY>u){c.withPreservedSelection(function(){c.tiers.splice(G,
1);c.tiers.splice(l,0,n);c._ensureTiersGrouped(l>G)});for(d=0;d<c.tiers.length;++d)c.tiers[d]==n&&(G=d);u=a.clientY;c.reorderTiers();y.appendChild(B);fa=!0}break}B.offsetTop<y.scrollTop?y.scrollTop-=y.scrollTop-B.offsetTop:B.offsetTop+B.offsetHeight>y.scrollTop+y.offsetHeight&&(y.scrollTop=Math.min(y.scrollTop+(B.offsetTop+B.offsetHeight)-(y.scrollTop+y.offsetHeight),q))},I=function(a){var d=n.label;a.stopPropagation();a.preventDefault();B&&(B.style.cursor="auto",y.removeChild(B),B=null,d.style.visibility=
"visible");document.removeEventListener("mousemove",p,!1);document.removeEventListener("mouseup",I,!1);if(fa){for(a=0;a<c.tiers.length;++a)if(c.tiers[a]==n){c.setSelectedTier(a);break}c.notifyTier()}};n.label.addEventListener("mousedown",function(a){a.stopPropagation();a.preventDefault();fa=!1;document.addEventListener("mousemove",p,!1);document.addEventListener("mouseup",I,!1)},!1);this.tiers.push(n);n.init();n.currentlyHeight=50;this.updateHeight();n.updateLabel();n.featureSource&&n.featureSource.addActivityListener&&
n.featureSource.addActivityListener(function(a){n.loaderButton.style.display=0<a?"inline-block":"none";c.pingActivity()});this.withPreservedSelection(c._ensureTiersGrouped);n._updateFromConfig();this.reorderTiers();return n};p.prototype.reorderTiers=function(){c(this.tierHolder);c(this.pinnedTierHolder);this.disablePinning&&(this.tierHolder.appendChild(this.ruler),this.tierHolder.appendChild(this.ruler2));for(var a=!1,d=[],b=[],f=0;f<this.tiers.length;++f){var n=this.tiers[f];n.pinned&&!this.disablePinning?
(d.push(n),this.pinnedTierHolder.appendChild(this.tiers[f].row),a=!0):(b.push(n),this.tierHolder.appendChild(this.tiers[f].row))}this.withPreservedSelection(function(){this.tiers.splice(0,this.tiers.length);for(var a=0;a<d.length;++a)this.tiers.push(d[a]);for(a=0;a<b.length;++a)this.tiers.push(b[a])});a?this.pinnedTierHolder.classList.add("tier-holder-pinned-full"):this.pinnedTierHolder.classList.remove("tier-holder-pinned-full");this.arrangeTiers()};p.prototype.withPreservedSelection=function(a){for(var d=
[],b=0;b<this.selectedTiers.length;++b)d.push(this.tiers[this.selectedTiers[b]]);a.call(this);this.selectedTiers=[];for(a=0;a<this.tiers.length;++a)0<=d.indexOf(this.tiers[a])&&this.selectedTiers.push(a)};p.prototype.refreshTier=function(a){this.knownSpace&&this.knownSpace.invalidate(a)};p.prototype._ensureTiersGrouped=function(a){for(var d={},b=0;b<this.tiers.length;++b){var c=this.tiers[b];c.dasSource.tierGroup&&pusho(d,c.dasSource.tierGroup,c)}var n=[];a&&this.tiers.reverse();for(b=0;b<this.tiers.length;++b)if(c=
this.tiers[b],c.dasSource.tierGroup){var f=d[c.dasSource.tierGroup];if(f){a&&f.reverse();for(var g=0;g<f.length;++g)n.push(f[g]);d[c.dasSource.tierGroup]=null}}else n.push(c);a&&n.reverse();this.tiers.splice(0,this.tiers.length);for(g=0;g<n.length;++g)this.tiers.push(n[g])};p.prototype.arrangeTiers=function(){for(var a=[],d={},b=0;b<this.tiers.length;++b){var c=this.tiers[b];c.pinned&&(a.push(c),c.dasSource.tierGroup&&pusho(d,c.dasSource.tierGroup,c))}for(b=0;b<this.tiers.length;++b)c=this.tiers[b],
c.pinned||(a.push(c),c.dasSource.tierGroup&&pusho(d,c.dasSource.tierGroup,c));for(var n in d){var c=d[n],g=this.tierGroups[n];g||(g={element:f("div",f("span",n,{className:"tier-group-label"}),{className:"tier-group"})},this.tierGroups[n]=g);g.element.parentNode&&g.element.parentNode.removeChild(g.element);for(var k=c[0].pinned?this.pinnedTierHolder:this.tierHolder,m=1E7,x=0,b=0;b<c.length;++b)var h=c[b].row,m=Math.min(m,h.offsetTop),x=Math.max(x,h.offsetTop+h.offsetHeight);g.element.style.top=m+"px";
g.element.style.left="0px";g.element.style.height=x-m+"px";k.appendChild(g.element)}if(this.tierBackgroundColors)for(b=0;b<a.length;++b)c=a[b],c.setBackground(this.tierBackgroundColors[b%this.tierBackgroundColors.length]),c.label.style.left=c.dasSource.tierGroup?"18px":"2px",c.background=this.tierBackgroundColors[b%this.tierBackgroundColors.length]};p.prototype.refresh=function(){this.notifyLocation();var a=100/this.scale|0,d=1E3/this.scale|0,b=(this.viewStart+this.viewEnd)/2,c=b-this.origin;this.origin=
b;this.scaleAtLastRedraw=this.scale;for(b=0;b<this.tiers.length;++b){var n=c;this.tiers[b].originHaxx&&(n+=this.tiers[b].originHaxx);this.tiers[b].originHaxx=n}c=this.targetQuantRes/this.scale;b=Math.max(1,(this.viewStart|0)-a);a=Math.min((this.viewEnd|0)+a,0<(this.currentSeqMax|0)?this.currentSeqMax|0:1E9);n=Math.max(1,(this.viewStart|0)-d);d=Math.min((this.viewEnd|0)+d,0<(this.currentSeqMax|0)?this.currentSeqMax|0:1E9);if(!this.knownSpace||this.knownSpace.chr!==this.chr){var f=this.getSequenceSource();
this.knownSpace&&this.knownSpace.cancel();this.knownSpace=new C(this.tiers,this.chr,n,d,c,f)}(f=this.knownSpace.bestCacheOverlapping(this.chr,b,a))&&f.min<=b&&f.max>=a?(this.drawnStart=Math.max(f.min,n),this.drawnEnd=Math.min(f.max,d)):(this.drawnStart=n,this.drawnEnd=d);this.knownSpace.viewFeatures(this.chr,this.drawnStart,this.drawnEnd,c);this.drawOverlays();this.positionRuler()};p.prototype.queryRegistry=function(a,d){var b,c;a?(b=this.chains[a].coords,this.mappableSources[a]||(this.mappableSources[a]=
new k),c=this.mappableSources[a]):(b=this.coordSystem,c=this.availableSources);var n=L(v(b));if(d){var f=localStorage["dalliance.registry."+n+".last_queried"];if(f)try{if(q(c,JSON.parse(localStorage["dalliance.registry."+n+".sources"]),a),432E5>(Date.now()|0)-(f|0))return}catch(g){console.log("Bad registry cache: "+g)}}(new I(this.registry)).sources(function(d){for(var f=[],g=0;g<d.length;++g){var k=d[g];if(k.coords&&0!=k.coords.length){var m=k.coords[0];m.taxon==b.taxon&&m.auth==b.auth&&m.version==
b.version&&f.push(k)}}localStorage["dalliance.registry."+n+".sources"]=JSON.stringify(f);localStorage["dalliance.registry."+n+".last_queried"]=""+Date.now();q(c,f,a)},function(a){},b)};p.prototype.move=function(a,d){var b=this.viewEnd-this.viewStart,c=this.viewStart-1*a/this.scale,n=c+b;d||(0<this.currentSeqMax&&n>this.currentSeqMax&&(n=this.currentSeqMax,c=this.viewEnd-b),1>c&&(c=1,n=c+b));this.setLocation(null,c,n,null,d)};p.prototype.zoomStep=function(a){var d=1*this.zoomSliderValue;a=d+a;a<this.zoomMin&&
(a=this.zoomMin);a>this.zoomMax&&(a=this.zoomMax);a!=d&&(this.zoomSliderValue=a,this.zoom(Math.exp(1*a/this.zoomExpt)))};p.prototype.zoom=function(a){this.zoomFactor=a;a=Math.round((this.viewStart+this.viewEnd)/2)|0;this.viewStart=a-this.zoomBase*this.zoomFactor/2;this.viewEnd=a+this.zoomBase*this.zoomFactor/2;0<this.currentSeqMax&&this.viewEnd>this.currentSeqMax+5&&(a=this.viewEnd-this.viewStart+1,this.viewEnd=this.currentSeqMax,this.viewStart=this.viewEnd-a+1);1>this.viewStart&&(a=this.viewEnd-
this.viewStart+1,this.viewStart=1,this.viewEnd=this.viewStart+a-1);this.scale=this.featurePanelWidth/(this.viewEnd-this.viewStart);this.notifyLocation();this.refresh()};p.prototype.spaceCheck=function(a){this.knownSpace&&this.knownSpace.chr===this.chr?(a=100/this.scale|0,((this.drawnStart|0)>Math.max(1,(this.viewStart|0)-a|0)||(this.drawnEnd|0)<Math.min((this.viewEnd|0)+a,0<(this.currentSeqMax|0)?this.currentSeqMax|0:1E9))&&this.refresh()):this.refresh()};p.prototype.resizeViewer=function(a){var d=
this.tierHolder.getBoundingClientRect().width|0;if(0!=d){var b=Math.max(this.featurePanelWidth,300);this.featurePanelWidth=d|0;b!=this.featurePanelWidth&&(this.zoomMax=this.zoomExpt*Math.log(this.maxViewWidth/this.zoomBase),this.zoomMin=this.zoomExpt*Math.log(this.featurePanelWidth/10/this.zoomBase),this.zoomSliderValue=this.zoomExpt*Math.log((this.viewEnd-this.viewStart+1)/this.zoomBase),this.viewEnd=this.viewStart+(this.viewEnd-this.viewStart)*this.featurePanelWidth/b,d=this.viewEnd-this.viewStart+
1,0<this.currentSeqMax&&this.viewEnd>this.currentSeqMax&&(this.viewEnd=this.currentSeqMax,this.viewStart=this.viewEnd-d+1),1>this.viewStart&&(this.viewStart=1,this.viewEnd=this.viewStart+d-1),this.positionRuler(),a||this.spaceCheck(),this.notifyLocation());this.fullScreen&&this.setFullScreenHeight()}};p.prototype.setFullScreenHeight=function(){this.browserHolder.style.maxHeight=Math.max(300,window.innerHeight-(document.body.offsetHeight-this.browserHolder.offsetHeight)-20)+"px"};p.prototype.addTier=
function(a){a=B(a);a.disabled=!1;a=this.makeTier(a);this.markSelectedTiers();this.positionRuler();this.notifyTier();return a};p.prototype.removeTier=function(a,d){var b=-1;if("undefined"!==typeof a.index&&0<=a.index&&a.index<this.tiers.length)b=a.index;else for(var c=0;c<this.tiers.length;++c)if(z(a,this.tiers[c].dasSource)){b=c;break}if(0>b)throw"Couldn't find requested tier";this.tiers.splice(b,1);for(var c=[],n=0;n<this.selectedTiers.length;++n){var f=this.selectedTiers[n];f<b?c.push(f):f>b&&c.push(f-
1)}this.selectedTiers=c;this.markSelectedTiers();this.reorderTiers();this.notifyTier()};p.prototype.getSequenceSource=function(){void 0===this._sequenceSource&&(this._sequenceSource=this._getSequenceSource());return this._sequenceSource};p.prototype._getSequenceSource=function(){for(var a=0;a<this.tiers.length;++a)if(this.tiers[a].sequenceSource)return this.tiers[a].sequenceSource;for(a=0;a<this.defaultSources.length;++a){var b=this.defaultSources[a];if(b.provides_entrypoints||"sequence"==b.tier_type||
b.twoBitURI||b.twoBitBlob)return b.twoBitURI||b.twoBitBlob?new d(b):new x(b)}};p.prototype.setLocation=function(a,d,b,c,n){if("number"!==typeof d)throw Error("minimum must be a number (got "+JSON.stringify(d)+")");if("number"!==typeof b)throw Error("maximum must be a number (got "+JSON.stringify(b)+")");c||(c=function(a){if(a)throw a;});var f=this;if((!a||a==this.chr)&&0<this.currentSeqMax)return this._setLocation(null,d,b,null,c,n);var g=this.getSequenceSource();if(!g)return c("Need a sequence source");
g.getSeqInfo(a,function(k){if(k)return f._setLocation(a,d,b,k,c,n);var m;m=0==a.indexOf("chr")?a.substr(3):"chr"+a;g.getSeqInfo(m,function(g){return g?f._setLocation(m,d,b,g,c,n):c("Couldn't find sequence '"+a+"'")})})};p.prototype._setLocation=function(a,d,b,c,n,f){var g=!1;a&&(0==a.indexOf("chr")&&(a=a.substring(3)),this.chr!=a&&(g=!0),this.chr=a,this.currentSeqMax=c.length);d=parseFloat(d);b=parseFloat(b);a=Math.max(10,b-d+1);f||(1>d&&(d=1,b=d+a-1),b>this.currentSeqMax&&(b=this.currentSeqMax,d=
Math.max(1,b-a+1)));this.viewStart=d;this.viewEnd=b;d=Math.max(this.featurePanelWidth,50)/(this.viewEnd-this.viewStart);f=1E-4<Math.abs(d-this.scale);this.scale=d;b=this.zoomSliderValue;this.zoomSliderValue=d=this.zoomExpt*Math.log((this.viewEnd-this.viewStart+1)/this.zoomBase);if(f||g){for(g=0;g<this.tiers.length;++g)this.tiers[g].viewportHolder.style.left="5000px",this.tiers[g].overlay.style.left="5000px";this.refresh();this.savedZoom?(d-=this.zoomMin,b-=this.zoomMin,g=d-this.savedZoom,Math.abs(d-
b)>Math.abs(g)&&(this.isSnapZooming=!this.isSnapZooming,this.savedZoom=b)):(this.isSnapZooming=!1,this.savedZoom=null)}else for(g=0;g<this.tiers.length;++g)this.tiers[g].viewportHolder.style.left=""+((-((this.viewStart-this.tiers[g].norigin)*this.scale)|0)-1E3)+"px",this.tiers[g].drawOverlay();this.notifyLocation();this.spaceCheck();this.instrumentActivity&&(this.activityStartTime=Date.now()|0);return n()};p.prototype.pingActivity=function(){if(this.instrumentActivity&&this.activityStartTime){for(var a=
0,d=0;d<this.tiers.length;++d)"none"!==this.tiers[d].loaderButton.style.display&&++a;0==a&&(a=Date.now()|0,console.log("Loading took "+(a-this.activityStartTime)+"ms"),this.activityStartTime=null)}};p.prototype.addInitListener=function(a){this.initListeners.push(a)};p.prototype.addFeatureListener=function(a,d){this.featureListeners.push(a)};p.prototype.notifyFeature=function(a,d,b,c){for(var n=0;n<this.featureListeners.length;++n)try{if(this.featureListeners[n](a,d,b,c))break}catch(f){console.log(f.stack)}};
p.prototype.addFeatureHoverListener=function(a,d){this.featureHoverListeners.push(a)};p.prototype.notifyFeatureHover=function(a,d,b,c){for(var n=0;n<this.featureHoverListeners.length;++n)try{this.featureHoverListeners[n](a,d,b,c)}catch(f){console.log(f.stack)}};p.prototype.addViewListener=function(a,d){this.viewListeners.push(a)};p.prototype.notifyLocation=function(){var a=Math.max(1,this.viewStart|0),d=this.viewEnd|0;0<this.currentSeqMax&&d>this.currentSeqMax&&(d=this.currentSeqMax);for(var b=0;b<
this.viewListeners.length;++b)try{this.viewListeners[b](this.chr,a,d,this.zoomSliderValue,{current:this.zoomSliderValue,alternate:this.savedZoom+this.zoomMin||this.zoomMin,isSnapZooming:this.isSnapZooming,min:this.zoomMin,max:this.zoomMax},this.viewStart,this.viewEnd)}catch(c){console.log(c.stack)}};p.prototype.addTierListener=function(a){this.tierListeners.push(a)};p.prototype.notifyTier=function(){for(var a=0;a<this.tierListeners.length;++a)try{this.tierListeners[a]()}catch(d){console.log(d.stack)}};
p.prototype.addRegionSelectListener=function(a){this.regionSelectListeners.push(a)};p.prototype.notifyRegionSelect=function(a,d,b){for(var c=0;c<this.regionSelectListeners.length;++c)try{this.regionSelectListeners[c](a,d,b)}catch(n){console.log(n.stack)}};p.prototype.highlightRegion=function(a,d,b){var c=this;if(a==this.chr)return this._highlightRegion(a,d,b);var n=this.getSequenceSource();if(!n)throw"Need a sequence source";n.getSeqInfo(a,function(f){if(f)return c._highlightRegion(a,d,b);var g;g=
0==a.indexOf("chr")?a.substr(3):"chr"+a;n.getSeqInfo(g,function(a){if(a)return c._highlightRegion(g,d,b)})})};p.prototype._highlightRegion=function(a,d,b){for(var c=0;c<this.highlights.length;++c){var n=this.highlights[c];if(n.chr==a&&n.min==d&&n.max==b)return}this.highlights.push(new r(a,d,b));c=this.viewStart-1E3/this.scale;n=this.viewEnd+1E3/this.scale;(a==this.chr||a=="chr"+this.chr)&&d<n&&b>c&&this.drawOverlays();this.notifyLocation()};p.prototype.clearHighlights=function(){this.highlights=[];
this.drawOverlays();this.notifyLocation()};p.prototype.drawOverlays=function(){for(var a=0;a<this.tiers.length;++a)this.tiers[a].drawOverlay()};p.prototype.featuresInRegion=function(a,d,b){var c=[];if(a!==this.chr)return[];for(a=0;a<this.tiers.length;++a)for(var n=this.tiers[a].currentFeatures||[],f=0;f<n.length;++f){var g=n[f];g.min<=b&&g.max>=d&&c.push(g)}return c};p.prototype.getSelectedTier=function(){return 0<this.selectedTiers.length?this.selectedTiers[0]:-1};p.prototype.setSelectedTier=function(a){this.selectedTiers=
null==a?[]:[a];this.markSelectedTiers();this.notifyTierSelection()};p.prototype.markSelectedTiers=function(){for(var a=0;a<this.tiers.length;++a){var d=this.tiers[a].nameButton;0<=this.selectedTiers.indexOf(a)?d.classList.add("active"):d.classList.remove("active")}0<this.selectedTiers.length&&(a=this.browserHolder.offsetTop+this.browserHolder.offsetHeight/2,a>document.body.scrollTop&&a+100<document.body.scrollTop+window.innerHeight&&this.browserHolder.focus())};p.prototype.addTierSelectionListener=
function(a){this.tierSelectionListeners.push(a)};p.prototype.notifyTierSelection=function(){for(var a=0;a<this.tierSelectionListeners.length;++a)try{this.tierSelectionListeners[a](this.selectedTiers)}catch(d){console.log(d.stack)}};p.prototype.addTierSelectionWrapListener=function(a){this.tierSelectionWrapListeners.push(a)};p.prototype.notifyTierSelectionWrap=function(a){for(var d=0;d<this.tierSelectionWrapListeners.length;++d)try{this.tierSelectionWrapListeners[d](a)}catch(b){console.log(b.stack)}};
p.prototype.positionRuler=function(){var a="none",d="",b="";"center"==this.rulerLocation?(a="block",d=""+(this.featurePanelWidth/2|0)+"px"):"left"==this.rulerLocation?(a="block",d="0px"):"right"==this.rulerLocation?(a="block",b="0px"):a="none";this.ruler.style.display=a;this.ruler.style.left=d;this.ruler.style.right=b;this.singleBaseHighlight?(this.ruler2.style.display="block",this.ruler2.style.borderWidth="1px",1>this.scale?(this.ruler2.style.width="0px",this.ruler2.style.borderRightWidth="0px"):
(this.ruler2.style.width=this.scale+"px",this.ruler2.style.borderRightWidth="1px"),this.locSingleBase.style.visibility="visible",this.locSingleBase.style.left=""+(this.featurePanelWidth/2-this.locSingleBase.offsetWidth/2+this.ruler2.offsetWidth/2|0)+"px"):(this.locSingleBase.style.visibility="hidden",this.ruler2.style.width="1px",this.ruler2.style.borderWidth="0px",this.ruler2.style.display="center"==this.rulerLocation?"none":"block");this.ruler2.style.left=""+(this.featurePanelWidth/2|0)+"px";for(var c=
0;c<this.tiers.length;++c){var n=this.tiers[c],f=n.quantOverlay,g;n.subtiers&&0<n.subtiers.length&&(g=n.subtiers[0].quant);f&&(f.style.display=g?a:"none",f.style.left=d,f.style.right=b)}};p.prototype.featureDoubleClick=function(a,d,b){if(a&&0!=a.length&&(b=a[a.length-1],b.min&&b.max)){var c=((b.min|0)-(this.viewStart|0))*this.scale,n=(b.max-b.min+1)*this.scale;a=((b.min|0)+(b.max|0))/2;10<n&&(d=1*(d-c)/n,0.3>d?a=b.min|0:0.7<d&&(a=(b.max|0)+1));d=this.viewEnd-this.viewStart;this.setLocation(null,a-
d/2,a+d/2)}};p.prototype.zoomForScale=function(a){return 0.2<a?"high":0.01<a?"medium":"low"};p.prototype.zoomForCurrentScale=function(){return this.zoomForScale(this.scale)};p.prototype.updateHeight=function(){for(var a=0,d=0;d<this.tiers.length;++d)a+=this.tiers[d].currentHeight||30;this.ruler.style.height=""+a+"px";this.ruler2.style.height=""+a+"px";this.browserHolder.style.display="block";this.browserHolder.style.display="flex"};p.prototype.scrollArrowKey=function(a,d){this.reverseKeyScrolling&&
(d=-d);if(a.ctrlKey||a.metaKey){var b=!1;a.shiftKey&&(b=!0);this.leap(d,b)}else if(1<this.scale){var b=(this.viewStart+this.viewEnd)/2,b=b-Math.round(b),c=1;a.shiftKey&&(c*=10);0<d?(c=-c-b,0<b&&(c+=1)):(c-=b,0>b&&(c-=1));this.setLocation(null,this.viewStart+c,this.viewEnd+c)}else this.move(a.shiftKey?100*d:25*d)};p.prototype.leap=function(a,d){var b=this,c=(b.viewStart+b.viewEnd+1)/2|0;0<a&&1>=b.viewStart?c-=1E8:0>a&&b.viewEnd>=b.currentSeqMax&&(c+=1E8);var n=b.getSelectedTier();0>n||((n=b.tiers[n])&&
(n.featureSource&&this.sourceAdapterIsCapable(n.featureSource,"quantLeap")&&"number"==typeof n.quantLeapThreshold||n.featureSource&&this.sourceAdapterIsCapable(n.featureSource,"leap"))?n.findNextFeature(b.chr,c,-a,d,function(n){if(n){var f=n.min,g=n.max;d&&(0<a?f>c+1?g=f:(g++,f=g):g<c-1?(g++,f=g):g=f);var k=b.viewEnd-b.viewStart+1;parseFloat(k/2)==parseInt(k/2)&&k--;f=(f+g-k)/2+1;b.setLocation(n.segment,f,f+k-1)}else alert("no next feature")}):this.move(100*a))};p.prototype.nameForCoordSystem=function(a){var d=
null,b=null;this.assemblyNamePrimary&&(d=""+a.auth,"undefined"!==typeof a.version&&(d+=a.version));this.assemblyNameUcsc&&(b=a.ucscName);return null!=d&&null!=b?d+"/"+b:d||b||"unknown"};p.prototype.makeLoader=function(a){var d=1<window.devicePixelRatio;return 20>(a||16)?f("img",null,{src:this.resolveURL("$$img/spinner_"+(d?16:32)+".gif"),width:"16",height:"16"}):f("img",null,{src:this.resolveURL("$$img/spinner_"+(d?24:48)+".gif"),width:"24",height:"24"})};p.prototype.getWorker=function(){if(!this.useFetchWorkers||
!this.fetchWorkers||0==this.fetchWorkers.length)return null;this.nextWorker>=this.fetchWorkers.length&&(this.nextWorker=0);return this.fetchWorkers[this.nextWorker++]};b.prototype.postCommand=function(a,d,b){var c="x"+ ++this.tagSeed;a.tag=c;this.callbacks[c]=d;this.worker.postMessage(a,b)};if("undefined"!==typeof t){t.exports={Browser:p,sourcesAreEqual:z,sourceDataURI:h};e("./browser-ui");e("./track-adder");e("./feature-popup");e("./tier-actions");e("./domui");e("./search");t=e("./sourceadapters");
var d=t.TwoBitSequenceSource,x=t.DASSequenceSource,C=e("./kspace").KnownSpace,I=e("./das").DASRegistry}g.prototype.get=function(a){var d=this.sourcesByURI[h(a)];if(d)for(var b=0;b<d.configs.length;++b)if(u(d.configs[b],a))return d.sources[b]};g.prototype.put=function(a,d){var b=h(a),c=this.sourcesByURI[b];c||(c={configs:[],sources:[]},this.sourcesByURI[b]=c);c.configs.push(a);c.sources.push(d)}},{"./browser-ui":5,"./chainset":7,"./das":10,"./domui":11,"./feature-popup":18,"./kspace":22,"./numformats":25,
"./search":29,"./sha1":32,"./sourceadapters":33,"./thub":40,"./tier":43,"./tier-actions":41,"./track-adder":44,"./utils":47,"./version":49,"es6-promise":51}],7:[function(e,t,s){function r(a,b,c,f){"string"==typeof a?(this.uri=a,this.srcTag=b,this.destTag=c,this.coords=f):(this.uri=a.uri,this.srcTag=a.srcTag,this.destTag=a.destTag,this.coords=g(a.coords),this.type=a.type,this.credentials=a.credentials);this.chainsBySrc={};this.chainsByDest={};this.postFetchQueues={};this.fetchedTiles={};this.granularity=
1E6;this.chainFetcher="bigbed"==this.type?new q(this.uri,this.credentials):"alias"==this.type?new z(a):new p(this.uri,this.srcTag,this.destTag)}function p(b,c,f){this.source=new a(b);this.srcTag=c;this.destTag=f}function q(a,b){var g=this;this.uri=a;this.credentials=b;this.bwg=new v(function(a,b){c(new f(g.uri,{credentials:g.credentials}),function(c,f){c?a(c):b(f)})});this.bwg.then(function(a,b){b&&console.log(b)})}function h(a){return parseInt(a)}function w(a){return 0==a.indexOf("chr")?a.substr(3):
a}function u(a){var b={srcChr:w(a.srcChrom),srcMin:parseInt(a.srcStart),srcMax:parseInt(a.srcEnd),srcOri:a.srcOri,destChr:w(a.segment),destMin:a.min-1,destMax:a.max,destOri:a.ori,blocks:[]},c=a.srcStarts.split(",").map(h),f=a.destStarts.split(",").map(h);a=a.blockLens.split(",").map(h);for(var g=0;g<c.length;++g)b.blocks.push([c[g],f[g],a[g]]);return b}function z(a){this.conf=a;this.forwardAliases={};a=a.sequenceAliases||[];for(var b=0;b<a.length;++b){var c=a[b];if(!(2>c.length)){for(var f=[],g=0;g<
c.length-1;++g)f.push(c[g]);this.forwardAliases[c[c.length-1]]=f}}}if("undefined"!==typeof e){s=e("./das");var a=s.DASSource,b=s.DASSegment;s=e("./utils");var m=s.pusho,g=s.shallowCopy,k=e("./cigar").parseCigar,f=e("./bin").URLFetchable,c=e("./bigwig").makeBwg,v=e("es6-promise").Promise}r.prototype.exportConfig=function(){return{uri:this.uri,srcTag:this.srcTag,destTag:this.destTag,coords:this.coords,type:this.type,credentials:this.credentials}};r.prototype.mapPoint=function(a,b){for(var c=this.chainsBySrc[a]||
[],f=0;f<c.length;++f){var g=c[f];if(b>=g.srcMin&&b<=g.srcMax){var k;k="-"==g.srcOri?g.srcMax-b:b-g.srcMin;for(var m=g.blocks,h=0;h<m.length;++h){var e=m[h],d=e[0],x=e[1],e=e[2];if(k>=d&&k<=d+e)return c=k-d,{seq:g.destChr,pos:"-"==g.destOri?g.destMax-x-c:c+x+g.destMin,flipped:g.srcOri!=g.destOri}}}}return null};r.prototype.mapSegment=function(a,b,c){a=this.chainsBySrc[a]||[];for(var f=[],g=0;g<a.length;++g){var k=a[g];if(c>=k.srcMin&&b<=k.srcMax){var m,h;"-"==k.srcOri?(m=k.srcMax-c,h=k.srcMax-b):
(m=b-k.srcMin,h=c-k.srcMin);for(var e=k.blocks,d=0;d<e.length;++d){var x=e[d],v=x[0],q=x[1],x=x[2];if(h>=v&&m<=v+x){var l={segment:k.destChr,flipped:"-"==k.srcOri^"-"==k.destOri};"-"==k.destOri?(m>=v?l.max=k.destMax-q-m+v:(l.max=k.destMax-q,l.partialMax=v-m),h<=v+x?l.min=k.destMax-q-h+v:(l.min=k.destMax-q-x,l.partialMin=h-v-x)):(m>=v?l.min=k.destMin+q+m-v:(l.min=k.destMin+q,l.partialMin=v-m),h<=v+x?l.max=k.destMin+q+h-v:(l.max=k.destMin+q+x,l.partialMax=h-v-x));f.push(l)}}}}return f};r.prototype.unmapPoint=
function(a,b){for(var c=this.chainsByDest[a]||[],f=0;f<c.length;++f){var g=c[f];if(b>=g.destMin&&b<=g.destMax){var k;k="-"==g.srcOri?g.destMax-b:b-g.destMin;for(var m=g.blocks,h=0;h<m.length;++h){var e=m[h],d=e[0],x=e[1],e=e[2];if(k>=x&&k<=x+e)return c=k-x,f=c+d+g.srcMin,f="-"==g.destOri?g.srcMax-d-c:c+d+g.srcMin,{seq:g.srcChr,pos:f,flipped:g.srcOri!=g.destOri}}}}return null};r.prototype.sourceBlocksForRange=function(a,c,f,g){for(var k=this,h=c/this.granularity|0,e=f/this.granularity|0,v=!1,q=h;q<=
e;++q){var d=a+"_"+q;this.fetchedTiles[d]||(v=!0,this.fetchedTiles[d]=!0)}if(v)this.postFetchQueues[a]||this.chainFetcher.fetchChains(a,h*this.granularity,(e+1)*this.granularity-1).then(function(d){k.chainsByDest||(k.chainsByDest[a]=[]);for(var b=0;b<d.length;++b){var c=d[b],f=k.chainsBySrc[c.srcChr];if(f){for(var l=!1,g=0;g<f.length;++g){var m=f[g];if(m.srcMin==c.srcMin&&m.srcMax==c.srcMax){l=!0;break}}l||f.push(c)}else k.chainsBySrc[c.srcChr]=[c];if(f=k.chainsByDest[c.destChr]){l=!1;for(g=0;g<f.length;++g)if(m=
f[g],m.destMin==c.destMin&&m.destMax==c.destMax){l=!0;break}l||f.push(c)}else k.chainsByDest[c.destChr]=[c]}if(k.postFetchQueues[a]){d=k.postFetchQueues[a];for(b=0;b<d.length;++b)d[b]();k.postFetchQueues[a]=null}}),m(this.postFetchQueues,a,function(){k.sourceBlocksForRange(a,c,f,g)});else{h=[];e=this.chainsByDest[a]||[];for(v=0;v<e.length;++v)if(q=e[v],c<=q.destMax&&f>=q.destMin){var x;"-"==q.srcOri?(d=q.destMax-f,x=q.destMax-c):(d=c-q.destMin,x=f-q.destMin);for(var C=q.blocks,u=0;u<C.length;++u){var l=
C[u],p=l[0],r=l[1],A=l[2];x>=r&&d<=r+A&&(l=Math.max(d,r)-r,r=Math.min(x,r+A)-r,"-"==q.destOri?h.push(new b(q.srcChr,q.srcMax-p-r,q.srcMax-p-l)):h.push(new b(q.srcChr,q.srcMin+l+p,q.srcMin+r+p)))}}g(h)}};p.prototype.fetchChains=function(a,b,c){var f=this;return new v(function(b,c){f.source.alignments(a,{},function(a){for(var c=[],g=0;g<a.length;++g)for(var d=a[g],m=0;m<d.blocks.length;++m){for(var h=d.blocks[m],e,l,v=0;v<h.segments.length;++v){var q=h.segments[v],u=d.objects[q.object];u.dbSource===
f.srcTag?e=q:u.dbSource===f.destTag&&(l=q)}if(e&&l){for(var h={srcChr:d.objects[e.object].accession,srcMin:e.min|0,srcMax:e.max|0,srcOri:e.strand,destChr:d.objects[l.object].accession,destMin:l.min|0,destMax:l.max|0,destOri:l.strand,blocks:[]},v=k(e.cigar),q=k(l.cigar),n=u=0,M=0,p=0;M<v.length&&p<q.length;)if("M"==v[M].op&&"M"==q[p].op){var B=Math.min(v[M].cnt,q[p].cnt);h.blocks.push([u,n,B]);v[M].cnt==B?++M:v[M].cnt-=B;q[p].cnt==B?++p:q[p]-=B;u+=B;n+=B}else"I"==v[M].op?n+=v[M++].cnt:"I"==q[p].op&&
(u+=q[p++].cnt);c.push(h)}}b(c)})})};q.prototype.fetchChains=function(a,b,c){return this.bwg.then(function(f,g){if(!f)throw Error("No BWG");return new v(function(g,k){f.getUnzoomedView().readWigData(a,b,c,function(a){g(a.map(u))})})})};z.prototype.fetchChains=function(a,b,c){b=[];c=this.forwardAliases[a]||[];for(var f=0;f<c.length;++f)b.push({srcChr:c[f],srcMin:1,srcMax:1E9,srcOri:"+",destChr:a,destMin:1,destMax:1E9,destOri:"+",blocks:[[1,1,1E9]]});return v.resolve(b)};"undefined"!==typeof t&&(t.exports=
{Chainset:r})},{"./bigwig":3,"./bin":4,"./cigar":8,"./das":10,"./utils":47,"es6-promise":51}],8:[function(e,t,s){function r(e){for(var h=[],r;null!=(r=p.exec(e));){var u=r[1];0==u.length&&(u=1);h.push({cnt:u|0,op:r[2]})}return h}var p=/([0-9]*)([MIDS])/g;"undefined"!==typeof t&&(t.exports={parseCigar:r})},{}],9:[function(e,t,s){function r(a,m,g,k){this.red=a|0;this.green=m|0;this.blue=g|0;k&&(this.name=k)}function p(a){a="00"+a.toString(16);return a.substring(a.length-2)}function q(b){var m=u[b];
m||((m=z.exec(b))?m=new r("0x"+m[1]|0,"0x"+m[2]|0,"0x"+m[3]|0,b):(m=a.exec(b))?m=new r(m[1]|0,m[2]|0,m[3]|0,b):(console.log("couldn't handle color: "+b),m=u.black),u[b]=m);return m}function h(a,m,g){for(var k=[],f=0;f<g.length;++f)k.push(q(g[f]));g=[];f=0;a:for(;f<a;++f){for(var c=m[0]+1*f/(a-1)*(m[m.length-1]-m[0]),h=0;h<m.length-1;++h)if(c>=m[h]&&c<=m[h+1]){var c=(c-m[h])/(m[h+1]-m[h]),e=k[h],h=k[h+1],h=(new r(e.red*(1-c)+h.red*c|0,e.green*(1-c)+h.green*c|0,e.blue*(1-c)+h.blue*c|0)).toSvgString();
g.push(h);continue a}throw"Bad step";}return g}function w(a,m,g,k){return k?h(a,[0,0.5,1],[m,g,k]):h(a,[0,1],[m,g])}r.prototype.toSvgString=function(){this.name||(this.name="rgb("+this.red+","+this.green+","+this.blue+")");return this.name};r.prototype.toHexString=function(){return"#"+p(this.red)+p(this.green)+p(this.blue)};var u={red:new r(255,0,0,"red"),green:new r(0,255,0,"green"),blue:new r(0,0,255,"blue"),yellow:new r(255,255,0,"yellow"),white:new r(255,255,255,"white"),black:new r(0,0,0,"black"),
gray:new r(180,180,180,"gray"),grey:new r(180,180,180,"grey"),lightskyblue:new r(135,206,250,"lightskyblue"),lightsalmon:new r(255,160,122,"lightsalmon"),hotpink:new r(255,105,180,"hotpink")},z=/^#([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})$/,a=/rgb\(([0-9]+),([0-9]+),([0-9]+)\)/;"undefined"!==typeof t&&(t.exports={makeColourSteps:h,makeGradient:w,dasColourForName:q})},{}],10:[function(e,t,s){function r(a,b,d,c){this.name=a;this.start=b;this.end=d;this.description=c}function p(a,b){var d;"string"==
typeof a?(this.uri=a,d=b||{}):d=a||{};for(var c in d)"function"!=typeof d[c]&&(this[c]=d[c]);this.coords||(this.coords=[]);this.props||(this.props={});(this.dasBaseURI=this.uri)&&"/"!=this.dasBaseURI.substr(this.uri.length-1)&&(this.dasBaseURI+="/")}function q(){}function h(a,b){return a.taxon==b.taxon&&a.auth==b.auth&&a.version==b.version}function w(a,b,d,c,f){this.name=a;this.start=b;this.end=d;this.alphabet=c;this.seq=f}function u(){}function z(a){a&&(this.id=a)}function a(a,b){this.desc=a;this.uri=
b}function b(a){this.type=a;this.objects={};this.blocks=[]}function m(){this.styles=[]}function g(){}function k(a,b){b=b||{};this.uri=a;this.opts=b}function f(a,b){var d=a.getElementsByTagName(b);if(0<d.length&&d[0].firstChild){d=d[0];if(1==d.childNodes.length)return d.firstChild.nodeValue;for(var c="",f=0;f<d.childNodes.length;++f)c+=d.childNodes[f].nodeValue;return c}return null}function c(b){for(var c=[],d=b.getElementsByTagName("LINK"),f=0;f<d.length;++f){var g=d[f];g.parentNode==b&&c.push(new a(g.firstChild?
g.firstChild.nodeValue:"Unknown",g.getAttribute("href")))}return c}function v(a){var b=[];a=a.getElementsByTagName("NOTE");for(var d=0;d<a.length;++d)a[d].firstChild&&b.push(a[d].firstChild.nodeValue);return b}function B(a,b,d,c){if(window.XDomainRequest){var f=new XDomainRequest;f.onload=function(){var a=new ActiveXObject("Microsoft.XMLDOM");a.async=!1;a.loadXML(f.responseText);b(a)};f.open("get",a)}else Date.now(),f=new XMLHttpRequest,f.onreadystatechange=function(){4==f.readyState&&(200<=f.status||
0==f.status)&&b(f.responseXML,f)},f.open("get",a,!0),d&&(f.withCredentials=!0),c&&f.setRequestHeader("X-DAS-Authorisation",c),f.overrideMimeType("text/xml"),f.setRequestHeader("Accept","application/xml,*/*");f.send("")}function N(a){a=(""+a).toLowerCase();return"yes"===a||"true"===a}function L(a){if(!a)return!1;a=(""+a).toLowerCase();return"no"!==a||"false"!==a}function O(a){var b=y(a);b.styles=[];for(var d=0;d<a.styles.length;++d){var c=b.styles[d]=y(a.styles[d]);c._methodRE=c._labelRE=c._typeRE=
void 0;c.style=y(c.style);c.style.id=void 0;c.style._gradient=void 0}return b}if("undefined"!==typeof e){s=e("./utils");var y=s.shallowCopy,J=s.pusho,F=e("./color").makeColourSteps}r.prototype.toString=function(){return this.name+":"+this.start+".."+this.end};r.prototype.isBounded=function(){return this.start&&this.end};r.prototype.toDASQuery=function(){var a="segment="+this.name;this.start&&this.end&&(a+=":"+this.start+","+this.end);return a};p.prototype.entryPoints=function(a){this.doCrossDomainRequest(this.dasBaseURI+
"entry_points",function(b){if(!b)return a([]);var d=[];b=b.getElementsByTagName("SEGMENT");for(var c=0;c<b.length;++c){var f=b[c],g=f.getAttribute("id"),l=f.getAttribute("size"),k;l?(k=1,l|=0):((k=f.getAttribute("start"))&&(k|=0),(l=f.getAttribute("stop"))&&(l|=0));var m=null;f.firstChild&&(m=f.firstChild.nodeValue);d.push(new r(g,k,l,m))}a(d)})};p.prototype.sequence=function(a,b){var d=this.dasBaseURI+"sequence?"+a.toDASQuery();this.doCrossDomainRequest(d,function(a){if(a){var d=[];a=a.getElementsByTagName("SEQUENCE");
for(var c=0;c<a.length;++c){var f=a[c],g=f.getAttribute("id"),k=f.getAttribute("start"),m=f.getAttribute("stop"),n=null;if(f.firstChild)for(var f=f.firstChild.nodeValue,n="",h=0;;){var e=f.indexOf("\n",h);if(0<=e)n+=f.substring(h,e).toUpperCase(),h=e+1;else{n+=f.substring(h).toUpperCase();break}}d.push(new w(g,k,m,"DNA",n))}b(d)}else b([])})};p.prototype.features=function(a,b,d){b=b||{};var g;if(this.features_uri)g=this.features_uri;else{var k=[];if(a)k.push(a.toDASQuery());else if(b.group)if(a=b.group,
"string"==typeof a)k.push("group_id="+a);else for(var m=0;m<a.length;++m)k.push("group_id="+a[m]);if(b.adjacent)for(a=b.adjacent,"string"==typeof a&&(a=[a]),m=0;m<a.length;++m)k.push("adjacent="+a[m]);if(b.type)if("string"==typeof b.type)k.push("type="+b.type);else for(a=0;a<b.type.length;++a)k.push("type="+b.type[a]);b.maxbins&&k.push("maxbins="+b.maxbins);0<k.length?g=this.dasBaseURI+"features?"+k.join(";"):d([],"No filters specified")}this.doCrossDomainRequest(g,function(a,b){if(a){for(var g=[],
k={},n=a.getElementsByTagName("SEGMENT"),m=0;m<n.length;++m){var h=n[m],e=h.getAttribute("id");k[e]={min:h.getAttribute("start"),max:h.getAttribute("stop")};for(var h=h.getElementsByTagName("FEATURE"),x=0;x<h.length;++x){var q=h[x],p=new u;p.segment=e;p.id=q.getAttribute("id");p.label=q.getAttribute("label");var C=f(q,"START"),B=f(q,"END");(C|0)>(B|0)?(p.min=B|0,p.max=C|0):(p.min=C|0,p.max=B|0);C=q.getElementsByTagName("TYPE");0<C.length&&(C=C[0],C.firstChild&&(p.type=C.firstChild.nodeValue),p.typeId=
C.getAttribute("id"),p.typeCv=C.getAttribute("cvId"));p.type=f(q,"TYPE");!p.type&&p.typeId&&(p.type=p.typeId);p.method=f(q,"METHOD");(C=f(q,"ORIENTATION"))||(C="0");p.orientation=C;p.score=f(q,"SCORE");p.links=c(q);p.notes=v(q);C=q.getElementsByTagName("GROUP");for(B=0;B<C.length;++B){var r=C[B],y=new z;y.type=r.getAttribute("type");y.id=r.getAttribute("id");y.links=c(r);y.notes=v(r);p.groups?p.groups.push(y):p.groups=Array(y)}if(p.notes)for(C=0;C<p.notes.length;++C)B=p.notes[C],0==B.indexOf("Genename=")&&
(r=new z,r.type="gene",r.id=B.substring(9),p.groups?p.groups.push(r):p.groups=Array(r));C=q.getElementsByTagName("PART");if(0<C.length){r=[];for(B=0;B<C.length;++B)r.push(C[B].getAttribute("id"));p.parts=r}C=q.getElementsByTagName("PARENT");if(0<C.length){q=[];for(B=0;B<C.length;++B)q.push(C[B].getAttribute("id"));p.parents=q}g.push(p)}}d(g,void 0,k)}else d([],"Failed request: "+(0==b.status?"server may not support CORS":"status="+b.status))},function(a){d([],a)})};p.prototype.alignments=function(a,
c,d){var g=this.dasBaseURI+"alignment?query="+a;this.doCrossDomainRequest(g,function(a){if(a){var c=[];a=a.getElementsByTagName("alignment");for(var l=0;l<a.length;++l){for(var k=a[l],m=new b(k.getAttribute("alignType")),h=k.getElementsByTagName("alignObject"),n=0;n<h.length;++n){var e=h[n],e={id:e.getAttribute("intObjectId"),accession:e.getAttribute("dbAccessionId"),version:e.getAttribute("objectVersion"),dbSource:e.getAttribute("dbSource"),dbVersion:e.getAttribute("dbVersion")};m.objects[e.id]=
e}k=k.getElementsByTagName("block");for(h=0;h<k.length;++h){for(var e=k[h],n={order:e.getAttribute("blockOrder"),segments:[]},e=e.getElementsByTagName("segment"),v=0;v<e.length;++v){var q=e[v],q={object:q.getAttribute("intObjectId"),min:q.getAttribute("start"),max:q.getAttribute("end"),strand:q.getAttribute("strand"),cigar:f(q,"cigar")};n.segments.push(q)}m.blocks.push(n)}c.push(m)}d(c)}else d([],"Failed request "+g)})};m.prototype.pushStyle=function(a,b,d){a||(a={type:"default"});a=y(a);b&&(a.zoom=
b);a.style=d;this.styles.push(a)};p.prototype.stylesheet=function(a,b){var d,c=this.credentials;this.stylesheet_uri?(d=this.stylesheet_uri,c=!1):d=this.dasBaseURI+"stylesheet";B(d,function(d){if(d){var c=new m;d=d.getElementsByTagName("TYPE");for(var f=0;f<d.length;++f){var k=d[f],h={};h.type=k.getAttribute("id");h.label=k.getAttribute("label");h.method=k.getAttribute("method");for(var k=k.getElementsByTagName("GLYPH"),e=0;e<k.length;++e){var n=k[e],v=n.getAttribute("zoom"),x;a:{if(n.hasChildNodes()){n=
n.firstChild;do{if(n.nodeType==Node.ELEMENT_NODE){x=n;break a}n=n.nextSibling}while(null!=n)}x=null}n=new g;n.glyph=x.localName;for(x=x.firstChild;x;){if(x.nodeType==Node.ELEMENT_NODE)if("BGGRAD"==x.localName){var q=n,p=x.localName,u,B=x;u=(u=B.getAttribute("steps"))?u|0:50;for(var r=[],y=[],B=B.getElementsByTagName("STOP"),z=0;z<B.length;++z){var O=B[z];r.push(1*O.getAttribute("score"));y.push(O.firstChild.nodeValue)}u=F(u,r,y);q[p]=u}else n[x.localName]=x.firstChild.nodeValue;x=x.nextSibling}c.pushStyle(h,
v,n)}}a(c)}else b&&b()},c)};k.prototype.sources=function(a,b,d){d||(d={});var c=[];d.taxon&&c.push("organism="+d.taxon);d.auth&&c.push("authority="+d.auth);d.version&&c.push("version="+d.version);d=this.uri;0<c.length&&(d=d+"?"+c.join("&"));B(d,function(d){if(!d&&b)b();else{var c=[];d=d.getElementsByTagName("SOURCE");for(var f=0;f<d.length;++f){var g=d[f],k=g.getElementsByTagName("VERSION");if(!(1>k.length)){for(var m=k[0],n=m.getElementsByTagName("COORDINATES"),k=[],h=0;h<n.length;++h){var e=n[h],
x=new q;x.auth=e.getAttribute("authority");x.taxon=e.getAttribute("taxid");x.version=e.getAttribute("version");k.push(x)}for(var n=[],e=m.getElementsByTagName("CAPABILITY"),v,h=0;h<e.length;++h)x=e[h],n.push(x.getAttribute("type")),"das1:features"==x.getAttribute("type")&&(v=x.getAttribute("query_uri"),v=v.substring(0,v.length-8));h={};m=m.getElementsByTagName("PROP");for(e=0;e<m.length;++e)J(h,m[e].getAttribute("name"),m[e].getAttribute("value"));v&&(g=new p(v,{source_uri:g.getAttribute("uri"),name:g.getAttribute("title"),
desc:g.getAttribute("description"),coords:k,props:h,capabilities:n}),c.push(g))}}a(c)}})};p.prototype.doCrossDomainRequest=function(a,b,d){var c;this.xUser&&(c="Basic "+btoa(this.xUser+":"+this.xPass));try{return B(a,b,this.credentials,c)}catch(f){if(d)d(f);else throw f;}};"undefined"!==typeof t&&(t.exports={DASGroup:z,DASFeature:u,DASStylesheet:m,DASStyle:g,DASSource:p,DASSegment:r,DASRegistry:k,DASSequence:w,DASLink:a,isDasBooleanTrue:N,isDasBooleanNotFalse:L,copyStylesheet:O,coordsMatch:h})},{"./color":9,
"./utils":47}],11:[function(e,t,s){function r(h,e,p){function a(){p?(b.className="fa fa-caret-down",e.style.display="table"):(b.className="fa fa-caret-right",e.style.display="none")}var b=q("i");a();b.addEventListener("click",function(b){b.preventDefault();b.stopPropagation();p=!p;a()},!1);h=q("h6",[b," ",h],{},{display:"block",background:"gray",color:"white",width:"100%",padding:"5px 2px",margin:"0px"});return q("div",[h,e],{})}if("undefined"!==typeof e){var p=e("./cbrowser").Browser;e=e("./utils");
var q=e.makeElement,h=e.removeChildren}p.prototype.removeAllPopups=function(){h(this.hPopupHolder);h(this.popupHolder)};p.prototype.makeTooltip=function(h,e){var p=!1,a=this,b=null,m;m=function(a){p=!1;b&&(clearTimeout(b),b=null);h.removeEventListener("mouseout",m,!1)};var g=function(k){var f=k.clientX+window.scrollX,c=k.clientY+window.scrollY;b||(b=setTimeout(function(){var k;k="function"===typeof e?e():e;var m=q("div",[q("div",null,{className:"tooltip-arrow"}),q("div",k,{className:"tooltip-inner"})],
{className:"tooltip bottom in"},{display:"block",top:""+(c+20)+"px",left:""+Math.max(f-30,20)+"px"});a.hPopupHolder.appendChild(m);var r;r=function(b){try{a.hPopupHolder.removeChild(m)}catch(c){}window.removeEventListener("mousemove",r,!1);p&&null!=h.offsetParent&&g(b)};window.addEventListener("mousemove",r,!1);b=null},1E3))};h.addEventListener("mouseover",function(a){p=!0;h.addEventListener("mouseout",m,!1);g(a)},!1);h.addEventListener("DOMNodeRemovedFromDocument",function(a){p=!1;b&&(clearTimeout(b),
b=null)},!1)};p.prototype.popit=function(h,e,p,a){var b=this;a||(a={});h||(h={});var m=a.width||200,g;h.clientX?(a=h.clientX,g=h.clientY):(a=500,g=50);a+=document.documentElement.scrollLeft||document.body.scrollLeft;g+=document.documentElement.scrollTop||document.body.scrollTop;var k=window.innerWidth,f=g,c=Math.min(a-m/2-4,k-m-30),v=q("div");v.className="popover fade "+(h.clientX?"bottom ":"")+"in";v.style.display="block";v.style.position="absolute";v.style.top=""+f+"px";v.style.left=""+c+"px";v.style.width=
m+"px";276<m&&(v.style.maxWidth=m+"px");v.appendChild(q("div",null,{className:"arrow"}));if(e){var B=q("button","",{className:"close"});B.innerHTML="&times;";B.addEventListener("mouseover",function(a){B.style.color="red"},!1);B.addEventListener("mouseout",function(a){B.style.color="black"},!1);B.addEventListener("click",function(a){a.preventDefault();a.stopPropagation();b.removeAllPopups()},!1);h=q("h4",[q("span",e,null,{maxWidth:"200px"}),B],{},{paddingLeft:"10px",paddingRight:"10px"});var r,L,O,
y;O=function(a){a.stopPropagation();a.preventDefault();c+=a.clientX-r;8>c&&(c=8);c>k-m-32&&(c=k-m-26);f+=a.clientY-L;f=Math.max(10,f);v.style.top=""+f+"px";v.style.left=""+Math.min(c,k-m-10)+"px";r=a.clientX;L=a.clientY};y=function(a){a.stopPropagation();a.preventDefault();window.removeEventListener("mousemove",O,!1);window.removeEventListener("mouseup",y,!1)};h.addEventListener("mousedown",function(a){a.preventDefault();a.stopPropagation();r=a.clientX;L=a.clientY;window.addEventListener("mousemove",
O,!1);window.addEventListener("mouseup",y,!1)},!1);v.appendChild(h)}v.appendChild(q("div",p,{className:"popover-content"},{padding:"0px"}));this.hPopupHolder.appendChild(v);var J={node:v,displayed:!0};v.addEventListener("DOMNodeRemoved",function(a){a.target==v&&(J.displayed=!1)},!1);return J};"undefined"!==typeof t&&(t.exports={makeTreeTableSection:r})},{"./cbrowser":6,"./utils":47}],12:[function(e,t,s){function r(h){this.source=h;this.base=h.uri||"http://rest.ensembl.org";this.species=h.species||
"human";this.activityListeners=[];this.busy=0;this.type="string"===typeof h.type?[h.type]:h.type||["regulatory"]}if("undefined"!==typeof e){var p=e("./sourceadapters").registerSourceAdapterFactory;e=e("./das");var q=e.DASStylesheet,h=e.DASStyle,w=e.DASFeature,u=e.DASGroup}r.prototype.addActivityListener=function(h){this.activityListeners.push(h)};r.prototype.notifyActivity=function(){for(var h=0;h<this.activityListeners.length;++h)try{this.activityListeners[h](this.busy)}catch(a){console.log(a)}};
r.prototype.getStyleSheet=function(e){var a=new q,b=new h;b.glyph="__NONE";0<=this.type.indexOf("exon")&&a.pushStyle({type:"transcript"},null,b);(0<=this.type.indexOf("exon")||0<=this.type.indexOf("transcript"))&&a.pushStyle({type:"gene"},null,b);b=new h;b.glyph="BOX";b.FGCOLOR="black";b.BGCOLOR="red";b.HEIGHT=8;b.BUMP=!0;b.LABEL=!0;b.ZINDEX=10;a.pushStyle({type:"cds"},null,b);b=new h;b.glyph="SQUARE";b.BUMP="yes";b.LABEL="no";b.FGCOLOR="blue";a.pushStyle({type:"variation",method:".+_UTR_variant"},
null,b);b=new h;b.glyph="TRIANGLE";b.DIRECTION="S";b.BUMP="yes";b.LABEL="no";b.FGCOLOR="blue";a.pushStyle({type:"variation",method:"missense_variant"},null,b);b=new h;b.glyph="TRIANGLE";b.DIRECTION="N";b.BUMP="yes";b.LABEL="no";b.FGCOLOR="blue";a.pushStyle({type:"variation",method:"splice_.+_variant"},null,b);b=new h;b.glyph="STAR";b.POINTS=6;b.BUMP="yes";b.LABEL="no";b.FGCOLOR="blue";a.pushStyle({type:"variation",method:"regulatory_region_variant"},null,b);b=new h;b.glyph="PLIMSOLL";b.BUMP="yes";
b.LABEL="no";b.FGCOLOR="rgb(50,80,255)";b.STROKECOLOR="black";a.pushStyle({type:"variation"},null,b);b=new h;b.glyph="SQUARE";b.BUMP="yes";b.LABEL="no";b.BGCOLOR="#888888";b.FGCOLOR="red";a.pushStyle({type:"indel",method:".+_UTR_variant"},null,b);b=new h;b.glyph="TRIANGLE";b.DIRECTION="S";b.BUMP="yes";b.LABEL="no";b.BGCOLOR="#888888";b.FGCOLOR="red";a.pushStyle({type:"indel",method:"missense_variant"},null,b);b=new h;b.glyph="TRIANGLE";b.DIRECTION="N";b.BUMP="yes";b.LABEL="no";b.BGCOLOR="#888888";
b.FGCOLOR="red";a.pushStyle({type:"indel",method:"splice_.+_variant"},null,b);b=new h;b.glyph="STAR";b.POINTS=6;b.BUMP="yes";b.LABEL="no";b.BGCOLOR="#888888";b.FGCOLOR="red";a.pushStyle({type:"indel",method:"regulatory_region_variant"},null,b);b=new h;b.glyph="PLIMSOLL";b.BUMP="yes";b.LABEL="no";b.BGCOLOR="#888888";b.FGCOLOR="red";b.STROKECOLOR="black";a.pushStyle({type:"indel"},null,b);b=new h;b.glyph="BOX";b.FGCOLOR="black";b.BGCOLOR="orange";b.HEIGHT=8;b.BUMP=!0;b.LABEL=!0;b.ZINDEX=20;a.pushStyle({type:"default"},
null,b);return e(a)};r.prototype.getScales=function(){return[]};r.prototype.fetch=function(h,a,b,m,g,k,f){var c=this;a=this.base+"/overlap/region/"+this.species+"/"+h+":"+a+"-"+b;b=[];for(m=0;m<this.type.length;++m)b.push("feature="+this.type[m]);b.push("content-type=application/json");a=a+"?"+b.join(";");var e=new XMLHttpRequest;e.onreadystatechange=function(){if(4==e.readyState)if(c.busy--,c.notifyActivity(),300<=e.status){var a="Error code "+e.status;try{var b=JSON.parse(e.response);b.error&&(a=
b.error)}catch(g){}f(a,null)}else{for(var a=JSON.parse(e.response),b=[],k=0;k<a.length;++k){var m=a[k],q=[],p=new w;p.segment=h;p.min=m.start|0;p.max=m.end|0;p.type=m.feature_type||"unknown";p.id=m.ID;if(m.Parent){var r=new u;r.id=m.Parent;p.groups=[r]}m.strand&&(0>m.strand?p.orientation="-":0<m.strand&&(p.orientation="+"));m.consequence_type&&(p.method=m.consequence_type);m.alt_alleles&&(q.push("Alleles="+m.alt_alleles.join("/")),1<m.alt_alleles.length&&(m.alt_alleles[1].length!=m.alt_alleles[0].length||
"-"==m.alt_alleles[1])&&(p.type="indel"));0<q.length&&(p.notes=q);b.push(p)}f(null,b)}};c.busy++;c.notifyActivity();e.open("GET",a,!0);e.responseType="text";e.send("")};p("ensembl",function(h){return{features:new r(h)}})},{"./das":10,"./sourceadapters":33}],13:[function(e,t,s){if("undefined"!==typeof e)var r=e("./cbrowser").Browser,p=e("./utils").shallowCopy,q=e("./sha1").hex_sha1,h=e("./das").copyStylesheet;r.prototype.exportFullConfig=function(h){h={chr:this.chr,viewStart:this.viewStart|0,viewEnd:this.viewEnd|
0,cookieKey:"dalliance_"+q(Date.now()),coordSystem:this.coordSystem,sources:this.exportSourceConfig(),chains:this.exportChains()};this.prefix&&(h.prefix=this.prefix);return h};r.prototype.exportChains=function(){var h={},e=this.chains||{},q;for(q in e)h[q]=e[q].exportConfig();return h};r.prototype.exportSourceConfig=function(e){e=[];for(var q=0;q<this.tiers.length;++q){var r=this.tiers[q],a=p(r.dasSource);a.noPersist||(a.coords=void 0,a.props=void 0,a.disabled||(a.disabled=void 0),r.config.stylesheet?
(a.style=h(r.config.stylesheet).styles,a.stylesheet_uri=void 0):a.style&&(a.style=h({styles:a.style}).styles),"string"===typeof r.config.name&&(a.name=r.config.name),void 0!==r.config.height&&(a.forceHeight=r.config.height),void 0!==r.config.forceMin&&(a.forceMin=r.config.forceMin),r.config.forceMinDynamic&&(a.forceMinDynamic=r.config.forceMinDynamic),void 0!==r.config.forceMax&&(a.forceMax=r.config.forceMax),void 0!==r.config.bumped&&(a.bumped=r.config.bumped),r.config.forceMaxDynamic&&(a.forceMaxDynamic=
r.config.forceMaxDynamic),e.push(a))}return e};r.prototype.exportPageTemplate=function(h){h=h||{};return'<html>\n  <head>\n    <script language="javascript" src="'+this.resolveURL("$$dalliance-compiled.js")+'">\x3c/script>\n    <script language="javascript">\n      var dalliance_browser = new Browser('+JSON.stringify(this.exportFullConfig(h),null,2)+');\n    \x3c/script>\n  </head>\n  <body>\n    <div id="svgHolder">Dalliance goes here</div>\n  </body>\n<html>\n'}},{"./cbrowser":6,"./das":10,"./sha1":32,
"./utils":47}],14:[function(e,t,s){if("undefined"!==typeof e)var r=e("./cbrowser").Browser,p=e("./glyphs").OverlayLabelCanvas,q=e("./numformats").formatQuantLabel,h=e("./sequence-draw").drawSeqTierGC;r.prototype.exportImage=function(e){e=e||{};for(var r=this.featurePanelWidth,z=0,a=0;a<this.tiers.length;++a){0<a&&(z+=3);var b=this.tiers[a];void 0!==b.layoutHeight&&(z+=b.layoutHeight)}var m=e.resolutionMultiplier||1,a=(r+200)*m|0,b=z*m|0,z=makeElement("canvas",null,{width:a,height:b}),g=z.getContext("2d");
g.fillStyle="white";g.fillRect(0,0,a,b);g.scale(m,m);for(a=m=0;a<this.tiers.length;++a){var b=this.tiers[a],k=(b.glyphCacheOrigin-this.viewStart)*this.scale,f=new p;g.save();g.translate(0,m);g.save();g.beginPath();g.moveTo(200,0);g.lineTo(200+r,0);g.lineTo(200+r,b.layoutHeight);g.lineTo(200,b.layoutHeight);g.closePath();g.clip();g.translate(200,0);g.save();g.translate(k,0);b.subtiers?b.paintToContext(g,f,k+1E3):h(b,b.currentSequence,g);g.restore();g.save();g.translate(k,0);f.draw(g,-k,r-k);g.restore();
g.restore();for(var f=!1,c=0,v=b.subtiers||[],B=0;B<v.length;++B){var N=v[B];if(N.quant){var f=!0,L=N.quant,O=N.height,y=2;40<O&&(y=1+(O/20|0));var O=O/(y-1),J=(L.max-L.min)/(y-1);g.beginPath();g.moveTo(205,c);g.lineTo(200,c);g.lineTo(200,c+N.height);g.lineTo(205,c+N.height);for(var F=1;F<y-1;++F){var G=F*O;g.moveTo(200,c+G);g.lineTo(203,c+G)}g.strokeStyle="black";g.strokeWidth=2;g.stroke();g.fillStyle="black";var F=q(L.max),s=c+7;g.fillText(F,197-g.measureText(F).width,s);F=q(L.min);s=c+N.height;
g.fillText(F,197-g.measureText(F).width,s);for(F=1;F<y-1;++F)G=F*O,s=q(1*L.max-F*J),G=c+G+3,g.fillText(s,197-g.measureText(s).width,G)}c+=N.height+3}c="string"===typeof b.config.name?b.config.name:b.dasSource.name;v=g.measureText(c).width;g.fillStyle="black";g.fillText(c,200-(f?22:12)-v,(b.layoutHeight+6)/2);g.restore();m+=b.layoutHeight+3}if(e.highlights){g.save();g.beginPath();g.moveTo(200,0);g.lineTo(200+r,0);g.lineTo(200+r,m);g.lineTo(200,m);g.closePath();g.clip();g.translate(200+k,0);k=r=this.viewStart;
a=this.viewEnd;for(b=0;b<this.highlights.length;++b)O=this.highlights[b],(O.chr===this.chr||O.chr==="chr"+this.chr)&&O.min<a&&O.max>k&&(g.globalAlpha=this.defaultHighlightAlpha,g.fillStyle=this.defaultHighlightFill,g.fillRect((O.min-r)*this.scale,0,(O.max-O.min)*this.scale,m));g.restore()}r=-1;"center"==e.ruler?r=200+(this.viewEnd-this.viewStart+1)*this.scale/2:"left"==e.ruler?r=200:"right"==e.ruler&&(r=200+(this.viewEnd-this.viewStart+1)*this.scale);0<=r&&(g.strokeStyle="blue",g.beginPath(),g.moveTo(r,
0),g.lineTo(r,m),g.stroke());return z.toDataURL("image/png")}},{"./cbrowser":6,"./glyphs":20,"./numformats":25,"./sequence-draw":30}],15:[function(e,t,s){if("undefined"!==typeof e){var r=e("./cbrowser").Browser;e=e("./utils");var p=e.makeElement,q=e.removeChildren}r.prototype.openExportPanel=function(){var h=this;if("export"===this.uiMode)this.hideToolPanel(),this.setUiMode("none");else{var e=p("div",null,{className:"export-form"}),r=p("select");r.appendChild(p("option","SVG",{value:"svg"}));r.appendChild(p("option",
"Image",{value:"png"}));r.appendChild(p("option","Dalliance config",{value:"config"}));r.appendChild(p("option","Dalliance sources",{value:"sources"}));r.appendChild(p("option","Dalliance page",{value:"page"}));r.value="svg";r.addEventListener("change",function(a){q(g);B()},!1);e.appendChild(p("p",["Export as: ",r]));var z=p("input",null,{type:"checkbox",checked:this.exportHighlights});z.addEventListener("change",function(a){h.exportHighlights=z.checked;h.storeStatus()},!1);var a=p("input",null,{type:"checkbox",
checked:this.exportRuler});a.addEventListener("change",function(b){h.exportRuler=a.checked;h.storeStatus()},!1);var b=p("input",null,{type:"text",value:"1.0"}),m=p("button","Export",{className:"btn btn-primary"});m.addEventListener("click",function(c){q(g);var f,k,m,e;if("svg"===r.value)f=URL.createObjectURL(h.makeSVG({highlights:z.checked,ruler:a.checked?h.rulerLocation:"none"})),k="SVG",m="image/svg",e="dalliance-view.svg";else if("png"===r.value){m=parseFloat(b.value);if(0.1>m||10<m){alert("bad scale "+
m);return}f=h.exportImage({highlights:z.checked,ruler:a.checked?h.rulerLocation:"none",resolutionMultiplier:m});k="Image";m="image/png";e="dalliance-view.png"}else"config"===r.value?(m=JSON.stringify(h.exportFullConfig(),null,2),k=new Blob([m],{type:"text/plain"}),f=URL.createObjectURL(k),k="Configuration",m="text/plain",e="dalliance-config.json"):"sources"===r.value?(m=JSON.stringify(h.exportSourceConfig(),null,2),k=new Blob([m],{type:"text/plain"}),f=URL.createObjectURL(k),k="Source array",m="text/plain",
e="dalliance-sources.json"):"page"===r.value&&(k=h.exportPageTemplate(),m="text/html",k=new Blob([k],{type:m}),f=URL.createObjectURL(k),k="Page template",e="dalliance-view.html");f&&(c=p("a","[Download]",{href:f,download:e,type:m}),m=p("a","[Preview in browser]",{href:f,type:m,target:"_new"}),g.appendChild(p("p",[""+k+" created: ",c,m])))},!1);h.addViewListener(function(){q(g)});h.addTierListener(function(){q(g)});var g=p("p",""),k=p("tr",[p("th","Include highlights",{},{width:"200px",textAlign:"right"}),
p("td",z)]),f=p("tr",[p("th","Include vertical guideline"),p("td",a)]),c=p("tr",[p("th","Scale multiplier"),p("td",b)]),v=p("table",[k,f,c]),B=function(){var a=r.value;k.style.display="svg"==a||"png"==a?"table-row":"none";f.style.display="svg"==a||"png"==a?"table-row":"none";c.style.display="png"==a?"table-row":"none"};B();e.appendChild(v);e.appendChild(m);e.appendChild(g);"none"!==this.uiMode&&this.hideToolPanel();this.browserHolder.insertBefore(e,this.svgHolder);this.activeToolPanel=e;this.setUiMode("export")}}},
{"./cbrowser":6,"./utils":47}],16:[function(e,t,s){t=e("./cbrowser");s=e("./chainset");var r=e("./sourceadapters"),p=e("./utils");e=e("./das");window.Browser=t.Browser;window.Chainset=s.Chainset;window.makeElement=p.makeElement;window.dalliance_registerSourceAdapterFactory=r.registerSourceAdapterFactory;window.dalliance_registerParserFactory=r.registerParserFactory;window.dalliance_makeParser=r.makeParser;window.DASSequence=e.DASSequence;window.DASFeature=e.DASFeature;window.DASGroup=e.DASGroup;window.DASStylesheet=
e.DASStylesheet;window.DASStyle=e.DASStyle;window.DASSource=e.DASSource},{"./cbrowser":6,"./chainset":7,"./das":10,"./sourceadapters":33,"./utils":47}],17:[function(e,t,s){function r(){this.glyphs=[];this.height=0;this.quant=null}function p(d){Date.now();Z=d.viewport.getContext("2d");b(d);d.padding="number"===typeof d.dasSource.padding?d.dasSource.padding:$;var c=[],n={},f={},g;for(g in d.ungroupedFeatures)for(var l=d.ungroupedFeatures[g],k=0;k<l.length;++k){var m=l[k];if(!m.parts){var e=d.styleForFeature(m);
if(e)if("LINEPLOT"==e.glyph)a(n,e.id,m),f[e.id]=e;else{var x=h(m,0,e,d);x&&c.push(x)}}}for(var v in n)g=n[v],e=f[v],"LINEPLOT"==e.glyph&&c.push(w(g,e,d));if(d.dasSource.collapseSuperGroups&&!d.bumped)for(var p in d.superGroups){n=d.superGroups[p];d.groups[p]=z(d.groups[p]);d.groups[p].isSuperGroup=!0;f={};v=1E10;l=-1E10;k=null;for(x=0;x<n.length;++x)if(g=d.groupedFeatures[n[x]]){for(e=0;e<g.length;++e)m=g[e],a(f,m.type,m),v=Math.min(m.min,v),l=Math.max(m.max,l),m.segment&&!k&&(k=m.segment);if(d.groups[p]&&
!d.groups[p].links||0==d.groups[p].links.length)d.groups[p].links=d.groups[n[0]].links;delete d.groupedFeatures[n[x]]}d.groups[p].max=l;d.groups[p].min=v;d.groups[p].segment=k;for(var C in f){g=f[C];v=g[0];l=null;for(e=0;e<g.length;++e)m=g[e],m=new S(m.min,m.max),l=l?Q(l,m):m;l=l.ranges();for(k=0;k<l.length;++k){for(var M=l[k],B=((M.max()|0)-(M.min()|0)+1)*n.length,u=0,e=0;e<g.length;++e)if(m=g[e],(m.min|0)<=M.max()&&(m.max|0)>=M.min())var A=Math.max(m.min|0,M.min()),m=Math.min(m.max|0,M.max()),u=
u+(m-A+1);var m=new R,y;for(y in v)m[y]=v[y];m.min=M.min();m.max=M.max();m.label&&1<n.length&&(m.label+=" ("+n.length+" vars)");m.visualWeight=1*u/B;a(d.groupedFeatures,p,m)}}delete d.superGroups[p]}y=[];for(var I in d.groupedFeatures)y.push(I);y.sort(function(a,b){var c=d.groupedFeatures[a][0].score-d.groupedFeatures[b][0].score;return 0<c?-1:0==c?0:1});C={};for(m=0;m<y.length;++m)if(I=y[m],x=q(d.groupedFeatures[I],0,d.groups[I],d,d.dasSource.collapseSuperGroups&&!d.bumped?"collapsed_gene":"tent"))x.group=
d.groups[I],C[I]=x;for(p in d.superGroups){n=d.superGroups[p];I=[];v=1E10;l=-1E10;for(y=0;y<n.length;++y)m=C[n[y]],C[n[y]]=null,m&&(I.push(m),v=Math.min(v,m.min()),l=Math.max(l,m.max()));for(y=0;y<I.length;++y)m=I[y],c.push(new L(m,v,l))}for(x in C)(m=C[x])&&c.push(m);p=new r;I=[];C=d.subtierMax||d.dasSource.subtierMax||d.browser.defaultSubtierMax;y=!1;m=0;a:for(;m<c.length;++m)if(x=c[m],x.bump&&(d.bumped||d.dasSource.collapseSuperGroups)){for(n=0;n<I.length;++n)if(f=I[n],f.hasSpaceFor(x)){f.add(x);
continue a}I.length>=C?y=!0:(f=new r,f.add(x),I.push(f))}else p.add(x);0<p.glyphs.length&&(I=[p].concat(I));for(n=0;n<I.length;++n)f=I[n],f.quant&&f.glyphs.unshift(new D(f.height));for(n=0;n<I.length;++n)f=I[n],f.glyphs.sort(function(a,d){return(a.zindex||0)-(d.zindex||0)});d.subtiers=I;d.glyphCacheOrigin=d.browser.viewStart;y?d.updateStatus("Bumping limit exceeded, use the track editor to see more features"):d.updateStatus()}function q(a,d,b,c,n){n=c.styleForFeature(b);var l,k=!1,m=[];d=null;for(var e=
0;e<a.length;++e){var x=a[e];x.orientation&&null==d&&(d=x.orientation);!l&&x.label&&(l=x.label);var v=c.styleForFeature(x);v&&!x.parts&&(W(v.LABEL)&&(k=!0),(x=h(x,0,v,c,null,!0))&&m.push(x))}if(0==m.length)return null;a="flat";n&&"LINE"===n.glyph||(c.dasSource.collapseSuperGroups&&!c.bumped?"+"===d?a="collapsed+":"-"===d&&(a="collapsed-"):"+"===d?a="hat+":"-"===d&&(a="hat-"));c=null;if(l&&k||n&&(W(n.LABEL)||W(n.LABELS)))c=b.label||l;b=new g(m,a);c&&("+"===d?c=">"+c:"-"===d&&(c="<"+c),b=new f(Z,b,
c,!1));b.bump=!0;return b}function h(a,b,n,k,h,e){function p(a,d,b){var c=null;if(a.currentSequence){var n=a.currentSequence.start|0,f=a.currentSequence.end|0;if(n<=b&&f>=d){for(var g=Math.max(d,n),f=Math.min(b,f),c=a.currentSequence.seq.substr(g-n,f-g+1);d<g;)c="N"+c,g--;for(;b>f;)c+="N",f++}}return c}var q=k.browser.scale,r=k.browser.viewStart,u=n.glyph||"BOX",z=a.min,D=a.max,s=a.orientation,R=a.score,Q=a.label||a.id,w=(z-r)*q,S=Math.max((D-r+1)*q,w+1),t=k.forceHeight||n.HEIGHT||h||12,T=t*=1,r=
n.BUMP&&W(n.BUMP),$;if("CROSS"===u||"EX"===u||"TRIANGLE"===u||"DOT"===u||"SQUARE"===u||"STAR"===u||"PLIMSOLL"===u){var V=n.FGCOLOR||"black",K=n.BGCOLOR||"none",z=n.STROKECOLOR;n.BGITEM&&a.itemRgb?V=a.itemRgb:W(n.COLOR_BY_SCORE2)&&(q=n.BGGRAD||n._gradient,q||(q=M(50,n.COLOR1,n.COLOR2,n.COLOR3),n._gradient=q),t=a.score2,void 0==t&&V||(D=n.MIN2?1*n.MIN2:0,D=(1*(t||0)-D)/((n.MAX2?1*n.MAX2:1)-D)*q.length|0,0>D&&(D=0),D>=q.length&&(D=q.length-1),V=q[D]));t=k.forceHeight||n.HEIGHT||h||12;T=t*=1;D=n.SIZE||
t;n.RSIZE&&(D=1*n.RSIZE*t);n.STROKETHRESHOLD&&D<1*n.STROKETHRESHOLD&&(z=null);D*=1;t=(w+S)/2;q=D/2;"EX"===u?z=new v(t,D,V):"TRIANGLE"===u?z=new B(t,D,n.DIRECTION||"N",n.LINEWIDTH||D,V,z):"DOT"===u?z=new N(t,D,V,z):"PLIMSOLL"===u?z=new A(t,D,0.2*D,V,z):"SQUARE"===u?z=new m(t-q,0,D,D,V,z):"STAR"===u?(u=5,n.POINTS&&(u=n.POINTS|0),z=new E(t,q,u,V,z)):z=new c(t,D,V);K&&"none"!=K&&5<S-w&&(w=new m(w,0,S-w,D,K),z=new g([w,z]));if(W(n.SCATTER)){K=k.quantMin(n);(D=k.quantMax(n))||(D=0>K?0:10);K||(K=0);k=(1*
R-K)/(D-K);R=-1*K/(D-K);if(0>k||1<k)return null;k>=R?(t=Math.max(1,(k-R)*T),b=b+(1-R)*T-t):(t=Math.max(1,(k-R)*T),b+=(1-R)*T);$={min:K,max:D};w=0;S="undefined"!==typeof a.forceLabel?a.forceLabel:n.LABEL;aa(S)&&Q&&!e&&(z=new f(Z,z,Q,!0,null,"above"==S?"above":"below"),"above"==S&&(w=z.textHeight+2),e=!0);z=new I(z,0,b-q-w,T)}}else if("HISTOGRAM"===u||"GRADIENT"===u&&"undefined"!==R)K=k.quantMin(n),(D=k.quantMax(n))||(D=0>K?0:10),K||(K=0),1*R<1*K&&(R=K),1*R>1*D&&(R=D),k=(1*R-K)/(D-K),R=-1*K/(D-K),"HISTOGRAM"===
u&&(k>=R?(t=Math.max(1,(k-R)*T),b=b+(1-R)*T-t):(t=Math.max(1,(R-k)*T),b+=(1-R)*T),$={min:K,max:D}),V=n.FGCOLOR||null,K=n.BGCOLOR||n.COLOR1||"green",n.BGITEM&&a.itemRgb&&(K=a.itemRgb),R=n.ALPHA?1*n.ALPHA:null,n.BGGRAD&&(q=n.BGGRAD,D=k*q.length|0,0>D&&(D=0),D>=q.length&&(D=q.length-1),K=q[D]),n.COLOR2&&(q=n._gradient,q||(q=M(50,n.COLOR1,n.COLOR2,n.COLOR3),n._gradient=q),D=k*q.length|0,0>D&&(D=0),D>=q.length&&(D=q.length-1),K=q[D]),z=new m(w,b,S-w,t,K,V,R);else if("HIDDEN"===u)z=new L(null,w,S),e=!0;
else if("ARROW"===u)k=n.FGCOLOR||"purple",b=W(n.PARALLEL),R=W(n.SOUTHWEST),K=W(n.NORTHEAST),z=new G(w,S,t,k,b,R,K);else if("ANCHORED_ARROW"===u)V=n.FGCOLOR||"none",K=n.BGCOLOR||"green",z=new O(w,S,t,K,V,s),z.bump=!0;else if("SPAN"===u)V=n.FGCOLOR||"black",z=new y(w,S,t,V);else if("LINE"===u)V=n.FGCOLOR||"black",z=new J(w,S,t,n.STYLE||"solid",s,V);else if("PRIMERS"===u)V=n.FGCOLOR||"black",K=n.BGCOLOR||"red",z=new F(w,S,t,K,V);else if("TEXT"===u)k=n.STRING||"text",K=n.FGCOLOR||"black",z=new d(Z,w,
S,t,K,k);else if("TOOMANY"===u)V=n.FGCOLOR||"gray",K=n.BGCOLOR||"orange",z=new H(w,S,t,K,V);else if("POINT"===u)t=k.forceHeight||n.HEIGHT||30,K=k.quantMin(n),D=k.quantMax(n),k=(1*R-K)/(D-K),b=1*t/(D-K)*(R-1*K)|0,$={min:K,max:D},K=n.FGCOLOR||n.COLOR1||"black",n.COLOR2&&(q=n._gradient,q||(q=M(50,n.COLOR1,n.COLOR2,n.COLOR3),n._gradient=q),D=k*q.length|0,0>D&&(D=0),D>=q.length&&(D=q.length-1),K=q[D]),z=new l((w+S)/2,t-b,t,K);else if("__SEQUENCE"===u){K=T=a.seq;u=V=a.quals;b=W(n.__INSERTIONS);R=[];if(a.cigar){h=
X(a.cigar);for(var u=K="",ra=s=0;ra<h.length;++ra){var ea=h[ra];if("M"==ea.op)K+=T.substr(s,ea.cnt),u+=V.substr(s,ea.cnt),s+=ea.cnt;else if("D"==ea.op)for(var Y=0;Y<ea.cnt;++Y)K+="-",u+="Z";else if("I"==ea.op){var ba=T.substr(s,ea.cnt),Y=new B(w+K.length*q,5,"S",5,"red");b&&(Y=new f(Z,Y,ba,!1,"center","above","7px sans-serif"));Y.feature={label:"Insertion: "+ba,type:"insertion",method:"insertion"};R.push(Y);s+=ea.cnt}else"S"==ea.op?s+=ea.cnt:console.log("unknown cigop"+ea.op)}}q=p(k,z,D);if(K&&q&&
("mismatch"===n.__SEQCOLOR||"mismatch-all"===n.__SEQCOLOR)){z=[];D="-"===a.orientation?",":".";for(T=0;T<K.length;++T)z.push(K[T]==q[T]?D:K[T]);K=z.join("")}z=new x(k.browser.baseColors,"-"===a.orientation?n._minusColor||"lightskyblue":n._plusColor||"lightsalmon",w,S,t,K,q,n.__SEQCOLOR,u,!W(n.__CLEARBG));b&&(z=new I(z,0,7));0<R.length&&(R.splice(0,0,z),z=new g(R))}else if("__INSERTION"===u)Y=new B(w,5,"S",5,"red"),z=new f(Z,Y,a.insertion||a.altAlleles[0],!1,"center","above","7px sans-serif"),1<S-
w&&(K=n.BGCOLOR||n.COLOR1||"green",w=new m(w,5,S-w,t,K,V),z=new g([w,z]));else{if("__NONE"===u)return null;V=n.FGCOLOR||null;K=n.BGCOLOR||n.COLOR1||"green";n.BGITEM&&a.itemRgb&&(K=a.itemRgb);q=(S-w)/(D-z);"translation"==a.type&&("protein_coding"==a.method||a.readframeExplicit)&&(!a.tags||0>a.tags.indexOf("cds_start_NF")||a.readframeExplicit)&&(!k.dasSource.collapseSuperGroups||k.bumped)&&0.5<=q?(q=p(k,z,D),z=new C(w,S,t,K,q,a.orientation,a.readframe)):z=new m(w,0,S-w,t,K,V)}(W(n.LABEL)||a.forceLabel)&&
Q&&!e&&(z=new f(Z,z,Q,!1));r&&(z.bump=!0);z.feature=a;$&&(z.quant=$);n.ZINDEX&&(z.zindex=n.ZINDEX|0);return z}function w(a,d,b){var c=b.browser.viewStart,n=b.browser.scale,f=b.forceHeight||d.HEIGHT||30,g=b.quantMin(d);b=b.quantMax(d);for(var l=1*f/(b-g),m=d.FGCOLOR||d.COLOR1||"black",h=[],e=0;e<a.length;++e){var x=a[e],q=f-((x.score-1*g)*l|0);h.push((((x.min|0)+(x.max|0))/2-c)*n);h.push(q)}a=new k(h,m,f);a.quant={min:g,max:b};d.ZINDEX&&(a.zindex=d.ZINDEX|0);return a}if("undefined"!==typeof e){var u=
e("./utils"),z=u.shallowCopy,a=u.pusho,u=e("./tier").DasTier,b=e("./features").sortFeatures;s=e("./glyphs");var m=s.BoxGlyph,g=s.GroupGlyph,k=s.LineGraphGlyph,f=s.LabelledGlyph,c=s.CrossGlyph,v=s.ExGlyph,B=s.TriangleGlyph,N=s.DotGlyph,L=s.PaddedGlyph,O=s.AArrowGlyph,y=s.SpanGlyph,J=s.LineGlyph,F=s.PrimersGlyph,G=s.ArrowGlyph,H=s.TooManyGlyph,d=s.TextGlyph,x=s.SequenceGlyph,C=s.AminoAcidGlyph,I=s.TranslatedGlyph,l=s.PointGlyph,D=s.GridGlyph,E=s.StarGlyph,A=s.PlimsollGlyph,n=s.OverlayLabelCanvas,M=
e("./color").makeGradient;s=e("./spans");var S=s.Range,Q=s.union;s=e("./das");var R=s.DASFeature,W=s.isDasBooleanTrue,aa=s.isDasBooleanNotFalse,X=e("./cigar").parseCigar,T=e("./numformats").formatQuantLabel}var $=3;r.prototype.indexFor=function(a){a=a.min();for(var d=0,b=this.glyphs.length;b>d;){var c=(d+b)/2|0;if(c>=this.glyphs.length)return this.glyphs.length;a<this.glyphs[c].min()?b=c:d=c+1}return b};r.prototype.add=function(a){var d=this.indexFor(a);this.glyphs.splice(d,0,a);this.height=Math.max(this.height,
a.height());a.quant&&null==this.quant&&(this.quant=a.quant)};r.prototype.hasSpaceFor=function(a){var d=this.indexFor(a);return 0<d&&this.glyphs[d-1].max()>=a.min()||d<this.glyphs.length&&this.glyphs[d].min()<=a.max()?!1:!0};var Z;u.prototype.paint=function(){var a=this.browser.retina&&1<window.devicePixelRatio,d=this.subtiers;if(d){var b=this.browser.featurePanelWidth+2E3;a&&(b*=2);var c=this.viewport.width|0;c<b-50&&(this.viewport.width=c=b);for(var b=this.padding,f=0;f<d.length;++f)b=b+d[f].height+
this.padding;f=b=Math.max(b+6,this.browser.minTierHeight);a&&(f*=2);f!=this.viewport.height&&(this.viewport.height=f);Math.max(b,this.browser.minTierHeight);this.viewportHolder.style.left="-1000px";this.viewport.style.width=a?""+c/2+"px":""+c+"px";this.viewport.style.height=""+b+"px";this.layoutHeight=Math.max(b,this.browser.minTierHeight);this.updateHeight();this.norigin=this.browser.viewStart;d=this.viewport.getContext("2d");d.clearRect(0,0,c,f);d.save();a&&d.scale(2,2);c=this.browser.viewStart-
1E3/this.browser.scale;f=this.browser.viewEnd+1E3/this.browser.scale;a=[];if(this.knownCoverage)for(var g=this.knownCoverage.ranges(),l=0;l<g.length;++l){var k=g[l];0==l?k.min()>c&&a.push({min:c,max:k.min()-1}):a.push({min:g[l-1].max()+1,max:k.min()-1});l==g.length-1&&k.max()<f&&a.push({min:k.max()+1,max:f})}if(0<a.length)for(d.fillStyle="gray",c=0;c<a.length;++c)f=a[c],g=(f.min-this.browser.viewStart)*this.browser.scale+1E3,d.fillRect(g,0,(f.max-this.browser.viewStart)*this.browser.scale+1E3-g,b);
b=new n;a=(this.glyphCacheOrigin-this.browser.viewStart)*this.browser.scale+1E3;d.translate(a,this.padding);b.translate(0,this.padding);this.paintToContext(d,b,a);this.overlayLabelCanvas=0<b.glyphs.length?b:null;d.restore();this.drawOverlay();this.paintQuant()}};u.prototype.paintToContext=function(a,d,b){var c=this.subtiers,n=this.viewport.width|0;a.save();for(var f=0;f<c.length;++f){for(var g=null,l=c[f].glyphs,k=0;k<l.length;++k){var m=l[k];m.min()<n-b&&m.max()>-b&&(m=l[k],m.draw(a,d),m.quant&&
(g=m.quant))}a.translate(0,c[f].height+this.padding);d.translate(0,c[f].height+this.padding)}a.restore();g&&this.quantLeapThreshold&&this.featureSource&&this.browser.sourceAdapterIsCapable(this.featureSource,"quantLeap")&&(d=c[0].height*(1-(this.quantLeapThreshold-g.min)/(g.max-g.min)),a.save(),a.strokeStyle="red",a.lineWidth=0.3,a.beginPath(),a.moveTo(-1E3,d),a.lineTo(n+1E3,d),a.stroke(),a.restore())};u.prototype.paintQuant=function(){if(this.quantOverlay){var a=this.browser.retina&&1<window.devicePixelRatio,
d;this.subtiers&&0<this.subtiers.length&&(d=this.subtiers[0].quant);if(d){var b=this.subtiers[0].height;this.quantOverlay.height=this.viewport.height;this.quantOverlay.width=a?100:50;this.quantOverlay.style.height=""+(a?this.quantOverlay.height/2:this.quantOverlay.height)+"px";this.quantOverlay.style.width="50px";this.quantOverlay.style.display="block";var c=this.quantOverlay.getContext("2d");a&&c.scale(2,2);a=2;40<b&&(a=1+(b/20|0));var n=(b+2*this.padding)/(a-1),f=(d.max-d.min)/(a-1);c.fillStyle=
"white";c.globalAlpha=0.6;"right"==this.browser.rulerLocation?c.fillRect(20,0,30,b+2*this.padding):c.fillRect(0,0,30,b+2*this.padding);c.globalAlpha=1;c.strokeStyle="black";c.lineWidth=1;c.beginPath();if("right"==this.browser.rulerLocation){c.moveTo(42,this.padding);c.lineTo(50,this.padding);c.lineTo(50,b+this.padding);c.lineTo(42,b+this.padding);for(var g=1;g<a-1;++g){var l=g*n;c.moveTo(50,l);c.lineTo(45,l)}}else for(c.moveTo(8,this.padding),c.lineTo(0,this.padding),c.lineTo(0,b+this.padding),c.lineTo(8,
b+this.padding),g=1;g<a-1;++g)l=g*n,c.moveTo(0,l),c.lineTo(5,l);c.stroke();c.fillStyle="black";if("right"==this.browser.rulerLocation)for(c.textAlign="right",c.fillText(T(d.max),41,8),c.fillText(T(d.min),41,b+this.padding),g=1;g<a-1;++g)l=g*n,c.fillText(T(1*d.max-g*f),41,l+3);else for(c.textAlign="left",c.fillText(T(d.max),9,8),c.fillText(T(d.min),9,b+this.padding),g=1;g<a-1;++g)l=g*n,c.fillText(T(1*d.max-g*f),9,l+3)}else this.quantOverlay.style.display="none"}};u.prototype.styleForFeature=function(a){var d=
this.browser.zoomForCurrentScale();if(!this.stylesheet)return null;for(var b=null,c=this.stylesheet.styles,n=0;n<c.length;++n){var f=c[n];if(!(f.zoom&&f.zoom!=d||f.orientation&&f.orientation!=a.orientation)){var g=f._labelRE;g&&g.test||(g=new RegExp("^"+f.label+"$"),f._labelRE=g);if(!f.label||g.test(a.label))if(g=f._methodRE,g&&g.test||(g=new RegExp("^"+f.method+"$"),f._methodRE=g),!f.method||g.test(a.method)){if(f.type)if("default"==f.type){b||(b=f.style);continue}else if(g=f._typeRE,g&&g.test||
(g=new RegExp("^"+f.type+"$"),f._typeRE=g),!g.test(a.type))continue;return f.style}}}return b};u.prototype.quantMin=function(a){return this.forceMinDynamic?this.currentFeaturesMinScore||0:"number"===typeof this.forceMin?this.forceMin:a.MIN||this.currentFeaturesMinScore||0};u.prototype.quantMax=function(a){return this.forceMaxDynamic?this.currentFeaturesMaxScore||0:"number"===typeof this.forceMax?this.forceMax:a.MAX||this.currentFeaturesMaxScore||0};"undefined"!==typeof t&&(t.exports={drawFeatureTier:p})},
{"./cigar":8,"./color":9,"./das":10,"./features":19,"./glyphs":20,"./numformats":25,"./spans":34,"./tier":43,"./utils":47}],18:[function(e,t,s){function r(a,b,m){var g=h(m.type,b.type),k=h(m.label,b.label,m.id,b.id);k&&0!=k.indexOf("__dazzle")&&(g=g+": "+k);this.hit=a;this.feature=b;this.group=m;this.title=g;this.sections=[]}function p(a,b){var m=[];if(a)for(var g=0;g<a.length;++g)w(m,a[g]);if(b)for(g=0;g<b.length;++g)w(m,b[g]);return m}if("undefined"!==typeof e){var q=e("./cbrowser").Browser;e=e("./utils");
var h=e.pick,w=e.pushnew,u=e.makeElement}var z=/^([A-Za-z_-]+)=(.+)/;q.prototype.addFeatureInfoPlugin=function(a){this.featureInfoPlugins||(this.featureInfoPlugins=[]);this.featureInfoPlugins.push(a)};r.prototype.setTitle=function(a){this.title=a};r.prototype.add=function(a,b){"string"===typeof b&&(b=u("span",b));this.sections.push({label:a,info:b})};q.prototype.featurePopup=function(a,b,m,g){var k=m.length;b=0<=--k?m[k]:{};var f=0<=--k?m[k]:{};m=new r(m,b,f);m.tier=g;for(var k=this.featureInfoPlugins||
[],c=0;c<k.length;++c)try{k[c](b,m)}catch(h){console.log(h.stack||h)}k=g.featureInfoPlugins||[];for(c=0;c<k.length;++c)try{k[c](b,m)}catch(e){console.log(e.stack||e)}this.removeAllPopups();g=u("table",null,{className:"table table-striped table-condensed"});g.style.width="100%";g.style.margin="0px";k=0;b.method&&(c=u("tr",[u("th","Method"),u("td",b.method)]),g.appendChild(c),++k);c=f.segment?f:b;c=u("tr",[u("th","Location"),u("td",c.segment+":"+c.min+"-"+c.max,{},{minWidth:"200px"})]);g.appendChild(c);
++k;void 0===b.score||null===b.score||"-"==b.score||b.suppressScore||(c=u("tr",[u("th","Score"),u("td",""+b.score)]),g.appendChild(c),++k);(c=p(f.links,b.links))&&0<c.length&&(c=u("tr",[u("th","Links"),u("td",c.map(function(a){return u("div",u("a",a.desc,{href:a.uri,target:"_new"}))}))]),g.appendChild(c),++k);b=p(f.notes,b.notes);for(f=0;f<b.length;++f){var c="Note",q=b[f],L=q.match(z);L&&(c=L[1],q=L[2]);c=u("tr",[u("th",c),u("td",q)]);g.appendChild(c);++k}for(b=0;b<m.sections.length;++b)k=m.sections[b],
g.appendChild(u("tr",[u("th",k.label),u("td",k.info)]));this.popit(a,m.title||"Feature",g,{width:450})}},{"./cbrowser":6,"./utils":47}],19:[function(e,t,s){function r(h){for(var e=h.browser.drawnStart,r=h.browser.drawnEnd,z={},a={},b={},m={},g={},k={},f={},c={},v=[],B,N,L,O=function(){L={};for(var a=0;a<h.currentFeatures.length;++a){var d=h.currentFeatures[a];d.id&&(L[d.id]=d)}},y=function(a){var d=[];if(a.parents)for(var b=0;b<a.parents.length;++b){var c=a.parents[b],f=L[c];f&&"SO:0000704"==f.typeCv&&
pushnew(d,c)}return d},J=0;J<h.currentFeatures.length;++J){var F=h.currentFeatures[J];if(!F.parts){var G=F.min<=r&&F.max>=e;if(F.min&&F.max){if(F.score&&"."!=F.score&&"-"!=F.score){var s=1*F.score;if(!B||s<B)B=s;if(!N||s>N)N=s}var s=[],d=null;if(F.groups)for(var x=0;x<F.groups.length;++x){var C=F.groups[x],I=C.id;if("gene"==C.type)d=I,k[I]=C;else if("translation"!=C.type){p(a,I,F);k[I]=C;s.push(I);C=m[I];if(!C||F.min<C)m[I]=F.min;C=g[I];if(!C||F.max>C)g[I]=F.max}}if(F.parents)for(L||O(),x=0;x<F.parents.length;++x){var l=
F.parents[x],D=L[l];if(D){D.parts||(D.parts=[F]);q(a,l,D);p(a,l,F);k[l]||(k[l]={type:D.type,id:D.id,label:D.label||D.id});s.push(l);C=m[l];if(!C||F.min<C)m[l]=F.min;C=g[l];if(!C||F.max>C)g[l]=F.max;C=y(D);0<C.length&&(d=C[0],l=L[C[0]],k[C[0]]={type:l.type,id:l.id,label:l.label||l.id},h.dasSource.collapseSuperGroups||(h.dasSource.collapseSuperGroups=!0))}}if(0==s.length)G&&p(z,F.type,F);else if(d)for(C=0;C<s.length;++C)I=s[C],q(f,d,I),c[I]=d}else v.push(F)}}for(I in a)v=k[I],"number"!==typeof v.min&&
(v.min=m[I]),"number"!==typeof v.max&&(v.max=g[I]),g[I]>=e&&m[I]<=r&&(b[I]=a[I]);h.ungroupedFeatures=z;h.groupedFeatures=b;h.groups=k;h.superGroups=f;h.groupsToSupers=c;B&&(0<B?B=0:0>N&&(N=0),h.currentFeaturesMinScore=B,h.currentFeaturesMaxScore=N)}if("undefined"!==typeof e){e=e("./utils");var p=e.pusho,q=e.pushnewo}"undefined"!==typeof t&&(t.exports={sortFeatures:r})},{"./utils":47}],20:[function(e,t,s){function r(a,d){this._stroke=a;this._fill=d}function p(a,d,b,c,f,g,l,k){this.x=a;this.y=d;this._width=
b;this._height=c;this.fill=f;this.stroke=g;this._alpha=l;this._radius=k||0}function q(a,d){this.glyphs=a;this.connector=d;this.h=a[0].height();for(var b=[],c=0;c<a.length;++c){var f=a[c];b.push(new I(f.min(),f.max()));this.h=Math.max(this.h,f.height())}this.coverage=C(b)}function h(a,d,b){this.points=a;this.color=d;this._height=b||50}function w(a,d,b,c,f,g,l){this.glyph=d;this.text=b;this.anchor=f||"left";this.align=g||"below";l&&(this.font=l);this.font&&(a.save(),a.font=this.font);b=a.measureText(b);
this.font&&a.restore();this.textLen=b.width;this.textHeight=5;this.bump=d.bump;this.measured=!c}function u(a,d,b){this._x=a;this._height=d;this._stroke=b}function z(a,d,b){this._x=a;this._height=d;this._stroke=b}function a(a,d,b,c,f,g){r.call(this,g,f);this._x=a;this._height=d;this._dir=b;this._width=c}function b(a,d,b,c){this._x=a;this._height=d;this._fill=b;this._stroke=c}function m(a,d,b){this.glyph=a;this._min=d;this._max=b;a&&(this.bump=a.bump)}function g(a,d,b,c,f,g){r.call(this,f,c);this._min=
a;this._max=d;this._height=b;this._ori=g}function k(a,d,b,c){r.call(this,c,null);this._min=a;this._max=d;this._height=b}function f(a,d,b,c,f,g){this._min=a;this._max=d;this._height=b;this._style=c;this._strand=f;this._stroke=g}function c(a,d,b,c,f){this._min=a;this._max=d;this._height=b;this._fill=c;this._stroke=f}function v(a,d,b,c,f,g,l){r.call(this,null,c);this._min=a;this._max=d;this._height=b;this._color=c;this._parallel=f;this._sw=g;this._ne=l}function B(a,d,b,c,f){this._min=a;this._max=d;this._height=
b;this._fill=c;this._stroke=f}function N(a,d,b,c,f,g){this._min=d;this._max=b;this._height=c;this._fill=f;this._string=g;this._textLen=a.measureText(g).width}function L(a,d,b){var c={red:"darkred",purple:"mediumpurple",blue:"darkblue",green:"darkgreen"}[b.toLowerCase()];b=c?[b,c]:["rgb(73, 68, 149)","rgb(9, 0, 103)"];return"?"==a?"black":"M"==a?"greenyellow":"*"==a?"crimson":b[d%2]}function O(a){var d={A:"T",T:"A",G:"C",C:"G"};a=a.split("").reverse().join("");for(var b=[],c=0;c<a.length;++c){var f=
a.substr(c,1).toUpperCase();b.push(f in d?d[f]:"N")}return b.join("")}function y(a,d,b,c,f,g,l){this._min=a;this._max=d;this._height=b;this._fill=c;this._seq=f;this._orientation=g;this._readframe=l}function J(a,d,b,c){this.glyph=a;this._height=c;this._x=d;this._y=b}function F(a,d,b,c){this._x=a;this._y=d;this._height=b;this._fill=c}function G(a){this._height=a||50}function H(a,d,b,c,f){r.call(this,f,c);this._x=a;this._r=d;this._points=b}function d(a,d,b,c,f){this._x=a;this._height=d;this._overhang=
b;this._fill=c;this._stroke=f;this._hh=d/2}function x(){this.oy=this.ox=0;this.glyphs=[]}if("undefined"!==typeof e){s=e("./spans");var C=s.union,I=s.Range;s=e("./utils");var l=s.makeElementNS,D=s.AMINO_ACID_TRANSLATION;e=e("./svg-utils");var E=e.NS_SVG,A=e.SVGPath}r.prototype.draw=function(a){a.beginPath();this.drawPath(a);this._fill&&(a.fillStyle=this._fill,a.fill());this._stroke&&(a.strokeStyle=this._stroke,a.stroke())};r.prototype.toSVG=function(){var a=new A;this.drawPath(a);return l(E,"path",
null,{d:a.toPathData(),fill:this._fill||"none",stroke:this._stroke||"none"})};r.prototype.drawPath=function(a){throw"drawPath method on PathGlyphBase must be overridden";};p.prototype.draw=function(a){var d=this._radius;0<d?(a.beginPath(),a.moveTo(this.x+d,this.y),a.lineTo(this.x+this._width-d,this.y),a.arcTo(this.x+this._width,this.y,this.x+this._width,this.y+d,d),a.lineTo(this.x+this._width,this.y+this._height-d),a.arcTo(this.x+this._width,this.y+this._height,this.x+this._width-d,this.y+this._height,
d),a.lineTo(this.x+d,this.y+this._height),a.arcTo(this.x,this.y+this._height,this.x,this.y+this._height-d,d),a.lineTo(this.x,this.y+d),a.arcTo(this.x,this.y,this.x+d,this.y,d),a.closePath(),null!=this._alpha&&(a.save(),a.globalAlpha=this._alpha),this.fill&&(a.fillStyle=this.fill,a.fill()),this.stroke&&(a.strokeStyle=this.stroke,a.lineWidth=0.5,a.stroke())):(null!=this._alpha&&(a.save(),a.globalAlpha=this._alpha),this.fill&&(a.fillStyle=this.fill,a.fillRect(this.x,this.y,this._width,this._height)),
this.stroke&&(a.strokeStyle=this.stroke,a.lineWidth=0.5,a.strokeRect(this.x,this.y,this._width,this._height)));null!=this._alpha&&a.restore()};p.prototype.toSVG=function(){var a=l(E,"rect",null,{x:this.x,y:this.y,width:this._width,height:this._height,stroke:this.stroke||"none",strokeWidth:0.5,fill:this.fill||"none"});null!=this._alpha&&a.setAttribute("opacity",this._alpha);return a};p.prototype.min=function(){return this.x};p.prototype.max=function(){return this.x+this._width};p.prototype.height=
function(){return this.y+this._height};q.prototype.drawConnectors=function(a){for(var d=this.coverage.ranges(),b=1;b<d.length;++b){var c=d[b],f=d[b-1];if(f&&c.min()>f.max()){var f=f.max(),c=c.min(),g=(f+c)/2;"hat+"===this.connector?(a.moveTo(f,this.h/2),a.lineTo(g,0),a.lineTo(c,this.h/2)):"hat-"===this.connector?(a.moveTo(f,this.h/2),a.lineTo(g,this.h),a.lineTo(c,this.h/2)):"collapsed+"===this.connector?(a.moveTo(f,this.h/2),a.lineTo(c,this.h/2),4<c-f&&(a.moveTo(g-2,this.h/2-3),a.lineTo(g+2,this.h/
2),a.lineTo(g-2,this.h/2+3))):"collapsed-"===this.connector?(a.moveTo(f,this.h/2),a.lineTo(c,this.h/2),4<c-f&&(a.moveTo(g+2,this.h/2-3),a.lineTo(g-2,this.h/2),a.lineTo(g+2,this.h/2+3))):(a.moveTo(f,this.h/2),a.lineTo(c,this.h/2))}}};q.prototype.draw=function(a,d){for(var b=0;b<this.glyphs.length;++b)this.glyphs[b].draw(a,d);a.strokeStyle="black";a.beginPath();this.drawConnectors(a);a.stroke()};q.prototype.toSVG=function(){for(var a=l(E,"g"),d=0;d<this.glyphs.length;++d)a.appendChild(this.glyphs[d].toSVG());
d=new A;this.drawConnectors(d);0<d.toPathData().length&&(d=l(E,"path",null,{d:d.toPathData(),fill:"none",stroke:"black",strokeWidth:0.5}),a.appendChild(d));return a};q.prototype.min=function(){return this.coverage.min()};q.prototype.max=function(){return this.coverage.max()};q.prototype.height=function(){return this.h};h.prototype.min=function(){return this.points[0]};h.prototype.max=function(){return this.points[this.points.length-2]};h.prototype.height=function(){return this._height};h.prototype.draw=
function(a){a.save();a.strokeStyle=this.color;a.lineWidth=2;a.beginPath();for(var d=0;d<this.points.length;d+=2){var b=this.points[d],c=this.points[d+1];0==d?a.moveTo(b,c):a.lineTo(b,c)}a.stroke();a.restore()};h.prototype.toSVG=function(){for(var a=new A,d=0;d<this.points.length;d+=2){var b=this.points[d],c=this.points[d+1];0==d?a.moveTo(b,c):a.lineTo(b,c)}return l(E,"path",null,{d:a.toPathData(),fill:"none",stroke:this.color,strokeWidth:"2px"})};w.prototype.toSVG=function(){var a=this.glyph.toSVG(),
d={};"above"==this.align?(a=l(E,"g",a,{transform:"translate(0, "+(this.textHeight|2)+")"}),d.y=this.textHeight):d.y=this.glyph.height()+15;this.font&&(d.fontSize=7);d.x="center"==this.anchor?(this.glyph.min()+this.glyph.max()-this.textLen)/2:this.glyph.min();return l(E,"g",[a,l(E,"text",this.text,d)])};w.prototype.min=function(){return this.glyph.min()};w.prototype.max=function(){return this.measured?Math.max(this.glyph.max(),1*this.glyph.min()+this.textLen+10):this.glyph.max()};w.prototype.height=
function(){var a=this.glyph.height();this.measured&&(a="above"==this.align?a+(this.textHeight+2):a+20);return a};w.prototype.draw=function(a,d){"above"==this.align&&(a.save(),a.translate(0,this.textHeight+2));this.glyph.draw(a);"above"==this.align&&a.restore();d.registerGlyph(this)};w.prototype.drawOverlay=function(a,d,b){a.fillStyle="black";this.font&&(a.save(),a.font=this.font);"center"==this.anchor?b=(this.glyph.min()+this.glyph.max()-this.textLen)/2:(b=this.glyph.min(),b<d&&(b=Math.min(d,this.glyph.max()-
this.textLen)));a.fillText(this.text,b,"above"==this.align?this.textHeight:this.glyph.height()+15);this.font&&a.restore()};u.prototype.draw=function(a){var d=this._height/2;a.beginPath();a.moveTo(this._x,0);a.lineTo(this._x,this._height);a.moveTo(this._x-d,d);a.lineTo(this._x+d,d);a.strokeStyle=this._stroke;a.lineWidth=1;a.stroke()};u.prototype.toSVG=function(){var a=this._height/2,d=new A;d.moveTo(this._x,0);d.lineTo(this._x,this._height);d.moveTo(this._x-a,a);d.lineTo(this._x+a,a);return l(E,"path",
null,{d:d.toPathData(),fill:"none",stroke:this._stroke,strokeWidth:"1px"})};u.prototype.min=function(){return this._x-this._height/2};u.prototype.max=function(){return this._x+this._height/2};u.prototype.height=function(){return this._height};z.prototype.draw=function(a){var d=this._height/2;a.beginPath();a.moveTo(this._x-d,0);a.lineTo(this._x+d,this._height);a.moveTo(this._x-d,this._height);a.lineTo(this._x+d,0);a.strokeStyle=this._stroke;a.lineWidth=1;a.stroke()};z.prototype.toSVG=function(){var a=
this._height/2,d=new A;d.moveTo(this._x-a,0);d.lineTo(this._x+a,this._height);d.moveTo(this._x-a,this._height);d.lineTo(this._x+a,0);return l(E,"path",null,{d:d.toPathData(),fill:"none",stroke:this._stroke,strokeWidth:"1px"})};z.prototype.min=function(){return this._x-this._height/2};z.prototype.max=function(){return this._x+this._height/2};z.prototype.height=function(){return this._height};a.prototype=Object.create(r.prototype);a.prototype.drawPath=function(a){var d=this._height/2,b=this._width/
2;"S"===this._dir?(a.moveTo(this._x,this._height),a.lineTo(this._x-b,0),a.lineTo(this._x+b,0)):"W"===this._dir?(a.moveTo(this._x+b,d),a.lineTo(this._x-b,0),a.lineTo(this._x-b,this._height)):"E"===this._dir?(a.moveTo(this._x-b,d),a.lineTo(this._x+b,0),a.lineTo(this._x+b,this._height)):(a.moveTo(this._x,0),a.lineTo(this._x+b,this._height),a.lineTo(this._x-b,this._height));a.closePath()};a.prototype.min=function(){return this._x-this._height/2};a.prototype.max=function(){return this._x+this._height/
2};a.prototype.height=function(){return this._height};b.prototype.draw=function(a){var d=this._height/2;a.fillStyle=this._stroke;a.beginPath();a.arc(this._x,d,d,0,6.29);this._fill&&(a.fillStyle=this._fill,a.fill());this._stroke&&(a.strokeStyle=this._stroke,a.stroke())};b.prototype.toSVG=function(){var a=this._height/2;return l(E,"circle",null,{cx:this._x,cy:a,r:a,fill:this._fill||"none",stroke:this._stroke||"none",strokeWidth:"1px"})};b.prototype.min=function(){return this._x-this._height/2};b.prototype.max=
function(){return this._x+this._height/2};b.prototype.height=function(){return this._height};m.prototype.draw=function(a,d){this.glyph&&this.glyph.draw(a,d)};m.prototype.toSVG=function(){return this.glyph?this.glyph.toSVG():l(E,"g")};m.prototype.min=function(){return this._min};m.prototype.max=function(){return this._max};m.prototype.height=function(){return this.glyph?this.glyph.height():1};g.prototype=Object.create(r.prototype);g.prototype.min=function(){return this._min};g.prototype.max=function(){return this._max};
g.prototype.height=function(){return this._height};g.prototype.drawPath=function(a){var d=this._max,b=this._min,c=this._height,f=0,g=0,l=this._height+2,k=0.333333*this._height;this._ori&&("+"===this._ori?g=0.5*this._height:"-"===this._ori&&(f=0.5*this._height));d-b<l&&(b=(d+b-l)/2,d=b+l);a.moveTo(b+f,0+k);a.lineTo(d-g,0+k);a.lineTo(d-g,0);a.lineTo(d,0+this._height/2);a.lineTo(d-g,0+c);a.lineTo(d-g,0+k+k);a.lineTo(b+f,0+k+k);a.lineTo(b+f,0+c);a.lineTo(b,0+c/2);a.lineTo(b+f,0);a.lineTo(b+f,0+k)};k.prototype=
Object.create(r.prototype);k.prototype.min=function(){return this._min};k.prototype.max=function(){return this._max};k.prototype.height=function(){return this._height};k.prototype.drawPath=function(a){var d=this._min,b=this._max,c=this._height,f=c/2;a.moveTo(d,f);a.lineTo(b,f);a.moveTo(d,0);a.lineTo(d,c);a.moveTo(b,0);a.lineTo(b,c)};f.prototype.min=function(){return this._min};f.prototype.max=function(){return this._max};f.prototype.height=function(){return this._height};f.prototype.drawPath=function(a){var d=
this._min,b=this._max,c=this._height,f=c/2;"hat"===this._style?(a.moveTo(d,f),a.lineTo((d+b)/2,"-"===this._strand?c:0)):a.moveTo(d,f);a.lineTo(b,f)};f.prototype.draw=function(a){a.beginPath();this.drawPath(a);a.strokeStyle=this._stroke;"dashed"===this._style&&a.setLineDash?(a.save(),a.setLineDash([3]),a.stroke(),a.restore()):a.stroke()};f.prototype.toSVG=function(){var a=new A;this.drawPath(a);a={d:a.toPathData(),stroke:this._stroke||"none"};"dashed"===this._style&&(a.strokeDasharray="3");return l(E,
"path",null,a)};c.prototype.min=function(){return this._min};c.prototype.max=function(){return this._max};c.prototype.height=function(){return this._height};c.prototype.drawStemPath=function(a){var d=this._max,b=this._height/2;a.moveTo(this._min,b);a.lineTo(d,b)};c.prototype.drawTrigsPath=function(a){var d=this._min,b=this._max,c=this._height,f=c/2;a.moveTo(d,0);a.lineTo(d+c,f);a.lineTo(d,c);a.lineTo(d,0);a.moveTo(b,0);a.lineTo(b-c,f);a.lineTo(b,c);a.lineTo(b,0)};c.prototype.draw=function(a){a.beginPath();
this.drawStemPath(a);a.strokeStyle=this._stroke;a.stroke();a.beginPath();this.drawTrigsPath(a);a.fillStyle=this._fill;a.fill()};c.prototype.toSVG=function(){var a=new A;this.drawStemPath(a);var d=new A;this.drawTrigsPath(d);return l(E,"g",[l(E,"path",null,{d:a.toPathData(),stroke:this._stroke||"none"}),l(E,"path",null,{d:d.toPathData(),fill:this._fill||"none"})])};v.prototype=Object.create(r.prototype);v.prototype.min=function(){return this._min};v.prototype.max=function(){return this._max};v.prototype.height=
function(){return this._height};v.prototype.drawPath=function(a){var d=this._min,b=this._max,c=this._height;if(this._parallel){var f=c/2,g=0.4*c;this._sw?(a.moveTo(d+f,c-g),a.lineTo(d+f,c),a.lineTo(d,f),a.lineTo(d+f,0),a.lineTo(d+f,g)):(a.moveTo(d,c-g),a.lineTo(d,g));this._ne?(a.lineTo(b-f,g),a.lineTo(b-f,0),a.lineTo(b,f),a.lineTo(b-f,c),a.lineTo(b-f,c-g)):(a.lineTo(b,g),a.lineTo(b,c-g))}else{var f=(d+b)/2,g=0.4*(b-d),l=c/3;this._ne?(a.moveTo(d+g,l),a.lineTo(d,l),a.lineTo(f,0),a.lineTo(b,l),a.lineTo(b-
g,l)):(a.moveTo(d+g,0),a.lineTo(b-g,0));this._sw?(a.lineTo(b-g,c-l),a.lineTo(b,c-l),a.lineTo(f,c),a.lineTo(d,c-l),a.lineTo(d+g,c-l)):(a.lineTo(b-g,c),a.lineTo(d+g,c))}a.closePath()};B.prototype.min=function(){return this._min};B.prototype.max=function(){return this._max};B.prototype.height=function(){return this._height};B.prototype.toSVG=function(){return l(E,"rect",null,{x:this._min,y:0,width:this._max-this._min,height:this._height,stroke:this._stroke||"none",fill:this._fill||"none"})};B.prototype.draw=
function(a){this._fill&&(a.fillStyle=this._fill,a.fillRect(this._min,0,this._max-this._min,this._height));if(this._stroke){a.strokeStyle=this._stroke;a.strokeRect(this._min,0,this._max-this._min,this._height);a.beginPath();for(var d=2;d<this._height;d+=3)a.moveTo(this._min,d),a.lineTo(this._max,d);a.stroke()}};N.prototype.min=function(){return this._min};N.prototype.max=function(){return Math.max(this._max,this._min+this._textLen)};N.prototype.height=function(){return this._height};N.prototype.draw=
function(a){a.fillStyle=this._fill;a.fillText(this._string,this._min,this._height-4)};N.prototype.toSVG=function(){return l(E,"text",this._string,{x:this._min,y:this._height-4})};y.prototype.min=function(){return this._min};y.prototype.max=function(){return this._max};y.prototype.height=function(){return this._height};y.prototype.draw=function(a){var d=this._seq,b=this._fill;if(d){var c=(this._max-this._min+1)/d.length,f=(3-this._readframe)%3,g=(d.length-f)%3,f="+"==this._orientation?f:g;0<f&&(a.fillStyle=
b,a.fillRect(this._min,0,c*f,this._height));for(;f<d.length;f+=3){g=d.substr(f,3).toUpperCase();"-"==this._orientation&&(g=O(g));var l=g in D?D[g]:"?",b=3==g.length?L(l,f,this._fill):this._fill;a.fillStyle=b;a.fillRect(this._min+f*c,0,c*g.length,this._height);8<=c&&3==g.length&&(a.fillStyle="white",a.fillText(l,this._min+(f+1)*c,this._height))}}};y.prototype.toSVG=function(){var a=l(E,"g"),d=this._seq,b=this._fill;if(!d)return a;var c=(this._max-this._min+1)/d.length,f=(3-this._readframe)%3,g=(d.length-
f)%3,f="+"==this._orientation?f:g;for(0<f&&a.appendChild(l(E,"rect",null,{x:this._min,y:0,width:c*f,height:this._height,fill:b}));f<d.length;f+=3){g=d.substr(f,3).toUpperCase();"-"==this._orientation&&(g=O(g));var k=g in D?D[g]:"?",b=3==g.length?L(k,f,this._fill):this._fill;a.appendChild(l(E,"rect",null,{x:this._min+f*c,y:0,width:c*g.length,height:this._height,fill:b}));8<=c&&3==g.length&&a.appendChild(l(E,"text",k,{x:this._min+(f+1)*c,y:this._height,fill:"white"}))}return a};(function(a){function d(a,
b,c,f,g,l,k,n,m,h){this.baseColors=a;this._strandColor=b;this._min=c;this._max=f;this._height=g;this._seq=l;this._ref=k;this._scheme=n;this._quals=m;this._fillbg=h}var b=1<window.devicePixelRatio,c={},f=/^[ACGT-]$/;d.prototype.min=function(){return this._min};d.prototype.max=function(){return this._max};d.prototype.height=function(){return this._height};d.prototype.alphaForQual=function(a){return 0.1+0.9*Math.max(0,Math.min(1*a/30,1))};d.prototype.draw=function(a){var d=this._seq,g=this._ref,l="mismatch-all"===
this._scheme,k=d?d.length:this._max-this._min+1,n=(this._max-this._min+1)/k;"mismatch"!==this._scheme&&"mismatch-all"!==this._scheme||8<=n||(a.fillStyle=this._strandColor,a.fillRect(this._min,this._height/4,this._max-this._min,this._height/2));for(var m=0;m<k;++m){var h=d?d.substr(m,1).toUpperCase():"N";if(f.test(h)||8<=n){var e=this.baseColors[h];if(this._quals){var x=this._quals.charCodeAt(m)-33,q=a.globalAlpha;a.globalAlpha=this.alphaForQual(x)}e||(x=g?g.substr(m,1).toUpperCase():"N",e="N"==h||
"N"==x?"gray":this._strandColor,l&&(h=x));a.fillStyle=e;x=f.test(h);!this._fillbg&&8<=n&&x||a.fillRect(this._min+m*n,0,n,this._height);if(8<=n&&x){var x=e+"_"+h,v=c[x];if(!v){v=document.createElement("canvas");b?(v.width=16,v.height=20):(v.width=8,v.height=10);var p=v.getContext("2d");b&&p.scale(2,2);p.fillStyle=this._fillbg?"black":e;e=p.measureText(h).width;p.fillText(h,0.5*(8-e),8);c[x]=v}b?a.drawImage(v,this._min+m*n+0.5*(n-8),0,8,10):a.drawImage(v,this._min+m*n+0.5*(n-8),0)}this._quals&&(a.globalAlpha=
q)}}};d.prototype.toSVG=function(){for(var a=this._seq,d=this._ref,b="mismatch-all"===this._scheme,c=(this._max-this._min+1)/this._seq.length,g=l(E,"g"),k=0;k<a.length;++k){var n=a?a.substr(k,1).toUpperCase():"N",m=this.baseColors[n];if(!m){var h=d?d.substr(k,1).toUpperCase():"N",m="N"==n||"N"==h?"gray":this._strandColor;b&&(n=h)}h=1;this._quals&&(h=this._quals.charCodeAt(k)-33,h=this.alphaForQual(h));var e=f.test(n);!this._fillbg&&8<=c&&e||g.appendChild(l(E,"rect",null,{x:this._min+k*c,y:0,width:c,
height:this._height,fill:m,fillOpacity:h}));8<=c&&e&&g.appendChild(l(E,"text",n,{x:this._min+(0.5+k)*c,y:8,textAnchor:"middle",fill:this._fillbg?"black":m,fillOpacity:h}))}return g};a.SequenceGlyph=d})(this);J.prototype.height=function(){return this._height?this._height:this.glyph.height()+this._y};J.prototype.min=function(){return this.glyph.min()+this._x};J.prototype.max=function(){return this.glyph.max()+this._x};J.prototype.minY=function(){return this._y};J.prototype.maxY=function(){return this._y+
this.glyph.height()};J.prototype.draw=function(a,d){a.save();a.translate(this._x,this._y);this.glyph.draw(a,d);a.restore()};J.prototype.toSVG=function(){var a=this.glyph.toSVG();a.setAttribute("transform","translate("+this._x+","+this._y+")");return a};F.prototype.min=function(){return this._x-2};F.prototype.max=function(){return this._x+2};F.prototype.height=function(){return this._height};F.prototype.draw=function(a){a.save();a.globalAlpha=0.3;a.fillStyle=this._fill;a.beginPath();a.arc(this._x,
this._y,1.5,0,6.29);a.fill();a.restore()};F.prototype.toSVG=function(){return l(E,"circle",null,{cx:this._x,cy:this._y,r:2,fill:this._fill,stroke:"none"})};G.prototype.notSelectable=!0;G.prototype.min=function(){return-1E5};G.prototype.max=function(){return 1E5};G.prototype.height=function(){return this._height};G.prototype.draw=function(a){a.save();a.strokeStyle="black";a.lineWidth=0.1;a.beginPath();for(var d=0;d<=this._height;d+=10)a.moveTo(-5E3,d),a.lineTo(5E3,d);a.stroke();a.restore()};G.prototype.toSVG=
function(){for(var a=new A,d=0;d<=this._height;d+=10)a.moveTo(-5E3,d),a.lineTo(5E3,d);return l(E,"path",null,{d:a.toPathData(),fill:"none",stroke:"black",strokeWidth:"0.1px"})};H.prototype=Object.create(r.prototype);H.prototype.min=function(){return this._x-this._r};H.prototype.max=function(){return this._x+this._r};H.prototype.height=function(){return 2*this._r};H.prototype.drawPath=function(a){for(var d=this._x,b=this._r,c=this._r,f=0;f<this._points;++f){var g=6.28*f/this._points,l=d+c*Math.sin(g),
g=b-c*Math.cos(g);0==f?a.moveTo(l,g):a.lineTo(l,g);g=6.28*(f+0.5)/this._points;l=d+0.4*c*Math.sin(g);g=b-0.4*c*Math.cos(g);a.lineTo(l,g)}a.closePath()};d.prototype.draw=function(a){var d=this._height/2;a.fillStyle=this._stroke;a.beginPath();a.arc(this._x,d,d-this._overhang,0,6.29);a.moveTo(this._x,0);a.lineTo(this._x,this._height);this._fill&&(a.fillStyle=this._fill,a.fill());this._stroke&&(a.strokeStyle=this._stroke,a.stroke())};d.prototype.toSVG=function(){var a=this._hh;return l(E,"g",[l(E,"circle",
null,{cx:this._x,cy:a,r:a-this._overhang}),l(E,"line",null,{x1:this._x,y1:0,x2:this._x,y2:this._height})],{fill:this._fill||"none",stroke:this._stroke||"none",strokeWidth:"1px"})};d.prototype.min=function(){return this._x-this._hh};d.prototype.max=function(){return this._x+this._hh};d.prototype.height=function(){return this._height};x.prototype.translate=function(a,d){this.ox+=a;this.oy+=d};x.prototype.registerGlyph=function(a){this.glyphs.push({x:this.ox,y:this.oy,glyph:a})};x.prototype.draw=function(a,
d,b){for(var c=0;c<this.glyphs.length;++c){var f=this.glyphs[c];a.save();a.translate(f.x,f.y);f.glyph.drawOverlay(a,d,b);a.restore()}};"undefined"!==typeof t&&(t.exports={BoxGlyph:p,GroupGlyph:q,LineGraphGlyph:h,LabelledGlyph:w,CrossGlyph:u,ExGlyph:z,TriangleGlyph:a,DotGlyph:b,PaddedGlyph:m,AArrowGlyph:g,SpanGlyph:k,LineGlyph:f,PrimersGlyph:c,ArrowGlyph:v,TooManyGlyph:B,TextGlyph:N,SequenceGlyph:this.SequenceGlyph,AminoAcidGlyph:y,TranslatedGlyph:J,GridGlyph:G,StarGlyph:H,PointGlyph:F,PlimsollGlyph:d,
OverlayLabelCanvas:x})},{"./spans":34,"./svg-utils":37,"./utils":47}],21:[function(e,t,s){function r(e,h){this.base=e;this.query=h}if("undefined"!==typeof e)var p=e("./das").DASFeature;r.prototype.features=function(e,h,r){url=this.base+"/features/"+e.name;h=[];this.query&&h.push(this.query);e.isBounded&&(h.push("start="+e.start),h.push("end="+e.end));0<h.length&&(url=url+"?"+h.join("&"));var u=new XMLHttpRequest;u.onreadystatechange=function(){if(4==u.readyState)if(300<=u.status)r(null,"Error code "+
u.status);else{var h=JSON.parse(u.response).features,a=[];for(fi=0;fi<h.length;++fi){var b=h[fi],m=new p;m.segment=e;m.min=(b.start|0)+1;m.max=b.end|0;b.name&&(m.label=b.name);m.type=b.type||"unknown";a.push(m)}r(a)}};u.open("GET",url,!0);u.responseType="text";u.send("")};"undefined"!==typeof t&&(t.exports={JBrowseStore:r})},{"./das":10}],22:[function(e,t,s){function r(){var a=this;this.reqs=[];this.awaitedFeatures={};this.requestsIssued=new J(function(b,c){a.notifyRequestsIssued=b})}function p(a,
b,c,d,f,g,k){this.chr=a;this.min=b;this.max=c;this.coverage=k;this.scale=d;this.features=f||[];this.status=g}function q(a,b,c,d,g,k){this.tierMap=a;this.chr=b;this.min=c;this.max=d;this.scale=g;this.seqSource=k||new f;this.viewCount=0;this.featureCache={};this.latestViews={}}function h(a,b,c){for(var d=[],f={},g=0;g<a.length;++g){var k=a[g];k.min&&k.max?k.groups&&0<k.groups.length?u(f,k.groups[0].id,k):k.min<=c&&k.max>=b&&d.push(k):d.push(k)}for(var l in f){a=f[l];for(var m=1E11,h=-1E11,g=0;g<a.length;++g)k=
a[g],m=Math.min(m,k.min),h=Math.max(h,k.max);if(m<=c||h>=b)for(g=0;g<a.length;++g)d.push(a[g])}return d}if("undefined"!==typeof e){s=e("./utils");var w=s.Awaited,u=s.pusho;s=e("./sourceadapters");var z=s.MappedFeatureSource,a=s.CachingFeatureSource,b=s.BWGFeatureSource,m=s.RemoteBWGFeatureSource,g=s.BAMFeatureSource,k=s.RemoteBAMFeatureSource,f=s.DummySequenceSource,c=s.DummyFeatureSource,v=e("./overlay").OverlayFeatureSource;s=e("./spans");var B=s.Range,N=s.intersection;s=e("./sample");var L=s.downsample,
O=s.getBaseCoverage,y=e("./das").DASSequence,J=e("es6-promise").Promise}r.prototype.addRequest=function(a){this.reqs.push(a)};r.prototype.abortAll=function(){for(var a=0;a<this.reqs.length;++a)this.reqs[a].abort()};p.prototype.toString=function(){return this.chr+":"+this.min+".."+this.max+";scale="+this.scale};q.prototype.cancel=function(){this.cancelled=!0};q.prototype.bestCacheOverlapping=function(a,b,c){return(a=this.featureCache[this.tierMap[0]])?a:null};q.prototype.viewFeatures=function(a,b,
c,d){if(d!=d)throw"viewFeatures called with silly scale";if(a!=this.chr)throw"Can't extend Known Space to a new chromosome";1>b&&(b=1);this.min=b;this.max=c;this.scale=d;this.pool&&this.pool.abortAll();this.pool=new r;this.awaitedSeq=new w;this.seqWasFetched=!1;this.viewCount++;this.startFetchesForTiers(this.tierMap);this.pool.notifyRequestsIssued()};q.prototype.invalidate=function(a){this.pool&&(this.featureCache[a]=null,this.startFetchesForTiers([a]))};q.prototype.startFetchesForTiers=function(a){for(var b=
this,c=this.awaitedSeq,d=!1,f,g=0;g<a.length;++g)try{this.startFetchesFor(a[g],c)&&(d=!0)}catch(k){f=a[g],f.currentFeatures=[],f.currentSequence=null,f.draw(),f.updateHeight(),f.updateStatus(k),console.log("Error fetching tier source"),console.log(k),f=k}if(d&&!this.seqWasFetched){this.seqWasFetched=!0;var l=this.min,m=this.max;if(this.cs&&this.cs.start<=l&&this.cs.end>=m)return a=this.cs.start==l&&this.cs.end==m?this.cs:new y(this.cs.name,l,m,this.cs.alphabet,this.cs.seq.substring(l-this.cs.start,
m+1-this.cs.start)),c.provide(a);this.seqSource.fetch(this.chr,l,m,this.pool,function(a,d){if(d){if(!b.cs||l<=b.cs.start&&m>=b.cs.end||l>=b.cs.end||m<=b.cs.start||m-l>b.cs.end-b.cs.start)b.cs=d;c.provide(d)}else console.log("Sequence loading failed",a),c.provide(null)})}if(f)throw f;};q.prototype.startFetchesFor=function(a,b){var f=this,d=this.viewCount,g=a.getSource()||new c,k=a.needsSequence(this.scale),m=f.featureCache[a],l=a.getActiveStyleFilters(this.scale),e;l&&(e=l.typeList());var v=this.chr,
q=this.min,n=this.max;if(void 0===e)return!1;if(m&&m.chr===this.chr&&m.min<=q&&m.max>=n){var r=m.features;if(m.min<q||m.max>n)r=h(r,q,n);f.provision(a,m.chr,N(m.coverage,new B(q,n)),m.scale,e,r,m.status,k?b:null);r=g.getScales();if(m.scale<=this.scale||!r)return k}g.instrument&&console.log("Starting  fetch "+d+" ("+q+", "+n+")");g.fetch(v,q,n,this.scale,e,this.pool,function(c,l,h,r){g.instrument&&console.log("Finishing fetch "+d);var u=f.latestViews[a]||-1;if(!(f.cancelled||u>d)){r||(r=new B(q,n));
if(!m||q<m.min||n>m.max)f.featureCache[a]=new p(v,q,n,h,l,c,r);f.latestViews[a]=d;f.provision(a,v,r,h,e,l,c,k?b:null)}},l);return k};q.prototype.provision=function(c,f,h,d,e,q,p,l){p&&(c.currentFeatures=[],c.currentSequence=null,c.draw(),c.updateHeight());c.updateStatus(p);if(!p){for(var r=p=!1,u=c.getSource();z.prototype.isPrototypeOf(u)||a.prototype.isPrototypeOf(u)||v.prototype.isPrototypeOf(u);)u=v.prototype.isPrototypeOf(u)?u.sources[0]:u.source;if(b.prototype.isPrototypeOf(u)||m.prototype.isPrototypeOf(u)||
g.prototype.isPrototypeOf(u)||k.prototype.isPrototypeOf(u))p=!0;u.opts&&(u.opts.forceReduction||u.opts.noDownsample)||p&&e&&1==e.length&&0<=e.indexOf("density")&&(q=L(q,this.scale));e&&1==e.length&&0<=e.indexOf("base-coverage")&&(r=!0);l?l.await(function(a){r&&(q=O(q,a,c.browser.baseColors));c.viewFeatures(f,h,d,q,a)}):c.viewFeatures(f,h,d,q)}};"undefined"!==typeof t&&(t.exports={KnownSpace:q})},{"./das":10,"./overlay":26,"./sample":28,"./sourceadapters":33,"./spans":34,"./utils":47,"es6-promise":51}],
23:[function(e,t,s){function r(a,m){this.block=a;this.offset=m}function p(a,m){var g=4294967296*(a[m+6]&255)+16777216*(a[m+5]&255)+65536*(a[m+4]&255)+256*(a[m+3]&255)+(a[m+2]&255),k=a[m+1]<<8|a[m];return 0==g&&0==k?null:new r(g,k)}function q(b,m){m=Math.min(m||1,b.byteLength-50);for(var g=[],k=[0],f=0;k[0]<m;){var c=new Uint8Array(b,k[0],12),c=c[11]<<8|c[10],c=z(b,12+c+k[0],Math.min(65536,b.byteLength-12-c-k[0]),k);k[0]+=8;f+=c.byteLength;g.push(c)}if(1==g.length)return g[0];k=new Uint8Array(f);for(c=
f=0;c<g.length;++c){var h=new Uint8Array(g[c]);a(h,0,k,f,h.length);f+=h.length}return k.buffer}function h(a,m){this.minv=a;this.maxv=m}function w(a,m){--m;return a>>14==m>>14?4681+(a>>14):a>>17==m>>17?585+(a>>17):a>>20==m>>20?73+(a>>20):a>>23==m>>23?9+(a>>23):a>>26==m>>26?1+(a>>26):0}function u(a,m){var g,k=[];--m;k.push(0);for(g=1+(a>>26);g<=1+(m>>26);++g)k.push(g);for(g=9+(a>>23);g<=9+(m>>23);++g)k.push(g);for(g=73+(a>>20);g<=73+(m>>20);++g)k.push(g);for(g=585+(a>>17);g<=585+(m>>17);++g)k.push(g);
for(g=4681+(a>>14);g<=4681+(m>>14);++g)k.push(g);return k}if("undefined"!==typeof e){e=e("jszlib");var z=e.inflateBuffer,a=e.arrayCopy}r.prototype.toString=function(){return""+this.block+":"+this.offset};"undefined"!==typeof t&&(t.exports={unbgzf:q,readVob:p,reg2bin:w,reg2bins:u,Chunk:h})},{jszlib:63}],24:[function(e,t,s){function r(){this.featuresByChr={};this.maxLength=1;this.chrRing=null}function p(a){this.source=a;w.call(this);this.storeHolder=new u;this.parser=h(a.payload);if(!this.parser)throw"Unsupported memstore payload: "+
a.payload;var b=this;this._load(function(a,g){if(a){for(var k=new r,f=[],c=a.split("\n"),h=b.parser.createSession(function(a){f.push(a)}),e=0;e<c.length;++e){var q=c[e];0<q.length&&h.parse(q)}h.flush();k.addFeatures(f);b.storeHolder.provide(k)}else b.error=g||"No data",b.storeHolder.provide(null)})}if("undefined"!==typeof e){t=e("./sourceadapters");var q=t.registerSourceAdapterFactory,h=t.makeParser,w=t.FeatureSourceBase;e("./das");e=e("./utils");var u=e.Awaited,z=e.textXHR}r.prototype.addFeatures=
function(a){for(var b={},m=0;m<a.length;++m){var g=a[m],k=g.segment||g.chr,f=this.featuresByChr[k];f||(f=[],this.featuresByChr[k]=f);f.push(g);b[k]=!0;g=g.max-g.min+1;g>this.maxLength&&(this.maxLength=g)}for(k in b)f=this.featuresByChr[k],f.sort(function(a,b){var f=a.min-b.min;return 0!=f?f:a.max-b.max});this.chrRing=null};r.prototype._indexFor=function(a,b){for(var m=0,g=a.length;g>m;){var k=(m+g)/2|0;if(k>=a.length)return a.length;b<a[k].min?g=k:m=k+1}return g};r.prototype.fetch=function(a,b,m){var g=
this.featuresByChr[a];g||(g=0==a.indexOf("chr")?this.featuresByChr[a.substring(3)]:this.featuresByChr["chr"+a]);if(!g)return[];var k=Math.max(0,this._indexFor(g,b-this.maxLength-1));a=Math.min(g.length-1,this._indexFor(g,m));for(var f=[];k<=a;++k){var c=g[k];c.min<=m&&c.max>=b&&f.push(c)}return f};r.prototype.findNextFeature=function(a,b,m){if(null==this.chrRing){this.chrRing=[];for(a in this.featuresByChr)this.chrRing.push(a);this.chrRing.sort()}var g=this.featuresByChr[a];g||(a=0==a.indexOf("chr")?
a.substring(3):"chr"+a,g=this.featuresByChr[a]);if(!g)return null;var k=Math.max(0,Math.min(this._indexFor(g,b),g.length-1));if(0<m){for(;k<g.length;){var f=g[k++];if(f.min>b)return f}a=this.chrRing.indexOf(a)+1;a>=this.chrRing.length&&(a=0);return this.findNextFeature(this.chrRing[a],0,m)}for(;0<=k;)if(f=g[k--],f.max<b)return f;a=this.chrRing.indexOf(a)-1;0>a&&(a=this.chrRing.length-1);return this.findNextFeature(this.chrRing[a],1E10,m)};p.prototype=Object.create(w.prototype);p.prototype._load=function(a){if(this.source.blob){var b=
new FileReader;b.onloadend=function(){return a(b.result,b.error)};b.readAsText(this.source.blob)}else z(this.source.uri,a,{})};p.prototype.fetch=function(a,b,m,g,k,f,c){var h=this;this.storeHolder.await(function(f){return f?(f=f.fetch(a,b,m),c(null,f,1E8)):c(h.error)})};p.prototype.getStyleSheet=function(a){this.parser&&this.parser.getStyleSheet&&this.parser.getStyleSheet(a)};p.prototype.getDefaultFIPs=function(a){this.parser&&this.parser.getDefaultFIPs&&this.parser.getDefaultFIPs(a)};p.prototype.getScales=
function(){return 1E8};p.prototype.findNextFeature=function(a,b,m,g){var k=this;this.storeHolder.await(function(f){return f?g(f.findNextFeature(a,b,m)):g(null,k.error)})};p.prototype.capabilities=function(){return{leap:!0}};q("memstore",function(a){return{features:new p(a)}})},{"./das":10,"./sourceadapters":33,"./utils":47}],25:[function(e,t,s){function r(e){return(e|0).toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")}function p(e){e=""+e;var h=e.indexOf(".");if(0>h)return e;var p=2;"-"==e.substring(0,
1)&&++p;return h>=p?e.substring(0,h):e.substring(0,h+2)}"undefined"!==typeof t&&(t.exports={formatLongInt:r,formatQuantLabel:p})},{}],26:[function(e,t,s){function r(e,p){this.sources=e;this.opts=p||{};this.activityListeners=[];this.readinessListeners=[];this.changeListeners=[];this.business=[];this.readiness=[];for(var a=0;a<this.sources.length;++a)this.initN(a);"function"===typeof p.merge?this.merge=p.merge:"concat"==p.merge?this.merge=h:"alternates"==p.merge?(this.merge=h,this.filterDispatchOnMethod=
!0):this.merge=q}function p(h,e,a){this.source=h;this.callback=e;this.sources=a;this.count=a.length;this.statusCount=this.returnCount=0;this.returns=[];this.features=[];this.statuses=[];this.scale=null}function q(h){for(var e=[],a=1;a<h.length;++a){for(var b={},m=h[a],g=0;g<m.length;++g)b[this.keyForFeature(m[g])]=m[g];e.push(b)}a=[];h=h[0];for(g=0;g<h.length;++g){for(var k=h[g],f=0;f<e.length;++f)if(b=e[f],m=b[this.keyForFeature(k)])for(var c in m)"score"===c?k.score2=m.score:"min"!==c&&"max"!==
c&&"segment"!==c&&"_cachedStyle"!==c&&(k[c]=m[c]);a.push(k)}return a}function h(h,e){for(var a=[],b=0;b<h.length;++b)for(var m=h[b],g=e[b].name,k=0;k<m.length;++k){var f=m[k];f.method=g;a.push(f)}return a}if("undefined"!==typeof e)var w=e("./utils").shallowCopy;r.prototype.initN=function(h){var e=this.sources[h],a=this;this.business[h]=0;e.addActivityListener&&e.addActivityListener(function(b){a.business[h]=b;a.notifyActivity()});e.addChangeListener&&e.addChangeListener(function(){a.notifyChange()});
e.addReadinessListener&&e.addReadinessListener(function(b){a.readiness[h]=b;a.notifyReadiness()})};r.prototype.addReadinessListener=function(h){this.readinessListeners.push(h);this.notifyReadinessListener(h)};r.prototype.notifyReadiness=function(){for(var h=0;h<this.readinessListeners.length;++h)this.notifyReadinessListener(this.readinessListeners[h])};r.prototype.notifyReadinessListener=function(h){for(var e=null,a=0;a<this.readiness.length;++a)if(null!=this.readiness[a]){e=this.readiness[a];break}try{h(e)}catch(b){console.log(b)}};
r.prototype.addActivityListener=function(h){this.activityListeners.push(h)};r.prototype.notifyActivity=function(){for(var h=0,e=0;e<this.business.length;++e)h+=this.business[e];for(e=0;e<this.activityListeners.length;++e)try{this.activityListeners[e](h)}catch(a){console.log(a)}};r.prototype.addChangeListener=function(h){this.changeListeners.push(h)};r.prototype.notifyChange=function(){for(var h=0;h<this.changeListeners.length;++h)try{this.changeListeners[h](this.busy)}catch(e){console.log(e)}};r.prototype.getScales=
function(){return this.sources[0].getScales()};r.prototype.getStyleSheet=function(h){return this.sources[0].getStyleSheet(h)};r.prototype.capabilities=function(){var h={},e=this.sources[0];e.capabilities&&(h=w(e.capabilities()));for(e=1;e<this.sources.length;++e){var a=this.sources[e];a.capabilities&&(a=a.capabilities(),a.search&&(h.search=a.search))}return h};r.prototype.search=function(h,e){for(var a=0;a<this.sources.length;++a){var b;b=this.sources[a];b=b.capabilities?b.capabilities().search:!1;
if(b)return this.sources[a].search(h,e)}};r.prototype.fetch=function(h,e,a,b,m,g,k,f){var c;if(this.filterDispatchOnMethod){c=[];for(var q=f.list(),r=0;r<this.sources.length;++r)for(var s=this.sources[r],L=0;L<q.length;++L){var O=q[L];if(!O.method||O.method==s.name){c.push(s);break}}}else c=this.sources;k=new p(this,k,c);for(r=0;r<c.length;++r)this.fetchN(k,r,c[r],h,e,a,b,m,g,f)};r.prototype.fetchN=function(h,e,a,b,m,g,k,f,c,q){a.fetch(b,m,g,k,f,c,function(a,b,c){return h.completed(e,a,b,c)},q)};
r.prototype.quantFindNextFeature=function(h,e,a,b,m){return this.sources[0].quantFindNextFeature(h,e,a,b,m)};r.prototype.findNextFeature=function(h,e,a,b){return this.sources[0].findNextFeature(h,e,a,b)};p.prototype.completed=function(h,e,a,b){if(null==this.scale||0==h)this.scale=b;if(this.returns[h])throw"Multiple returns for source "+h;this.returns[h]=!0;this.returnCount++;this.features[h]=a;e&&(this.statuses[h]=e,this.statusCount++);if(this.returnCount==this.count){if(0<this.statusCount){h="";
for(e=0;e<this.count;++e)if(a=this.statuses[e])0<h.length&&(h+=", "),h+=a;return this.callback(h,null,this.scale)}this.callback(null,this.source.merge(this.features,this.sources),this.scale)}};r.prototype.getDefaultFIPs=function(h){for(var e=0;e<this.sources.length;++e){var a=this.sources[e];a.getDefaultFIPs&&a.getDefaultFIPs(h)}};r.prototype.keyForFeature=function(h){return""+h.min+".."+h.max};"undefined"!==typeof t&&(t.exports={OverlayFeatureSource:r})},{"./utils":47}],27:[function(e,t,s){function r(k,
f,c){var e=/^\w+\s[0-9]+\s[0-9]+.*$/,B=/([^=]+)=\"?([^\"]+)\"?/,s=/^##\s*fileformat=VCFv4\..+/;(k.blob?new h(k.blob):new q(k.uri,{credentials:k.credentials})).slice(0,65536).salted().fetch(function(h,q){if(!h)return c||(k.credentials=!0,r(k,f,!0)),f(k,"Couldn't fetch data");var y=new Uint8Array(h),J=(new Uint32Array(h,0,1))[0];if(J==u||J==z){k.tier_type="bwg";y=/\/?([^/]+?)(.bw|.bb|.bigWig|.bigBed)?$/;if(y=y.exec(k.uri||k.blob.name))k.name=y[1];return f(k,null)}if(J==m)return k.tier_type="bai",f(k,
null);if(31==y[0]||139==y[1]){y=a(h);y=new Uint8Array(y);J=w(y,0);if(J==b){k.tier_type="bam";y=/\/?([^/]+?)(.bam)?$/;if(y=y.exec(k.uri||k.blob.name))k.name=y[1];return f(k,null)}if(J==g)return k.tier_type="tabix-index",f(k,null);if(1768301347==J){k.tier_type="tabix";k.payload="vcf";y=/\/?([^/]+?)(.vcf)?(.gz)?$/;if(y=y.exec(k.uri||k.blob.name))k.name=y[1];return f(k,null)}console.log("magic = "+J.toString(16));return f(k,"Unsupported format")}y=String.fromCharCode.apply(null,y).split("\n");if(0<y.length&&
s.test(y[0]))return k.tier_type="memstore",k.payload="vcf",y=/\/?([^/]+?)(.vcf)?$/,(y=y.exec(k.uri||k.blob.name))&&!k.name&&(k.name=y[1]),f(k,null);for(var t=0;t<y.length;++t)if(J=y[t].replace("\r",""),0!=J.length&&0!=J.indexOf("browser")){if(0==J.indexOf("track")){y="bed";J=J.split(/\s/);for(t=1;t<J.length;++t){var G=B.exec(J[t]);G&&("type"==G[1]&&"wiggle_0"==G[2]?y="wig":"name"==G[0]&&(k.name=G[2]))}p(k,y);return f(k,null)}if(0==J.indexOf("fixedStep")||0==J.indexOf("variableStep"))return p(k,"wig"),
f(k,null);if(e.test(J))return p(k,null),f(k,null);break}return f(k,"Unsupported format")})}function p(a,b){a.tier_type="memstore";var c=/\/?([^/]+?)(.(bed|wig))?$/.exec(a.uri||a.blob.name);c&&(a.name||(a.name=c[1]),!b&&c[3]&&(b=c[3]));a.payload=b||"bed"}if("undefined"!==typeof e){s=e("./bin");var q=s.URLFetchable,h=s.BlobFetchable,w=s.readInt;s=e("./bigwig");var u=s.BIG_WIG_MAGIC,z=s.BIG_BED_MAGIC,a=e("./lh3utils").unbgzf;s=e("./bam");var b=s.BAM_MAGIC,m=s.BAI_MAGIC,g=e("./tabix").TABIX_MAGIC}"undefined"!==
typeof t&&(t.exports={probeResource:r})},{"./bam":1,"./bigwig":3,"./bin":4,"./lh3utils":23,"./tabix":39}],28:[function(e,t,s){function r(a){return m[a%m.length]*Math.pow(10,a/m.length|0)}function p(a,b,f){this.scale=a;this.cnt=this.tot=0;this.hasScore=!1;this.min=b;this.max=f;this.features=[]}function q(a,b){return a.min<b.min?-1:a.min>b.min?1:a.max<b.max?-1:b.max>a.max?1:0}function h(a,b){for(var f=0;r(f+1)<b;)++f;for(var f=r(f),c=[],h=-1E10,e=1E10,m=0;m<a.length;++m){var q=a[m];if(q.groups&&0<q.groups.length)return a;
for(var u=q.min/f|0,y=q.max/f|0,h=Math.max(h,y),e=Math.min(e,u);u<=y;++u){var J=c[u];J||(J=new p(f,u*f,(u+1)*f-1),c[u]=J);J.feature(q)}}m=[];for(u=e;u<=h;++u)if(J=c[u])q=new z,q.segment=a[0].segment,q.min=u*f+1,q.max=(u+1)*f,q.score=J.score(),q.type="density",m.push(q);Date.now();return m}function w(a){this._pos=a;this._bases={};this._totalCount=0}function u(g,k,f){for(var c,h,e=null,m=null,q=[],p=0;p<g.length;++p){var r=g[p];if(r.groups&&0<r.groups.length)return g;c=r.seq;var u=r.quals,s=a(r.cigar),
G=[];h=[];for(var t=0,d=0;d<s.length;++d){var x=s[d];if("M"==x.op)G.push(c.substr(t,x.cnt)),h.push(u.substr(t,x.cnt)),t+=x.cnt;else if("D"==x.op)for(var C=0;C<x.cnt;++C)G.push("-"),h.push("Z");else"I"==x.op?t+=x.cnt:"S"==x.op?t+=x.cnt:console.log("unknown cigop"+x.op)}c=G.join("");h=h.join("");G=c;t=h;d=r.orientation;x=r.min||0;r=r.max||0;h=0;for(c=x;c<=r;++c)s=q[c],s||(s=new w(c),q[c]=s),u=G.charAt(h),C=t.charCodeAt(h)-33,s.recordBase(u,C,d),h++;e=e?Math.min(e,x):x;m=m?Math.max(m,r):r}r=e;p=m;h=
[];if(k&&(c=k.start|0,s=k.end|0,c<=p&&s>=r)){u=Math.max(r,c);s=Math.min(p,s);for(G=0;G<u-r;G++)h.push("N");h.push(k.seq.substr(u-c,s-u+1));for(G=0;G<p-s;G++)h.push("N")}k=h.join("");p=[];h=0;for(c=e;c<=m;++c){if(s=q[c])if(r=new z,r.segment=g[0].segment,r.min=s.pos(),r.max=r.min,r.notes=[],r.notes=r.notes.concat(s.infoList()),r.type="base-coverage",r.suppressScore=!0,k)for(e=k.charAt(h),r.notes.unshift("Ref="+e),s=s.baseScoreList(e,0.2),G=0;G<s.length;G++){u=s[G].base;t=s[G].score;d=b(r);d.score=t;
if(1<s.length||u!=e)d.itemRgb=f[u];p.push(d)}else p.push(r);h++}return p}if("undefined"!==typeof e)var z=e("./das").DASFeature,a=e("./cigar").parseCigar,b=e("./utils").shallowCopy;var m=[1,2,5];p.prototype.score=function(){if(0==this.cnt)return 0;if(this.hasScore)return this.tot/this.cnt;var a=this.features;a.sort(q);for(var b=-1E10,f=0,c=0,h=1;h<a.length;++h){var e=a[h],m=Math.max(e.min,this.min),e=Math.min(e.max,this.max),c=c+(e-m+1);m>b?(f+=e-m+1,b=e):e>b&&(f+=e-b,b=e)}return 0<f?1*c/f:0};p.prototype.feature=
function(a){void 0!==a.score&&(this.tot+=a.score,this.hasScore=!0);++this.cnt;this.features.push(a)};w.prototype.recordBase=function(a,b,f){if(this._bases[a])a=this._bases[a],a.cnt++,a.totalQual+=b,a.strandCnt[f]++;else{var c={"+":0,"-":0};c[f]++;this._bases[a]={cnt:1,totalQual:b,strandCnt:c}}this._totalCount++};w.prototype.totalCount=function(){return this._totalCount};w.prototype.pos=function(){return this._pos};w.prototype.infoList=function(){var a=[],b=this._totalCount;a.push("Depth="+b.toString());
for(var f in this._bases){var c=this._bases[f],h=c.cnt,e=c.strandCnt["+"],m=c.strandCnt["-"],c=c.totalQual/h,h=[f,"=",h," (",(100*h/b).toFixed(0),"%, ",e," +, ",m," -, Qual: ",c.toFixed(0),")"];a.push(h.join(""))}return a};w.prototype.baseScoreList=function(a,b){var f=[],c=this._totalCount,h=b*c,e;for(e in this._bases){var m=this._bases[e].cnt;m<h||e==a||(f.push({base:e,score:c}),c-=m)}f.push({base:a,score:c});return f};"undefined"!==typeof t&&(t.exports={downsample:h,getBaseCoverage:u})},{"./cigar":8,
"./das":10,"./utils":47}],29:[function(e,t,s){function r(h,e){var a=parseFloat(h.replace(/,/g,""));return"k"===e||"K"===e?1E3*a|0:"m"==e||"M"===e?1E6*a|0:a|0}if("undefined"!==typeof e)var p=e("./cbrowser").Browser,q=e("./bin").URLFetchable,h=e("./trix").connectTrix;var w=/^([\d+,\w,\.,\_,\-]+):([0-9,\.]+?)([KkMmGg])?((-|\.\.)+([0-9,\.]+)([KkMmGg])?)?$/;p.prototype.search=function(e,p){var a=this,b=w.exec(e);if(b){var m=b[1],g;if(b[6])g=r(b[2],b[3]),b=r(b[6],b[7]);else{var k=this.viewEnd-this.viewStart+
1;g=r(b[2],b[3])-k/2|0;b=g+k-1}this.setLocation(m,g,b,p)}else{if(!e||0==e.length)return!1;var f=0,c=!1,v=function(b,g){--f;if(g)return p(g);b||(b=[]);for(var k=5E8,h=-1E8,m=null,q=0;q<b.length;++q){var r=b[q];null==m&&(m=r.segment);k=Math.min(k,r.min);h=Math.max(h,r.max)}if(m)c=!0,a.highlightRegion(m,k,h),q=Math.max(2500,0.3*(h-k+1)|0),a.setLocation(m,k-q,h+q,p);else if(0==f&&!c)return p("no match for '"+e+"'")},B=function(a,b){b.lookup(e,function(b,c){if(null==b||2>b.length)return a.featureSource.search(e,
v);var f=b[1].split(",")[0];return a.featureSource.search(f,v)})};if(this.searchEndpoint)return f=1,this.doDasSearch(a.searchEndpoint,e,v);for(m=0;m<this.tiers.length;++m)(function(b){a.sourceAdapterIsCapable(b.featureSource,"search")?b.dasSource.trixURI?(++f,b.trix?B(b,b.trix):h(new q(b.dasSource.trixURI),new q(b.dasSource.trixURI+"x"),function(a){b.trix=a;B(b,a)})):(++f,b.featureSource.search(e,v)):b.dasSource.provides_search&&(++f,a.doDasSearch(b.dasSource,e,v))})(this.tiers[m])}};p.prototype.doDasSearch=
function(h,e,a){h.features(null,{group:e,type:"transcript"},function(b){b||(b=[]);for(var h=[],g=0;g<b.length;++g){var k=b[g];k.label.toLowerCase()==e.toLowerCase()&&h.push(k)}return a(h)},!1)}},{"./bin":4,"./cbrowser":6,"./trix":45}],30:[function(e,t,s){function r(h,g){g||(g=a);for(var k=b.length;h*b[k%b.length]*Math.pow(10,k/b.length|0)<g;)++k;return b[k%b.length]*Math.pow(10,k/b.length|0)}function p(a,b){var k=a.viewport.getContext("2d"),f=a.browser.retina&&1<window.devicePixelRatio,c=a.browser.featurePanelWidth+
2E3;f&&(c*=2);var h=a.viewport.width|0;h<c-50&&(a.viewport.width=h=c);c=50;b&&b.seq&&(c+=25);var e=c;f&&(e*=2);a.viewport.height=e;a.viewport.style.height=""+c+"px";a.viewport.style.width=f?""+h/2+"px":""+h+"px";a.layoutHeight=c;a.updateHeight();a.background&&(k.fillStyle=a.background,k.fillRect(0,0,h,a.viewport.height));f&&k.scale(2,2);q(a,b,k)}function q(a,b,k){var f=a.browser.scale,c=a.browser.viewStart-1E3/f|0,h=a.browser.viewEnd+2E3/f,e=a.browser.currentSeqMax;k.translate(1E3,0);var q=h;0<e&&
e<h&&(q=e);for(var p=r(f),u=Math.max(0,(c/p|0)*p),e=a.browser.viewStart;u<=q;)k.fillStyle=0==u/p%2?"white":"black",k.strokeStyle="black",k.fillRect((u-e)*f,8,p*f,3),k.strokeRect((u-e)*f,8,p*f,3),k.fillStyle="black",k.fillText(w(u),(u-e)*f,22),u+=p;if(b&&b.seq)for(;c<=h;++c)c>=b.start&&c<=b.end&&(q=b.seq.substr(c-b.start,1).toUpperCase(),(p=a.browser.baseColors[q])||(p="gray"),k.fillStyle=p,8<=f?(p=k.measureText(q).width,k.fillText(q,(c-e)*f+0.5*(f-p),52)):k.fillRect((c-e)*f,42,f,12));a.norigin=a.browser.viewStart;
a.viewportHolder.style.left="-1000px"}function h(a,b){var k=a.browser.scale,f=a.browser.viewStart-1E3/k|0,c=a.browser.viewEnd+2E3/k,h=a.browser.currentSeqMax,e=c;0<h&&h<c&&(e=h);for(var q=r(k),p=Math.max(0,(f/q|0)*q),h=a.browser.viewStart,s=u(z,"g",[],{fontSize:"8pt"});p<=e;)s.appendChild(u(z,"rect",null,{x:(p-h)*k,y:8,width:q*k,height:3,fill:0==p/q%2?"white":"black",stroke:"black"})),s.appendChild(u(z,"text",w(p),{x:(p-h)*k,y:28,fill:"black",stroke:"none"})),p+=q;if(b&&b.seq)for(;f<=c;++f)f>=b.start&&
f<=b.end&&(e=b.seq.substr(f-b.start,1).toUpperCase(),(q=a.browser.baseColors[e])||(q="gray"),8<=k?s.appendChild(u(z,"text",e,{x:(0.5+f-h)*k,y:52,textAnchor:"middle",fill:q})):s.appendChild(u(z,"rect",null,{x:(f-h)*k,y:42,width:k,height:12,fill:q})));return s}if("undefined"!==typeof e){s=e("./utils");var w=s.formatLongInt,u=s.makeElementNS,z=e("./svg-utils").NS_SVG,w=e("./numformats").formatLongInt}var a=100,b=[1,2,5],z="http://www.w3.org/2000/svg";"undefined"!==typeof t&&(t.exports={drawSeqTier:p,
drawSeqTierGC:q,svgSeqTier:h})},{"./numformats":25,"./svg-utils":37,"./utils":47}],31:[function(e,t,s){if("undefined"!=typeof e){t=e("./cbrowser");var r=t.Browser,p=t.sourceDataURI,q=t.sourcesAreEqual,h=e("./version"),w=e("./utils").miniJSONify,u=e("./sha1").hex_sha1}r.prototype.nukeStatus=function(){delete localStorage["dalliance."+this.cookieKey+".view-chr"];delete localStorage["dalliance."+this.cookieKey+".view-start"];delete localStorage["dalliance."+this.cookieKey+".view-end"];delete localStorage["dalliance."+
this.cookieKey+".current-seq-length"];delete localStorage["dalliance."+this.cookieKey+".showing-alt-zoom"];delete localStorage["dalliance."+this.cookieKey+".saved-zoom"];delete localStorage["dalliance."+this.cookieKey+".sources"];delete localStorage["dalliance."+this.cookieKey+".hubs"];delete localStorage["dalliance."+this.cookieKey+".version"];delete localStorage["dalliance."+this.cookieKey+".reverse-scrolling"];delete localStorage["dalliance."+this.cookieKey+".reverse-key-scrolling"];delete localStorage["dalliance."+
this.cookieKey+".ruler-location"]};r.prototype.storeStatus=function(){this.storeViewStatus();this.storeTierStatus()};r.prototype.storeViewStatus=function(){!this.cookieKey||this.noPersist||this.noPersistView||(localStorage["dalliance."+this.cookieKey+".view-chr"]=this.chr,localStorage["dalliance."+this.cookieKey+".view-start"]=this.viewStart|0,localStorage["dalliance."+this.cookieKey+".view-end"]=this.viewEnd|0,localStorage["dalliance."+this.cookieKey+".showing-alt-zoom"]=""+this.isSnapZooming,localStorage["dalliance."+
this.cookieKey+".saved-zoom"]=this.savedZoom,this.currentSeqMax&&(localStorage["dalliance."+this.cookieKey+".current-seq-length"]=this.currentSeqMax))};r.prototype.storeTierStatus=function(){if(this.cookieKey&&!this.noPersist){for(var e=[],a=0;a<this.tiers.length;++a){var b=this.tiers[a];b.dasSource.noPersist||e.push({source:b.dasSource,config:b.config||{}})}localStorage["dalliance."+this.cookieKey+".sources"]=JSON.stringify(e);e={};a=[];for(b=0;b<this.hubObjects.length;++b){var m=this.hubObjects[b],
g={url:m.hub.url,genome:m.genome};m.credentials&&(g.credentials=m.credentials);m.mapping&&(g.mapping=m.mapping);e[g.url]=!0;a.push(g)}for(b=0;b<this.hubs.length;++b)g=this.hubs[b],"string"===typeof g&&(g={url:g}),e[g.url]||a.push(g);localStorage["dalliance."+this.cookieKey+".hubs"]=JSON.stringify(a);localStorage["dalliance."+this.cookieKey+".reverse-scrolling"]=this.reverseScrolling;localStorage["dalliance."+this.cookieKey+".reverse-key-scrolling"]=this.reverseKeyScrolling;localStorage["dalliance."+
this.cookieKey+".single-base-highlight"]=this.singleBaseHighlight;localStorage["dalliance."+this.cookieKey+".ruler-location"]=this.rulerLocation;localStorage["dalliance."+this.cookieKey+".export-ruler"]=this.exportRuler;localStorage["dalliance."+this.cookieKey+".export-highlights"]=this.exportHighlights;localStorage["dalliance."+this.cookieKey+".version"]=h.CONFIG}};r.prototype.restoreStatus=function(){if(!this.noPersist){var e=localStorage["dalliance."+this.cookieKey+".version"];if(h.CONFIG==(e?
e|0:-100)){var e=localStorage["dalliance."+this.cookieKey+".configHash"]||"",a=u(w({sources:this.sources,hubs:this.hubs}));if(a!=e)localStorage["dalliance."+this.cookieKey+".configHash"]=a;else{e={};for(a=0;a<this.sources.length;++a){var b=this.sources[a];if(b){var m=p(b),g=e[m];g||(e[m]=g=[]);g.push(b)}}if(!this.noPersistView&&(a=localStorage["dalliance."+this.cookieKey+".view-chr"],b=localStorage["dalliance."+this.cookieKey+".view-start"]|0,g=localStorage["dalliance."+this.cookieKey+".view-end"]|
0,a&&b&&g)){this.chr=a;this.viewStart=b;this.viewEnd=g;if(a=localStorage["dalliance."+this.cookieKey+".current-seq-length"])this.currentSeqMax=a|0;this.isSnapZooming="true"==localStorage["dalliance."+this.cookieKey+".showing-alt-zoom"];a=parseFloat(localStorage["dalliance."+this.cookieKey+".saved-zoom"]);"number"!==typeof a||isNaN(a)||(this.savedZoom=a)}this.reverseScrolling=(a=localStorage["dalliance."+this.cookieKey+".reverse-scrolling"])&&"true"==a;this.reverseKeyScrolling=(a=localStorage["dalliance."+
this.cookieKey+".reverse-key-scrolling"])&&"true"==a;this.singleBaseHighlight=(a=localStorage["dalliance."+this.cookieKey+".single-base-highlight"])&&"true"==a;if(a=localStorage["dalliance."+this.cookieKey+".ruler-location"])this.rulerLocation=a;if(a=localStorage["dalliance."+this.cookieKey+".export-ruler"])this.exportRuler="true"===a;if(a=localStorage["dalliance."+this.cookieKey+".export-highlights"])this.exportHighlights="true"===a;if(a=localStorage["dalliance."+this.cookieKey+".sources"]){var k=
JSON.parse(a);this.sources=[];this.restoredConfigs=[];for(a=0;a<k.length;++a)for(b=this.sources[a]=k[a].source,this.restoredConfigs[a]=k[a].config,m=p(b),g=e[m]||[],m=0;m<g.length;++m){var f=g[m];if(q(b,f))for(var c in f)f.hasOwnProperty(c)&&("function"===typeof f[c]||f[c]instanceof Blob)&&(b[c]=f[c])}}if(c=localStorage["dalliance."+this.cookieKey+".hubs"])this.hubs=JSON.parse(c);return!0}}}};r.prototype.reset=function(){for(var h=this.tiers.length-1;0<=h;--h)this.removeTier({index:h},!0);for(h=0;h<
this.defaultSources.length;++h)this.defaultSources[h].disabled||this.addTier(this.defaultSources[h]);this.highlights.splice(0,this.highlights.length);this.setLocation(this.defaultChr,this.defaultStart,this.defaultEnd)}},{"./cbrowser":6,"./sha1":32,"./utils":47,"./version":49}],32:[function(e,t,s){function r(a){a=q(h(a));for(var b=u?"0123456789ABCDEF":"0123456789abcdef",e="",g,k=0;k<a.length;k++)g=a.charCodeAt(k),e+=b.charAt(g>>>4&15)+b.charAt(g&15);return e}function p(a){a=q(h(a));for(var b="",e=
a.length,g=0;g<e;g+=3)for(var k=a.charCodeAt(g)<<16|(g+1<e?a.charCodeAt(g+1)<<8:0)|(g+2<e?a.charCodeAt(g+2):0),f=0;4>f;f++)b=8*g+6*f>8*a.length?b+z:b+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(k>>>6*(3-f)&63);return b}function q(a){for(var b=Array(a.length>>2),h=0;h<b.length;h++)b[h]=0;for(h=0;h<8*a.length;h+=8)b[h>>5]|=(a.charCodeAt(h/8)&255)<<24-h%32;a=8*a.length;b[a>>5]|=128<<24-a%32;b[(a+64>>9<<4)+15]=a;a=Array(80);for(var h=1732584193,g=-271733879,k=-1732584194,
f=271733878,c=-1009589776,e=0;e<b.length;e+=16){for(var q=h,p=g,r=k,u=f,y=c,s=0;80>s;s++){if(16>s)a[s]=b[e+s];else{var t=a[s-3]^a[s-8]^a[s-14]^a[s-16];a[s]=t<<1|t>>>31}var t=h<<5|h>>>27,G;G=20>s?g&k|~g&f:40>s?g^k^f:60>s?g&k|g&f|k&f:g^k^f;t=w(w(t,G),w(w(c,a[s]),20>s?1518500249:40>s?1859775393:60>s?-1894007588:-899497514));c=f;f=k;k=g<<30|g>>>2;g=h;h=t}h=w(h,q);g=w(g,p);k=w(k,r);f=w(f,u);c=w(c,y)}b=[h,g,k,f,c];a="";for(h=0;h<32*b.length;h+=8)a+=String.fromCharCode(b[h>>5]>>>24-h%32&255);return a}function h(a){for(var b=
"",h=-1,g,k;++h<a.length;)g=a.charCodeAt(h),k=h+1<a.length?a.charCodeAt(h+1):0,55296<=g&&56319>=g&&56320<=k&&57343>=k&&(g=65536+((g&1023)<<10)+(k&1023),h++),127>=g?b+=String.fromCharCode(g):2047>=g?b+=String.fromCharCode(192|g>>>6&31,128|g&63):65535>=g?b+=String.fromCharCode(224|g>>>12&15,128|g>>>6&63,128|g&63):2097151>=g&&(b+=String.fromCharCode(240|g>>>18&7,128|g>>>12&63,128|g>>>6&63,128|g&63));return b}function w(a,b){var h=(a&65535)+(b&65535);return(a>>16)+(b>>16)+(h>>16)<<16|h&65535}var u=0,
z="";"undefined"!==typeof t&&(t.exports={b64_sha1:p,hex_sha1:r})},{}],33:[function(e,t,s){function r(a,d){Z[a]=d}function p(a,d){ja[a]=d}function q(a){if(ja[a])return ja[a](a)}function h(a){var d=this;this.source=a;this.cfsid="cfs"+ ++ka;a.name&&(this.name=a.name);a.addChangeListener&&a.addChangeListener(function(){d.cfsid="cfs"+ ++ka})}function w(){this.busy=0;this.activityListeners=[];this.readinessListeners=[];this.readiness=null}function u(a){this.dasSource=new x(a);this.busy=0;this.activityListeners=
[]}function z(a){this.dasSource=new x(a);this.awaitedEntryPoints=new y;var d=this;this.dasSource.entryPoints(function(a){d.awaitedEntryPoints.provide(a)})}function a(a){var d=this;this.source=a;this.twoBit=new y;if(a.twoBitURI)a=new E(a.twoBitURI);else if(a.twoBitBlob)a=new A(a.twoBitBlob);else throw Error("No twoBitURI or twoBitBlob parameter");n(a,function(a,b){b?console.log(b):d.twoBit.provide(a)})}function b(a){w.call(this);var d=this;this.readiness="Connecting";this.bwgSource=this.opts=a;d.bwgHolder=
new y;if(this.opts.preflight){var b=ga[this.opts.preflight];if(!b){b=new y;ga[this.opts.preflight]=b;var c=new XMLHttpRequest;c.onreadystatechange=function(){4==c.readyState&&(200==c.status?b.provide("success"):b.provide("failure"))};c.open("get",this.opts.preflight+"?"+hex_sha1("salt"+Date.now()),!0);this.opts.credentials&&(c.withCredentials=!0);c.send("")}b.await(function(a){"success"===a&&d.init()})}else d.init()}function m(a,d){w.call(this);this.worker=d;this.readiness="Connecting";this.bwgSource=
this.opts=a;this.keyHolder=new y;this.init()}function g(a,d){if(!(a.flag&Q.SEGMENT_UNMAPPED)){var b;b=a.seq?a.seq.length:a.seqLength;if(a.cigar){b=0;for(var c=aa(a.cigar),f=0;f<c.length;++f){var g=c[f];if("M"==g.op||"D"==g.op)b+=g.cnt}}c=new I;c.min=a.pos+1;c.max=a.pos+b;c.segment=a.segment;c.type="bam";c.id=a.readName;c.notes=["MQ="+a.mq];c.cigar=a.cigar;c.seq=a.seq;c.quals=a.quals;c.orientation=a.flag&Q.REVERSE_COMPLEMENT?"-":"+";c.bamRecord=a;d&&a.flag&Q.MULTIPLE_SEGMENTS&&(c.groups=[{id:a.readName,
type:"readpair"}]);return c}}function k(a){w.call(this);var d=this;this.bamSource=a;this.opts={credentials:a.credentials,preflight:a.preflight,bamGroup:a.bamGroup};this.bamHolder=new y;if(this.opts.preflight){var b=ga[this.opts.preflight];if(!b){b=new y;ga[this.opts.preflight]=b;var c=new XMLHttpRequest;c.onreadystatechange=function(){4==c.readyState&&(200==c.status?b.provide("success"):b.provide("failure"))};c.open("get",this.opts.preflight+"?"+hex_sha1("salt"+Date.now()),!0);this.opts.credentials&&
(c.withCredentials="true");c.send("")}b.await(function(a){"success"===a&&d.init()})}else d.init()}function f(a,d){w.call(this);this.bamSource=a;this.worker=d;this.opts={credentials:a.credentials,preflight:a.preflight,bamGroup:a.bamGroup};this.keyHolder=new y;this.init()}function c(a,d){this.source=a;this.mapping=d;this.activityListeners=[];this.busy=0}function v(){}function B(){}function N(a){this.store=new T(a.jbURI,a.jbQuery)}if("undefined"!==typeof e){var L=e("./cbrowser").Browser,O=e("./tier").DasTier;
s=e("./utils");var y=s.Awaited,J=s.arrayIndexOf,F=s.shallowCopy,G=s.resolveUrlToPage;s=e("./das");var H=s.DASStylesheet,d=s.DASStyle,x=s.DASSource,C=s.DASSegment,I=s.DASFeature,l=s.DASSequence,D=s.DASLink;s=e("./bin");var E=s.URLFetchable,A=s.BlobFetchable,n=e("./twoBit").makeTwoBit,M=e("./bigwig").makeBwg;s=e("./bam");var S=s.makeBam,Q=s.BamFlags;s=e("./spans");var R=s.Range,W=s.union,aa=e("./cigar").parseCigar,X=e("./overlay").OverlayFeatureSource,T=e("./jbjson").JBrowseStore,$=e("./chainset").Chainset;
e("./style")}var Z={},ja={};O.prototype.initSources=function(){var a=this,d=this.browser.createSources(this.dasSource);this.featureSource=d.features||new v;this.sequenceSource=d.sequence;this.featureSource&&this.featureSource.addChangeListener&&this.featureSource.addChangeListener(function(){a.browser.refreshTier(a)})};L.prototype.createSources=function(d){var g=this.sourceCache.get(d);if(g)return g;var l,e;if("sequence"==d.tier_type||d.twoBitURI||d.twoBitBlob)e=d.twoBitURI||d.twoBitBlob?new a(d):
new z(d);else if(d.tier_type&&Z[d.tier_type])e=(0,Z[d.tier_type])(d),l=e.features,e=e.sequence;else if(d.bwgURI||d.bwgBlob)l=(l=this.getWorker())?new m(d,l):new b(d);else if(d.bamURI||d.bamBlob)l=(l=this.getWorker())?new f(d,l):new k(d);else if(d.jbURI)l=new N(d);else if(d.uri||d.features_uri)l=new u(d);if(d.overlay){g=[];l&&g.push(new h(l));for(l=0;l<d.overlay.length;++l){var n=this.createSources(d.overlay[l]);n&&n.features&&g.push(n.features)}l=new X(g,d)}d.sequenceAliases&&(l=new c(l,new $({type:"alias",
sequenceAliases:d.sequenceAliases})));d.mapping&&(l=new c(l,this.chains[d.mapping]));d.name&&l&&!l.name&&(l.name=d.name);null!=l&&(l=new h(l));if(null!=l||null!=e)g={features:l,sequence:e},this.sourceCache.put(d,g);return g};O.prototype.fetchStylesheet=function(a){(this.dasSource.stylesheet_uri||!(this.dasSource.tier_type||this.dasSource.bwgURI||this.dasSource.bwgBlob||this.dasSource.bamURI||this.dasSource.bamBlob||this.dasSource.twoBitURI||this.dasSource.twoBitBlob||this.dasSource.jbURI||this.dasSource.overlay)?
new u(this.dasSource):this.getSource()).getStyleSheet(a)};var ka=0;h.prototype.addReadinessListener=function(a){if(this.source.addReadinessListener)return this.source.addReadinessListener(a);a(null)};h.prototype.search=function(a,d){if(this.source.search)return this.source.search(a,d)};h.prototype.getDefaultFIPs=function(a){if(this.source.getDefaultFIPs)return this.source.getDefaultFIPs(a)};h.prototype.getStyleSheet=function(a){this.source.getStyleSheet(a)};h.prototype.getScales=function(){return this.source.getScales()};
h.prototype.addActivityListener=function(a){this.source.addActivityListener&&this.source.addActivityListener(a)};h.prototype.addChangeListener=function(a){this.source.addChangeListener&&this.source.addChangeListener(a)};h.prototype.findNextFeature=function(a,d,b,c){this.source.findNextFeature(a,d,b,c)};h.prototype.quantFindNextFeature=function(a,d,b,c,f){this.source.quantFindNextFeature(a,d,b,c,f)};h.prototype.capabilities=function(){return this.source.capabilities?this.source.capabilities():{}};
h.prototype.fetch=function(a,d,b,c,f,g,l,h){if(!g)throw Error("Fetch pool is null");var k=this,e=this.cfsid,n=g.awaitedFeatures[e];if(n&&n.started){if(n.styleFilters.doesNotContain(h)){k.source.fetch(a,d,b,c,f,g,l,h);return}}else n?n.styleFilters.addAll(h):(n=new y,n.styleFilters=h,g.awaitedFeatures[e]=n,g.requestsIssued.then(function(){n.started=!0;k.source.fetch(a,d,b,c,n.styleFilters.typeList(),g,function(a,d,b,c){n.res||n.provide({status:a,features:d,scale:b,coverage:c})},n.styleFilters)}).catch(function(a){console.log(a)}));
n.await(function(a){l(a.status,a.features,a.scale,a.coverage)})};w.prototype.addReadinessListener=function(a){this.readinessListeners.push(a);a(this.readiness)};w.prototype.notifyReadiness=function(){for(var a=0;a<this.readinessListeners.length;++a)try{this.readinessListeners[a](this.readiness)}catch(d){console.log(d)}};w.prototype.addActivityListener=function(a){this.activityListeners.push(a)};w.prototype.notifyActivity=function(){for(var a=0;a<this.activityListeners.length;++a)try{this.activityListeners[a](this.busy)}catch(d){console.log(d)}};
w.prototype.getScales=function(){return null};w.prototype.fetch=function(a,d,b,c,f,g,l){return l(null,[],1E9)};w.prototype.getStyleSheet=function(a){var b=new H,c=new d;c.glyph="BOX";c.BGCOLOR="blue";c.FGCOLOR="black";b.pushStyle({type:"default"},null,c);return a(b)};u.prototype.addActivityListener=function(a){this.activityListeners.push(a)};u.prototype.notifyActivity=function(){for(var a=0;a<this.activityListeners.length;++a)try{this.activityListeners[a](this.busy)}catch(d){console.log(d)}};u.prototype.getStyleSheet=
function(a){this.dasSource.stylesheet(function(d){a(d)},function(){a(null,"Couldn't fetch DAS stylesheet")})};u.prototype.fetch=function(a,d,b,c,f,g,l){if(f&&0==f.length)l(null,[],c);else if(this.dasSource.uri||this.dasSource.features_uri){if(this.dasSource.dasStaticFeatures&&this.cachedStaticFeatures)return l(null,this.cachedStaticFeatures,this.cachedStaticScale);var h=!1!==this.dasSource.maxbins;f={type:f};h&&(f.maxbins=1+((b-d)/c|0));var k=this;k.busy++;k.notifyActivity();this.dasSource.features(new C(a,
d,b),f,function(a,d){k.busy--;k.notifyActivity();var b=c;h||(b=0.1);!d&&k.dasSource.dasStaticFeatures&&(k.cachedStaticFeatures=a,k.cachedStaticScale=b);l(d,a,b)})}};u.prototype.findNextFeature=this.sourceFindNextFeature=function(a,d,b,c){if(this.dasSource.capabilities&&0<=J(this.dasSource.capabilities,"das1:adjacent-feature")){var f=this;if(this.dasAdjLock)return console.log("Already looking for a next feature, be patient!");this.dasAdjLock=!0;a={adjacent:a+":"+(d|0)+":"+(0<b?"F":"B")};if(d=thisTier.getDesiredTypes(thisTier.browser.scale))a.types=
d;thisTier.dasSource.features(null,a,function(a){f.dasAdjLock=!1;0<a.length&&null!=a[0]&&c(a[0])})}};z.prototype.fetch=function(a,d,b,c,f){this.dasSource.sequence(new C(a,d,b),function(a){return 1==a.length?f(null,a[0]):f("Didn't get sequence")})};z.prototype.getSeqInfo=function(a,d){this.awaitedEntryPoints.await(function(b){for(var c=0;c<b.length;++c)if(b[c].name==a)return d({length:b[c].end});return d()})};a.prototype.fetch=function(a,d,b,c,f){this.twoBit.await(function(c){c.fetch(a,d,b,function(c,
g){if(g)return f(g,null);var h=new l(a,d,b,"DNA",c);return f(null,h)})})};a.prototype.getSeqInfo=function(a,d){this.twoBit.await(function(b){b.getSeq(a)?b.getSeq(a).length(function(a){d({length:a})}):d()})};u.prototype.getScales=function(){return[]};var ga={};b.prototype=Object.create(w.prototype);b.prototype.init=function(){var a=this,d;d=this.bwgSource.bwgURI?new E(this.bwgSource.bwgURI,{credentials:this.opts.credentials}):new A(this.bwgSource.bwgBlob);M(d,function(d,b){b?(a.error=b,a.readiness=
null,a.notifyReadiness(),a.bwgHolder.provide(null)):(a.bwgHolder.provide(d),a.readiness=null,a.notifyReadiness(),"bigbed"==d.type&&d.getExtraIndices(function(d){a.extraIndices=d}))})};b.prototype.capabilities=function(){var a={leap:!0};this.bwgHolder.res&&"bigwig"==this.bwgHolder.res.type&&(a.quantLeap=!0);if(this.extraIndices&&0<this.extraIndices.length){a.search=[];for(var d=0;d<this.extraIndices.length;++d)a.search.push(this.extraIndices[d].field)}return a};b.prototype.fetch=function(a,d,b,c,f,
g,l){var h=this;this.bwgHolder.await(function(g){if(null==g)return l(h.error||"Can't access binary file",null,null);var k;k=!f||0==f.length||0<=J(f,"density");h.opts.clientBin&&(k=!1);if("bigwig"==g.type||k||"undefined"!==typeof h.opts.forceReduction){k=-1;for(var e=0;e<g.zoomLevels.length;++e)if(g.zoomLevels[e].reduction<=c)k=e;else break;"undefined"!==typeof h.opts.forceReduction&&(k=h.opts.forceReduction);k=0>k?g.getUnzoomedView():g.getZoomedView(k)}else k=g.getUnzoomedView();h.busy++;h.notifyActivity();
k.readWigData(a,d,b,function(a){h.busy--;h.notifyActivity();var c=1E9;if("bigwig"===g.type){var f=(b-d)/a.length/2;f<c&&(c=f)}if(h.opts.link)for(f=0;f<a.length;++f){var k=a[f];k.label&&(k.links=[new D("Link",h.opts.link.replace(/\$\$/,k.label))])}l(null,a,c)})})};b.prototype.quantFindNextFeature=function(a,d,b,c,f){var g=this;g.busy++;g.notifyActivity();this.bwgHolder.res.thresholdSearch(a,d,b,c,function(a,d){g.busy--;g.notifyActivity();return f(a,d)})};b.prototype.findNextFeature=function(a,d,b,
c){var f=this;f.busy++;f.notifyActivity();this.bwgHolder.res.getUnzoomedView().getFirstAdjacent(a,d,b,function(a){f.busy--;f.notifyActivity();0<a.length&&null!=a[0]&&c(a[0])})};b.prototype.getScales=function(){var a=this.bwgHolder.res;if(a){for(var d=[1],b=0;b<a.zoomLevels.length;++b)d.push(a.zoomLevels[b].reduction);return d}return null};b.prototype.search=function(a,d){return this.extraIndices&&0!=this.extraIndices.length?this.extraIndices[0].lookup(a,d):d(null,"No indices available")};b.prototype.getDefaultFIPs=
function(a){if(this.opts.noExtraFeatureInfo)return!0;this.bwgHolder.await(function(d){d&&d.schema&&d.definedFieldCount<d.schema.fields.length&&a(function(a,b){for(var c=0;c<b.hit.length;++c)if(b.hit[c].isSuperGroup)return;for(c=d.definedFieldCount;c<d.schema.fields.length;++c){var f=d.schema.fields[c];b.add(f.comment,a[f.name])}})})};b.prototype.getStyleSheet=function(a){this.bwgHolder.await(function(b){if(!b)return a(null,"bbi error");var c=new H;if("bigbed"==b.type){var f=new d;f.glyph="BOX";f.FGCOLOR=
"black";f.BGCOLOR="blue";f.HEIGHT=8;f.BUMP=!0;f.LABEL=!0;f.ZINDEX=20;c.pushStyle({type:"bigwig"},null,f);f.glyph="BOX";f.FGCOLOR="black";f.BGCOLOR="red";f.HEIGHT=10;f.BUMP=!0;f.ZINDEX=20;c.pushStyle({type:"translation"},null,f);f=new d;f.glyph="BOX";f.FGCOLOR="black";f.BGCOLOR="white";f.HEIGHT=10;f.ZINDEX=10;f.BUMP=!0;f.LABEL=!0;c.pushStyle({type:"transcript"},null,f);f=new d;f.glyph="HISTOGRAM";f.COLOR1="white";f.COLOR2="black";f.HEIGHT=30;c.pushStyle({type:"density"},null,f)}else f=new d,f.glyph=
"HISTOGRAM",f.COLOR1="white",f.COLOR2="black",f.HEIGHT=30,c.pushStyle({type:"default"},null,f);12==b.definedFieldCount&&14<=b.fieldCount&&(c.geneHint=!0);return a(c)})};m.prototype=Object.create(w.prototype);m.prototype.init=function(){var a=this,d=this.bwgSource.uri||this.bwgSource.bwgURI,b=this.bwgSource.blob||this.bwgSource.bwgBlob,c=function(d,b){a.readiness=null;a.notifyReadiness();d?a.worker.postCommand({command:"meta",connection:d},function(b,c){c?(a.error=c,a.keyHolder.provide(null)):(a.meta=
b,a.keyHolder.provide(d))}):(a.error=b,a.keyHolder.provide(null))};b?this.worker.postCommand({command:"connectBBI",blob:b},c):this.worker.postCommand({command:"connectBBI",uri:G(d),credentials:this.bwgSource.credentials},c)};m.prototype.capabilities=function(){var a={leap:!0};this.meta&&"bigwig"==this.meta.type&&(a.quantLeap=!0);if(this.meta&&this.meta.extraIndices&&0<this.meta.extraIndices.length){a.search=[];for(var d=0;d<this.meta.extraIndices.length;++d)a.search.push(this.meta.extraIndices[d].field)}return a};
m.prototype.fetch=function(a,d,b,c,f,g,l){var h=this;h.busy++;h.notifyActivity();this.keyHolder.await(function(g){if(!g)return h.busy--,h.notifyActivity(),l(h.error||"Can't access binary file",null,null);var k=-1,e=!f||0==f.length||0<=J(f,"density");h.opts.clientBin&&(e=!1);if("bigwig"==h.meta.type||e||"undefined"!==typeof h.opts.forceReduction){for(e=1;e<h.meta.zoomLevels.length;++e)if(h.meta.zoomLevels[e]<=c)k=e-1;else break;"undefined"!==typeof h.opts.forceReduction&&(k=h.opts.forceReduction)}h.worker.postCommand({command:"fetch",
connection:g,chr:a,min:d,max:b,zoom:k},function(a,c){h.busy--;h.notifyActivity();var f=1E9;if("bigwig"===h.meta.type){var g=(b-d)/a.length/2;g<f&&(f=g)}if(h.opts.link)for(g=0;g<a.length;++g){var k=a[g];k.label&&(k.links=[new D("Link",h.opts.link.replace(/\$\$/,k.label))])}l(c,a,f)})})};m.prototype.quantFindNextFeature=function(a,d,b,c,f){var g=this;this.busy++;this.notifyActivity();this.worker.postCommand({command:"quantLeap",connection:this.keyHolder.res,chr:a,pos:d,dir:b,threshold:c,under:!1},function(a,
d){console.log(a,d);g.busy--;g.notifyActivity();return f(a,d)})};m.prototype.findNextFeature=function(a,d,b,c){var f=this;this.busy++;this.notifyActivity();this.worker.postCommand({command:"leap",connection:this.keyHolder.res,chr:a,pos:d,dir:b},function(a,d){f.busy--;f.notifyActivity();0<a.length&&null!=a[0]&&c(a[0])})};m.prototype.getScales=function(){var a=this.meta;return a?a.zoomLevels:null};m.prototype.search=function(a,d){if(!this.meta.extraIndices||0==this.meta.extraIndices.length)return d(null,
"No indices available");var b=this;this.busy++;this.notifyActivity();this.worker.postCommand({command:"search",connection:this.keyHolder.res,query:a,index:this.meta.extraIndices[0]},function(a,c){b.busy--;b.notifyActivity();d(a,c)})};m.prototype.getDefaultFIPs=function(a){if(this.opts.noExtraFeatureInfo)return!0;var d=this;this.keyHolder.await(function(b){var c=d.meta;c&&c.schema&&c.definedFieldCount<c.schema.fields.length&&a(function(a,d){for(var b=0;b<d.hit.length;++b)if(d.hit[b].isSuperGroup)return;
for(b=c.definedFieldCount;b<c.schema.fields.length;++b){var f=c.schema.fields[b];d.add(f.comment,a[f.name])}})})};m.prototype.getStyleSheet=function(a){var b=this;this.keyHolder.await(function(c){c=b.meta;if(!c)return a(null,"bbi error");var f=new H;if("bigbed"==c.type){var g=new d;g.glyph="BOX";g.FGCOLOR="black";g.BGCOLOR="blue";g.HEIGHT=8;g.BUMP=!0;g.LABEL=!0;g.ZINDEX=20;f.pushStyle({type:"bigwig"},null,g);g.glyph="BOX";g.FGCOLOR="black";g.BGCOLOR="red";g.HEIGHT=10;g.BUMP=!0;g.ZINDEX=20;f.pushStyle({type:"translation"},
null,g);g=new d;g.glyph="BOX";g.FGCOLOR="black";g.BGCOLOR="white";g.HEIGHT=10;g.ZINDEX=10;g.BUMP=!0;g.LABEL=!0;f.pushStyle({type:"transcript"},null,g);g=new d;g.glyph="HISTOGRAM";g.COLOR1="white";g.COLOR2="black";g.HEIGHT=30;f.pushStyle({type:"density"},null,g)}else g=new d,g.glyph="HISTOGRAM",g.COLOR1="white",g.COLOR2="black",g.HEIGHT=30,f.pushStyle({type:"default"},null,g);12==c.definedFieldCount&&14<=c.fieldCount&&(f.geneHint=!0);return a(f)})};k.prototype=Object.create(w.prototype);k.prototype.init=
function(){var a=this,d,b;this.bamSource.bamBlob?(d=new A(this.bamSource.bamBlob),b=new A(this.bamSource.baiBlob)):(d=new E(this.bamSource.bamURI,{credentials:this.opts.credentials}),b=new E(this.bamSource.baiURI||this.bamSource.bamURI+".bai",{credentials:this.opts.credentials}));S(d,b,function(d,b){a.readiness=null;a.notifyReadiness();d?a.bamHolder.provide(d):(a.error=b,a.bamHolder.provide(null))})};k.prototype.fetch=function(a,d,b,c,f,l,h){var k=f&&1==f.length&&"density"==f[0],e=this;e.busy++;e.notifyActivity();
this.bamHolder.await(function(c){if(!c)return e.busy--,e.notifyActivity(),h(e.error||"Couldn't fetch BAM");c.fetch(a,d,b,function(a,d){e.busy--;e.notifyActivity();if(d)h(d,null,null);else{for(var b=[],c=0;c<a.length;++c){var f=g(a[c],e.opts.bamGroup);f&&b.push(f)}h(null,b,1E9)}},{light:k})})};k.prototype.getScales=function(){return 1E9};k.prototype.getStyleSheet=function(a){this.bamHolder.await(function(b){b=new H;var c=new d;c.glyph="HISTOGRAM";c.COLOR1="black";c.COLOR2="red";c.HEIGHT=30;b.pushStyle({type:"density"},
"low",c);b.pushStyle({type:"density"},"medium",c);c=new d;c.glyph="__SEQUENCE";c.FGCOLOR="black";c.BGCOLOR="blue";c.HEIGHT=8;c.BUMP=!0;c.LABEL=!1;c.ZINDEX=20;b.pushStyle({type:"bam"},"high",c);return a(b)})};f.prototype=Object.create(w.prototype);f.prototype.init=function(){var a=this,d=this.bamSource.uri||this.bamSource.bamURI,b=this.bamSource.indexUri||this.bamSource.baiURI||d+".bai",c=this.bamSource.bamBlob||this.bamSource.blob,f=this.bamSource.baiBlob||this.bamSource.indexBlob,g=function(d,b){a.readiness=
null;a.notifyReadiness();d?a.keyHolder.provide(d):(a.error=b,a.keyHolder.provide(null))};c?this.worker.postCommand({command:"connectBAM",blob:c,indexBlob:f},g):this.worker.postCommand({command:"connectBAM",uri:G(d),indexUri:G(b),credentials:this.bamSource.credentials},g)};f.prototype.fetch=function(a,d,b,c,f,l,h){var k=f&&1==f.length&&"density"==f[0],e=this;e.busy++;e.notifyActivity();this.keyHolder.await(function(c){if(!c)return e.busy--,e.notifyActivity(),h(e.error||"Couldn't fetch BAM");e.worker.postCommand({command:"fetch",
connection:c,chr:a,min:d,max:b,opts:{light:k}},function(a,d){e.busy--;e.notifyActivity();if(d)h(d,null,null);else{for(var b=[],c=0;c<a.length;++c){var f=g(a[c],e.opts.bamGroup);f&&b.push(f)}h(null,b,1E9)}})})};f.prototype.getScales=function(){return 1E9};f.prototype.getStyleSheet=function(a){this.keyHolder.await(function(b){b=new H;var c=new d;c.glyph="HISTOGRAM";c.COLOR1="black";c.COLOR2="red";c.HEIGHT=30;b.pushStyle({type:"density"},"low",c);b.pushStyle({type:"density"},"medium",c);c=new d;c.glyph=
"__SEQUENCE";c.FGCOLOR="black";c.BGCOLOR="blue";c.HEIGHT=8;c.BUMP=!0;c.LABEL=!1;c.ZINDEX=20;b.pushStyle({type:"bam"},"high",c);return a(b)})};c.prototype.addActivityListener=function(a){this.activityListeners.push(a)};c.prototype.notifyActivity=function(){for(var a=0;a<this.activityListeners.length;++a)try{this.activityListeners[a](this.busy)}catch(d){console.log(d)}};c.prototype.getStyleSheet=function(a){return this.source.getStyleSheet(a)};c.prototype.getScales=function(){return this.source.getScales()};
c.prototype.getDefaultFIPs=function(a){if(this.source.getDefaultFIPs)return this.source.getDefaultFIPs(a)};c.prototype.simplifySegments=function(a,d){if(0==a.length)return a;a.sort(function(a,d){var b=a.name-d.name;return b?b:(b=a.start-d.start)?b:a.end-d.end});for(var b=[],c=a[0],f=0;f<a.length;++f){var g=a[f];g.name!=c.name||g.start>c.end+d?(b.push(c),c=g):c=new C(c.name,Math.min(c.start,g.start),Math.max(c.end,g.end))}b.push(c);return b};c.prototype.fetch=function(a,d,b,c,f,g,l,h){var k=this,e=
b-d+1;k.busy++;k.notifyActivity();this.mapping.sourceBlocksForRange(a,d,b,function(a){if(0==a.length)k.busy--,k.notifyActivity(),l("No mapping available for this regions",[],c);else{a=k.simplifySegments(a,Math.max(100,0.05*e));var d=[],b=null,n=a.length,m;a.map(function(a){k.source.fetch(a.name,a.start,a.end,c,f,g,function(c,f,g){c&&!m&&(m=c);if(f)for(c=0;c<f.length;++c){var h=f[c],e=h.segment;0==e.indexOf("chr")&&(e=e.substr(3));e=k.mapping.mapSegment(e,h.min,h.max);if(0==e.length)h.parts&&0<h.parts.length&&
d.push(h);else for(var q=0;q<e.length;++q){var p=e[q],x=F(h);x.segment=p.segment;x.min=p.min;x.max=p.max;p.partialMin&&(x.partialMin=p.partialMin);p.partialMax&&(x.partialMax=p.partialMax);p.flipped&&("-"==h.orientation?x.orientation="+":"+"==h.orientation&&(x.orientation="-"));d.push(x)}}f=k.mapping.mapPoint(a.name,a.start);c=k.mapping.mapPoint(a.name,a.end);f&&c&&(f=new R(f.pos,c.pos),b=b?W(b,f):f);--n;0==n&&(k.busy--,k.notifyActivity(),l(m,d,g,b))},h)})}})};v.prototype.getScales=function(){return null};
v.prototype.fetch=function(a,d,b,c,f,g,h){return h(null,[],1E9)};v.prototype.getStyleSheet=function(a){var b=new H,c=new d;c.glyph="BOX";c.BGCOLOR="blue";c.FGCOLOR="black";b.pushStyle({type:"default"},null,c);return a(b)};B.prototype.fetch=function(a,d,b,c,f){return f(null,null)};N.prototype.getScales=function(){return null};N.prototype.getStyleSheet=function(a){var b=new H,c=new d;c.glyph="BOX";c.FGCOLOR="black";c.BGCOLOR="green";c.HEIGHT=8;c.BUMP=!0;c.LABEL=!0;c.ZINDEX=20;b.pushStyle({type:"default"},
null,c);return a(b)};N.prototype.fetch=function(a,d,b,c,f,g,h){f&&0==f.length?h(null,[],c):this.store.features(new C(a,d,b),{},function(a,d){h(d,a,1E5)})};L.prototype.sourceAdapterIsCapable=function(a,d){return a.capabilities?a.capabilities()[d]:!1};"undefined"!==typeof t&&(t.exports={FeatureSourceBase:w,TwoBitSequenceSource:a,DASSequenceSource:z,MappedFeatureSource:c,CachingFeatureSource:h,BWGFeatureSource:b,RemoteBWGFeatureSource:m,BAMFeatureSource:k,RemoteBAMFeatureSource:f,DummyFeatureSource:v,
DummySequenceSource:B,registerSourceAdapterFactory:r,registerParserFactory:p,makeParser:q},e("./ensembljson"),e("./tabix-source"),e("./memstore"),e("./bedwig"),e("./vcf"))},{"./bam":1,"./bedwig":2,"./bigwig":3,"./bin":4,"./cbrowser":6,"./chainset":7,"./cigar":8,"./das":10,"./ensembljson":12,"./jbjson":21,"./memstore":24,"./overlay":26,"./spans":34,"./style":35,"./tabix-source":38,"./tier":43,"./twoBit":46,"./utils":47,"./vcf":48}],34:[function(e,t,s){function r(a,b){if("number"!=typeof a||"number"!=
typeof b)throw"Bad range "+a+","+b;this._min=a;this._max=b}function p(a){this._ranges=a}function q(a,b){a instanceof Array||(a=[a],b&&a.push(b));if(0==a.length)return null;if(1==a.length)return a[0];for(var h=[],g=0;g<a.length;++g)a[g]._pushRanges(h);for(var h=h.sort(z),g=[],k=h[0],k=new r(k._min,k._max),f=1;f<h.length;++f){var c=h[f];c._min>k._max+1?(g.push(k),k=new r(c._min,c._max)):c._max>k._max&&(k._max=c._max)}g.push(k);return 1==g.length?g[0]:new p(g)}function h(a,b){for(var h=a.ranges(),g=
b.ranges(),k=h.length,f=g.length,c=0,e=0,q=[];c<k&&e<f;){a=h[c];b=g[e];var u=Math.max(a.min(),b.min()),s=Math.min(a.max(),b.max());s>=u&&q.push(new r(u,s));a.max()>b.max()?++e:++c}return 0==q.length?null:1==q.length?q[0]:new p(q)}function w(a){var b=0;a=a.ranges();for(var h=0;h<a.length;++h)var g=a[h],b=b+(g.max()-g.min()+1);return b}function u(a,b){return a.min()<b.min()?-1:a.min()>b.min()?1:a.max()<b.max()?-1:b.max()>a.max()?1:0}function z(a,b){return a._min<b._min?-1:a._min>b._min?1:a._max<b._max?
-1:b._max>a._max?1:0}r.prototype.min=function(){return this._min};r.prototype.max=function(){return this._max};r.prototype.contains=function(a){return a>=this._min&&a<=this._max};r.prototype.isContiguous=function(){return!0};r.prototype.ranges=function(){return[this]};r.prototype._pushRanges=function(a){a.push(this)};r.prototype.toString=function(){return"["+this._min+"-"+this._max+"]"};p.prototype.min=function(){return this._ranges[0].min()};p.prototype.max=function(){return this._ranges[this._ranges.length-
1].max()};p.prototype.contains=function(a){for(var b=0;b<this._ranges.length;++b)if(this._ranges[b].contains(a))return!0;return!1};p.prototype.isContiguous=function(){return 1<this._ranges.length};p.prototype.ranges=function(){return this._ranges};p.prototype._pushRanges=function(a){for(var b=0;b<this._ranges.length;++b)a.push(this._ranges[b])};p.prototype.toString=function(){for(var a="",b=0;b<this._ranges.length;++b)0<b&&(a+=","),a+=this._ranges[b].toString();return a};"undefined"!==typeof t&&(t.exports=
{Range:r,union:q,intersection:h,coverage:w,rangeOver:u,_rangeOrder:z})},{}],35:[function(e,t,s){function r(e,h,p){this.type=e;this.method=h;this.label=p}function p(e){this._filters={};if(e)for(var h=0;h<e.length;++h)this.add(e[h])}r.prototype.equals=function(e){return this.type==e.type&&this.method==e.method&&this.label==e.label};r.prototype.toString=function(){var e=[];this.type&&e.push("type="+this.type);this.method&&e.push("method="+this.method);this.label&&e.push("label="+this.label);return"StyleFilter<"+
e.join(";")+">"};p.prototype.add=function(e){var h=e.toString();this._filters[h]||(this._filters[h]=e,this._list=null)};p.prototype.addAll=function(e){e=e.list();for(var h=0;h<e.length;++h)this.add(e[h])};p.prototype.doesNotContain=function(e){e=e.list();for(var h=0;h<e.length;++h)if(!this._filters[h.toString()])return!0;return!1};p.prototype.list=function(){if(!this._list){this._list=[];for(var e in this._filters)this._filters.hasOwnProperty(e)&&this._list.push(this._filters[e])}return this._list};
p.prototype.typeList=function(){for(var e=[],h=this.list(),p=0;p<h.length;++p){var r=h[p].type;if(!r||"default"==r)return null;0>e.indexOf(r)&&e.push(r)}return e};"undefined"!==typeof t&&(t.exports={StyleFilter:r,StyleFilterSet:p})},{}],36:[function(e,t,s){if("undefined"!==typeof e){var r=e("./cbrowser").Browser,p=e("./utils").makeElementNS,q=e("./version"),h=e("./sequence-draw").svgSeqTier;t=e("./svg-utils");var w=t.NS_SVG,u=t.NS_XLINK,z=t.SVGPath,a=e("./numformats").formatQuantLabel}r.prototype.makeSVG=
function(b){b=b||{};var e=b.minTierHeight||20,g=document.implementation.createDocument(w,"svg",null),k=p(w,"g",null,{fontFamily:"helvetica",fontSize:"8pt"});g.documentElement.appendChild(k);var f=p(w,"a",p(w,"text","Graphics from Dalliance "+q,{x:(this.featurePanelWidth+200+20)/2,y:30,strokeWidth:0,fontSize:"12pt",textAnchor:"middle",fill:"blue"}));f.setAttribute("xmlns:xlink",u);f.setAttribute("xlink:href","http://www.biodalliance.org/");k.appendChild(f);f=p(w,"rect",null,{x:200,y:50,width:this.featurePanelWidth,
height:1E5});f=p(w,"clipPath",f,{id:"featureClip"});k.appendChild(f);for(var f=70,c=p(w,"g",null,{}),r=0;r<this.tiers.length;++r){var s=this.tiers[r],t=p(w,"g",null,{clipPath:"url(#featureClip)",clipRule:"nonzero"}),L=p(w,"g"),O=f,y=p(w,"rect",null,{x:0,y:O,width:"10000",height:50,fill:s.background});t.appendChild(y);if(s.sequenceSource){var J=h(s,s.currentSequence);t.appendChild(p(w,"g",J,{transform:"translate(200, "+f+")"}));f+=80}else{if(!s.subtiers)continue;for(var J=(s.glyphCacheOrigin-this.viewStart)*
this.scale,F=!1,G=0;G<s.subtiers.length;++G){for(var f=f+3,H=s.subtiers[G],d=[],x=0;x<H.glyphs.length;++x)d.push(H.glyphs[x].toSVG());t.appendChild(p(w,"g",d,{transform:"translate("+(200+J)+", "+f+")"}));if(H.quant){var F=!0,d=H.quant,C=H.height,x=2;40<C&&(x=1+(C/20|0));var C=C/(x-1),I=(d.max-d.min)/(x-1),l=new z;l.moveTo(205,f);l.lineTo(200,f);l.lineTo(200,f+H.height);l.lineTo(205,f+H.height);for(var D=1;D<x-1;++D){var E=D*C;l.moveTo(200,f+E);l.lineTo(203,f+E)}L.appendChild(p(w,"path",null,{d:l.toPathData(),
fill:"none",stroke:"black",strokeWidth:"2px"}));L.appendChild(p(w,"text",a(d.max),{x:197,y:f+7,textAnchor:"end"}));L.appendChild(p(w,"text",a(d.min),{x:197,y:f+H.height,textAnchor:"end"}));for(D=1;D<x-1;++D)E=D*C,L.appendChild(p(w,"text",a(1*d.max-D*I),{x:197,y:f+E+3,textAnchor:"end"}))}f+=H.height+3}f-O<e&&(f=O+e)}L.appendChild(p(w,"text","string"===typeof s.config.name?s.config.name:s.dasSource.name,{x:200-(F?20:12),y:(f+O+8)/2,fontSize:"10pt",textAnchor:"end"}));y.setAttribute("height",f-O);c.appendChild(p(w,
"g",[t,L]))}if(b.highlights)for(e=this.highlights||[],F=0;F<e.length;++F)C=e[F],(C.chr==this.chr||C.chr=="chr"+this.chr)&&C.min<this.viewEnd&&C.max>this.viewStart&&(r=(Math.max(C.min,this.viewStart)-this.viewStart)*this.scale,s=(Math.min(C.max,this.viewEnd)-this.viewStart)*this.scale,c.appendChild(p(w,"rect",null,{x:200+r,y:70,width:s-r,height:f-70,stroke:"none",fill:this.defaultHighlightFill,fillOpacity:this.defaultHighlightAlpha})));e=-1;"center"==b.ruler?e=200+(this.viewEnd-this.viewStart)*this.scale/
2:"left"==b.ruler?e=200:"right"==b.ruler&&(e=200+(this.viewEnd-this.viewStart)*this.scale);0<=e&&c.appendChild(p(w,"line",null,{x1:e,y1:70,x2:e,y2:f,stroke:"blue"}));k.appendChild(c);g.documentElement.setAttribute("width",this.featurePanelWidth+20+200);g.documentElement.setAttribute("height",f+50);return new Blob([(new XMLSerializer).serializeToString(g)],{type:"image/svg+xml"})}},{"./cbrowser":6,"./numformats":25,"./sequence-draw":30,"./svg-utils":37,"./utils":47,"./version":49}],37:[function(e,
t,s){function r(){this.ops=[]}r.prototype.moveTo=function(e,q){this.ops.push("M "+e+" "+q)};r.prototype.lineTo=function(e,q){this.ops.push("L "+e+" "+q)};r.prototype.closePath=function(){this.ops.push("Z")};r.prototype.toPathData=function(){return this.ops.join(" ")};"undefined"!==typeof t&&(t.exports={NS_SVG:"http://www.w3.org/2000/svg",NS_XLINK:"http://www.w3.org/1999/xlink",SVGPath:r})},{}],38:[function(e,t,s){function r(b){h.call(this);this.readiness="Connecting";this.source=b;this.tabixHolder=
new z;var e=this,g=q(b.payload);if(g)this.parser=g;else throw"Unsuported tabix payload "+b.payload;var k;this.source.blob?(b=new u(this.source.blob),k=new u(this.source.indexBlob)):(b=new w(this.source.uri,{credentials:this.source.credentials}),k=new w(this.source.indexURI||this.source.uri+".tbi",{credentials:this.source.credentials}));a(b,k,function(a,b){e.tabixHolder.provide(a);a.fetchHeader(function(a,b){if(a){for(var c=g.createSession(function(){}),f=0;f<a.length;++f)c.parse(a[f]);c.flush()}});
e.readiness=null;e.notifyReadiness()})}if("undefined"!==typeof e){t=e("./sourceadapters");var p=t.registerSourceAdapterFactory,q=t.makeParser,h=t.FeatureSourceBase;t=e("./bin");var w=t.URLFetchable,u=t.BlobFetchable,z=e("./utils").Awaited,a=e("./tabix").connectTabix}r.prototype=Object.create(h.prototype);r.prototype.fetch=function(a,h,g,e,f,c,q){var p=this;p.busy++;p.notifyActivity();this.tabixHolder.await(function(c){c.fetch(a,h,g,function(a,b){p.busy--;p.notifyActivity();for(var c=[],f=p.parser.createSession(function(a){c.push(a)}),
g=0;g<a.length;++g)f.parse(a[g]);f.flush();q(null,c,1E9)})})};r.prototype.getStyleSheet=function(a){this.parser&&this.parser.getStyleSheet&&this.parser.getStyleSheet(a)};r.prototype.getDefaultFIPs=function(a){this.parser&&this.parser.getDefaultFIPs&&this.parser.getDefaultFIPs(a)};p("tabix",function(a){return{features:new r(a)}})},{"./bin":4,"./sourceadapters":33,"./tabix":39,"./utils":47}],39:[function(e,t,s){function r(){}function p(a,e,g){var k=new r;k.data=a;k.tbi=e;k.tbi.fetch(function(a){if(!a)return g(null,
"Couldn't access Tabix");a=u(a,a.byteLength);var b=new Uint8Array(a);if(h(b,0)!=q)return g(null,"Not a tabix index");var e=h(b,4);k.format=h(b,8);k.colSeq=h(b,12);k.colStart=h(b,16);k.colEnd=h(b,20);k.meta=h(b,24);k.skip=h(b,28);h(b,32);k.indices=[];var m=36;k.chrToIndex={};k.indexToChr=[];for(var p=0;p<e;++p){for(var r="";;){var s=b[m++];if(0==s)break;r+=String.fromCharCode(s)}k.chrToIndex[r]=p;0==r.indexOf("chr")?k.chrToIndex[r.substring(3)]=p:k.chrToIndex["chr"+r]=p;k.indexToChr.push(r)}r=1E9;
for(s=0;s<e;++s){for(var y=m,t=h(b,m),m=m+4,p=0;p<t;++p){h(b,m);var z=h(b,m+4),m=m+(8+16*z)}for(var z=h(b,m),G=m+=4,p=0;p<z;++p){var H=w(b,G),G=G+8;if(H){p=H.block;0<H.offset&&(p+=65536);p<r&&(r=p);break}}m+=8*z;0<t&&(k.indices[s]=new Uint8Array(a,y,m-y))}k.headerMax=r;g(k)})}var q=21578324;if("undefined"!==typeof e){e("./spans");var h=e("./bin").readInt;e=e("./lh3utils");var w=e.readVob,u=e.unbgzf,z=e.reg2bins,a=e.Chunk}r.prototype.blocksForRange=function(b,e,g){var k=this.indices[b];if(!k)return[];
b=z(e,g);for(var f=[],c=0;c<b.length;++c)f[b[c]]=!0;b=[];for(var p=[],c=h(k,0),q=4,r=0;r<c;++r){var u=h(k,q),s=h(k,q+4),q=q+8;if(f[u])for(var y=0;y<s;++y){var t=w(k,q),F=w(k,q+8);(4681>u?p:b).push(new a(t,F));q+=16}else q+=16*s}c=h(k,q);f=null;e=Math.min(e>>14,c-1);g=Math.min(g>>14,c-1);for(c=e;c<=g;++c)(e=w(k,q+4+8*c))&&(!f||e.block<f.block||e.offset<f.offset)&&(f=e);k=[];if(null!=f)for(c=0;c<p.length;++c)g=p[c],g.maxv.block>=f.block&&g.maxv.offset>=f.offset&&k.push(g);p=k;k=[];for(c=0;c<p.length;++c)k.push(p[c]);
for(c=0;c<b.length;++c)k.push(b[c]);k.sort(function(a,b){var d=a.minv.block-b.minv.block;return 0!=d?d:a.minv.offset-b.minv.offset});b=[];if(0<k.length){p=k[0];for(c=1;c<k.length;++c)g=k[c],g.minv.block==p.maxv.block?p=new a(p.minv,g.maxv):(b.push(p),p=g);b.push(p)}return b};r.prototype.fetch=function(a,h,g,e){function f(){if(s>=q.length)return e(r);if(t){var a=new Uint8Array(t);c.readRecords(a,q[s].minv.offset,r,h,g,p);t=null;++s;return f()}var b=q[s],a=b.minv.block;c.data.slice(a,b.maxv.block+65536-
a).fetch(function(a){t=u(a,b.maxv.block-b.minv.block+1);return f()})}var c=this;a=this.chrToIndex[a];if(void 0==a)return e([]);var p=this.indexToChr[a],q;void 0===a?q=[]:(q=this.blocksForRange(a,h,g))||e(null,"Error in index fetch");var r=[],s=0,t;f()};r.prototype.readRecords=function(a,h,g,e,f,c){a:for(;;){for(var p="";h<a.length;){var q=a[h++];if(10==q){q=p.split("\t");if(q[this.colSeq-1]==c){var r=parseInt(q[this.colStart-1]),u=r;0<this.colEnd&&(u=parseInt(q[this.colEnd-1]));this.format&65536&&
++r;r<=f&&u>=e&&g.push(p)}continue a}else p+=String.fromCharCode(q)}break}};r.prototype.fetchHeader=function(a){var h=this;h.data.slice(0,h.headerMax).fetch(function(g){if(!g)return a(null,"Fetch failed");g=new Uint8Array(u(g,g.byteLength));for(var e=0,f="",c=[];e<g.length;){var p=g[e++];if(10==p)if(f.charCodeAt(0)==h.meta)c.push(f),f="";else return a(c);else f+=String.fromCharCode(p)}a(c)})};"undefined"!==typeof t&&(t.exports={connectTabix:p,TABIX_MAGIC:q})},{"./bin":4,"./lh3utils":23,"./spans":34}],
40:[function(e,t,s){function r(a){this.genomes={};this.url=a}function p(){}function q(a){this.hub=a}function h(a,b,f){f=f||{};f.salt=!0;u(a,function(h,e){if(e)return b(null,e);var m=h.split(k),p=new r(a);f.credentials&&(p.credentials=f.credentials);for(var s=0;s<m.length-2;s+=3)p[m[s+1]]=m[s+2];if(p.genomesFile){var t=z(a,p.genomesFile);u(t,function(a,c){if(c)return b(null,c);for(var d=a.split(g),h=0;h<d.length;++h){var e=d[h].split(k),m=new q(p);f.credentials&&(m.credentials=f.credentials);for(var l=
0;l<e.length-2;l+=3)m[e[l+1]]=e[l+2];m.twoBitPath&&(m.twoBitPath=z(t,m.twoBitPath));m.genome&&m.trackDb&&(m.absURL=z(t,m.trackDb),p.genomes[m.genome]=m)}b(p)},f)}else b(null,"No genomesFile")},f)}function w(a,b){return a.priority&&b.priority?1*a.priority-1*b.priority:a.priority?1:b.priority?-1:a.shortLabel.localeCompare(b.shortLabel)}if("undefined"!==typeof e){s=e("./utils");var u=s.textXHR,z=s.relativeURL,a=s.shallowCopy;e=e("./das");var b=e.DASStylesheet,m=e.DASStyle}var g=/\n\s*\n/,k=/(\w+) +(.+)\n?/,
f=/subGroup[1-9]/;p.prototype.get=function(a){if(this[a])return this[a];if(this._parent)return this._parent.get(a)};q.prototype.getTracks=function(a){var b=this;if(this._tracks)return a(this._tracks);u(this.absURL,function(h,e){if(e)return a(null,e);h=h.replace("\\\n"," ");for(var m=[],q={},r=h.split(g),u=0;u<r.length;++u){var s=r[u].replace(/\#.*/g,"").split(k),t=new p;t._db=b;for(var w=0;w<s.length-2;w+=3){var d=s[w+1],x=s[w+2];if(d.match(f)){t.subgroups||(t.subgroups={});for(var d=x.split(/\s/),
x=d[0],C={name:d[1],tags:[],titles:[]},I=2;I<d.length;++I){var l=d[I].split(/=/);C.tags.push(l[0]);C.titles.push(l[1])}t.subgroups[x]=C}else if("subGroups"===d)for(d=x.split(/(\w+)=(\w+)/),t.sgm={},I=0;I<d.length-2;I+=3)t.sgm[d[I+1]]=d[I+2];else t[s[w+1]]=s[w+2]}t.track&&(t.type||t.container||t.view||t.bigDataUrl)&&(m.push(t),q[t.track]=t)}r=[];u=[];for(d=0;d<m.length;++d)t=m[d],s=!0,t.parent&&(w=t.parent.split(/\s+/),(x=q[w[0]])?(t._parent=x,x.children||(x.children=[]),x.children.push(t),x&&(s=!1)):
console.log("Couldn't find parent "+w[0]+"("+t.parent+")")),t.compositeTrack?u.push(t):s&&r.push(t);for(m=0;m<u.length;++m)if(q=u[m],q.children){t=!1;for(s=0;s<q.children.length;++s)d=q.children[s],d.view&&(d.shortLabel=q.shortLabel+": "+d.shortLabel,r.push(d),t=!0);t||r.push(q)}b._tracks=r;return a(b._tracks,null)},{credentials:this.credentials,salt:!0})};p.prototype.toDallianceSource=function(){var a={name:this.shortLabel,desc:this.longLabel};this._db.mapping&&(a.mapping=this._db.mapping);var b=
this.get("pennantIcon");b&&(b=b.split(/\s+/),a.pennant="http://genome.ucsc.edu/images/"+b[0]);if(b=this.get("searchTrix"))a.trixURI=z(this._db.absURL,b);if("multiWig"==this.container){a.merge="concat";a.overlay=[];b=this.children||[];a.style=[];a.noDownsample=!0;for(var f=0;f<b.length;++f){var g=b[f],h=g.toDallianceSource();a.overlay.push(h);if(h.style)for(var e=0;e<h.style.length;++e){var k=h.style[e];k.method=g.shortLabel;"transparentOverlay"==this.aggregate&&(k.style.ALPHA=0.5);a.style.push(k)}}return a}b=
this.type;if(!b){for(b=this;b._parent&&!b.type;)b=b._parent;b=b.type}if(b){f=b.split(/\s+/);if("bigBed"==f[0]&&this.bigDataUrl)return b=f[1]|0,f="+"==f[2],a.bwgURI=z(this._db.absURL,this.bigDataUrl),a.style=this.bigbedStyles(),this._db.credentials&&(a.credentials=!0),12<=b&&f&&(a.collapseSuperGroups=!0),a;if("bigWig"==f[0]&&this.bigDataUrl)return a.bwgURI=z(this._db.absURL,this.bigDataUrl),a.style=this.bigwigStyles(),a.noDownsample=!0,this.yLineOnOff&&"on"==this.yLineOnOff&&(a.quantLeapThreshold=
void 0!==this.yLineMark?1*this.yLineMark:0),this._db.credentials&&(a.credentials=!0),a;if("bam"==f[0]&&this.bigDataUrl)return a.bamURI=z(this._db.absURL,this.bigDataUrl),this._db.credentials&&(a.credentials=!0),a;if("vcfTabix"==f[0]&&this.bigDataUrl)return a.uri=z(this._db.absURL,this.bigDataUrl),a.tier_type="tabix",a.payload="vcf",this._db.credentials&&(a.credentials=!0),a;console.log("Unsupported "+this.type)}};p.prototype.bigwigStyles=function(){var a=this.type;if(!a){for(a=this;a._parent&&!a.type;)a=
a._parent;a=a.type}if(a){var a=a.split(/\s+/),f,g;3<=a.length&&(f=1*a[1],g=1*a[2]);var h;this.maxHeightPixels&&(a=this.maxHeightPixels.split(/:/),3==a.length?h=a[1]|0:console.log("maxHeightPixels should be of the form max:default:min"));a="bars";this.graphTypeDefault&&(a=this.graphTypeDefault);var e="black",k=null;this.color&&(e="rgb("+this.color+")");this.altColor&&(k="rgb("+this.altColor+")");var p=new b,q=new m;q.glyph="points"==a?"POINT":"HISTOGRAM";k?(q.COLOR1=e,q.COLOR2=k):q.BGCOLOR=e;q.HEIGHT=
h||30;if(f||g)q.MIN=f,q.MAX=g;p.pushStyle({type:"default"},null,q);return p.styles}};p.prototype.bigbedStyles=function(){var c="on"==(""+this.get("itemRgb")).toLowerCase(),f=this.get("visibility")||"full",g=this.get("color"),g=g?"rgb("+g+")":"blue",h=new b,e=new m;e.glyph="BOX";e.FGCOLOR="black";e.BGCOLOR=g;e.HEIGHT="full"==f||"pack"==f?12:8;e.BUMP="full"==f||"pack"==f;e.LABEL="full"==f||"pack"==f;e.ZINDEX=20;c&&(e.BGITEM=!0);(f=this.get("colorByStrand"))?(f=f.split(/\s+/),g=a(e),g.BGCOLOR="rgb("+
f[0]+")",h.pushStyle({type:"bigwig",orientation:"+"},null,g),e=a(e),e.BGCOLOR="rgb("+f[1]+")",h.pushStyle({type:"bigwig",orientation:"-"},null,e)):h.pushStyle({type:"bigwig"},null,e);e=new m;e.glyph="BOX";e.FGCOLOR="black";c&&(e.BGITEM=!0);e.BGCOLOR="red";e.HEIGHT=10;e.BUMP=!0;e.ZINDEX=20;h.pushStyle({type:"translation"},null,e);c=new m;c.glyph="BOX";c.FGCOLOR="black";c.BGCOLOR="white";c.HEIGHT=10;c.ZINDEX=10;c.BUMP=!0;c.LABEL=!0;h.pushStyle({type:"transcript"},null,c);return h.styles};"undefined"!==
typeof t&&(t.exports={connectTrackHub:h,THUB_COMPARE:w})},{"./das":10,"./utils":47}],41:[function(e,t,s){if("undefined"!==typeof e)var r=e("./cbrowser").Browser,p=e("./utils").shallowCopy;r.prototype.mergeSelectedTiers=function(){for(var e=[],h=[],r=0;r<this.selectedTiers.length;++r){var u=this.tiers[this.selectedTiers[r]];e.push(p(u.dasSource));for(var s=u.stylesheet.styles,a=0;a<s.length;++a){var b=s[a],m=p(b);m.method=u.dasSource.name.replace(/[()+*?]/g,"\\$&");m._methodRE=null;m.style=p(b.style);
void 0===m.style.ZINDEX&&(m.style.ZINDEX=r);u.forceMin&&(m.style.MIN=u.forceMin);u.forceMax&&(m.style.MAX=u.forceMax);h.push(m)}}this.addTier({name:"Merged",merge:"concat",overlay:e,noDownsample:!0,style:h});this.setSelectedTier(this.tiers.length-1)}},{"./cbrowser":6,"./utils":47}],42:[function(e,t,s){function r(a){for(var b=0;b<a.styles.length;++b){var e=a.styles[b].style;if("__SEQUENCE"===e.glyph)return e}}if("undefined"!==typeof e){var p=e("./cbrowser").Browser,q=e("./utils").makeElement;t=e("./das");
var h=t.isDasBooleanTrue,w=t.copyStylesheet,u=e("./color").dasColourForName}var z={DOT:!0,EX:!0,STAR:!0,SQUARE:!0,CROSS:!0,TRIANGLE:!0,PLIMSOLL:!0};p.prototype.openTierPanel=function(a){if("tier"===this.uiMode&&this.manipulatingTier===a)this.hideToolPanel(),this.setUiMode("none");else{var b=function(a){a.BGGRAD||(1==x?("LINEPLOT"==a.glyph||z[a.glyph]?a.FGCOLOR=L.value:a.BGCOLOR=L.value,a.COLOR1=a.COLOR2=a.COLOR3=null):(a.COLOR1=L.value,a.COLOR2=O.value,a.COLOR3=2<x?y.value:null),a._gradient=null,
a._plusColor=J.value,a._minusColor=F.value)},e=function(d){for(var b=w(a.stylesheet),c=a.browser.zoomForCurrentScale(),f=0;f<b.styles.length;++f){var g=b.styles[f];g.zoom&&g.zoom!=c||d(g.style)}return b},g=function(d){a.mergeStylesheet(e(b))};this.manipulatingTier=a;var k=q("div",null,{className:"tier-edit"});if(a.dasSource.mapping){var f=this.chains[a.dasSource.mapping].coords;k.appendChild(q("div","Mapped from "+f.auth+f.version,null,{background:"gray",paddingBottom:"5px",marginBottom:"5px",textAlign:"center"}))}var c=
q("div","Editing styles for current zoom level",null,{background:"gray",paddingBottom:"5px",marginBottom:"5px",textAlign:"center",display:"none"});k.appendChild(c);var p=q("input",null,{type:"text"}),s=q("input",null,{type:"checkbox",disabled:this.disablePinning}),t=q("select");t.appendChild(q("option","Histogram",{value:"HISTOGRAM"}));t.appendChild(q("option","Line Plot",{value:"LINEPLOT"}));t.appendChild(q("option","Ribbon",{value:"GRADIENT"}));t.appendChild(q("option","Scatter",{value:"SCATTER"}));
var L=q("input",null,{type:"text",value:"#dd00dd"}),O=q("input",null,{type:"text",value:"#dd00dd"}),y=q("input",null,{type:"text",value:"#dd00dd"}),J=q("input",null,{type:"text",value:"#ffa07a"}),F=q("input",null,{type:"text",value:"#87cefa"});try{L.type=O.type=y.type="color",J.type=F.type="color"}catch(G){}var H=[L,O,y],f=q("i",null,{className:"fa fa-plus-circle"}),d=q("i",null,{className:"fa fa-minus-circle"}),x=1,C=q("td",H),I=function(a){x=a;for(var d=0;d<a;++d)H[d].style.display="block";for(d=
a;d<H.length;++d)H[d].style.display="none"};f.addEventListener("click",function(a){3>x&&(I(x+1),g(null))},!1);d.addEventListener("click",function(a){1<x&&(I(x-1),g(null))},!1);var l=q("input",null,{type:"text",value:"0.0"}),D=q("input",null,{type:"text",value:"10.0"}),E=q("input",null,{type:"checkbox"}),A=q("input",null,{type:"checkbox"}),n=q("input",null,{type:"checkbox",checked:void 0!==a.quantLeapThreshold}),M=q("input",null,{type:"text",value:a.quantLeapThreshold,disabled:!n.checked}),S=q("input",
null,{type:"text",value:"50"}),Q=q("input",null,{type:"checkbox"}),R=q("input",null,{type:"text"}),W=q("input",null,{type:"checkbox"}),aa=null;0<a.stylesheet.styles.length&&(aa=a.stylesheet.styles[0].style);var X=function(){p.value="string"===typeof a.config.name?a.config.name:a.dasSource.name;s.checked=a.pinned;a.forceHeight?S.value=""+a.forceHeight:aa&&aa.HEIGHT&&(S.value=""+aa.HEIGHT);"number"==typeof a.quantLeapThreshold?(n.checked=!0,M.disabled=!1,parseFloat(M.value)!=a.quantLeapThreshold&&(M.value=
a.quantLeapThreshold)):(n.checked=!1,M.disabled=!0);R.value="number"==typeof a.subtierMax?""+a.subtierMax:""+(a.dasSource.subtierMax||a.browser.defaultSubtierMax);if(0<a.stylesheet.styles.length){for(var d=null,b=!1,f=!1,f=a.browser.zoomForCurrentScale(),g=0,e=0;e<a.stylesheet.styles.length;++e){var k=a.stylesheet.styles[e];if(!k.zoom||k.zoom==f)if(++g,k=a.stylesheet.styles[e].style,d||(d=aa=k),"LINEPLOT"==k.glyph||"HISTOGRAM"==k.glyph||"GRADIENT"==k.glyph||h(k.SCATTER))b||(d=aa=k),b=!0}if(!d)return;
c.style.display=g==a.stylesheet.styles.length?"none":"block";f=b&&1==g;b?(na.style.display="table-row",la.style.display="table-row",ha.style.display="none",pa.style.display="none"):(na.style.display="none",la.style.display="none",ha.style.display="table-row",Q.checked=h(aa.BUMP),R.disabled=!h(aa.BUMP),pa.style.display="table-row",W.checked=h(aa.LABEL));f?(ka.style.display="table-row",ga.style.display="table-row"):(ka.style.display="none",ga.style.display="none");g=1;d.COLOR1?(L.value=u(d.COLOR1).toHexString(),
d.COLOR2&&(O.value=u(d.COLOR2).toHexString(),d.COLOR3?(y.value=u(d.COLOR3).toHexString(),g=3):g=2)):"LINEPLOT"==d.glyph||"DOT"==d.glyph&&d.FGCOLOR?L.value=u(d.FGCOLOR).toHexString():d.BGCOLOR&&(L.value=u(d.BGCOLOR).toHexString());I(g);d._plusColor&&(J.value=u(d._plusColor).toHexString()||d._plusColor);d._minusColor&&(F.value=u(d._minusColor).toHexString()||d._minusColor);h(d.SCATTER)?t.value="SCATTER":t.value=d.glyph;var m,q;void 0!==d.MIN&&(g=parseFloat(d.MIN),isNaN(g)||(m=g));a.forceMinDynamic||
void 0===d.MIN&&void 0===a.forceMin?(E.checked=!1,l.disabled=!0):(E.checked=!0,l.disabled=!1);void 0!==d.MAX&&(g=parseFloat(d.MAX),isNaN(g)||(q=g));a.forceMaxDynamic||void 0===d.MAX&&void 0===a.forceMax?(A.checked=!1,D.disabled=!0):(A.checked=!0,D.disabled=!1);void 0!=a.forceMin&&(m=a.forceMin);void 0!=a.forceMax&&(q=a.forceMax);"number"==typeof m&&m!=parseFloat(l.value)&&(l.value=m);"number"==typeof q&&q!=parseFloat(D.value)&&(D.value=q);(d=r(a.stylesheet))?($.style.display="table-row",T.checked=
"mismatch"===d.__SEQCOLOR,ja.style.display="table-row",Z.checked=h(d.__INSERTIONS)):($.style.display="none",ja.style.display="none");d&&T.checked&&!f?(fa.style.display="table-row",ca.style.display="table-row"):(fa.style.display="none",ca.style.display="none")}b&&a.browser.sourceAdapterIsCapable(a.featureSource,"quantLeap")?ma.style.display="table-row":ma.style.display="none"},T=q("input",null,{type:"checkbox"}),$=q("tr",[q("th","Highlight mismatches & strands"),q("td",T)]);T.addEventListener("change",
function(d){d=w(a.stylesheet);r(d).__SEQCOLOR=T.checked?"mismatch":"base";a.mergeStylesheet(d)});var Z=q("input",null,{type:"checkbox"}),ja=q("tr",[q("th","Show insertions"),q("td",Z)]);Z.addEventListener("change",function(d){d=w(a.stylesheet);r(d).__INSERTIONS=Z.checked?"yes":"no";a.mergeStylesheet(d)});var ka=q("tr",[q("th","Style"),q("td",t)]),ga=q("tr",[q("th",["Colour(s)",f,d]),C]),fa=q("tr",[q("th","Plus Strand Color"),q("td",J)]),ca=q("tr",[q("th","Minus Strand Color"),q("td",F)]),na=q("tr",
[q("th","Min value"),q("td",[E," ",l])]),la=q("tr",[q("th","Max value"),q("td",[A," ",D])]),ma=q("tr",[q("th","Threshold leap:"),q("td",[n," ",M])]),ha=q("tr",[q("th","Bump overlaps"),q("td",[Q," limit: ",R])]),pa=q("tr",[q("th","Label features"),q("td",W)]),f=q("table",[q("tr",[q("th","Name",{},{width:"150px",textAlign:"right"}),p]),q("tr",[q("th","Pin to top"),s]),q("tr",[q("th","Height"),q("td",S)]),ka,ga,fa,ca,na,la,ma,ha,pa,$,ja]);X();k.appendChild(f);f=q("button","Reset track",{className:"btn"},
{marginLeft:"auto",marginRight:"auto",display:"block"});f.addEventListener("click",function(d){a.setConfig({})},!1);k.appendChild(f);p.addEventListener("input",function(d){a.mergeConfig({name:p.value})},!1);s.addEventListener("change",function(d){a.mergeConfig({pinned:s.checked})},!1);for(f=0;f<H.length;++f)H[f].addEventListener("change",g,!1);J.addEventListener("change",g,!1);F.addEventListener("change",g,!1);t.addEventListener("change",function(d){d=e(function(a){"SCATTER"===t.value?(a.SCATTER=
!0,a.glyph="DOT",a.SIZE="3"):(a.glyph=t.value,a.SCATTER=void 0);b(a)});a.mergeStylesheet(d)},!1);E.addEventListener("change",function(d){d={forceMinDynamic:!E.checked};l.disabled=!E.checked;var b=parseFloat(l.value);E.checked&&"number"==typeof b&&!isNaN(b)&&(d.forceMin=parseFloat(b));a.mergeConfig(d)});l.addEventListener("input",function(d){d=parseFloat(l.value);"number"!=typeof d||isNaN(d)||a.mergeConfig({forceMin:d})},!1);A.addEventListener("change",function(d){d={forceMaxDynamic:!A.checked};D.disabled=
!A.checked;var b=parseFloat(D.value);A.checked&&"number"==typeof b&&!isNaN(b)&&(d.forceMax=parseFloat(b));a.mergeConfig(d)});D.addEventListener("input",function(d){d=parseFloat(D.value);"number"!=typeof d||isNaN(d)||a.mergeConfig({forceMax:d})},!1);S.addEventListener("input",function(d){d=parseFloat(S.value);"number"!=typeof d||isNaN(d)||a.mergeConfig({height:Math.min(500,d|0)})},!1);var qa=function(){M.disabled=!n.checked;if(n.checked){var d=parseFloat(M.value);"number"!=typeof d||isNaN(d)||a.mergeConfig({quantLeapThreshold:parseFloat(M.value)})}else a.mergeConfig({quantLeapThreshold:null})};
n.addEventListener("change",function(a){qa()},!1);M.addEventListener("input",function(a){qa()},!1);W.addEventListener("change",function(d){d=e(function(a){a.LABEL=W.checked?"yes":"no"});a.mergeStylesheet(d)},!1);Q.addEventListener("change",function(d){d=e(function(a){a.BUMP=Q.checked?"yes":"no"});a.mergeStylesheet(d)},!1);R.addEventListener("input",function(d){d=parseInt(R.value);"number"==typeof d&&0<d&&a.mergeConfig({subtierMax:d})},!1);this.showToolPanel(k);this.setUiMode("tier");a.addTierListener(X);
var U=a.browser.scale;a.browser.addViewListener(function(){a.browser.scale!=U&&(U=a.browser.scale,X())})}}},{"./cbrowser":6,"./color":9,"./das":10,"./utils":47}],43:[function(e,t,s){function r(a,b,g,e){this.config=g||{};this.id="tier"+ ++m;this.browser=a;this.dasSource=q(b);this.background=e;this.viewport=p("canvas",null,{width:""+((this.browser.featurePanelWidth|0)+2E3),height:"30",className:"viewport_12_5"},{position:"inline-block",margin:"0px",border:"0px"});this.viewportHolder=p("div",this.viewport,
{className:"viewport-holder_12_5"},{background:e,position:"absolute",padding:"0px",margin:"0px",border:"0px",left:"-1000px",minHeight:"200px"});this.overlay=p("canvas",null,{width:+(this.browser.featurePanelWidth|0),height:"30",className:"viewport-overlay"});this.notifier=p("div","",{className:"notifier"});this.notifierHolder=p("div",this.notifier,{className:"notifier-holder"});this.quantOverlay=p("canvas",null,{width:"50",height:"56",className:"quant-overlay"});this.removeButton=p("i",null,{className:"fa fa-times"});
this.bumpButton=p("i",null,{className:"fa fa-plus-circle"});this.loaderButton=a.makeLoader(16);this.loaderButton.style.display="none";this.infoElement=p("div",this.dasSource.desc,{className:"track-label-info"});this.nameButton=p("div",[],{className:"tier-tab"});this.nameButton.appendChild(this.removeButton);b.pennant?this.nameButton.appendChild(p("img",null,{src:b.pennant,width:"16",height:"16"})):b.mapping&&(g=null,this.browser.chains[b.mapping]&&(g=this.browser.chains[b.mapping].coords.version),
g&&this.nameButton.appendChild(p("span",""+g,null,{fontSize:"8pt",background:"black",color:"white",paddingLeft:"3px",paddingRight:"3px",paddingTop:"1px",paddingBottom:"1px",marginLeft:"2px",borderRadius:"10px"})));this.nameElement=p("span",b.name);this.nameButton.appendChild(p("span",[this.nameElement,this.infoElement],{className:"track-name-holder"}));this.nameButton.appendChild(this.bumpButton);this.nameButton.appendChild(this.loaderButton);this.label=p("span",[this.nameButton],{className:"btn-group track-label"});
this.row=p("div",[this.viewportHolder,this.overlay,this.quantOverlay],{className:"tier"+(b.className?" "+b.className:"")});e||(this.row.style.background="none");a.noDefaultLabels||this.row.appendChild(this.label);this.row.appendChild(this.notifierHolder);this.layoutHeight=25;this.bumped=!0;this.styleIdSeed=0;b.quantLeapThreshold&&(this.quantLeapThreshold=b.quantLeapThreshold);this.dasSource.collapseSuperGroups&&(this.bumped=!1);this.layoutWasDone=!1;b.featureInfoPlugin&&this.addFeatureInfoPlugin(b.featureInfoPlugin);
this.initSources();var h=this;this.featureSource&&this.featureSource.getDefaultFIPs&&!b.noSourceFeatureInfo&&this.featureSource.getDefaultFIPs(function(a){a&&h.addFeatureInfoPlugin(a)});this.featureSource&&this.featureSource.addReadinessListener&&this.featureSource.addReadinessListener(function(a){h.notify(a,-1)});this.listeners=[];this.featuresLoadedListeners=[]}if("undefined"!==typeof e){s=e("./utils");var p=s.makeElement,q=s.shallowCopy,h=s.miniJSONify;s=e("./das");var w=s.DASStylesheet,u=s.DASStyle,
z=e("./sha1").b64_sha1;s=e("./style");var a=s.StyleFilter,b=s.StyleFilterSet}var m=0;r.prototype.setBackground=function(a){this.background=a;this.viewportHolder.style.background=a};r.prototype.toString=function(){return this.id};r.prototype.addFeatureInfoPlugin=function(a){this.featureInfoPlugins||(this.featureInfoPlugins=[]);this.featureInfoPlugins.push(a)};r.prototype.init=function(){var a=this;a.dasSource.style?(this.setStylesheet({styles:a.dasSource.style}),this.browser.refreshTier(this)):(a.status=
"Fetching stylesheet",a.fetchStylesheet(function(b,g){if(g||!b){a.error="No stylesheet";b=new w;var e=new u;e.glyph="BOX";e.BGCOLOR="blue";e.FGCOLOR="black";b.pushStyle({type:"default"},null,e);a.setStylesheet(b)}else a.setStylesheet(b),b.geneHint&&(a.dasSource.collapseSuperGroups=!0,a.bumped=!1,a.updateLabel()),a._updateFromConfig();a.browser.refreshTier(a)}))};r.prototype.setStylesheet=function(a){this.baseStylesheet=q(a);for(a=0;a<this.baseStylesheet.styles.length;++a){var b=this.baseStylesheet.styles[a]=
q(this.baseStylesheet.styles[a]);b._methodRE=b._labelRE=b._typeRE=null;b.style=q(b.style);b.style.id="style"+ ++this.styleIdSeed}this.baseStylesheetValidity=z(h(this.baseStylesheet));this._updateFromConfig()};r.prototype.getSource=function(){return this.featureSource};r.prototype.getDesiredTypes=function(a){if(a=this.getActiveStyleFilters(a))return a.typeList()};r.prototype.getActiveStyleFilters=function(f){f=this.browser.zoomForCurrentScale();if(this.stylesheet){for(var c=new b,g=this.stylesheet.styles,
e=0;e<g.length;++e){var h=g[e];h.zoom&&h.zoom!=f||c.add(new a(h.type,h.method,h.label))}return c}};r.prototype.needsSequence=function(a){return this.sequenceSource&&5>a||(this.dasSource.bamURI||this.dasSource.bamBlob||this.dasSource.bwgURI||this.dasSource.bwgBlob)&&20>a?!0:!1};r.prototype.viewFeatures=function(a,b,g,e,h){this.currentFeatures=e;this.currentSequence=h;this.notifyFeaturesLoaded();this.knownChr=a;this.knownCoverage=b;this.status&&(this.status=null,this._notifierToStatus());this.draw()};
r.prototype.draw=function(){var a=this.currentSequence;this.sequenceSource?k(this,a):g(this);this.paint();this.originHaxx=0;this.browser.arrangeTiers()};r.prototype.findNextFeature=function(a,b,g,e,h){if(this.quantLeapThreshold)b=b+(this.browser.viewEnd-this.browser.viewStart+1)*g/2|0,this.featureSource.quantFindNextFeature(a,b,g,this.quantLeapThreshold,h);else{if(this.knownCoverage&&b>=this.knownCoverage.min()&&b<=this.knownCoverage.max()&&this.currentFeatures){for(var k=null,m=0;m<this.currentFeatures.length;++m){var p=
this.currentFeatures[m];if(p.min&&p.max&&!(p.parents&&0<p.parents.length))if(0>g)if(1==e&&p.max>=b&&p.min<b){if(!k||p.min>k.min||p.min==k.min&&p.max<k.max)k=p}else p.max<b&&(!k||p.max>k.max||p.max==k.max&&p.min<k.min||p.min==k.mmin&&k.max>=b)&&(k=p);else if(1==e&&p.min<=b&&p.max>b){if(!k||p.max<k.max||p.max==k.max&&p.min>k.min)k=p}else p.min>b&&(!k||p.min<k.min||p.min==k.min&&p.max>k.max||p.max==k.max&&k.min<=b)&&(k=p)}if(k)return h(k);b=0>g?this.browser.knownSpace.min:this.browser.knownSpace.max}this.trySourceFNF(a,
b,g,h)}};r.prototype.trySourceFNF=function(a,b,g,e){var h=this;this.featureSource.findNextFeature(a,b,g,function(a){a||e(a);var b=h.browser.getSequenceSource();b||e(a);b.getSeqInfo(a.segment,function(b){b?e(a):h.trySourceFNF(a.segment,0<g?1E10:0,g,e)})})};r.prototype.updateLabel=function(){this.bumpButton.className=this.bumped?"fa fa-minus-circle":"fa fa-plus-circle";this.bumpButton.style.display=this.dasSource.collapseSuperGroups?"inline-block":"none"};r.prototype.updateHeight=function(){this.currentHeight=
Math.max(Math.max(this.layoutHeight,this.label.clientHeight+2),this.browser.minTierHeight);this.row.style.height=""+this.currentHeight+"px";this.browser.updateHeight()};r.prototype.drawOverlay=function(){var a=this.browser,b=a.retina&&1<window.devicePixelRatio;this.overlay.height=this.viewport.height;this.overlay.width=b?2*a.featurePanelWidth:a.featurePanelWidth;var g=this.overlay.getContext("2d");b&&g.scale(2,2);var e=b=a.viewStart,h=a.viewEnd;if(this.overlayLabelCanvas){var k=(this.glyphCacheOrigin-
this.browser.viewStart)*this.browser.scale;g.save();g.translate(k,0);var m=-k+2;this.dasSource.tierGroup&&(m+=15);this.overlayLabelCanvas.draw(g,m,a.featurePanelWidth-k);g.restore()}for(k=0;k<a.highlights.length;++k)m=a.highlights[k],(m.chr===a.chr||m.chr==="chr"+a.chr)&&m.min<h&&m.max>e&&(g.globalAlpha=a.defaultHighlightAlpha,g.fillStyle=a.defaultHighlightFill,g.fillRect((m.min-b)*a.scale,0,(m.max-m.min)*a.scale,this.overlay.height));this.overlay.style.width=a.featurePanelWidth;this.overlay.style.height=
this.viewport.style.height;this.overlay.style.left="0px"};r.prototype.updateStatus=function(a){a?(this.status=a,this._notifierToStatus()):this.status&&(this.status=null,this._notifierToStatus())};r.prototype.notify=function(a,b){"number"!==typeof b&&(b=2E3);this.notifierFadeTimeout&&(clearTimeout(this.notifierFadeTimeout),this.notifierFadeTimeout=null);if(a){if(this._notifierOn(a),0<b){var g=this;this.notifierFadeTimeout=setTimeout(function(){g._notifierToStatus()},b)}}else this._notifierToStatus()};
r.prototype._notifierOn=function(a){this.notifier.textContent=a;this.notifier.style.opacity=0.8};r.prototype._notifierOff=function(){this.notifier.style.opacity=0};r.prototype._notifierToStatus=function(){this.status?this._notifierOn(this.status):this._notifierOff()};r.prototype.setConfig=function(a){this.config=a||{};this._updateFromConfig();this.notifyTierListeners()};r.prototype.mergeStylesheet=function(a){this.mergeConfig({stylesheet:a,stylesheetValidity:this.baseStylesheetValidity})};r.prototype.mergeConfig=
function(a){for(var b in a)this.config[b]=a[b];this._updateFromConfig();this.notifyTierListeners()};r.prototype._updateFromConfig=function(){var a=!1,b=!1;this.nameElement.textContent="string"===typeof this.config.name?this.config.name:this.dasSource.name;var g=this.config.height||this.dasSource.forceHeight;g!=this.forceHeight&&(this.forceHeight=g,a=!0);this.forceMinDynamic!=this.config.forceMinDynamic&&(this.forceMinDynamic=this.config.forceMinDynamic,a=!0);g=void 0!=this.config.forceMin?this.config.forceMin:
this.dasSource.forceMin;this.forceMin!=g&&(this.forceMin=g,a=!0);this.forceMaxDynamic!=this.config.forceMaxDynamic&&(this.forceMaxDynamic=this.config.forceMaxDynamic,a=!0);g=void 0!=this.config.forceMax?this.config.forceMax:this.dasSource.forceMax;this.forceMax!=g&&(this.forceMax=g,a=!0);g=null;void 0!==this.config.quantLeapThreshold?g=this.config.quantLeapThreshold:void 0!==this.dasSource.quantLeapThreshold&&(g=this.dasSource.quantLeapThreshold);g!=this.quantLeapThreshold&&(this.quantLeapThreshold=
g,a=!0);g=null;this.config.stylesheetValidity==this.baseStylesheetValidity&&(g=this.config.stylesheet);g=g||this.baseStylesheet;this.stylesheet!==g&&(this.stylesheet=g,a=!0);g=void 0!==this.config.pinned?this.config.pinned:this.dasSource.pinned;g!==this.pinned&&(this.pinned=g,b=!0);g=typeof("number"===this.config.subtierMax)?this.config.subtierMax:this.dasSource.subtierMax||this.browser.defaultSubtierMax;g!=this.subtierMax&&(this.subtierMax=g,a=!0);g=void 0!==this.config.bumped?this.config.bumped:
void 0!==this.dasSource.bumped?this.dasSource.bumped:this.dasSource.collapseSuperGroups?!1:!0;g!==this.bumped&&(this.bumped=g,a=!0,this.updateLabel());a&&this.scheduleRedraw();b&&this.browser.reorderTiers()};r.prototype.scheduleRedraw=function(){if(this.currentFeatures){var a=this;this.redrawTimeout||(this.redrawTimeout=setTimeout(function(){a.draw();a.redrawTimeout=null},10))}};r.prototype.addTierListener=function(a){this.listeners.push(a)};r.prototype.notifyTierListeners=function(a){for(var b=0;b<
this.listeners.length;++b)try{this.listeners[b](a)}catch(g){console.log(g)}this.browser.notifyTier()};r.prototype.addFeaturesLoadedListener=function(a){this.featuresLoadedListeners.push(a)};r.prototype.notifyFeaturesLoaded=function(){for(var a=0;a<this.featuresLoadedListeners.length;++a)try{this.featuresLoadedListeners[a].call(this)}catch(b){console.log(b)}};if("undefined"!==typeof t){t.exports={DasTier:r};var g=e("./feature-draw").drawFeatureTier,k=e("./sequence-draw").drawSeqTier}},{"./das":10,
"./feature-draw":17,"./sequence-draw":30,"./sha1":32,"./style":35,"./utils":47}],44:[function(e,t,s){function r(a,b){for(var c=0;c<a.length;++c){var f=a[c];f===b?f.classList.add("active"):f.classList.remove("active")}}if("undefined"!==typeof e){t=e("./cbrowser");var p=t.Browser,q=t.sourcesAreEqual;t=e("./utils");var h=t.makeElement,w=t.removeChildren,u=t.Observed;t=e("./thub");var z=t.THUB_COMPARE,a=t.connectTrackHub,b=e("./domui").makeTreeTableSection,m=e("./probe").probeResource;t=e("./bin");var g=
t.URLFetchable,k=t.BlobFetchable,f=t.readInt,c=e("./lh3utils").unbgzf,v=e("./bam").BAI_MAGIC,B=e("./tabix").TABIX_MAGIC;e=e("./das");var N=e.DASSource,L=e.DASSegment,O=e.DASRegistry,y=e.coordsMatch}p.prototype.currentlyActive=function(a){for(var b=0;b<this.tiers.length;++b)if(q(this.tiers[b].dasSource,a))return this.tiers[b];return!1};p.prototype.makeButton=function(a,b){var c=h("a",a,{href:"#"});b&&this.makeTooltip(c,b);return h("li",c)};p.prototype.showTrackAdder=function(e){function p(a){ba.style.display=
"none";ia.style.display="none";Y.style.display="none";U=!1;w(P);for(var d=h("div",null,{},{width:"100%"}),c=[],f=0;f<a.length;++f)c.push(a[f]);c.sort(function(a,d){return a.shortLabel.toLowerCase().trim().localeCompare(d.shortLabel.toLowerCase().trim())});a=[];for(var g=[],f=0;f<c.length;++f){var e=c[f];e.children&&0<e.children.length&&"multiWig"!=e.container?a.push(e):g.push(e)}0<g.length&&a.push({shortLabel:"Others",priority:-1E8,children:g});a.sort(z);for(var k=[],c=0;c<a.length;++c){e=g=a[c];
!e.dimensions&&e._parent&&e._parent.dimensions&&(e=e._parent);f={};if(e.dimensions)for(var l=e.dimensions.split(/(\w+)=(\w+)/),n=0;n<l.length-2;n+=3)f[l[n+1]]=l[n+2];if(f.dimX&&f.dimY){for(var m=f.dimX,q=f.dimY,f=e.subgroups[m],l=e.subgroups[q],n={},r=0;r<g.children.length;++r){var x=g.children[r],e=x.sgm[m],C=x.sgm[q];n[e]||(n[e]={});n[e][C]=x}q=h("table",null,{className:"table table-striped table-condensed"},{tableLayout:"fixed"});e=h("tr");e.appendChild(h("th",null,{},{width:"150px",height:"100px"}));
for(C=0;C<f.titles.length;++C)m=h("th",h("div",f.titles[C],{},{transform:"rotate(-60deg)",transformOrigin:"0% 100%",webkitTransform:"rotate(-60deg) translate(20px,10px)",webkitTransformOrigin:"0% 100%",textAlign:"left"}),{},{width:"35px",height:"100px",verticalAlign:"bottom"}),e.appendChild(m);q.appendChild(e);for(var u=h("tbody",null,{className:"table table-striped table-condensed"}),s=0;s<l.titles.length;++s){var C=l.tags[s],t=h("tr");t.appendChild(h("th",l.titles[s]),{});for(var D=0;D<f.titles.length;++D){var e=
f.tags[D],v=h("td");if(n[e]&&n[e][C]){e=n[e][C];r=e.toDallianceSource();if(!r)continue;m=h("tr");x=h("td");x.style.textAlign="center";var I=h("input");I.type="checkbox";I.dalliance_source=r;oa&&(I.dalliance_mapping=oa);k.push(I);v.appendChild(I);I.addEventListener("change",function(a){a.target.checked?A.addTier(a.target.dalliance_source):A.removeTier(a.target.dalliance_source)})}t.appendChild(v)}u.appendChild(t)}q.appendChild(u);d.appendChild(b(g.shortLabel,q,0==c))}else{l=h("tbody",null,{className:"table table-striped table-condensed"});
n=h("table",l,{className:"table table-striped table-condensed"},{width:"100%",tableLayout:"fixed"});C=0;g.children.sort(z);for(f=0;f<g.children.length;++f)if(e=g.children[f],r=e.toDallianceSource())m=h("tr"),x=h("td",null,{},{width:"30px"}),x.style.textAlign="center",I=h("input"),I.type="checkbox",I.dalliance_source=r,oa&&(I.dalliance_mapping=oa),k.push(I),x.appendChild(I),I.addEventListener("change",function(a){a.target.checked?A.addTier(a.target.dalliance_source):A.removeTier(a.target.dalliance_source)}),
m.appendChild(x),q=h("td"),q.appendChild(document.createTextNode(e.shortLabel)),e.longLabel&&0<e.longLabel.length&&A.makeTooltip(q,e.longLabel),m.appendChild(q),l.appendChild(m),++C;1<a.length||"Others"!==g.shortLabel?d.appendChild(b(g.shortLabel,n,0==c)):d.appendChild(n)}}var E=function(){for(var a=0;a<k.length;++a){var d=k[a],b=A.currentlyActive(d.dalliance_source);b?(d.checked=!0,d.disabled=null!=b.sequenceSource):d.checked=!1}};E();A.addTierListener(function(a){E()});P.appendChild(d)}function q(){r(n,
ka);U="bin";ba.style.display="none";ia.style.display="inline";Y.style.display="none";w(P);var a=h("div",null,{},{paddingLeft:"10px",paddingRight:"10px"});a.appendChild(h("h3","Add custom URL-based data"));a.appendChild(h("p",["You can add indexed binary data hosted on an web server that supports CORS (",h("a","full details",{href:"http://www.biodalliance.org/bin.html"}),").  Currently supported formats are bigwig, bigbed, and indexed BAM."]));a.appendChild(h("br"));a.appendChild(document.createTextNode("URL: "));
ca=h("input","",{size:80,value:"http://www.biodalliance.org/datasets/ensGene.bb"},{width:"100%"});a.appendChild(ca);a.appendChild(h("br"));a.appendChild(h("b","- or -"));a.appendChild(h("br"));a.appendChild(document.createTextNode("File: "));ha=h("input",null,{type:"file",multiple:"multiple"});a.appendChild(ha);a.appendChild(h("p",'Clicking the "Add" button below will initiate a series of test queries.'));P.appendChild(a);ca.focus()}function s(){r(n,ga);ba.style.display="none";ia.style.display="inline";
Y.style.display="none";U="hub-connect";ba.style.visibility="hidden";w(P);var a=h("div",null,{},{paddingLeft:"10px",paddingRight:"10px"});a.appendChild(h("h3","Connect to a track hub."));a.appendChild(h("p",['Enter the top-level URL (usually points to a file called "hub.txt") of a UCSC-style track hub']));ca=h("input","",{size:120,value:"http://www.biodalliance.org/datasets/testhub/hub.txt"},{width:"100%"});a.appendChild(ca);P.appendChild(a);ca.focus()}function d(){r(n,ja);ba.style.display="none";
ia.style.display="inline";Y.style.display="none";U="das";w(P);var a=h("div",null,{},{paddingLeft:"10px",paddingRight:"10px"});a.appendChild(h("h3","Add custom DAS data"));a.appendChild(h("p","This interface is intended for adding custom or lab-specific data.  Public data can be added more easily via the registry interface."));a.appendChild(document.createTextNode("URL: "));a.appendChild(h("br"));ca=h("input","",{size:80,value:"http://www.derkholm.net:8080/das/medipseq_reads/"},{width:"100%"});a.appendChild(ca);
a.appendChild(h("p",'Clicking the "Add" button below will initiate a series of test queries.  If the source is password-protected, you may be prompted to enter credentials.'));P.appendChild(a);ca.focus()}function x(){if(U)if("das"===U){var a=ca.value.trim();/^.+:\/\//.exec(a)||(a="http://"+a);var b=new N({name:"temporary",uri:a});ta(b)}else if("bin"===U)if((a=ha.files)&&0<a.length){b=K=[];U="multiple";for(var c=0;c<a.length;++c){var f=a[c];f&&b.push({blob:f})}for(c=0;c<b.length;++c)ra(b[c]);ea()}else a=
ca.value.trim(),/^.+:\/\//.exec(a)||(a="http://"+a),va({uri:a});else if("reset"===U)d();else if("reset-bin"===U)q();else if("reset-hub"===U)s();else if("prompt-bai"===U)(a=ha.files)&&0<a.length&&a[0]?(da.baiBlob=a[0],l(da)):(a=da,ba.style.display="none",ia.style.display="inline",Y.style.display="inline",w(P),U="prompt-bai",P.appendChild(h("h2","Select an index file")),P.appendChild(h("p","Dalliance requires a BAM index (.bai) file when displaying BAM data.  These normally accompany BAM files.  For security reasons, web applications like Dalliance can only access local files which you have explicity selected.  Please use the file chooser below to select the appropriate BAI file")),
P.appendChild(document.createTextNode("Index file: ")),ha=h("input",null,{type:"file"}),P.appendChild(ha),da=a);else if("prompt-tbi"===U)(a=ha.files)&&0<a.length&&a[0]?(da.indexBlob=a[0],D(da)):(a=da,ba.style.display="none",ia.style.display="inline",Y.style.display="inline",w(P),U="prompt-tbi",P.appendChild(h("h2","Select an index file")),P.appendChild(h("p","Dalliance requires a Tabix index (.tbi) file when displaying VCF data.  For security reasons, web applications like Dalliance can only access local files which you have explicity selected.  Please use the file chooser below to select the appropriate BAI file")),
P.appendChild(document.createTextNode("Index file: ")),ha=h("input",null,{type:"file"}),P.appendChild(ha),da=a);else if("finalize"===U||"finalize-bin"===U)da.name=na.value,a=la.value,da.mapping="__default__"!=a?a:void 0,ma&&(da.maxbins=ma.checked),1<pa.value.length&&1<qa.value.length&&(da.xUser=pa.value,da.xPass=qa.value),A.addTier(da),"finalize-bin"==U?q():d();else if("hub-connect"===U)a=ca.value.trim(),/^.+:\/\//.exec(a)||(a="http://"+a),C(a);else{if("multiple"===U){for(a=0;a<K.length;++a)if(b=
K[a],!b.hidden&&("bam"!=b.tier_type||b.indexBlob||b.indexUri)&&("tabix"!=b.tier_type||b.indexBlob||b.indexUri)&&(b=ua(b)))b.noPersist=!0,A.addTier(b);q()}}else A.removeAllPopups()}function C(d,b,c){b=b||{};for(var f=0;f<A.hubObjects.length;++f){var g=A.hubObjects[f];if(g.hub.url==d){for(f=0;f<n.length;++f)n[f].hub==g&&r(n,n[f]);g.getTracks(function(a,d){d&&console.log(d);p(a)});return}}a(d,function(a,f){if(f){if(!c)return C(d,{credentials:!0},!0);w(P);P.appendChild(h("h2","Error connecting to track hub"));
P.appendChild(h("p",f));U="reset-hub"}else{var g=null,e=null,k;for(k in a.genomes){var l=null,m=!1;if(k==A.coordSystem.ucscName)m=!0;else for(var q in A.chains)k==A.chains[q].coords.ucscName&&(l=q,m=!0);m&&(m={url:d,genome:k},b.credentials&&(m.credentials=!0),l&&(m.mapping=l,a.genomes[k].mapping=l),A.hubs.push(m),A.hubObjects.push(a.genomes[k]),m=T(a.genomes[k]),fa.appendChild(m),l&&g||(g=a.genomes[k],e=m))}g?(A.notifyTier(),r(n,e),g.getTracks(function(a,d){p(a)})):(w(P),P.appendChild(h("h2","No data for this genome")),
P.appendChild(h("p","This URL appears to be a valid track-hub, but it doesn't contain any data for the coordinate system of this browser")),P.appendChild(h("p","coordSystem.ucscName = "+A.coordSystem.ucscName)),U="reset-hub")}},b)}function t(a,d){var b=a.uri;if(d){var c=/(.+)\/[^\/]+\/?/.exec(b);c&&(b=c[1]+"/sources")}(new O(b,{credentials:a.credentials})).sources(function(b){if(!b||0==b.length)return d?V(a):t(a,!0);var c=null;if(1==b.length)c=b[0];else for(var f=0;f<b.length;++f)if(b[f].uri===a.uri){c=
b[f];break}f=b=!1;if(c&&(a.name=c.name,a.desc=c.desc,a.maxbins=c.maxbins?!0:!1,c.capabilities&&(a.capabilities=c.capabilities),f=!0,c.coords&&1==c.coords.length))if(c=c.coords[0],y(c,A.coordSystem))b=!0;else if(A.chains)for(var g in A.chains)y(c,A.chains[g].coords)&&(a.mapping=g,b=!0);return V(a,b,f)},function(){return d?V(a):t(a,!0)})}function l(a){(a.baiBlob?new k(a.baiBlob):new g(a.bamURI+".bai")).slice(0,256).fetch(function(d){var b=!1;d&&(d=new Uint8Array(d),b=f(d,0)==v);return b?V(a,!1,!1,!0):
E("You have selected a valid BAM file, but a corresponding index (.bai) file was not found.  Please index your BAM (samtools index) and place the BAI file in the same directory")})}function D(a){(a.indexBlob?new k(a.indexBlob):new g(a.uri+".tbi")).slice(0,65536).fetch(function(d){var b=!1;if(d){var g=new Uint8Array(d);if(31==g[0]||139==g[1])d=c(d),g=new Uint8Array(d),b=f(g,0)==B}return b?V(a,!1,!1,!0):E('You have selected a valid VCF file, but a corresponding index (.tbi) file was not found.  Please index your VCF ("tabix -p vcf -f myfile.vcf.gz") and place the .tbi file in the same directory')})}
function E(a){ba.style.display="none";ia.style.display="inline";Y.style.display="inline";w(P);a=a||"Custom data format not recognized";P.appendChild(h("h2","Error adding custom data"));P.appendChild(h("p",a));P.appendChild(h("p","Currently supported formats are bigBed, bigWig, and BAM."));U="reset-bin"}if("add"===this.uiMode)this.hideToolPanel(),this.setUiMode("none");else{var A=this;e=h("div",null,{className:"dalliance"},{width:"100%",display:"inline-block",boxSizing:"border-box",MozBoxSizing:"border-box",
verticalAlign:"top",paddingRight:"15px"});var n=[],M,S;if(!this.noRegistryTabs){var Q=this.makeButton("Registry","Browse compatible datasources from the DAS registry");n.push(Q);for(var R in this.mappableSources)(function(a){var d=A.makeButton(A.chains[a].srcTag,"Browse datasources mapped from "+A.chains[a].srcTag);n.push(d);d.addEventListener("click",function(b){b.preventDefault();b.stopPropagation();r(n,d);M(A.mappableSources[a],a)},!1)})(R)}R={};for(var W=0;W<this.defaultSources.length;++W){var aa=
this.defaultSources[W],X=aa.group||"Defaults";R[X]?R[X].push(aa):R[X]=[aa]}var T=function(a){var d=a.hub,b=h("i",null,{className:"fa fa-list-alt"},{cursor:"context-menu"}),c=d.shortLabel||"Unknown";a.mapping&&(c=c+" ("+a.genome+")");var c=h("span",[c," ",b]),f=A.makeButton(c,d.longLabel);f.hub=a;n.push(f);f.addEventListener("click",function(d){d.preventDefault();d.stopPropagation();r(n,f);w(P);d=A.makeLoader(24);d.style.marginLeft="auto";d.style.marginRight="auto";d.style.marginTop="100px";P.appendChild(h("div",
d,null,{textAlign:"center"}));ba.style.display="none";ia.style.display="none";Y.style.display="none";a.getTracks(function(a,d){d&&console.log(d);p(a)})},!1);b.addEventListener("click",function(d){d.preventDefault();d.stopPropagation();var b=h("li",h("a","Remove hub")),c=h("li",h("a","Enable all")),g=h("li",h("a","Disable all")),e=h("ul",[b,c,g],{className:"dropdown-menu"},{display:"block"}),k=d.clientX;d=d.clientY;k+=document.documentElement.scrollLeft||document.body.scrollLeft;d+=document.documentElement.scrollTop||
document.body.scrollTop;e.style.position="absolute";e.style.top=""+(d+10)+"px";e.style.left=""+(k-30)+"px";A.hPopupHolder.appendChild(e);var l=function(a){console.log("cc");document.body.removeEventListener("click",l,!0);A.hPopupHolder.removeChild(e)};document.body.addEventListener("click",l,!0);b.addEventListener("click",function(d){for(d=0;d<A.hubObjects.length;++d)if(A.hubObjects[d].absURL==a.absURL){A.hubObjects.splice(d,1);break}for(d=0;d<A.hubs.length;++d){var b=A.hubs[d];"string"===typeof b&&
(b={url:b});if(b.url==a.hub.url&&!b.genome||b.genome==a.genome){A.hubs.splice(d,1);break}}A.notifyTier();fa.removeChild(f);r(n,ga);s()},!1);c.addEventListener("click",function(d){a.getTracks(function(a,d){d&&console.log(d);for(var b=0;b<a.length;++b){var c=a[b].toDallianceSource();A.currentlyActive(c)||A.addTier(c)}})},!1);g.addEventListener("click",function(d){a.getTracks(function(a,d){d&&console.log(d);for(var b=0;b<a.length;++b){var c=a[b].toDallianceSource();A.currentlyActive(c)&&A.removeTier(c)}})},
!1)},!1);return f},$=null,Z=null;for(X in R)(function(a,d){var b=A.makeButton(a,"Browse the default set of data for this browser");b.addEventListener("click",function(a){a.preventDefault();a.stopPropagation();r(n,b);M(new u(d))},!1);n.push(b);$||($=b,Z=d)})(X,R[X]);var ja=this.makeButton("DAS","Add arbitrary DAS data");n.push(ja);var ka=this.makeButton("Binary","Add data in bigwig or bigbed format");n.push(ka);for(X=0;X<this.hubObjects.length;++X)T(this.hubObjects[X]);var ga=this.makeButton("+","Connect to a new track-hub");
n.push(ga);var fa=h("ul",n,{className:"nav nav-tabs"},{marginBottom:"0px"});e.appendChild(fa);var ca,na,la,ma,ha,pa,qa,U=!1,da=null,X=h("form",null,{},{display:"inline-block",width:"100%"});X.addEventListener("submit",function(a){a.stopPropagation();a.preventDefault();x();return!1},!0);var P=h("div");P.style.position="relative";P.style.overflow="scroll";X.appendChild(P);var oa,sa;M=function(a,d){ba.style.display="none";ia.style.display="none";Y.style.display="none";sa&&sa.removeListener(S);oa=d;sa=
a;sa.addListenerAndFire(S)};S=function(a){U=!1;var d=[];w(P);if(a){for(var b=h("tbody",null,{className:"table table-striped table-condensed"},{width:"100%"}),c=h("table",b,{className:"table table-striped table-condensed"},{width:"100%",tableLayout:"fixed"}),f=0,g=[],e=0;e<a.length;++e)g.push(a[e]);g.sort(function(a,d){return a.name.toLowerCase().trim().localeCompare(d.name.toLowerCase().trim())});for(e=0;e<g.length;++e){a=g[e];var k=h("tr"),l=h("td",null,{},{width:"30px"});l.style.textAlign="center";
if(!a.props||a.props.cors){var n=h("input");n.type="checkbox";n.dalliance_source=a;oa&&(n.dalliance_mapping=oa);l.appendChild(n);d.push(n);n.addEventListener("change",function(a){a.target.checked?A.addTier(a.target.dalliance_source):A.removeTier(a.target.dalliance_source)})}else l.appendChild(document.createTextNode("!")),A.makeTooltip(l,h("span",["This data source isn't accessible because it doesn't support ",h("a","CORS",{href:"http://www.w3.org/TR/cors/"}),"."]));k.appendChild(l);l=h("td");l.appendChild(document.createTextNode(a.name));
a.desc&&0<a.desc.length&&A.makeTooltip(l,a.desc);k.appendChild(l);b.appendChild(k);++f}var m=function(){for(var a=0;a<d.length;++a){var b=d[a];A.currentlyActive(b.dalliance_source)?b.checked=!0:b.checked=!1}};m();A.addTierListener(function(a){m()});P.appendChild(c)}else P.appendChild(h("p","Dalliance was unable to retrieve data source information from the DAS registry, please try again later"))};Q&&Q.addEventListener("click",function(a){a.preventDefault();a.stopPropagation();r(n,Q);M(A.availableSources)},
!1);ka.addEventListener("click",function(a){a.preventDefault();a.stopPropagation();q()},!1);ga.addEventListener("click",function(a){a.preventDefault();a.stopPropagation();s()},!1);ja.addEventListener("click",function(a){a.preventDefault();a.stopPropagation();d()},!1);var ia=h("button","Add",{className:"btn btn-primary"});ia.addEventListener("click",function(a){a.stopPropagation();a.preventDefault();x()},!1);var ta=function(a,d){var b=A.knownSpace;if(b){var c=Math.max(b.min,(b.min+b.max-100)/2)|0,
b=new L(b.chr,c,Math.min(c+99,b.max));a.features(b,{},function(b,c){if(c)d?(w(P),P.appendChild(h("h2","Custom data not found")),P.appendChild(h("p","DAS uri: "+a.uri+" is not answering features requests")),U="reset"):(a.credentials=!0,ta(a,!0));else{var f=/\/([^/]+)\/?$/.exec(a.uri);f&&(a.name=f[1]);t(a)}})}else alert("Can't confirm track-addition to an uninit browser.")},ua=function(a){var d={name:a.name};a.credentials&&(d.credentials=a.credentials);a.mapping&&"__default__"!=a.mapping&&(d.mapping=
a.mapping);if("bwg"==a.tier_type)return a.blob?d.bwgBlob=a.blob:a.uri&&(d.bwgURI=a.uri),d;if("bam"==a.tier_type)return a.blob?(d.bamBlob=a.blob,d.baiBlob=a.indexBlob):(d.bamURI=a.uri,d.baiURI=a.indexUri),d;if("tabix"==a.tier_type)return d.tier_type="tabix",d.payload=a.payload,a.blob?(d.blob=a.blob,d.indexBlob=a.indexBlob):(d.uri=a.uri,d.indexUri=a.indexUri),d;if("memstore"==a.tier_type)return d.tier_type="memstore",d.payload=a.payload,a.blob?d.blob=a.blob:d.uri=a.uri,d},va=function(a){m(a,function(a,
d){if(d)w(P),P.appendChild(h("h2","Couldn't access custom data")),P.appendChild(h("p",""+d)),U="reset-bin";else{var b=ua(a);return"bam"==a.tier_type?l(b):"tabix"==a.tier_type?D(b):V(b,!1,!1,!0)}})},V=function(a,d,b,c){ba.style.display="none";ia.style.display="inline";Y.style.display="inline";w(P);P.appendChild(h("h2","Add custom data: step 2"));P.appendChild(document.createTextNode("Label: "));na=h("input","",{value:a.name});P.appendChild(na);pa=h("input","");qa=h("input","");P.appendChild(h("br"));
P.appendChild(h("br"));P.appendChild(h("h4","Coordinate system: "));la=h("select",null);la.appendChild(h("option",A.nameForCoordSystem(A.coordSystem),{value:"__default__"}));if(A.chains)for(var f in A.chains)la.appendChild(h("option",A.nameForCoordSystem(A.chains[f].coords),{value:f}));la.value=a.mapping||"__default__";P.appendChild(la);d?P.appendChild(h("p","(Based on server response, probably doesn't need changing.)")):(P.appendChild(h("p",[h("b","Warning: "),"unable to determine the correct value from server responses.  Please check carefully."])),
P.appendChild(h("p","If you don't see the mapping you're looking for, please contact thomas@biodalliance.org")));c||(P.appendChild(document.createTextNode("Quantitative: ")),ma=h("input",null,{type:"checkbox",checked:!0}),"undefined"!==typeof a.maxbins&&(ma.checked=a.maxbins),P.appendChild(ma),b?P.appendChild(h("p","(Based on server response, probably doesn't need changing.)")):P.appendChild(h("p",[h("b","Warning: "),"unable to determine correct value.  If in doubt, leave checked."])));a.bwgBlob&&
P.appendChild(h("p",[h("b","Warning: "),"data added from local file.  Due to the browser security model, the track will disappear if you reload Dalliance."]));na.focus();U="bin"===U||"prompt-bai"===U||"prompt-tbi"===U?"finalize-bin":"finalize";da=a},K=null,ra=function(a){m(a,function(a,d){d&&(a.error=d);for(var b=[],c={},f={},g=0;g<K.length;++g){var e=K[g];"bam"!=e.tier_type||e.indexBlob||(c[e.blob.name]=e);"tabix"!=e.tier_type||e.indexBlob||(f[e.blob.name]=e)}for(g=0;g<K.length;++g)if(e=K[g],"bai"===
e.tier_type){var h=/(.+)\.bai$/.exec(e.blob.name);h&&c[h[1]]&&(c[h[1]].indexBlob=e.blob,b.push(g))}else"tabix-index"===e.tier_type&&(h=/(.+)\.tbi$/.exec(e.blob.name))&&f[h[1]]&&(f[h[1]].indexBlob=e.blob,b.push(g));for(c=b.length-1;0<=c;--c)K.splice(b[c],1);ea()})},ea=function(){w(P);var a=!1,d=h("table",K.filter(function(a){return!a.hidden}).map(function(d){h("tr").appendChild(h("td",d.name||d.blob.name));var b;b=d.error?h("span","Error",null,{color:"red"}):d.tier_type?d.payload||d.tier_type:A.makeLoader(16);
var c,f="unknown";"bwg"==d.tier_type||"memstore"==d.tier_type?f="okay":"bam"==d.tier_type?f=d.indexBlob?"okay":"needs-index":"tabix"==d.tier_type&&(f=d.indexBlob?"okay":"needs-index");if("okay"==f){c=h("select",null,null,{width:"150px"});c.appendChild(h("option",A.nameForCoordSystem(A.coordSystem),{value:"__default__"}));if(A.chains)for(var g in A.chains)c.appendChild(h("option",A.nameForCoordSystem(A.chains[g].coords),{value:g}));c.value=d.mapping||"__default__";c.addEventListener("change",function(a){d.mapping=
c.value;console.log(d)},!1)}else"needs-index"==f&&(c=h("span","Needs index",{},{color:"red"}),a=!0);return h("tr",[h("td",d.name||d.blob.name),h("td",b),h("td",c)])}),{className:"table table-striped table-condensed"});P.appendChild(d);if(a){P.appendChild(h("p","Some of these files are missing required index (.bai or .tbi) files.  For security reasons, web applications like Dalliance can only access local files which you have explicity selected.  Please use the file chooser below to select the appropriate index file"));
P.appendChild(document.createTextNode("Index file(s): "));var b=h("input",null,{type:"file",multiple:"multiple"});P.appendChild(b);b.addEventListener("change",function(a){console.log("fileset changed");a=b.files||[];for(var d=0;d<a.length;++d){var c=a[d];c&&(c={blob:c,hidden:!0},K.push(c),ra(c))}},!1)}},Y=h("button","Cancel",{className:"btn"});Y.addEventListener("click",function(a){a.stopPropagation();a.preventDefault();"finalize-bin"===U?q():d()},!1);var ba=h("button","Refresh",{className:"btn"});
ba.addEventListener("click",function(a){a.stopPropagation();a.preventDefault();A.queryRegistry(oa)},!1);this.makeTooltip(ba,"Click to re-fetch data from the DAS registry");R=h("div",[ia," ",Y," ",ba]);R.style.margin="10px";X.appendChild(R);e.appendChild(X);M(A.availableSources);this.showToolPanel(e);this.setUiMode("add");$&&(r(n,$),M(new u(Z)))}}},{"./bam":1,"./bin":4,"./cbrowser":6,"./das":10,"./domui":11,"./lh3utils":23,"./probe":27,"./tabix":39,"./thub":40,"./utils":47}],45:[function(e,t,s){function r(e,
h,r){h.fetchAsText(function(h){if(!h)return r(null,"Couldn't fetch index-index");h=h.split(/(.+)([0-9A-F]{10})\n/);for(var s=[],a=[],b=1;b<h.length;b+=3)s.push(h[b]),a.push(parseInt(h[b+1],16));return r(new p(s,a,e))})}function p(e,h,p){this.keys=e;this.offsets=h;this.ix=p}p.prototype.lookup=function(e,h){for(var p,r=(e+"     ").substring(0,5).toLowerCase(),s=0;s<this.keys.length;++s)if(0>r.localeCompare(this.keys[s])){p=this.ix.slice(this.offsets[s-1],this.offsets[s]-this.offsets[s-1]);break}p||
(p=this.ix.slice(this.offsets[this.offsets.length-1]));p.fetchAsText(function(a){a=a.split("\n");for(var b=0;b<a.length;++b)if(0==a[b].indexOf(e.toLowerCase()+" "))return h(a[b].split(" "));return h(null)})};"undefined"!==typeof t&&(t.exports={connectTrix:r})},{}],46:[function(e,t,s){function r(){}function p(a,f){var c=new r;c.data=a;c.data.slice(0,12500).fetch(function(a){if(!a)return f(null,"Couldn't access data");var g=new Uint8Array(a);a=h(g,0);if(a==b)c.readInt=h;else if(a==m)c.readInt=w;else return f(null,
"Not a .2bit file, magic=0x"+a.toString(16));a=c.readInt(g,4);if(0!=a)return f(null,"Unsupported version "+a);c.seqCount=c.readInt(g,8);c.seqDict={};var e=16,k=0,p=0,r=function(){for(;k<c.seqCount;){var a=g[e];if(e+a+6>=g.length)return c.data.slice(p+e,12500).fetch(function(a){p+=e;e=0;g=new Uint8Array(a);r()});++e;for(var b="",h=1;h<=a;++h)b+=String.fromCharCode(g[e++]);a=c.readInt(g,e);e+=4;c.seqDict[b]=new q(c,a);++k}return f(c)};r()})}function q(a,b){this.tbf=a;this.offset=b}if("undefined"!==
typeof e){s=e("./bin");var h=s.readInt,w=s.readIntBE;e=e("./spans");var u=e.Range,z=e.union,a=e.intersection}var b=440477507,m=1126646042;r.prototype.getSeq=function(a){var b=this.seqDict[a];b||(b=this.seqDict["chr"+a]);return b};r.prototype.fetch=function(a,b,c,g){var e=this.getSeq(a);if(e){if(c<=b)return g("");e.fetch(b,c,g)}else return g(null,"Couldn't find "+a)};q.prototype.init=function(a){if(this.seqOffset)return a();var b=this;b.tbf.data.slice(b.offset,8).fetch(function(c){if(!c)return a("Fetch failed");
c=new Uint8Array(c);b._length=b.tbf.readInt(c,0);b.nBlockCnt=b.tbf.readInt(c,4);b.tbf.data.slice(b.offset+8,8*b.nBlockCnt+4).fetch(function(c){if(!c)return a("Fetch failed");c=new Uint8Array(c);for(var g=null,e=0;e<b.nBlockCnt;++e)var h=b.tbf.readInt(c,4*e),m=b.tbf.readInt(c,4*(e+b.nBlockCnt)),h=new u(h,h+m-1),g=g?z(g,h):h;b.nBlocks=g;b.mBlockCnt=b.tbf.readInt(c,8*b.nBlockCnt);b.seqLength=(b._length+3)/4|0;b.seqOffset=b.offset+16+8*(b.nBlockCnt+b.mBlockCnt);return a()})})};var g=["T","C","A","G"];
q.prototype.fetch=function(b,f,c){--b;--f;var e=this;this.init(function(h){if(h)return c(null,h);var m=b>>2;h=f+3>>2;if(0>m||h>e.seqLength)return c("Coordinates out of bounds: "+b+":"+f);e.tbf.data.slice(e.seqOffset+m,h-m).salted().fetch(function(h){function p(a){for(;t<=a;){var b=t&3,c=q[(t>>2)-m];s+=g[0==b?c>>6&3:1==b?c>>4&3:2==b?c>>2&3:c&3];++t}}if(null==h)return c("SeqFetch failed");var q=new Uint8Array(h);h=[];if(e.nBlocks){var r=a(new u(b,f),e.nBlocks);r&&(h=r.ranges())}for(var s="",t=b,r=0;r<
h.length;++r){var w=h[r];if(t>w.min())throw"N mismatch...";for(t<w.min()&&p(w.min()-1);t<=w.max();)s+="N",++t}t<=f&&p(f);return c(s)})})};q.prototype.length=function(a){var b=this;this.init(function(c){return c?a(null,c):a(b._length)})};"undefined"!==typeof t&&(t.exports={makeTwoBit:p})},{"./bin":4,"./spans":34}],47:[function(e,t,s){function r(a,b){for(var c=0;c<a.length;++c)if(a[c]==b)return;a.push(b)}function p(a,b,c){a[b]?a[b].push(c):a[b]=[c]}function q(a,b,c){var f=a[b];if(f){for(a=0;a<f.length;++a)if(f[a]==
c)return;f.push(c)}else a[b]=[c]}function h(a,b,c,f){if(a)return a;if(b)return b;if(c)return c;if(f)return f}function r(a,b){for(var c=0;c<a.length;++c)if(a[c]==b)return;a.push(b)}function w(a,b){if(!a)return-1;for(var c=0;c<a.length;++c)if(a[c]===b)return c;return-1}function u(a,b,c,f){a=document.createElement(a);if(b){b instanceof Array||(b=[b]);for(var g=0;g<b.length;++g){var e=b[g];e&&("string"==typeof e?e=document.createTextNode(e):"number"==typeof e&&(e=document.createTextNode(""+e)),a.appendChild(e))}}if(c)for(var d in c)try{a[d]=
c[d]}catch(h){throw console.log("error setting "+d),h;}if(f)for(d in f)a.style[d]=f[d];return a}function z(a,b,c,f){a=document.createElementNS(a,b);if(c)for(c instanceof Array||(c=[c]),b=0;b<c.length;++b){var g=c[b];"string"==typeof g&&(g=document.createTextNode(g));a.appendChild(g)}if(f)for(var e in f){c=a;b=e;var g=f[e],d=N[b];if(!d){for(var d="",h=0;h<b.length;++h)var k=b.substring(h,h+1),m=k.toLowerCase(),d=m!=k?d+"-"+m:d+k;N[b]=d}c.setAttribute(d,g)}return a}function a(a){if(a&&a.childNodes)for(;0<
a.childNodes.length;)a.removeChild(a.firstChild)}function b(a,c){if("undefined"===typeof a)return"undefined";if(null==a)return"null";if("string"==typeof a)return"'"+a+"'";if("number"==typeof a||"boolean"==typeof a)return""+a;if("object"==typeof a){if(a instanceof Array){for(var f=null,g=0;g<a.length;++g)f=(null==f?"":f+", ")+b(a[g],c);return"["+(f?f:"")+"]"}c=c||{};f=null;for(g in a)c[g]||void 0!=g&&"function"!=typeof a[g]&&(f=(null==f?"":f+", ")+g+": "+b(a[g],c));return"{"+(f?f:"")+"}"}return typeof a}
function m(a){var b={},c;for(c in a)b[c]=a[c];return b}function g(a){this.value=a;this.listeners=[]}function k(){this.queue=[]}function f(a,b,c){c.salt&&(a=a+"?salt="+B(""+Date.now()+","+ ++L));var f=new XMLHttpRequest;f.onreadystatechange=function(){4==f.readyState&&(300<=f.status?b(null,"Error code "+f.status):b(f.responseText))};f.open("GET",a,!0);f.responseType="text";c&&c.credentials&&(f.withCredentials=!0);f.send("")}function c(a,b){if(0==b.indexOf("http:")||0==b.indexOf("https:"))return b;
var c=a.lastIndexOf("/");return 0<=c?a.substr(0,c+1)+b:b}function v(a){return u("a",null,{href:a}).href}if("undefined"!==typeof e)var B=e("./sha1").b64_sha1;var N={};g.prototype.addListener=function(a){this.listeners.push(a)};g.prototype.addListenerAndFire=function(a){this.listeners.push(a);a(this.value)};g.prototype.removeListener=function(a){var b=this.listeners;a=w(b,a);0<=a&&b.splice(a,1)};g.prototype.get=function(){return this.value};g.prototype.set=function(a){this.value=a;for(var b=0;b<this.listeners.length;++b)this.listeners[b](a)};
k.prototype.provide=function(a){if(void 0!==this.res)throw"Resource has already been provided.";this.res=a;for(var b=0;b<this.queue.length;++b)this.queue[b](a);this.queue=null};k.prototype.await=function(a){if(void 0!==this.res)return a(this.res),this.res;this.queue.push(a)};var L=0;e={TTT:"F",TTC:"F",TTA:"L",TTG:"L",CTT:"L",CTC:"L",CTA:"L",CTG:"L",ATT:"I",ATC:"I",ATA:"I",ATG:"M",GTT:"V",GTC:"V",GTA:"V",GTG:"V",TCT:"S",TCC:"S",TCA:"S",TCG:"S",CCT:"P",CCC:"P",CCA:"P",CCG:"P",ACT:"T",ACC:"T",ACA:"T",
ACG:"T",GCT:"A",GCC:"A",GCA:"A",GCG:"A",TAT:"Y",TAC:"Y",TAA:"*",TAG:"*",CAT:"H",CAC:"H",CAA:"Q",CAG:"Q",AAT:"N",AAC:"N",AAA:"K",AAG:"K",GAT:"D",GAC:"D",GAA:"E",GAG:"E",TGT:"C",TGC:"C",TGA:"*",TGG:"W",CGT:"R",CGC:"R",CGA:"R",CGG:"R",AGT:"S",AGC:"S",AGA:"R",AGG:"R",GGT:"G",GGC:"G",GGA:"G",GGG:"G"};"trim"in String.prototype||(String.prototype.trim=function(){return this.replace(/^\s+/,"").replace(/\s+$/,"")});"undefined"!==typeof t&&(t.exports={textXHR:f,relativeURL:c,resolveUrlToPage:v,shallowCopy:m,
pusho:p,pushnew:r,pushnewo:q,arrayIndexOf:w,pick:h,makeElement:u,makeElementNS:z,removeChildren:a,miniJSONify:b,Observed:g,Awaited:k,AMINO_ACID_TRANSLATION:e})},{"./sha1":32}],48:[function(e,t,s){function r(){this.info=[]}function p(a,b){this.parser=a;this.sink=b}if("undefined"!==typeof e){var q=e("./sourceadapters").registerParserFactory;e=e("./das");var h=e.DASStylesheet,w=e.DASStyle,u=e.DASFeature}var z=/([^;=]+)(=([^;]+))?;?/,a=/##INFO=<([^>]+)>/,b=/([^,=]+)=([^,]+|"[^"]+"),?/;r.prototype.createSession=
function(a){return new p(this,a)};p.prototype.parse=function(e){if(0!=e.length)if("#"==e[0]){if(1<e.length&&"#"==e[1]&&(e=a.exec(e))){var g=e[1].split(b),h=null,f=null;for(e=0;e<g.length-1;e+=3){var c=g[e+1],p=g[e+2].replace(/"/g,"");"ID"==c?h=p:"Description"==c&&(f=p)}h&&f&&this.parser.info.push({id:h,desc:f})}}else{g=e.split("\t");h=new u;h.segment=g[0];h.id=g[2];h.refAllele=g[3];h.altAlleles=g[4].split(",");h.min=parseInt(g[1]);h.max=h.min+h.refAllele.length-1;g=g[7].split(z);h.info={};for(e=0;e<
g.length;e+=4)h.info[g[e+1]]=g[e+3];e=h.altAlleles[0];g=h.refAllele;e.length>g.length?(h.type="insertion",0==e.indexOf(g)?(h.insertion=e.substr(g.length),h.min+=g.length,h.max=h.min-1):h.insertion=e):h.type=e.length<g.length?"deletion":"substitution";this.sink(h)}};p.prototype.flush=function(){};r.prototype.getStyleSheet=function(a){var b=new h,e=new w;e.glyph="__INSERTION";e.BUMP="yes";e.LABEL="no";e.FGCOLOR="rgb(50,80,255)";e.BGCOLOR="#888888";e.STROKECOLOR="black";b.pushStyle({type:"insertion"},
null,e);e=new w;e.glyph="PLIMSOLL";e.BUMP="yes";e.LABEL="no";e.FGCOLOR="rgb(255, 60, 60)";e.BGCOLOR="#888888";e.STROKECOLOR="black";b.pushStyle({type:"deletion"},null,e);e=new w;e.glyph="PLIMSOLL";e.BUMP="yes";e.LABEL="no";e.FGCOLOR="rgb(50,80,255)";e.BGCOLOR="#888888";e.STROKECOLOR="black";b.pushStyle({type:"default"},null,e);return a(b)};r.prototype.getDefaultFIPs=function(a){var b=this;a(function(a,f){f.add("Ref. allele",a.refAllele);f.add("Alt. alleles",a.altAlleles.join(","));if(a.info)for(var c=
0;c<b.info.length;++c){var e=b.info[c],h=a.info[e.id];void 0!==h&&f.add(e.desc,h)}})};q("vcf",function(){return new r})},{"./das":10,"./sourceadapters":33}],49:[function(e,t,s){e={CONFIG:5,MAJOR:0,MINOR:12,MICRO:9,PATCH:"",BRANCH:"dev",toString:function(){var e=""+this.MAJOR+"."+this.MINOR+"."+this.MICRO;this.PATCH&&(e+=this.PATCH);this.BRANCH&&""!=this.BRANCH&&(e=e+"-"+this.BRANCH);return e}};"undefined"!==typeof t&&(t.exports=e)},{}],50:[function(e,t,s){function r(){function e(a){a=Math.min(a,m);
f=a=Math.max(a,b);s.style.left=""+f+"px"}function h(a){a=Math.min(a,m);c=a=Math.max(a,b);t.style.left=""+c+"px"}var r=p("hr",null,{className:"slider-track"}),s=p("hr",null,{className:"slider-thumb active"}),t=p("hr",null,{className:"slider-thumb"}),a=p("div",[r,s,t],{className:"slider"}),b=0,m=200,g=0,k=200,f=50,c=100,v=[];a.removeLabels=function(){for(var b=0;b<v.length;++b)a.removeChild(v[b]);v=[]};a.addLabel=function(c,f){var e=p("div",f,{className:"slider-label"},{left:""+(b+(c-g)*(m-b)/(k-g)|
0)+"px"});a.appendChild(e);v.push(e)};var B=document.createEvent("HTMLEvents");B.initEvent("change",!0,!1);Object.defineProperty(a,"value",{get:function(){return g+(f-b)*(k-g)/(m-b)},set:function(a){e(b+(a-g)*(m-b)/(k-g))}});Object.defineProperty(a,"value2",{get:function(){return g+(c-b)*(k-g)/(m-b)},set:function(a){h(b+(a-g)*(m-b)/(k-g))}});Object.defineProperty(a,"active",{get:function(){return s.classList.contains("active")?1:2},set:function(a){1==a?(s.classList.add("active"),t.classList.remove("active")):
(t.classList.add("active"),s.classList.remove("active"))}});Object.defineProperty(a,"min",{get:function(){return g},set:function(a){g=a}});Object.defineProperty(a,"max",{get:function(){return k},set:function(a){k=a}});var N,L,r=function(b){L=this==s?1:2;L!=a.active&&(a.active=L,a.dispatchEvent(B));b.stopPropagation();b.preventDefault();window.addEventListener("mousemove",O,!1);window.addEventListener("mouseup",y,!1);N=b.clientX-(1==L?f:c)};s.addEventListener("mousedown",r,!1);t.addEventListener("mousedown",
r,!1);var O=function(b){1==L?e(b.clientX-N):h(b.clientX-N);a.dispatchEvent(B)},y=function(a){window.removeEventListener("mousemove",O,!1);window.removeEventListener("mouseup",y,!1)};return a}if("undefined"!==typeof e)var p=e("./utils").makeElement;"undefined"!==typeof t&&(t.exports=r)},{"./utils":47}],51:[function(e,t,s){t=e("./promise/promise").Promise;e=e("./promise/polyfill").polyfill;s.Promise=t;s.polyfill=e},{"./promise/polyfill":56,"./promise/promise":57}],52:[function(e,t,s){var r=e("./utils").isArray,
p=e("./utils").isFunction;s.all=function(e){if(!r(e))throw new TypeError("You must pass an array to all.");return new this(function(h,r){function s(b){return function(e){t[b]=e;0===--a&&h(t)}}var t=[],a=e.length,b;0===a&&h([]);for(var m=0;m<e.length;m++)(b=e[m])&&p(b.then)?b.then(s(m),r):(t[m]=b,0===--a&&h(t))})}},{"./utils":61}],53:[function(e,t,s){(function(e,p){function q(){return function(){e.nextTick(u)}}function h(){var b=0,f=new a(u),c=document.createTextNode("");f.observe(c,{characterData:!0});
return function(){c.data=b=++b%2}}function t(){return function(){b.setTimeout(u,1)}}function u(){for(var a=0;a<m.length;a++){var b=m[a];(0,b[0])(b[1])}m=[]}var z="undefined"!==typeof window?window:{},a=z.MutationObserver||z.WebKitMutationObserver,b="undefined"!==typeof p?p:void 0===this?window:this,m=[],g;g="undefined"!==typeof e&&"[object process]"==={}.toString.call(e)?q():a?h():t();s.asap=function(a,b){1===m.push([a,b])&&g()}}).call(this,e("1YiZ5S"),"undefined"!==typeof self?self:"undefined"!==
typeof window?window:{})},{"1YiZ5S":62}],54:[function(e,t,s){s.cast=function(e){return e&&"object"===typeof e&&e.constructor===this?e:new this(function(p){p(e)})}},{}],55:[function(e,t,s){var r={instrument:!1};s.config=r;s.configure=function(e,q){if(2===arguments.length)r[e]=q;else return r[e]}},{}],56:[function(e,t,s){(function(r){var p=e("./promise").Promise,q=e("./utils").isFunction;s.polyfill=function(){var e;e="undefined"!==typeof r?r:"undefined"!==typeof window&&window.document?window:self;
"Promise"in e&&"cast"in e.Promise&&"resolve"in e.Promise&&"reject"in e.Promise&&"all"in e.Promise&&"race"in e.Promise&&function(){var p;new e.Promise(function(e){p=e});return q(p)}()||(e.Promise=p)}}).call(this,"undefined"!==typeof self?self:"undefined"!==typeof window?window:{})},{"./promise":57,"./utils":61}],57:[function(e,t,s){function r(a){if(!c(a))throw new TypeError("You must pass a resolver function as the first argument to the promise constructor");if(!(this instanceof r))throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.");
this._subscribers=[];p(a,this)}function p(a,c){function d(a){z(c,a)}function f(a){b(c,a)}try{a(d,f)}catch(g){f(g)}}function q(a,f,d,g){var e=c(d),h,l,k,m;if(e)try{h=d(g),k=!0}catch(p){m=!0,l=p}else h=g,k=!0;u(f,h)||(e&&k?z(f,h):m?b(f,l):a===J?z(f,h):a===F&&b(f,h))}function h(a,b,d,c){a=a._subscribers;var f=a.length;a[f]=b;a[f+J]=d;a[f+F]=c}function w(a,b){for(var d,c,f=a._subscribers,g=a._detail,e=0;e<f.length;e+=3)d=f[e],c=f[e+b],q(b,d,c,g);a._subscribers=null}function u(g,e){var d=null,h;try{if(g===
e)throw new TypeError("A promises callback cannot return that same promise.");if(f(e)&&(d=e.then,c(d)))return d.call(e,function(d){if(h)return!0;h=!0;e!==d?z(g,d):a(g,d)},function(a){if(h)return!0;h=!0;b(g,a)}),!0}catch(k){if(h)return!0;b(g,k);return!0}return!1}function z(b,c){b===c?a(b,c):u(b,c)||a(b,c)}function a(a,b){a._state===O&&(a._state=y,a._detail=b,k.async(m,a))}function b(a,b){a._state===O&&(a._state=y,a._detail=b,k.async(g,a))}function m(a){w(a,a._state=J)}function g(a){w(a,a._state=F)}
var k=e("./config").config;e("./config");var f=e("./utils").objectOrFunction,c=e("./utils").isFunction;e("./utils");t=e("./cast").cast;var v=e("./all").all,B=e("./race").race,N=e("./resolve").resolve,L=e("./reject").reject;e=e("./asap").asap;k.async=e;var O=void 0,y=0,J=1,F=2;r.prototype={constructor:r,_state:void 0,_detail:void 0,_subscribers:void 0,then:function(a,b){var d=this,c=new this.constructor(function(){});if(this._state){var f=arguments;k.async(function(){q(d._state,c,f[d._state-1],d._detail)})}else h(this,
c,a,b);return c},"catch":function(a){return this.then(null,a)}};r.all=v;r.cast=t;r.race=B;r.resolve=N;r.reject=L;s.Promise=r},{"./all":52,"./asap":53,"./cast":54,"./config":55,"./race":58,"./reject":59,"./resolve":60,"./utils":61}],58:[function(e,t,s){var r=e("./utils").isArray;s.race=function(e){if(!r(e))throw new TypeError("You must pass an array to race.");return new this(function(q,h){for(var r,s=0;s<e.length;s++)(r=e[s])&&"function"===typeof r.then?r.then(q,h):q(r)})}},{"./utils":61}],59:[function(e,
t,s){s.reject=function(e){return new this(function(p,q){q(e)})}},{}],60:[function(e,t,s){s.resolve=function(e){return new this(function(p,q){p(e)})}},{}],61:[function(e,t,s){function r(e){return"function"===typeof e}e=Date.now||function(){return(new Date).getTime()};s.objectOrFunction=function(e){return r(e)||"object"===typeof e&&null!==e};s.isFunction=r;s.isArray=function(e){return"[object Array]"===Object.prototype.toString.call(e)};s.now=e},{}],62:[function(e,t,s){function r(){}e=t.exports={};
e.nextTick=function(){if("undefined"!==typeof window&&window.setImmediate)return function(e){return window.setImmediate(e)};if("undefined"!==typeof window&&window.postMessage&&window.addEventListener){var e=[];window.addEventListener("message",function(q){var h=q.source;h!==window&&null!==h||"process-tick"!==q.data||(q.stopPropagation(),0<e.length&&e.shift()())},!0);return function(q){e.push(q);window.postMessage("process-tick","*")}}return function(e){setTimeout(e,0)}}();e.title="browser";e.browser=
!0;e.env={};e.argv=[];e.on=r;e.addListener=r;e.once=r;e.off=r;e.removeListener=r;e.removeAllListeners=r;e.emit=r;e.binding=function(e){throw Error("process.binding is not supported");};e.cwd=function(){return"/"};e.chdir=function(e){throw Error("process.chdir is not supported");}},{}],63:[function(e,t,s){function r(){}function p(){this.was=[0]}function q(a,c,f){this.hufts=new Int32Array(3*b);this.window=new Uint8Array(f);this.end=f;this.checkfn=c;this.mode=v;this.reset(a,null);this.index=this.table=
this.left=0;this.blens=null;this.bb=new Int32Array(1);this.tb=new Int32Array(1);this.codes=new h;this.check=this.write=this.read=this.bitb=this.bitk=this.last=0;this.inftree=new w}function h(){}function w(){}function u(a,b,c,f,e){if(0!=e){if(!a)throw"Undef src";if(!c)throw"Undef dest";if(0==b&&e==a.length)c.set(a,f);else if(H)a=a.subarray(b,b+e),c.set(a,f);else if(1==a.BYTES_PER_ELEMENT&&100<e)a=new Uint8Array(a.buffer,a.byteOffset+b,e),c.set(a,f);else for(var g=0;g<e;++g)c[f+g]=a[b+g]}}function z(b,
c,e,h){b=c?e?new Uint8Array(b,c,e):new Uint8Array(b,c,b.byteLength-c):new Uint8Array(b);e=new r;e.inflateInit(a,!0);e.next_in=b;e.next_in_index=0;e.avail_in=b.length;b=[];for(var l=0;;){var p=new Uint8Array(32E3);e.next_out=p;e.next_out_index=0;e.avail_out=p.length;var q=e.inflate(m);if(q!=g&&q!=k&&q!=f)throw e.msg;if(0!=e.avail_out){var s=new Uint8Array(p.length-e.avail_out);u(p,0,s,0,p.length-e.avail_out);p=s}b.push(p);l+=p.length;if(q==k||q==f)break}h&&(h[0]=(c||0)+e.next_in_index);if(1==b.length)return b[0].buffer;
c=new Uint8Array(l);for(e=h=0;e<b.length;++e)l=b[e],u(l,0,c,h,l.length),h+=l.length;return c.buffer}var a=15,b=1440,m=0,g=0,k=1,f=-5,c=[0,1,3,7,15,31,63,127,255,511,1023,2047,4095,8191,16383,32767,65535],v=0,B=[96,7,256,0,8,80,0,8,16,84,8,115,82,7,31,0,8,112,0,8,48,0,9,192,80,7,10,0,8,96,0,8,32,0,9,160,0,8,0,0,8,128,0,8,64,0,9,224,80,7,6,0,8,88,0,8,24,0,9,144,83,7,59,0,8,120,0,8,56,0,9,208,81,7,17,0,8,104,0,8,40,0,9,176,0,8,8,0,8,136,0,8,72,0,9,240,80,7,4,0,8,84,0,8,20,85,8,227,83,7,43,0,8,116,0,
8,52,0,9,200,81,7,13,0,8,100,0,8,36,0,9,168,0,8,4,0,8,132,0,8,68,0,9,232,80,7,8,0,8,92,0,8,28,0,9,152,84,7,83,0,8,124,0,8,60,0,9,216,82,7,23,0,8,108,0,8,44,0,9,184,0,8,12,0,8,140,0,8,76,0,9,248,80,7,3,0,8,82,0,8,18,85,8,163,83,7,35,0,8,114,0,8,50,0,9,196,81,7,11,0,8,98,0,8,34,0,9,164,0,8,2,0,8,130,0,8,66,0,9,228,80,7,7,0,8,90,0,8,26,0,9,148,84,7,67,0,8,122,0,8,58,0,9,212,82,7,19,0,8,106,0,8,42,0,9,180,0,8,10,0,8,138,0,8,74,0,9,244,80,7,5,0,8,86,0,8,22,192,8,0,83,7,51,0,8,118,0,8,54,0,9,204,81,7,15,
0,8,102,0,8,38,0,9,172,0,8,6,0,8,134,0,8,70,0,9,236,80,7,9,0,8,94,0,8,30,0,9,156,84,7,99,0,8,126,0,8,62,0,9,220,82,7,27,0,8,110,0,8,46,0,9,188,0,8,14,0,8,142,0,8,78,0,9,252,96,7,256,0,8,81,0,8,17,85,8,131,82,7,31,0,8,113,0,8,49,0,9,194,80,7,10,0,8,97,0,8,33,0,9,162,0,8,1,0,8,129,0,8,65,0,9,226,80,7,6,0,8,89,0,8,25,0,9,146,83,7,59,0,8,121,0,8,57,0,9,210,81,7,17,0,8,105,0,8,41,0,9,178,0,8,9,0,8,137,0,8,73,0,9,242,80,7,4,0,8,85,0,8,21,80,8,258,83,7,43,0,8,117,0,8,53,0,9,202,81,7,13,0,8,101,0,8,37,0,
9,170,0,8,5,0,8,133,0,8,69,0,9,234,80,7,8,0,8,93,0,8,29,0,9,154,84,7,83,0,8,125,0,8,61,0,9,218,82,7,23,0,8,109,0,8,45,0,9,186,0,8,13,0,8,141,0,8,77,0,9,250,80,7,3,0,8,83,0,8,19,85,8,195,83,7,35,0,8,115,0,8,51,0,9,198,81,7,11,0,8,99,0,8,35,0,9,166,0,8,3,0,8,131,0,8,67,0,9,230,80,7,7,0,8,91,0,8,27,0,9,150,84,7,67,0,8,123,0,8,59,0,9,214,82,7,19,0,8,107,0,8,43,0,9,182,0,8,11,0,8,139,0,8,75,0,9,246,80,7,5,0,8,87,0,8,23,192,8,0,83,7,51,0,8,119,0,8,55,0,9,206,81,7,15,0,8,103,0,8,39,0,9,174,0,8,7,0,8,135,
0,8,71,0,9,238,80,7,9,0,8,95,0,8,31,0,9,158,84,7,99,0,8,127,0,8,63,0,9,222,82,7,27,0,8,111,0,8,47,0,9,190,0,8,15,0,8,143,0,8,79,0,9,254,96,7,256,0,8,80,0,8,16,84,8,115,82,7,31,0,8,112,0,8,48,0,9,193,80,7,10,0,8,96,0,8,32,0,9,161,0,8,0,0,8,128,0,8,64,0,9,225,80,7,6,0,8,88,0,8,24,0,9,145,83,7,59,0,8,120,0,8,56,0,9,209,81,7,17,0,8,104,0,8,40,0,9,177,0,8,8,0,8,136,0,8,72,0,9,241,80,7,4,0,8,84,0,8,20,85,8,227,83,7,43,0,8,116,0,8,52,0,9,201,81,7,13,0,8,100,0,8,36,0,9,169,0,8,4,0,8,132,0,8,68,0,9,233,80,
7,8,0,8,92,0,8,28,0,9,153,84,7,83,0,8,124,0,8,60,0,9,217,82,7,23,0,8,108,0,8,44,0,9,185,0,8,12,0,8,140,0,8,76,0,9,249,80,7,3,0,8,82,0,8,18,85,8,163,83,7,35,0,8,114,0,8,50,0,9,197,81,7,11,0,8,98,0,8,34,0,9,165,0,8,2,0,8,130,0,8,66,0,9,229,80,7,7,0,8,90,0,8,26,0,9,149,84,7,67,0,8,122,0,8,58,0,9,213,82,7,19,0,8,106,0,8,42,0,9,181,0,8,10,0,8,138,0,8,74,0,9,245,80,7,5,0,8,86,0,8,22,192,8,0,83,7,51,0,8,118,0,8,54,0,9,205,81,7,15,0,8,102,0,8,38,0,9,173,0,8,6,0,8,134,0,8,70,0,9,237,80,7,9,0,8,94,0,8,30,0,
9,157,84,7,99,0,8,126,0,8,62,0,9,221,82,7,27,0,8,110,0,8,46,0,9,189,0,8,14,0,8,142,0,8,78,0,9,253,96,7,256,0,8,81,0,8,17,85,8,131,82,7,31,0,8,113,0,8,49,0,9,195,80,7,10,0,8,97,0,8,33,0,9,163,0,8,1,0,8,129,0,8,65,0,9,227,80,7,6,0,8,89,0,8,25,0,9,147,83,7,59,0,8,121,0,8,57,0,9,211,81,7,17,0,8,105,0,8,41,0,9,179,0,8,9,0,8,137,0,8,73,0,9,243,80,7,4,0,8,85,0,8,21,80,8,258,83,7,43,0,8,117,0,8,53,0,9,203,81,7,13,0,8,101,0,8,37,0,9,171,0,8,5,0,8,133,0,8,69,0,9,235,80,7,8,0,8,93,0,8,29,0,9,155,84,7,83,0,8,
125,0,8,61,0,9,219,82,7,23,0,8,109,0,8,45,0,9,187,0,8,13,0,8,141,0,8,77,0,9,251,80,7,3,0,8,83,0,8,19,85,8,195,83,7,35,0,8,115,0,8,51,0,9,199,81,7,11,0,8,99,0,8,35,0,9,167,0,8,3,0,8,131,0,8,67,0,9,231,80,7,7,0,8,91,0,8,27,0,9,151,84,7,67,0,8,123,0,8,59,0,9,215,82,7,19,0,8,107,0,8,43,0,9,183,0,8,11,0,8,139,0,8,75,0,9,247,80,7,5,0,8,87,0,8,23,192,8,0,83,7,51,0,8,119,0,8,55,0,9,207,81,7,15,0,8,103,0,8,39,0,9,175,0,8,7,0,8,135,0,8,71,0,9,239,80,7,9,0,8,95,0,8,31,0,9,159,84,7,99,0,8,127,0,8,63,0,9,223,
82,7,27,0,8,111,0,8,47,0,9,191,0,8,15,0,8,143,0,8,79,0,9,255],N=[80,5,1,87,5,257,83,5,17,91,5,4097,81,5,5,89,5,1025,85,5,65,93,5,16385,80,5,3,88,5,513,84,5,33,92,5,8193,82,5,9,90,5,2049,86,5,129,192,5,24577,80,5,2,87,5,385,83,5,25,91,5,6145,81,5,7,89,5,1537,85,5,97,93,5,24577,80,5,4,88,5,769,84,5,49,92,5,12289,82,5,13,90,5,3073,86,5,193,192,5,24577],L=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],O=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,
5,5,0,112,112],y=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577],J=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13];r.prototype.inflateInit=function(b,c){b||(b=a);c&&(c=!1);this.istate=new p;return this.istate.inflateInit(this,c?-b:b)};r.prototype.inflate=function(a){return null==this.istate?-2:this.istate.inflate(this,a)};r.prototype.inflateEnd=function(){if(null==this.istate)return-2;var a=istate.inflateEnd(this);
this.istate=null;return a};r.prototype.inflateSync=function(){return istate.inflateSync(this)};r.prototype.inflateSetDictionary=function(a,b){return istate.inflateSetDictionary(this,a,b)};p.prototype.inflateReset=function(a){if(null==a||null==a.istate)return-2;a.total_in=a.total_out=0;a.msg=null;a.istate.mode=0!=a.istate.nowrap?7:0;a.istate.blocks.reset(a,null);return g};p.prototype.inflateEnd=function(a){null!=this.blocks&&this.blocks.free(a);this.blocks=null;return g};p.prototype.inflateInit=function(a,
b){this.blocks=a.msg=null;nowrap=0;0>b&&(b=-b,nowrap=1);if(8>b||15<b)return this.inflateEnd(a),-2;this.wbits=b;a.istate.blocks=new q(a,0!=a.istate.nowrap?null:this,1<<b);this.inflateReset(a);return g};p.prototype.inflate=function(a,b){var c,e;if(null==a||null==a.istate||null==a.next_in)return-2;b=4==b?f:g;for(c=f;;)switch(a.istate.mode){case 0:if(0==a.avail_in)return c;c=b;a.avail_in--;a.total_in++;if(8!=((a.istate.method=a.next_in[a.next_in_index++])&15)){a.istate.mode=13;a.msg="unknown compression method";
a.istate.marker=5;break}if((a.istate.method>>4)+8>a.istate.wbits){a.istate.mode=13;a.msg="invalid window size";a.istate.marker=5;break}a.istate.mode=1;case 1:if(0==a.avail_in)return c;c=b;a.avail_in--;a.total_in++;e=a.next_in[a.next_in_index++]&255;if(0!=((a.istate.method<<8)+e)%31){a.istate.mode=13;a.msg="incorrect header check";a.istate.marker=5;break}if(0==(e&32)){a.istate.mode=7;break}a.istate.mode=2;case 2:if(0==a.avail_in)return c;c=b;a.avail_in--;a.total_in++;a.istate.need=(a.next_in[a.next_in_index++]&
255)<<24&4278190080;a.istate.mode=3;case 3:if(0==a.avail_in)return c;c=b;a.avail_in--;a.total_in++;a.istate.need+=(a.next_in[a.next_in_index++]&255)<<16&16711680;a.istate.mode=4;case 4:if(0==a.avail_in)return c;c=b;a.avail_in--;a.total_in++;a.istate.need+=(a.next_in[a.next_in_index++]&255)<<8&65280;a.istate.mode=5;case 5:if(0==a.avail_in)return c;a.avail_in--;a.total_in++;a.istate.need+=a.next_in[a.next_in_index++]&255;a.adler=a.istate.need;a.istate.mode=6;return 2;case 6:return a.istate.mode=13,
a.msg="need dictionary",a.istate.marker=0,-2;case 7:c=a.istate.blocks.proc(a,c);if(-3==c){a.istate.mode=13;a.istate.marker=0;break}c==g&&(c=b);if(c!=k)return c;c=b;a.istate.blocks.reset(a,a.istate.was);if(0!=a.istate.nowrap){a.istate.mode=12;break}a.istate.mode=8;case 8:if(0==a.avail_in)return c;c=b;a.avail_in--;a.total_in++;a.istate.need=(a.next_in[a.next_in_index++]&255)<<24&4278190080;a.istate.mode=9;case 9:if(0==a.avail_in)return c;c=b;a.avail_in--;a.total_in++;a.istate.need+=(a.next_in[a.next_in_index++]&
255)<<16&16711680;a.istate.mode=10;case 10:if(0==a.avail_in)return c;c=b;a.avail_in--;a.total_in++;a.istate.need+=(a.next_in[a.next_in_index++]&255)<<8&65280;a.istate.mode=11;case 11:if(0==a.avail_in)return c;c=b;a.avail_in--;a.total_in++;a.istate.need+=a.next_in[a.next_in_index++]&255;if(a.istate.was[0]!=a.istate.need){a.istate.mode=13;a.msg="incorrect data check";a.istate.marker=5;break}a.istate.mode=12;case 12:return k;case 13:return-3;default:return-2}};p.prototype.inflateSetDictionary=function(a,
b,c){var e=0,f=c;if(null==a||null==a.istate||6!=a.istate.mode)return-2;if(a._adler.adler32(1,b,0,c)!=a.adler)return-3;a.adler=a._adler.adler32(0,null,0,0);f>=1<<a.istate.wbits&&(f=(1<<a.istate.wbits)-1,e=c-f);a.istate.blocks.set_dictionary(b,e,f);a.istate.mode=7;return g};var F=[0,0,255,255];p.prototype.inflateSync=function(a){var b,c,e;if(null==a||null==a.istate)return-2;13!=a.istate.mode&&(a.istate.mode=13,a.istate.marker=0);if(0==(b=a.avail_in))return f;c=a.next_in_index;for(e=a.istate.marker;0!=
b&&4>e;)a.next_in[c]==F[e]?e++:e=0!=a.next_in[c]?0:4-e,c++,b--;a.total_in+=c-a.next_in_index;a.next_in_index=c;a.avail_in=b;a.istate.marker=e;if(4!=e)return-3;b=a.total_in;c=a.total_out;this.inflateReset(a);a.total_in=b;a.total_out=c;a.istate.mode=7;return g};p.prototype.inflateSyncPoint=function(a){return null==a||null==a.istate||null==a.istate.blocks?-2:a.istate.blocks.sync_point()};var G=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];q.prototype.reset=function(a,b){b&&(b[0]=this.check);6==this.mode&&
this.codes.free(a);this.mode=v;this.read=this.write=this.bitb=this.bitk=0;this.checkfn&&(a.adler=this.check=a._adler.adler32(0,null,0,0))};q.prototype.proc=function(a,b){var e,f,h,m,p,q,n;m=a.next_in_index;p=a.avail_in;f=this.bitb;h=this.bitk;q=this.write;for(n=q<this.read?this.read-q-1:this.end-q;;)switch(this.mode){case v:for(;3>h;){if(0!=p)b=g;else return this.bitb=f,this.bitk=h,a.avail_in=p,a.total_in+=m-a.next_in_index,a.next_in_index=m,this.write=q,this.inflate_flush(a,b);p--;f|=(a.next_in[m++]&
255)<<h;h+=8}e=f&7;this.last=e&1;switch(e>>>1){case 0:f>>>=3;h-=3;e=h&7;f>>>=e;h-=e;this.mode=1;break;case 1:var r=new Int32Array(1),s=new Int32Array(1),t=[],w=[];e=s;var y=t,z=w;r[0]=9;e[0]=5;y[0]=B;z[0]=N;this.codes.init(r[0],s[0],t[0],0,w[0],0,a);f>>>=3;h-=3;this.mode=6;break;case 2:f>>>=3;h-=3;this.mode=3;break;case 3:return f>>>=3,h-=3,this.mode=13,a.msg="invalid block type",b=-3,this.bitb=f,this.bitk=h,a.avail_in=p,a.total_in+=m-a.next_in_index,a.next_in_index=m,this.write=q,this.inflate_flush(a,
b)}break;case 1:for(;32>h;){if(0!=p)b=g;else return this.bitb=f,this.bitk=h,a.avail_in=p,a.total_in+=m-a.next_in_index,a.next_in_index=m,this.write=q,this.inflate_flush(a,b);p--;f|=(a.next_in[m++]&255)<<h;h+=8}if((~f>>>16&65535)!=(f&65535))return this.mode=13,a.msg="invalid stored block lengths",b=-3,this.bitb=f,this.bitk=h,a.avail_in=p,a.total_in+=m-a.next_in_index,a.next_in_index=m,this.write=q,this.inflate_flush(a,b);this.left=f&65535;f=h=0;this.mode=0!=this.left?2:0!=this.last?7:v;break;case 2:if(0==
p)return this.bitb=f,this.bitk=h,a.avail_in=p,a.total_in+=m-a.next_in_index,a.next_in_index=m,write=q,this.inflate_flush(a,b);if(0==n&&(q==end&&0!=read&&(q=0,n=q<this.read?this.read-q-1:this.end-q),0==n&&(this.write=q,b=this.inflate_flush(a,b),q=this.write,n=q<this.read?this.read-q-1:this.end-q,q==this.end&&0!=this.read&&(q=0,n=q<this.read?this.read-q-1:this.end-q),0==n)))return this.bitb=f,this.bitk=h,a.avail_in=p,a.total_in+=m-a.next_in_index,a.next_in_index=m,this.write=q,this.inflate_flush(a,
b);b=g;e=this.left;e>p&&(e=p);e>n&&(e=n);u(a.next_in,m,window,q,e);m+=e;p-=e;q+=e;n-=e;if(0!=(this.left-=e))break;this.mode=0!=this.last?7:v;break;case 3:for(;14>h;){if(0!=p)b=g;else return this.bitb=f,this.bitk=h,a.avail_in=p,a.total_in+=m-a.next_in_index,a.next_in_index=m,this.write=q,this.inflate_flush(a,b);p--;f|=(a.next_in[m++]&255)<<h;h+=8}this.table=e=f&16383;if(29<(e&31)||29<(e>>5&31))return this.mode=9,a.msg="too many length or distance symbols",b=-3,this.bitb=f,this.bitk=h,a.avail_in=p,
a.total_in+=m-a.next_in_index,a.next_in_index=m,this.write=q,this.inflate_flush(a,b);e=258+(e&31)+(e>>5&31);if(null==this.blens||this.blens.length<e)this.blens=new Int32Array(e);else for(n=0;n<e;n++)this.blens[n]=0;f>>>=14;h-=14;this.index=0;mode=4;case 4:for(;this.index<4+(this.table>>>10);){for(;3>h;){if(0!=p)b=g;else return this.bitb=f,this.bitk=h,a.avail_in=p,a.total_in+=m-a.next_in_index,a.next_in_index=m,this.write=q,this.inflate_flush(a,b);p--;f|=(a.next_in[m++]&255)<<h;h+=8}this.blens[G[this.index++]]=
f&7;f>>>=3;h-=3}for(;19>this.index;)this.blens[G[this.index++]]=0;this.bb[0]=7;e=this.inftree.inflate_trees_bits(this.blens,this.bb,this.tb,this.hufts,a);if(e!=g)return b=e,-3==b&&(this.blens=null,this.mode=9),this.bitb=f,this.bitk=h,a.avail_in=p,a.total_in+=m-a.next_in_index,a.next_in_index=m,write=q,this.inflate_flush(a,b);this.index=0;this.mode=5;case 5:for(;;){e=this.table;if(!(this.index<258+(e&31)+(e>>5&31)))break;for(e=this.bb[0];h<e;){if(0!=p)b=g;else return this.bitb=f,this.bitk=h,a.avail_in=
p,a.total_in+=m-a.next_in_index,a.next_in_index=m,this.write=q,this.inflate_flush(a,b);p--;f|=(a.next_in[m++]&255)<<h;h+=8}e=this.hufts[3*(this.tb[0]+(f&c[e]))+1];s=this.hufts[3*(this.tb[0]+(f&c[e]))+2];if(16>s)f>>>=e,h-=e,this.blens[this.index++]=s;else{n=18==s?7:s-14;for(r=18==s?11:3;h<e+n;){if(0!=p)b=g;else return this.bitb=f,this.bitk=h,a.avail_in=p,a.total_in+=m-a.next_in_index,a.next_in_index=m,this.write=q,this.inflate_flush(a,b);p--;f|=(a.next_in[m++]&255)<<h;h+=8}f>>>=e;h-=e;r+=f&c[n];f>>>=
n;h-=n;n=this.index;e=this.table;if(n+r>258+(e&31)+(e>>5&31)||16==s&&1>n)return this.blens=null,this.mode=9,a.msg="invalid bit length repeat",b=-3,this.bitb=f,this.bitk=h,a.avail_in=p,a.total_in+=m-a.next_in_index,a.next_in_index=m,this.write=q,this.inflate_flush(a,b);s=16==s?this.blens[n-1]:0;do this.blens[n++]=s;while(0!=--r);this.index=n}}this.tb[0]=-1;r=new Int32Array(1);s=new Int32Array(1);t=new Int32Array(1);w=new Int32Array(1);r[0]=9;s[0]=6;e=this.table;e=this.inftree.inflate_trees_dynamic(257+
(e&31),1+(e>>5&31),this.blens,r,s,t,w,this.hufts,a);if(e!=g)return-3==e&&(this.blens=null,this.mode=13),b=e,this.bitb=f,this.bitk=h,a.avail_in=p,a.total_in+=m-a.next_in_index,a.next_in_index=m,this.write=q,this.inflate_flush(a,b);this.codes.init(r[0],s[0],this.hufts,t[0],this.hufts,w[0],a);this.mode=6;case 6:this.bitb=f;this.bitk=h;a.avail_in=p;a.total_in+=m-a.next_in_index;a.next_in_index=m;this.write=q;if((b=this.codes.proc(this,a,b))!=k)return this.inflate_flush(a,b);b=g;this.codes.free(a);m=a.next_in_index;
p=a.avail_in;f=this.bitb;h=this.bitk;q=this.write;n=q<this.read?this.read-q-1:this.end-q;if(0==this.last){this.mode=v;break}this.mode=7;case 7:this.write=q;b=this.inflate_flush(a,b);q=this.write;if(this.read!=this.write)return this.bitb=f,this.bitk=h,a.avail_in=p,a.total_in+=m-a.next_in_index,a.next_in_index=m,this.write=q,this.inflate_flush(a,b);mode=12;case 8:return b=k,this.bitb=f,this.bitk=h,a.avail_in=p,a.total_in+=m-a.next_in_index,a.next_in_index=m,this.write=q,this.inflate_flush(a,b);case 9:return b=
-3,this.bitb=f,this.bitk=h,a.avail_in=p,a.total_in+=m-a.next_in_index,a.next_in_index=m,this.write=q,this.inflate_flush(a,b);default:return b=-2,this.bitb=f,this.bitk=h,a.avail_in=p,a.total_in+=m-a.next_in_index,a.next_in_index=m,this.write=q,this.inflate_flush(a,b)}};q.prototype.free=function(a){this.reset(a,null);this.hufts=this.window=null};q.prototype.set_dictionary=function(a,b,c){u(a,b,window,0,c);this.read=this.write=c};q.prototype.sync_point=function(){return 1==this.mode};q.prototype.inflate_flush=
function(a,b){var c,e,h;e=a.next_out_index;h=this.read;c=(h<=this.write?this.write:this.end)-h;c>a.avail_out&&(c=a.avail_out);0!=c&&b==f&&(b=g);a.avail_out-=c;a.total_out+=c;null!=this.checkfn&&(a.adler=this.check=a._adler.adler32(this.check,this.window,h,c));u(this.window,h,a.next_out,e,c);e+=c;h+=c;h==this.end&&(h=0,this.write==this.end&&(this.write=0),c=this.write-h,c>a.avail_out&&(c=a.avail_out),0!=c&&b==f&&(b=g),a.avail_out-=c,a.total_out+=c,null!=this.checkfn&&(a.adler=this.check=a._adler.adler32(this.check,
this.window,h,c)),u(this.window,h,a.next_out,e,c),e+=c,h+=c);a.next_out_index=e;this.read=h;return b};h.prototype.init=function(a,b,c,e,f,g,h){this.mode=0;this.lbits=a;this.dbits=b;this.ltree=c;this.ltree_index=e;this.dtree=f;this.dtree_index=g;this.tree=null};h.prototype.proc=function(a,b,e){var f,h,m=0,p=0,q=0,n,r,s,q=b.next_in_index;n=b.avail_in;m=a.bitb;p=a.bitk;r=a.write;for(s=r<a.read?a.read-r-1:a.end-r;;)switch(this.mode){case 0:if(258<=s&&10<=n&&(a.bitb=m,a.bitk=p,b.avail_in=n,b.total_in+=
q-b.next_in_index,b.next_in_index=q,a.write=r,e=this.inflate_fast(this.lbits,this.dbits,this.ltree,this.ltree_index,this.dtree,this.dtree_index,a,b),q=b.next_in_index,n=b.avail_in,m=a.bitb,p=a.bitk,r=a.write,s=r<a.read?a.read-r-1:a.end-r,e!=g)){this.mode=e==k?7:9;break}this.need=this.lbits;this.tree=this.ltree;this.tree_index=this.ltree_index;this.mode=1;case 1:for(f=this.need;p<f;){if(0!=n)e=g;else return a.bitb=m,a.bitk=p,b.avail_in=n,b.total_in+=q-b.next_in_index,b.next_in_index=q,a.write=r,a.inflate_flush(b,
e);n--;m|=(b.next_in[q++]&255)<<p;p+=8}f=3*(this.tree_index+(m&c[f]));m>>>=this.tree[f+1];p-=this.tree[f+1];h=this.tree[f];if(0==h){this.lit=this.tree[f+2];this.mode=6;break}if(0!=(h&16)){this.get=h&15;this.len=this.tree[f+2];this.mode=2;break}if(0==(h&64)){this.need=h;this.tree_index=f/3+this.tree[f+2];break}if(0!=(h&32)){this.mode=7;break}this.mode=9;b.msg="invalid literal/length code";e=-3;a.bitb=m;a.bitk=p;b.avail_in=n;b.total_in+=q-b.next_in_index;b.next_in_index=q;a.write=r;return a.inflate_flush(b,
e);case 2:for(f=this.get;p<f;){if(0!=n)e=g;else return a.bitb=m,a.bitk=p,b.avail_in=n,b.total_in+=q-b.next_in_index,b.next_in_index=q,a.write=r,a.inflate_flush(b,e);n--;m|=(b.next_in[q++]&255)<<p;p+=8}this.len+=m&c[f];m>>=f;p-=f;this.need=this.dbits;this.tree=this.dtree;this.tree_index=this.dtree_index;this.mode=3;case 3:for(f=this.need;p<f;){if(0!=n)e=g;else return a.bitb=m,a.bitk=p,b.avail_in=n,b.total_in+=q-b.next_in_index,b.next_in_index=q,a.write=r,a.inflate_flush(b,e);n--;m|=(b.next_in[q++]&
255)<<p;p+=8}f=3*(this.tree_index+(m&c[f]));m>>=this.tree[f+1];p-=this.tree[f+1];h=this.tree[f];if(0!=(h&16)){this.get=h&15;this.dist=this.tree[f+2];this.mode=4;break}if(0==(h&64)){this.need=h;this.tree_index=f/3+this.tree[f+2];break}this.mode=9;b.msg="invalid distance code";e=-3;a.bitb=m;a.bitk=p;b.avail_in=n;b.total_in+=q-b.next_in_index;b.next_in_index=q;a.write=r;return a.inflate_flush(b,e);case 4:for(f=this.get;p<f;){if(0!=n)e=g;else return a.bitb=m,a.bitk=p,b.avail_in=n,b.total_in+=q-b.next_in_index,
b.next_in_index=q,a.write=r,a.inflate_flush(b,e);n--;m|=(b.next_in[q++]&255)<<p;p+=8}this.dist+=m&c[f];m>>=f;p-=f;this.mode=5;case 5:for(f=r-this.dist;0>f;)f+=a.end;for(;0!=this.len;){if(0==s&&(r==a.end&&0!=a.read&&(r=0,s=r<a.read?a.read-r-1:a.end-r),0==s&&(a.write=r,e=a.inflate_flush(b,e),r=a.write,s=r<a.read?a.read-r-1:a.end-r,r==a.end&&0!=a.read&&(r=0,s=r<a.read?a.read-r-1:a.end-r),0==s)))return a.bitb=m,a.bitk=p,b.avail_in=n,b.total_in+=q-b.next_in_index,b.next_in_index=q,a.write=r,a.inflate_flush(b,
e);a.window[r++]=a.window[f++];s--;f==a.end&&(f=0);this.len--}this.mode=0;break;case 6:if(0==s&&(r==a.end&&0!=a.read&&(r=0,s=r<a.read?a.read-r-1:a.end-r),0==s&&(a.write=r,e=a.inflate_flush(b,e),r=a.write,s=r<a.read?a.read-r-1:a.end-r,r==a.end&&0!=a.read&&(r=0,s=r<a.read?a.read-r-1:a.end-r),0==s)))return a.bitb=m,a.bitk=p,b.avail_in=n,b.total_in+=q-b.next_in_index,b.next_in_index=q,a.write=r,a.inflate_flush(b,e);e=g;a.window[r++]=this.lit;s--;this.mode=0;break;case 7:7<p&&(p-=8,n++,q--);a.write=r;
e=a.inflate_flush(b,e);r=a.write;if(a.read!=a.write)return a.bitb=m,a.bitk=p,b.avail_in=n,b.total_in+=q-b.next_in_index,b.next_in_index=q,a.write=r,a.inflate_flush(b,e);this.mode=8;case 8:return e=k,a.bitb=m,a.bitk=p,b.avail_in=n,b.total_in+=q-b.next_in_index,b.next_in_index=q,a.write=r,a.inflate_flush(b,e);case 9:return e=-3,a.bitb=m,a.bitk=p,b.avail_in=n,b.total_in+=q-b.next_in_index,b.next_in_index=q,a.write=r,a.inflate_flush(b,e);default:return e=-2,a.bitb=m,a.bitk=p,b.avail_in=n,b.total_in+=
q-b.next_in_index,b.next_in_index=q,a.write=r,a.inflate_flush(b,e)}};h.prototype.free=function(a){};h.prototype.inflate_fast=function(a,b,e,f,h,m,p,q){var n,r,s,t,v,w,y,z,B,G,F,H;w=q.next_in_index;y=q.avail_in;t=p.bitb;v=p.bitk;z=p.write;B=z<p.read?p.read-z-1:p.end-z;a=c[a];G=c[b];do{for(;20>v;)y--,t|=(q.next_in[w++]&255)<<v,v+=8;n=t&a;r=e;s=f;H=3*(s+n);if(0==(b=r[H]))t>>=r[H+1],v-=r[H+1],p.window[z++]=r[H+2],B--;else{do{t>>=r[H+1];v-=r[H+1];if(0!=(b&16)){b&=15;F=r[H+2]+(t&c[b]);t>>=b;for(v-=b;15>
v;)y--,t|=(q.next_in[w++]&255)<<v,v+=8;n=t&G;r=h;s=m;H=3*(s+n);b=r[H];do if(t>>=r[H+1],v-=r[H+1],0!=(b&16)){for(b&=15;v<b;)y--,t|=(q.next_in[w++]&255)<<v,v+=8;n=r[H+2]+(t&c[b]);t>>=b;v-=b;B-=F;if(z>=n)n=z-n,p.window[z++]=p.window[n++],p.window[z++]=p.window[n++],F-=2;else{n=z-n;do n+=p.end;while(0>n);b=p.end-n;if(F>b){F-=b;if(0<z-n&&b>z-n){do p.window[z++]=p.window[n++];while(0!=--b)}else u(p.window,n,p.window,z,b),z+=b;n=0}}do p.window[z++]=p.window[n++];while(0!=--F);break}else if(0==(b&64))n+=
r[H+2],n+=t&c[b],H=3*(s+n),b=r[H];else return q.msg="invalid distance code",F=q.avail_in-y,F=v>>3<F?v>>3:F,y+=F,w-=F,v-=F<<3,p.bitb=t,p.bitk=v,q.avail_in=y,q.total_in+=w-q.next_in_index,q.next_in_index=w,p.write=z,-3;while(1);break}if(0==(b&64)){if(n+=r[H+2],n+=t&c[b],H=3*(s+n),0==(b=r[H])){t>>=r[H+1];v-=r[H+1];p.window[z++]=r[H+2];B--;break}}else{if(0!=(b&32))return F=q.avail_in-y,F=v>>3<F?v>>3:F,y+=F,w-=F,v-=F<<3,p.bitb=t,p.bitk=v,q.avail_in=y,q.total_in+=w-q.next_in_index,q.next_in_index=w,p.write=
z,k;q.msg="invalid literal/length code";F=q.avail_in-y;F=v>>3<F?v>>3:F;y+=F;w-=F;v-=F<<3;p.bitb=t;p.bitk=v;q.avail_in=y;q.total_in+=w-q.next_in_index;q.next_in_index=w;p.write=z;return-3}}while(1)}}while(258<=B&&10<=y);F=q.avail_in-y;F=v>>3<F?v>>3:F;w-=F;p.bitb=t;p.bitk=v-(F<<3);q.avail_in=y+F;q.total_in+=w-q.next_in_index;q.next_in_index=w;p.write=z;return g};w.prototype.huft_build=function(a,c,e,h,k,m,p,q,n,r,s){var t,v,w,z,y,B,F,G,H;B=0;v=e;do this.c[a[c+B]]++,B++,v--;while(0!=v);if(this.c[0]==
e)return p[0]=-1,q[0]=0,g;y=q[0];for(w=1;15>=w&&0==this.c[w];w++);z=w;y<w&&(y=w);for(v=15;0!=v&&0==this.c[v];v--);r=v;y>v&&(y=v);q[0]=y;for(q=1<<w;w<v;w++,q<<=1)if(0>(q-=this.c[w]))return-3;if(0>(q-=this.c[v]))return-3;this.c[v]+=q;this.x[1]=w=0;B=1;for(F=2;0!=--v;)this.x[F]=w+=this.c[B],F++,B++;B=v=0;do 0!=(w=a[c+B])&&(this.v[this.x[w]++]=v),B++;while(++v<e);e=this.x[r];B=this.x[0]=v=0;c=-1;G=-y;for(H=F=this.u[0]=0;z<=r;z++)for(a=this.c[z];0!=a--;){for(;z>G+y;){c++;G+=y;H=r-G;H=H>y?y:H;if((t=1<<
(w=z-G))>a+1&&(t-=a+1,F=z,w<H))for(;++w<H&&!((t<<=1)<=this.c[++F]);)t-=this.c[F];H=1<<w;if(this.hn[0]+H>b)return-3;this.u[c]=F=this.hn[0];this.hn[0]+=H;0!=c?(this.x[c]=v,this.r[0]=w,this.r[1]=y,w=v>>>G-y,this.r[2]=F-this.u[c-1]-w,u(this.r,0,n,3*(this.u[c-1]+w),3)):p[0]=F}this.r[1]=z-G;B>=e?this.r[0]=192:s[B]<h?(this.r[0]=256>this.v[B]?0:96,this.r[2]=this.v[B++]):(this.r[0]=m[this.v[B]-h]+16+64,this.r[2]=k[this.v[B++]-h]);t=1<<z-G;for(w=v>>>G;w<H;w+=t)u(this.r,0,n,3*(F+w),3);for(w=1<<z-1;0!=(v&w);w>>>=
1)v^=w;v^=w;for(w=(1<<G)-1;(v&w)!=this.x[c];)c--,G-=y,w=(1<<G)-1}return 0!=q&&1!=r?f:g};w.prototype.inflate_trees_bits=function(a,b,c,e,g){this.initWorkArea(19);this.hn[0]=0;a=this.huft_build(a,0,19,19,null,null,c,b,e,this.hn,this.v);if(-3==a)g.msg="oversubscribed dynamic bit lengths tree";else if(a==f||0==b[0])g.msg="incomplete dynamic bit lengths tree",a=-3;return a};w.prototype.inflate_trees_dynamic=function(a,b,c,e,h,k,m,p,n){this.initWorkArea(288);this.hn[0]=0;k=this.huft_build(c,0,a,257,L,O,
k,e,p,this.hn,this.v);if(k!=g||0==e[0])return-3==k?n.msg="oversubscribed literal/length tree":-4!=k&&(n.msg="incomplete literal/length tree",k=-3),k;this.initWorkArea(288);k=this.huft_build(c,a,b,0,y,J,m,h,p,this.hn,this.v);return k!=g||0==h[0]&&257<a?(-3==k?n.msg="oversubscribed distance tree":k==f?(n.msg="incomplete distance tree",k=-3):-4!=k&&(n.msg="empty distance tree with lengths",k=-3),k):g};w.prototype.initWorkArea=function(a){null==this.hn&&(this.hn=new Int32Array(1),this.v=new Int32Array(a),
this.c=new Int32Array(16),this.r=new Int32Array(3),this.u=new Int32Array(15),this.x=new Int32Array(16));this.v.length<a&&(this.v=new Int32Array(a));for(var b=0;b<a;b++)this.v[b]=0;for(b=0;16>b;b++)this.c[b]=0;for(b=0;3>b;b++)this.r[b]=0;u(this.c,0,this.u,0,15);u(this.c,0,this.x,0,16)};var H="function"===typeof(new Uint8Array(1)).subarray;"undefined"!==typeof t&&(t.exports={inflateBuffer:z,arrayCopy:u})},{}]},{},[16]);
